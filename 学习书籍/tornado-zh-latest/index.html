

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tornado 4.3 文档</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
        <link rel="index" title="索引"
              href="genindex.html"/>
        <link rel="search" title="搜索" href="search.html"/>
    <link rel="top" title="None" href="index.html#document-index"/> 

  
  <script src="_static/js/modernizr.min.js"></script>


<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://tornado-zh.readthedocs.io/zh/latest/" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'index'
</script>

<script type="text/javascript" src="_static/readthedocs-dynamic-include.js"></script>

<!-- end RTD <extrahead> --></head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html#document-index" class="icon icon-home"> Tornado
          

          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-guide">用户指南</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-guide/intro">介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-guide/async">异步和非阻塞I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-guide/coroutines">协程</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-guide/queues"><code class="docutils literal"><span class="pre">Queue</span></code> 示例 - 一个并发网络爬虫</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-guide/structure">Tornado web应用的结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-guide/templates">模板和UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-guide/security">认证和安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-guide/running">运行和部署</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-webframework">web框架</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-web"><code class="docutils literal"><span class="pre">tornado.web</span></code> &#8212; <code class="docutils literal"><span class="pre">RequestHandler</span></code> 和 <code class="docutils literal"><span class="pre">Application</span></code> 类</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-template"><code class="docutils literal"><span class="pre">tornado.template</span></code> &#8212; 产生灵活的输出</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-escape"><code class="docutils literal"><span class="pre">tornado.escape</span></code> &#8212; 转义和字符串操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-locale"><code class="docutils literal"><span class="pre">tornado.locale</span></code> &#8212; 国际化支持</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-websocket"><code class="docutils literal"><span class="pre">tornado.websocket</span></code> &#8212; 浏览器与服务器双向通信</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-http">HTTP servers and clients</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-httpserver"><code class="docutils literal"><span class="pre">tornado.httpserver</span></code> &#8212; 非阻塞 HTTP server</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-httpclient"><code class="docutils literal"><span class="pre">tornado.httpclient</span></code> &#8212; 异步 HTTP 客户端</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-httputil"><code class="docutils literal"><span class="pre">tornado.httputil</span></code> &#8212; Manipulate HTTP headers and URLs</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-http1connection"><code class="docutils literal"><span class="pre">tornado.http1connection</span></code> &#8211; HTTP/1.x client/server implementation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-networking">异步网络</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-ioloop"><code class="docutils literal"><span class="pre">tornado.ioloop</span></code> &#8212; Main event loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-iostream"><code class="docutils literal"><span class="pre">tornado.iostream</span></code> &#8212; Convenient wrappers for non-blocking sockets</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-netutil"><code class="docutils literal"><span class="pre">tornado.netutil</span></code> &#8212; Miscellaneous network utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tcpclient"><code class="docutils literal"><span class="pre">tornado.tcpclient</span></code> &#8212; <code class="docutils literal"><span class="pre">IOStream</span></code> connection factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tcpserver"><code class="docutils literal"><span class="pre">tornado.tcpserver</span></code> &#8212; 基于 <code class="docutils literal"><span class="pre">IOStream</span></code> 的基础 TCP 服务</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-coroutine">协程和并发</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-gen"><code class="docutils literal"><span class="pre">tornado.gen</span></code> &#8212; Simplify asynchronous code</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-concurrent"><code class="docutils literal"><span class="pre">tornado.concurrent</span></code> &#8212; Work with threads and futures</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-locks"><code class="docutils literal"><span class="pre">tornado.locks</span></code> &#8211; 同步原语</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-queues"><code class="docutils literal"><span class="pre">tornado.queues</span></code> &#8211; 协程的队列</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-process"><code class="docutils literal"><span class="pre">tornado.process</span></code> &#8212; Utilities for multiple processes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-integration">与其他服务集成</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-auth"><code class="docutils literal"><span class="pre">tornado.auth</span></code> &#8212; Third-party login with OpenID and OAuth</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-wsgi"><code class="docutils literal"><span class="pre">tornado.wsgi</span></code> &#8212; Interoperability with other Python frameworks and servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-asyncio"><code class="docutils literal"><span class="pre">tornado.platform.asyncio</span></code> &#8212; Bridge between <code class="docutils literal"><span class="pre">asyncio</span></code> and Tornado</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-caresresolver"><code class="docutils literal"><span class="pre">tornado.platform.caresresolver</span></code> &#8212; Asynchronous DNS Resolver using C-Ares</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-twisted"><code class="docutils literal"><span class="pre">tornado.platform.twisted</span></code> &#8212; Bridges between Twisted and Tornado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-utilities">通用工具</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-autoreload"><code class="docutils literal"><span class="pre">tornado.autoreload</span></code> &#8212; Automatically detect code changes in development</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-log"><code class="docutils literal"><span class="pre">tornado.log</span></code> &#8212; Logging support</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-options"><code class="docutils literal"><span class="pre">tornado.options</span></code> &#8212; Command-line parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-stack_context"><code class="docutils literal"><span class="pre">tornado.stack_context</span></code> &#8212; Exception handling across asynchronous callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-testing"><code class="docutils literal"><span class="pre">tornado.testing</span></code> &#8212; Unit testing support for asynchronous code</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-util"><code class="docutils literal"><span class="pre">tornado.util</span></code> &#8212; General-purpose utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-faq">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-releases">版本记录</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v4.3.0">What&#8217;s new in Tornado 4.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v4.2.1">What&#8217;s new in Tornado 4.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v4.2.0">What&#8217;s new in Tornado 4.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v4.1.0">What&#8217;s new in Tornado 4.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v4.0.2">What&#8217;s new in Tornado 4.0.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v4.0.1">What&#8217;s new in Tornado 4.0.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v4.0.0">What&#8217;s new in Tornado 4.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v3.2.2">What&#8217;s new in Tornado 3.2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v3.2.1">What&#8217;s new in Tornado 3.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v3.2.0">What&#8217;s new in Tornado 3.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v3.1.1">What&#8217;s new in Tornado 3.1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v3.1.0">What&#8217;s new in Tornado 3.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v3.0.2">What&#8217;s new in Tornado 3.0.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v3.0.1">What&#8217;s new in Tornado 3.0.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v3.0.0">What&#8217;s new in Tornado 3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v2.4.1">What&#8217;s new in Tornado 2.4.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v2.4.0">What&#8217;s new in Tornado 2.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v2.3.0">What&#8217;s new in Tornado 2.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v2.2.1">What&#8217;s new in Tornado 2.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v2.2.0">What&#8217;s new in Tornado 2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v2.1.1">What&#8217;s new in Tornado 2.1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v2.1.0">What&#8217;s new in Tornado 2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v2.0.0">What&#8217;s new in Tornado 2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v1.2.1">What&#8217;s new in Tornado 1.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v1.2.0">What&#8217;s new in Tornado 1.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v1.1.1">What&#8217;s new in Tornado 1.1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v1.1.0">What&#8217;s new in Tornado 1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v1.0.1">What&#8217;s new in Tornado 1.0.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-releases/v1.0.0">What&#8217;s new in Tornado 1.0</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html#document-index">Tornado</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html#document-index">Docs</a> &raquo;</li>
        
      <li>Tornado 4.3 文档</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/tao12345666333/tornado-zh/blob/master/docs/index.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tornado-web-server">
<h1><img alt="Tornado Web Server" src="_images/tornado.png" /><a class="headerlink" href="#tornado-web-server" title="永久链接至标题">¶</a></h1>
<p><a class="reference external" href="http://www.tornadoweb.org">Tornado</a> 是一个Python web框架和异步网络库，起初由 <a class="reference external" href="http://friendfeed.com">FriendFeed</a> 开发. 通过使用非阻塞网络I/O， Tornado可以支撑上万级的连接，处理 <a class="reference external" href="http://en.wikipedia.org/wiki/Push_technology#Long_polling">长连接</a>,
<a class="reference external" href="http://en.wikipedia.org/wiki/WebSocket">WebSockets</a> ，和其他需要与每个用户保持长久连接的应用.</p>
<div class="section" id="id2">
<h2>相关链接<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://github.com/tornadoweb/tornadohttps://pypi.python.org/packages/source/t/tornado/tornado-4.3.tar.gz">下载当前4.3版本</a></li>
<li><a class="reference external" href="https://github.com/tornadoweb/tornado">源码 (github)</a></li>
<li>邮件列表: <a class="reference external" href="http://groups.google.com/group/python-tornado">discussion</a> and <a class="reference external" href="http://groups.google.com/group/python-tornado-announce">announcements</a></li>
<li><a class="reference external" href="http://stackoverflow.com/questions/tagged/tornado">Stack Overflow</a></li>
<li><a class="reference external" href="https://github.com/tornadoweb/tornado/wiki/Links">Wiki</a></li>
</ul>
</div>
<div class="section" id="hello-world">
<h2>Hello, world<a class="headerlink" href="#hello-world" title="永久链接至标题">¶</a></h2>
<p>这是一个简单的Tornado的web应用:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tornado.ioloop</span>
<span class="kn">import</span> <span class="nn">tornado.web</span>

<span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">make_app</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
    <span class="p">])</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">make_app</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
    <span class="n">tornado</span><span class="o">.</span><span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>这个例子没有使用Tornado的任何异步特性;了解详情请看 <a class="reference external" href="https://github.com/tornadoweb/tornado/tree/stable/demos/chat">simple chat room</a>.</p>
</div>
<div class="section" id="id4">
<h2>安装<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p><strong>自动安装</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">tornado</span>
</pre></div>
</div>
<p>Tornado在 <a class="reference external" href="http://pypi.python.org/pypi/tornado">PyPI</a> 列表中，可以使用 <code class="docutils literal"><span class="pre">pip</span></code> 或 <code class="docutils literal"><span class="pre">easy_install</span></code> 安装. 注意源码发布中包含的示例应用可能不会出现在这种方式安装的代码中，所以你也可能希望通过下载一份源码包的拷贝来进行安装.</p>
<p><strong>手动安装</strong>: 下载当前4.3版本:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="n">xvzf</span> <span class="n">tornado</span><span class="o">-</span><span class="mf">4.3</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">cd</span> <span class="n">tornado</span><span class="o">-</span><span class="mf">4.3</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">build</span>
<span class="n">sudo</span> <span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>
</div>
<p>Tornado的源码托管在 <a class="reference external" href="https://github.com/tornadoweb/tornado">hosted on GitHub</a>.</p>
<p><strong>Prerequisites</strong>: Tornado 4.3 运行在Python 2.6, 2.7, 和 3.2+
(对Python 2.6 和 3.2的支持是不推荐的并将在下个版本中移除). 对Python 2的2.7.9或更新版 <em>强烈</em>
推荐提高对SSL支持. 另外Tornado的依赖包可能通过 <code class="docutils literal"><span class="pre">pip</span></code> or <code class="docutils literal"><span class="pre">setup.py</span> <span class="pre">install</span></code> 被自动安装,
下面这些可选包可能是有用的:</p>
<ul class="simple">
<li><a class="reference external" href="https://pypi.python.org/pypi/unittest2">unittest2</a> 是用来在Python 2.6上运行Tornado的测试用例的(更高版本的Python是不需要的)</li>
<li><a class="reference external" href="https://pypi.python.org/pypi/futures">concurrent.futures</a> 是推荐配合Tornado使用的线程池并且可以支持 <a class="reference internal" href="index.html#tornado.netutil.ThreadedResolver" title="tornado.netutil.ThreadedResolver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil.ThreadedResolver</span></code></a> 的用法. 它只在Python 2中被需要，Python 3已经包括了这个标准库.</li>
<li><a class="reference external" href="http://pycurl.sourceforge.net">pycurl</a> 是在
<code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code> 中可选使用的.需要Libcurl 7.19.3.1 或更高版本;推荐使用7.21.1或更高版本.</li>
<li><a class="reference external" href="http://www.twistedmatrix.com">Twisted</a> 会在
<a class="reference internal" href="index.html#module-tornado.platform.twisted" title="tornado.platform.twisted"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.twisted</span></code></a> 中使用.</li>
<li><a class="reference external" href="https://pypi.python.org/pypi/pycares">pycares</a> 是一个当线程不适用情况下的非阻塞DNS解决方案.</li>
<li><a class="reference external" href="https://pypi.python.org/pypi/Monotime">Monotime</a> 添加对monotonic clock的支持,当环境中的时钟被频繁调整的时候，改善其可靠性. 在Python 3.3中不再需要.</li>
</ul>
<p><strong>平台</strong>: Tornado可以运行在任何类Unix平台上,虽然为了最好的性能和可扩展性
只有Linux(使用 <code class="docutils literal"><span class="pre">epoll</span></code>)和BSD(使用 <code class="docutils literal"><span class="pre">kqueue</span></code>)是推荐的产品部署环境(尽管Mac OS X通过BSD发展来并且支持kqueue,但它的网络质量很差，所以它只适合开发使用)
Tornado也可以运行在Windows上，虽然它的配置不是官方支持的,同时也仅仅推荐开发使用.</p>
</div>
<div class="section" id="id5">
<h2>文档<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>这个文档同时也提供 <a class="reference external" href="https://readthedocs.org/projects/tornado/downloads/">PDF 和 Epub 格式</a>.</p>
<div class="toctree-wrapper compound">
<span id="document-guide"></span><div class="section" id="id1">
<h3>用户指南<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-guide/intro"></span><div class="section" id="id1">
<h4>介绍<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p><a class="reference external" href="http://www.tornadoweb.org">Tornado</a> 是一个Python web框架和异步网络库
起初由 <a class="reference external" href="http://friendfeed.com">FriendFeed</a> 开发. 通过使用非阻塞网络I/O, Tornado
可以支持上万级的连接，处理
<a class="reference external" href="http://en.wikipedia.org/wiki/Push_technology#Long_polling">长连接</a>,
<a class="reference external" href="http://en.wikipedia.org/wiki/WebSocket">WebSockets</a>, 和其他
需要与每个用户保持长久连接的应用.</p>
<p>Tornado 大体上可以被分为4个主要的部分:</p>
<ul class="simple">
<li>web框架 (包括创建web应用的 <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 类，还有很多其他支持的类).</li>
<li>HTTP的客户端和服务端实现 (<a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> and
<a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a>).</li>
<li>异步网络库 (<a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> and <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a>),
为HTTP组件提供构建模块，也可以用来实现其他协议.</li>
<li>协程库 (<a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a>) 允许异步代码写的更直接而不用链式回调的方式.</li>
</ul>
<p>Tornado web 框架和HTTP server 一起为
<a class="reference external" href="http://www.python.org/dev/peps/pep-3333/">WSGI</a> 提供了一个全栈式的选择.
在WSGI容器 (<a class="reference internal" href="index.html#tornado.wsgi.WSGIAdapter" title="tornado.wsgi.WSGIAdapter"><code class="xref py py-obj docutils literal"><span class="pre">WSGIAdapter</span></code></a>) 中使用Tornado web框架或者使用Tornado HTTP server
作为一个其他WSGI框架(<a class="reference internal" href="index.html#tornado.wsgi.WSGIContainer" title="tornado.wsgi.WSGIContainer"><code class="xref py py-obj docutils literal"><span class="pre">WSGIContainer</span></code></a>)的容器,这样的组合方式都是有局限性的.
为了充分利用Tornado的特性,你需要一起使用Tornado的web框架和HTTP server.</p>
</div>
<span id="document-guide/async"></span><div class="section" id="i-o">
<h4>异步和非阻塞I/O<a class="headerlink" href="#i-o" title="永久链接至标题">¶</a></h4>
<p>实时web功能需要为每个用户提供一个多数时间被闲置的长连接,
在传统的同步web服务器中，这意味着要为每个用户提供一个线程,
当然每个线程的开销都是很昂贵的.</p>
<p>为了尽量减少并发连接造成的开销，Tornado使用了一种单线程事件循环的方式.
这就意味着所有的应用代码都应该是异步非阻塞的,
因为在同一时间只有一个操作是有效的.</p>
<p>异步和非阻塞是非常相关的并且这两个术语经常交换使用,但它们不是完全相同的事情.</p>
<div class="section" id="id1">
<h5>阻塞<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>一个函数在等待某些事情的返回值的时候会被 <strong>阻塞</strong>. 函数被阻塞的原因有很多:
网络I/O,磁盘I/O,互斥锁等.事实上 <em>每个</em> 函数在运行和使用CPU的时候都或多或少
会被阻塞(举个极端的例子来说明为什么对待CPU阻塞要和对待一般阻塞一样的严肃:
比如密码哈希函数
<a class="reference external" href="http://bcrypt.sourceforge.net/">bcrypt</a>, 需要消耗几百毫秒的CPU时间,这已
经远远超过了一般的网络或者磁盘请求时间了).</p>
<p>一个函数可以在某些方面阻塞在另外一些方面不阻塞.例如,
<a class="reference internal" href="index.html#module-tornado.httpclient" title="tornado.httpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient</span></code></a> 在默认的配置下,会在DNS解析上面阻塞,但是在其他网络请
求的时候不阻塞
(为了减轻这种影响，可以用 <a class="reference internal" href="index.html#tornado.netutil.ThreadedResolver" title="tornado.netutil.ThreadedResolver"><code class="xref py py-obj docutils literal"><span class="pre">ThreadedResolver</span></code></a> 或者是
通过正确配置 <code class="docutils literal"><span class="pre">libcurl</span></code> 用 <code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code> 来做).
在Tornado的上下文中,我们一般讨论网络I/O上下文的阻塞,尽管各种阻塞已经被最小
化.</p>
</div>
<div class="section" id="id2">
<h5>异步<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p><strong>异步</strong> 函数在会在完成之前返回，在应用中触发下一个动作之前通常会在后
台执行一些工作(和正常的 <strong>同步</strong> 函数在返回前就执行完所有的事情不同).这里列
举了几种风格的异步接口:</p>
<ul class="simple">
<li>回调参数</li>
<li>返回一个占位符 (<a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>, <code class="docutils literal"><span class="pre">Promise</span></code>, <code class="docutils literal"><span class="pre">Deferred</span></code>)</li>
<li>传送给一个队列</li>
<li>回调注册表 (POSIX信号)</li>
</ul>
<p>不论使用哪种类型的接口, <em>按照定义</em> 异步函数与它们的调用者都有着不同的交互方
式;也没有什么对调用者透明的方式使得同步函数异步(类似 <a class="reference external" href="http://www.gevent.org">gevent</a> 使用轻量级线程的系统性能虽然堪比异步系统,但它们并
没有真正的让事情异步).</p>
</div>
<div class="section" id="id3">
<h5>例子<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>一个简单的同步函数:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado.httpclient</span> <span class="k">import</span> <span class="n">HTTPClient</span>

<span class="k">def</span> <span class="nf">synchronous_fetch</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">http_client</span> <span class="o">=</span> <span class="n">HTTPClient</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
</pre></div>
</div>
<p>把上面的例子用回调参数重写的异步函数:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado.httpclient</span> <span class="k">import</span> <span class="n">AsyncHTTPClient</span>

<span class="k">def</span> <span class="nf">asynchronous_fetch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
    <span class="n">http_client</span> <span class="o">=</span> <span class="n">AsyncHTTPClient</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
        <span class="n">callback</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
    <span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">handle_response</span><span class="p">)</span>
</pre></div>
</div>
<p>使用 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 代替回调:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado.concurrent</span> <span class="k">import</span> <span class="n">Future</span>

<span class="k">def</span> <span class="nf">async_fetch_future</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">http_client</span> <span class="o">=</span> <span class="n">AsyncHTTPClient</span><span class="p">()</span>
    <span class="n">my_future</span> <span class="o">=</span> <span class="n">Future</span><span class="p">()</span>
    <span class="n">fetch_future</span> <span class="o">=</span> <span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">fetch_future</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">my_future</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">my_future</span>
</pre></div>
</div>
<p><a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 版本明显更加复杂，但是 <code class="docutils literal"><span class="pre">Futures</span></code> 却是Tornado中推荐的写法
因为它有两个主要的优势.首先是错误处理更加一致,因为 <a class="reference internal" href="index.html#tornado.concurrent.Future.result" title="tornado.concurrent.Future.result"><code class="xref py py-obj docutils literal"><span class="pre">Future.result</span></code></a>
方法可以简单的抛出异常(相较于常见的回调函数接口特别指定错误处理),
而且 <code class="docutils literal"><span class="pre">Futures</span></code> 很适合和协程一起使用.协程会在后面深入讨论.这里是上
面例子的协程版本,和最初的同步版本很像:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado</span> <span class="k">import</span> <span class="n">gen</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">fetch_coroutine</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">http_client</span> <span class="o">=</span> <span class="n">AsyncHTTPClient</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">gen</span><span class="o">.</span><span class="n">Return</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">raise</span> <span class="pre">gen.Return(response.body)</span></code> 声明是在Python 2 (and 3.2)下人为
执行的, 因为在其中生成器不允许返回值.为了克服这个问题,Tornado的协程
抛出一种特殊的叫 <a class="reference internal" href="index.html#tornado.gen.Return" title="tornado.gen.Return"><code class="xref py py-obj docutils literal"><span class="pre">Return</span></code></a> 的异常. 协程捕获这个异常并把它作为返回值.
在Python 3.3和更高版本,使用 <code class="docutils literal"><span class="pre">return</span>
<span class="pre">response.body</span></code> 有相同的结果.</p>
</div>
</div>
<span id="document-guide/coroutines"></span><div class="section" id="id1">
<h4>协程<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>Tornado中推荐使用 <strong>协程</strong> 写异步代码. 协程使用了Python的 <code class="docutils literal"><span class="pre">yield</span></code>
关键字代替链式回调来将程序挂起和恢复执行(像在 <a class="reference external" href="http://www.gevent.org">gevent</a> 中出现的轻量级线程合作方式有时也被称为协程,
但是在Tornado中所有的协程使用明确的上下文切换,并被称为异步函数).</p>
<p>使用协程几乎像写同步代码一样简单, 并且不需要浪费额外的线程. 它们还通过减少上下文切换来 <a class="reference external" href="https://glyph.twistedmatrix.com/2014/02/unyielding.html">使并发编程更简单</a> .</p>
<p>例子:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado</span> <span class="k">import</span> <span class="n">gen</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">fetch_coroutine</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">http_client</span> <span class="o">=</span> <span class="n">AsyncHTTPClient</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="c1"># 在Python 3.3之前, 在generator中是不允许有返回值的</span>
    <span class="c1"># 必须通过抛出异常来代替.</span>
    <span class="c1"># 就像 raise gen.Return(response.body).</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
</pre></div>
</div>
<div class="section" id="python-3-5-async-and-await">
<span id="native-coroutines"></span><h5>Python 3.5: <code class="docutils literal"><span class="pre">async</span></code> and <code class="docutils literal"><span class="pre">await</span></code><a class="headerlink" href="#python-3-5-async-and-await" title="永久链接至标题">¶</a></h5>
<p>Python 3.5 引入了 <code class="docutils literal"><span class="pre">async</span></code> 和 <code class="docutils literal"><span class="pre">await</span></code> 关键字(使用这些关键字的
函数也被称为&#8221;原生协程&#8221;). 从Tornado 4.3, 你可以用它们代替 <code class="docutils literal"><span class="pre">yield</span></code> 为基础的协程.
只需要简单的使用 <code class="docutils literal"><span class="pre">async</span> <span class="pre">def</span> <span class="pre">foo()</span></code> 在函数定义的时候代替 <code class="docutils literal"><span class="pre">&#64;gen.coroutine</span></code> 装饰器, 用 <code class="docutils literal"><span class="pre">await</span></code> 代替yield. 本文档的其他部分会继续使用 <code class="docutils literal"><span class="pre">yield</span></code> 的风格来和旧版本的Python兼容, 但是如果 <code class="docutils literal"><span class="pre">async</span></code> 和 <code class="docutils literal"><span class="pre">await</span></code> 可用的话，它们运行起来会更快:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_coroutine</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">http_client</span> <span class="o">=</span> <span class="n">AsyncHTTPClient</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">await</span></code> 关键字比 <code class="docutils literal"><span class="pre">yield</span></code> 关键字功能要少一些.
例如,在一个使用 <code class="docutils literal"><span class="pre">yield</span></code> 的协程中， 你可以得到
<code class="docutils literal"><span class="pre">Futures</span></code> 列表, 但是在原生协程中,你必须把列表用 <a class="reference internal" href="index.html#tornado.gen.multi" title="tornado.gen.multi"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.multi</span></code></a> 包起来. 你也可以使用 <a class="reference internal" href="index.html#tornado.gen.convert_yielded" title="tornado.gen.convert_yielded"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.convert_yielded</span></code></a>
来把任何使用 <code class="docutils literal"><span class="pre">yield</span></code> 工作的代码转换成使用 <code class="docutils literal"><span class="pre">await</span></code> 的形式.</p>
<p>虽然原生协程没有明显依赖于特定框架(例如它们没有使用装饰器,例如 <a class="reference internal" href="index.html#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.coroutine</span></code></a> 或
<a class="reference external" href="https://docs.python.org/3.4/library/asyncio-task.html#asyncio.coroutine" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">asyncio.coroutine</span></code></a>), 不是所有的协程都和其他的兼容. 有一个 <em>协程执行者(coroutine runner)</em> 在第一个协程被调用的时候进行选择, 然后被所有用  <code class="docutils literal"><span class="pre">await</span></code> 直接调用的协程共享.
Tornado 的协程执行者(coroutine runner)在设计上是多用途的,可以接受任何来自其他框架的awaitable对象;
其他的协程运行时可能有很多限制(例如, <code class="docutils literal"><span class="pre">asyncio</span></code> 协程执行者不接受来自其他框架的协程).
基于这些原因,我们推荐组合了多个框架的应用都使用Tornado的协程执行者来进行协程调度.
为了能使用Tornado来调度执行asyncio的协程, 可以使用
<a class="reference internal" href="index.html#tornado.platform.asyncio.to_asyncio_future" title="tornado.platform.asyncio.to_asyncio_future"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.asyncio.to_asyncio_future</span></code></a> 适配器.</p>
</div>
<div class="section" id="id3">
<h5>它是如何工作的<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>包含了 <code class="docutils literal"><span class="pre">yield</span></code> 关键字的函数是一个 <strong>生成器(generator)</strong>. 所有的生成器都是异步的;
当调用它们的时候,会返回一个生成器对象,而不是一个执行完的结果.
<code class="docutils literal"><span class="pre">&#64;gen.coroutine</span></code> 装饰器通过 <code class="docutils literal"><span class="pre">yield</span></code> 表达式和生成器进行交流, 而且通过返回一个 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 与协程的调用方进行交互.</p>
<p>下面是一个协程装饰器内部循环的简单版本:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># tornado.gen.Runner 简化的内部循环</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># send(x) makes the current yield return x.</span>
    <span class="c1"># It returns when the next yield is reached</span>
    <span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">future</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
</pre></div>
</div>
<p>装饰器从生成器接收一个 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 对象, 等待(非阻塞的)这个 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>
对象执行完成, 然后&#8221;解开(unwraps)&#8221; 这个 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 对象，并把结果作为
<code class="docutils literal"><span class="pre">yield</span></code> 表达式的结果传回给生成器.  大多数异步代码从来不会直接接触 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 类
除非 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 立即通过异步函数返回给 <code class="docutils literal"><span class="pre">yield</span></code> 表达式.</p>
</div>
<div class="section" id="id4">
<h5>如何调用协程<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>协程一般不会抛出异常: 它们抛出的任何异常将被 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 捕获
直到它被得到. 这意味着用正确的方式调用协程是重要的, 否则你可能有被
忽略的错误:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">divide</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">bad_call</span><span class="p">():</span>
    <span class="c1"># 这里应该抛出一个 ZeroDivisionError 的异常, 但事实上并没有</span>
    <span class="c1"># 因为协程的调用方式是错误的.</span>
    <span class="n">divide</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>几乎所有的情况下, 任何一个调用协程的函数都必须是协程它自身, 并且在
调用的时候使用 <code class="docutils literal"><span class="pre">yield</span></code> 关键字. 当你复写超类中的方法, 请参阅文档,
看看协程是否支持(文档应该会写该方法 &#8220;可能是一个协程&#8221; 或者 &#8220;可能返回
一个 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> &#8221;):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">good_call</span><span class="p">():</span>
    <span class="c1"># yield 将会解开 divide() 返回的 Future 并且抛出异常</span>
    <span class="k">yield</span> <span class="n">divide</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>有时你可能想要对一个协程&#8221;一劳永逸&#8221;而且不等待它的结果. 在这种情况下,
建议使用 <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.spawn_callback" title="tornado.ioloop.IOLoop.spawn_callback"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.spawn_callback</span></code></a>, 它使得 <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> 负责调用. 如果
它失败了, <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> 会在日志中把调用栈记录下来:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># IOLoop 将会捕获异常,并且在日志中打印栈记录.</span>
<span class="c1"># 注意这不像是一个正常的调用, 因为我们是通过</span>
<span class="c1"># IOLoop 调用的这个函数.</span>
<span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">spawn_callback</span><span class="p">(</span><span class="n">divide</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>最后, 在程序顶层, <em>如果 `.IOLoop` 尚未运行,</em> 你可以启动 <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>,
执行协程,然后使用 <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.run_sync" title="tornado.ioloop.IOLoop.run_sync"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.run_sync</span></code></a> 方法停止 <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> . 这通常被
用来启动面向批处理程序的 <code class="docutils literal"><span class="pre">main</span></code> 函数:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># run_sync() 不接收参数,所以我们必须把调用包在lambda函数中.</span>
<span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">divide</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>协程模式<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<div class="section" id="callback">
<h6>结合 callback<a class="headerlink" href="#callback" title="永久链接至标题">¶</a></h6>
<p>为了使用回调而不是 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 与异步代码进行交互, 把调用包在 <a class="reference internal" href="index.html#tornado.gen.Task" title="tornado.gen.Task"><code class="xref py py-obj docutils literal"><span class="pre">Task</span></code></a>
中. 这将为你添加一个回调参数并且返回一个可以yield的 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">call_task</span><span class="p">():</span>
    <span class="c1"># 注意这里没有传进来some_function.</span>
    <span class="c1"># 这里会被Task翻译成</span>
    <span class="c1">#   some_function(other_args, callback=callback)</span>
    <span class="k">yield</span> <span class="n">gen</span><span class="o">.</span><span class="n">Task</span><span class="p">(</span><span class="n">some_function</span><span class="p">,</span> <span class="n">other_args</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h6>调用阻塞函数<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h6>
<p>从协程调用阻塞函数最简单的方式是使用
<a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ThreadPoolExecutor</span></code></a>, 它将返回和协程兼容的
<code class="docutils literal"><span class="pre">Futures</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">thread_pool</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">call_blocking</span><span class="p">():</span>
    <span class="k">yield</span> <span class="n">thread_pool</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">blocking_func</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h6>并行<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h6>
<p>协程装饰器能识别列表或者字典对象中各自的 <code class="docutils literal"><span class="pre">Futures</span></code>, 并且并行的等待这些 <code class="docutils literal"><span class="pre">Futures</span></code> :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">parallel_fetch</span><span class="p">(</span><span class="n">url1</span><span class="p">,</span> <span class="n">url2</span><span class="p">):</span>
    <span class="n">resp1</span><span class="p">,</span> <span class="n">resp2</span> <span class="o">=</span> <span class="k">yield</span> <span class="p">[</span><span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url1</span><span class="p">),</span>
                          <span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url2</span><span class="p">)]</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">parallel_fetch_many</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="k">yield</span> <span class="p">[</span><span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
    <span class="c1"># 响应是和HTTPResponses相同顺序的列表</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">parallel_fetch_dict</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="k">yield</span> <span class="p">{</span><span class="n">url</span><span class="p">:</span> <span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">}</span>
    <span class="c1"># 响应是一个字典 {url: HTTPResponse}</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h6>交叉存取<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h6>
<p>有时候保存一个 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 比立即yield它更有用, 所以你可以在等待之前
执行其他操作:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">fetch_future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_next_chunk</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">fetch_future</span>
        <span class="k">if</span> <span class="n">chunk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="n">fetch_future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_next_chunk</span><span class="p">()</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h6>循环<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h6>
<p>协程的循环是棘手的, 因为在Python中没有办法在 <code class="docutils literal"><span class="pre">for</span></code> 循环或者
<code class="docutils literal"><span class="pre">while</span></code> 循环 <code class="docutils literal"><span class="pre">yield</span></code> 迭代器,并且捕获yield的结果. 相反,你需要将
循环条件从访问结果中分离出来, 下面是一个使用 <a class="reference external" href="http://motor.readthedocs.org/en/stable/">Motor</a> 的例子:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">motor</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">motor</span><span class="o">.</span><span class="n">MotorClient</span><span class="p">()</span><span class="o">.</span><span class="n">test</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">loop_example</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
    <span class="k">while</span> <span class="p">(</span><span class="k">yield</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetch_next</span><span class="p">):</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">next_object</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h6>在后台运行<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h6>
<p><a class="reference internal" href="index.html#tornado.ioloop.PeriodicCallback" title="tornado.ioloop.PeriodicCallback"><code class="xref py py-obj docutils literal"><span class="pre">PeriodicCallback</span></code></a> 通常不使用协程. 相反,一个协程可以包含一个
<code class="docutils literal"><span class="pre">while</span> <span class="pre">True:</span></code> 循环并使用
<a class="reference internal" href="index.html#tornado.gen.sleep" title="tornado.gen.sleep"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.sleep</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">minute_loop</span><span class="p">():</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">do_something</span><span class="p">()</span>
        <span class="k">yield</span> <span class="n">gen</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

<span class="c1"># Coroutines that loop forever are generally started with</span>
<span class="c1"># spawn_callback().</span>
<span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">spawn_callback</span><span class="p">(</span><span class="n">minute_loop</span><span class="p">)</span>
</pre></div>
</div>
<p>有时可能会遇到一个更复杂的循环. 例如, 上一个循环运行每次花费
<code class="docutils literal"><span class="pre">60+N</span></code> 秒, 其中 <code class="docutils literal"><span class="pre">N</span></code> 是 <code class="docutils literal"><span class="pre">do_something()</span></code> 花费的时间. 为了
准确的每60秒运行,使用上面的交叉模式:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">minute_loop2</span><span class="p">():</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">nxt</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>   <span class="c1"># 开始计时.</span>
        <span class="k">yield</span> <span class="n">do_something</span><span class="p">()</span>  <span class="c1"># 计时后运行.</span>
        <span class="k">yield</span> <span class="n">nxt</span>             <span class="c1"># 等待计时结束.</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-guide/queues"></span><div class="section" id="queue">
<h4><a class="reference internal" href="index.html#tornado.queues.Queue" title="tornado.queues.Queue"><code class="xref py py-class docutils literal"><span class="pre">Queue</span></code></a> 示例 - 一个并发网络爬虫<a class="headerlink" href="#queue" title="永久链接至标题">¶</a></h4>
<p>Tornado的 <a class="reference internal" href="index.html#module-tornado.queues" title="tornado.queues"><code class="xref py py-obj docutils literal"><span class="pre">tornado.queues</span></code></a> 模块实现了异步生产者/消费者模式的协程, 类似于
通过Python 标准库的 <a class="reference external" href="https://docs.python.org/3.4/library/queue.html#module-queue" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">queue</span></code></a> 实现线程模式.</p>
<p>一个yield <a class="reference internal" href="index.html#tornado.queues.Queue.get" title="tornado.queues.Queue.get"><code class="xref py py-obj docutils literal"><span class="pre">Queue.get</span></code></a> 的协程直到队列中有值的时候才会暂停. 如果队列设置了最大长度
yield <a class="reference internal" href="index.html#tornado.queues.Queue.put" title="tornado.queues.Queue.put"><code class="xref py py-obj docutils literal"><span class="pre">Queue.put</span></code></a> 的协程直到队列中有空间才会暂停.</p>
<p>一个 <a class="reference internal" href="index.html#tornado.queues.Queue" title="tornado.queues.Queue"><code class="xref py py-obj docutils literal"><span class="pre">Queue</span></code></a>  从0开始对完成的任务进行计数. <a class="reference internal" href="index.html#tornado.queues.Queue.put" title="tornado.queues.Queue.put"><code class="xref py py-obj docutils literal"><span class="pre">put</span></code></a> 加计数;
<a class="reference internal" href="index.html#tornado.queues.Queue.task_done" title="tornado.queues.Queue.task_done"><code class="xref py py-obj docutils literal"><span class="pre">task_done</span></code></a> 减少计数.</p>
<p>这里的网络爬虫的例子, 队列开始的时候只包含 base_url. 当一个worker抓取到一个页面
它会解析链接并把它添加到队列中, 然后调用 <a class="reference internal" href="index.html#tornado.queues.Queue.task_done" title="tornado.queues.Queue.task_done"><code class="xref py py-obj docutils literal"><span class="pre">task_done</span></code></a> 减少计数一次.
最后, 当一个worker抓取到的页面URL都是之前抓取到过的并且队列中没有任务了.
于是worker调用 <a class="reference internal" href="index.html#tornado.queues.Queue.task_done" title="tornado.queues.Queue.task_done"><code class="xref py py-obj docutils literal"><span class="pre">task_done</span></code></a> 把计数减到0.
等待 <a class="reference internal" href="index.html#tornado.queues.Queue.join" title="tornado.queues.Queue.join"><code class="xref py py-obj docutils literal"><span class="pre">join</span></code></a> 的主协程取消暂停并且完成.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">timedelta</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">HTMLParser</span> <span class="k">import</span> <span class="n">HTMLParser</span>
    <span class="kn">from</span> <span class="nn">urlparse</span> <span class="k">import</span> <span class="n">urljoin</span><span class="p">,</span> <span class="n">urldefrag</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">html.parser</span> <span class="k">import</span> <span class="n">HTMLParser</span>
    <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="k">import</span> <span class="n">urljoin</span><span class="p">,</span> <span class="n">urldefrag</span>

<span class="kn">from</span> <span class="nn">tornado</span> <span class="k">import</span> <span class="n">httpclient</span><span class="p">,</span> <span class="n">gen</span><span class="p">,</span> <span class="n">ioloop</span><span class="p">,</span> <span class="n">queues</span>

<span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;http://www.tornadoweb.org/en/stable/&#39;</span>
<span class="n">concurrency</span> <span class="o">=</span> <span class="mi">10</span>


<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">get_links_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Download the page at `url` and parse it for links.</span>

<span class="sd">    Returned links have had the fragment after `#` removed, and have been made</span>
<span class="sd">    absolute so, e.g. the URL &#39;gen.html#tornado.gen.coroutine&#39; becomes</span>
<span class="sd">    &#39;http://www.tornadoweb.org/en/stable/gen.html&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">httpclient</span><span class="o">.</span><span class="n">AsyncHTTPClient</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;fetched </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">url</span><span class="p">)</span>

        <span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> \
            <span class="k">else</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">urljoin</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">remove_fragment</span><span class="p">(</span><span class="n">new_url</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">new_url</span> <span class="ow">in</span> <span class="n">get_links</span><span class="p">(</span><span class="n">html</span><span class="p">)]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exception: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">gen</span><span class="o">.</span><span class="n">Return</span><span class="p">([])</span>

    <span class="k">raise</span> <span class="n">gen</span><span class="o">.</span><span class="n">Return</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">remove_fragment</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">pure_url</span><span class="p">,</span> <span class="n">frag</span> <span class="o">=</span> <span class="n">urldefrag</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pure_url</span>


<span class="k">def</span> <span class="nf">get_links</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">URLSeeker</span><span class="p">(</span><span class="n">HTMLParser</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">HTMLParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">handle_starttag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
            <span class="n">href</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">href</span> <span class="ow">and</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">href</span><span class="p">)</span>

    <span class="n">url_seeker</span> <span class="o">=</span> <span class="n">URLSeeker</span><span class="p">()</span>
    <span class="n">url_seeker</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">url_seeker</span><span class="o">.</span><span class="n">urls</span>


<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">queues</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">fetching</span><span class="p">,</span> <span class="n">fetched</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">()</span>

    <span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">fetch_url</span><span class="p">():</span>
        <span class="n">current_url</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_url</span> <span class="ow">in</span> <span class="n">fetching</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;fetching </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">current_url</span><span class="p">)</span>
            <span class="n">fetching</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">current_url</span><span class="p">)</span>
            <span class="n">urls</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">get_links_from_url</span><span class="p">(</span><span class="n">current_url</span><span class="p">)</span>
            <span class="n">fetched</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">current_url</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">new_url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
                <span class="c1"># Only follow links beneath the base URL</span>
                <span class="k">if</span> <span class="n">new_url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">base_url</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">new_url</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">q</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>

    <span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">worker</span><span class="p">():</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">fetch_url</span><span class="p">()</span>

    <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>

    <span class="c1"># Start workers, then wait for the work queue to be empty.</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">concurrency</span><span class="p">):</span>
        <span class="n">worker</span><span class="p">()</span>
    <span class="k">yield</span> <span class="n">q</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">300</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">fetching</span> <span class="o">==</span> <span class="n">fetched</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done in </span><span class="si">%d</span><span class="s1"> seconds, fetched </span><span class="si">%s</span><span class="s1"> URLs.&#39;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fetched</span><span class="p">)))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">logging</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
    <span class="n">io_loop</span> <span class="o">=</span> <span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span>
    <span class="n">io_loop</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
</div>
<span id="document-guide/structure"></span><div class="section" id="tornado-web">
<h4>Tornado web应用的结构<a class="headerlink" href="#tornado-web" title="永久链接至标题">¶</a></h4>
<p>通常一个Tornado web应用包括一个或者多个 <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 子类,
一个可以将收到的请求路由到对应handler的 <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 对象,和
一个启动服务的 <code class="docutils literal"><span class="pre">main()</span></code> 函数.</p>
<p>一个最小的&#8221;hello world&#8221;例子就像下面这样:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tornado.ioloop</span>
<span class="kn">import</span> <span class="nn">tornado.web</span>

<span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">make_app</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
    <span class="p">])</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">make_app</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
    <span class="n">tornado</span><span class="o">.</span><span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="application">
<h5><code class="docutils literal"><span class="pre">Application</span></code> 对象<a class="headerlink" href="#application" title="永久链接至标题">¶</a></h5>
<p><a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 对象是负责全局配置的, 包括映射请求转发给处理程序的路由
表.</p>
<p>路由表是 <a class="reference internal" href="index.html#tornado.web.URLSpec" title="tornado.web.URLSpec"><code class="xref py py-obj docutils literal"><span class="pre">URLSpec</span></code></a> 对象(或元组)的列表, 其中每个都包含(至少)一个正则
表达式和一个处理类. 顺序问题; 第一个匹配的规则会被使用. 如果正则表达
式包含捕获组, 这些组会被作为 <em>路径参数</em> 传递给处理函数的HTTP方法.
如果一个字典作为 <a class="reference internal" href="index.html#tornado.web.URLSpec" title="tornado.web.URLSpec"><code class="xref py py-obj docutils literal"><span class="pre">URLSpec</span></code></a> 的第三个参数被传递, 它会作为 <em>初始参数</em>
传递给 <a class="reference internal" href="index.html#tornado.web.RequestHandler.initialize" title="tornado.web.RequestHandler.initialize"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.initialize</span></code></a>.  最后 <a class="reference internal" href="index.html#tornado.web.URLSpec" title="tornado.web.URLSpec"><code class="xref py py-obj docutils literal"><span class="pre">URLSpec</span></code></a> 可能有一个名字
, 这将允许它被 <a class="reference internal" href="index.html#tornado.web.RequestHandler.reverse_url" title="tornado.web.RequestHandler.reverse_url"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.reverse_url</span></code></a> 使用.</p>
<p>例如, 在这个片段中根URL <code class="docutils literal"><span class="pre">/</span></code> 映射到了
<code class="docutils literal"><span class="pre">MainHandler</span></code> , 像 <code class="docutils literal"><span class="pre">/story/</span></code> 后跟着一个数字这种形式的URL被映射到了
<code class="docutils literal"><span class="pre">StoryHandler</span></code>.  这个数字被传递(作为字符串)给
<code class="docutils literal"><span class="pre">StoryHandler.get</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;link to story 1&lt;/a&gt;&#39;</span> <span class="o">%</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">reverse_url</span><span class="p">(</span><span class="s2">&quot;story&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">StoryHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">story_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;this is story </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">story_id</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">([</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/story/([0-9]+)&quot;</span><span class="p">,</span> <span class="n">StoryHandler</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;story&quot;</span><span class="p">)</span>
    <span class="p">])</span>
</pre></div>
</div>
<p><a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 构造函数有很多关键字参数可以用于自定义应用程序的行为
和使用某些特性(或者功能); 完整列表请查看 <a class="reference internal" href="index.html#tornado.web.Application.settings" title="tornado.web.Application.settings"><code class="xref py py-obj docutils literal"><span class="pre">Application.settings</span></code></a> .</p>
</div>
<div class="section" id="requesthandler">
<h5><code class="docutils literal"><span class="pre">RequestHandler</span></code> 子类<a class="headerlink" href="#requesthandler" title="永久链接至标题">¶</a></h5>
<p>Tornado web 应用程序的大部分工作是在 <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 子类下完成的.
处理子类的主入口点是一个命名为处理HTTP方法的函数: <code class="docutils literal"><span class="pre">get()</span></code>,
<code class="docutils literal"><span class="pre">post()</span></code>, 等等. 每个处理程序可以定义一个或者多个这种方法来处理不同
的HTTP动作. 如上所述, 这些方法将被匹配路由规则的捕获组对应的参数调用.</p>
<p>在处理程序中, 调用方法如 <a class="reference internal" href="index.html#tornado.web.RequestHandler.render" title="tornado.web.RequestHandler.render"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.render</span></code></a> 或者
<a class="reference internal" href="index.html#tornado.web.RequestHandler.write" title="tornado.web.RequestHandler.write"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.write</span></code></a> 产生一个响应.  <code class="docutils literal"><span class="pre">render()</span></code> 通过名字加载一个
<a class="reference internal" href="index.html#tornado.template.Template" title="tornado.template.Template"><code class="xref py py-obj docutils literal"><span class="pre">Template</span></code></a> 并使用给定的参数渲染它. <code class="docutils literal"><span class="pre">write()</span></code> 被用于非模板基础的输
出; 它接受字符串, 字节, 和字典(字典会被编码成JSON).</p>
<p>在 <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 中的很多方法的设计是为了在子类中复写和在整个应用
中使用. 常用的方法是定义一个 <code class="docutils literal"><span class="pre">BaseHandler</span></code> 类, 复写一些方法例如
<a class="reference internal" href="index.html#tornado.web.RequestHandler.write_error" title="tornado.web.RequestHandler.write_error"><code class="xref py py-obj docutils literal"><span class="pre">write_error</span></code></a> 和 <a class="reference internal" href="index.html#tornado.web.RequestHandler.get_current_user" title="tornado.web.RequestHandler.get_current_user"><code class="xref py py-obj docutils literal"><span class="pre">get_current_user</span></code></a>
然后子类继承使用你自己的 <code class="docutils literal"><span class="pre">BaseHandler</span></code> 而不是 <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a>
在你所有具体的处理程序中.</p>
</div>
<div class="section" id="id1">
<h5>处理输入请求<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>处理请求的程序(request handler)可以使用 <code class="docutils literal"><span class="pre">self.request</span></code> 访问代表当
前请求的对象. 通过
<a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest" title="tornado.httputil.HTTPServerRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerRequest</span></code></a> 的类定义查看完整的属性列表.</p>
<p>使用HTML表单格式请求的数据会被解析并且可以在一些方法中使用, 例如
<a class="reference internal" href="index.html#tornado.web.RequestHandler.get_query_argument" title="tornado.web.RequestHandler.get_query_argument"><code class="xref py py-obj docutils literal"><span class="pre">get_query_argument</span></code></a> 和
<a class="reference internal" href="index.html#tornado.web.RequestHandler.get_body_argument" title="tornado.web.RequestHandler.get_body_argument"><code class="xref py py-obj docutils literal"><span class="pre">get_body_argument</span></code></a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyFormHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;html&gt;&lt;body&gt;&lt;form action=&quot;/myform&quot; method=&quot;POST&quot;&gt;&#39;</span>
                   <span class="s1">&#39;&lt;input type=&quot;text&quot; name=&quot;message&quot;&gt;&#39;</span>
                   <span class="s1">&#39;&lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;&#39;</span>
                   <span class="s1">&#39;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_header</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;You wrote &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_body_argument</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>由于HTLM表单编码不确定一个标签的参数是单一值还是一个列表,
<a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 有明确的方法来允许应用程序表明是否它期望接收一个列表.
对于列表, 使用
<a class="reference internal" href="index.html#tornado.web.RequestHandler.get_query_arguments" title="tornado.web.RequestHandler.get_query_arguments"><code class="xref py py-obj docutils literal"><span class="pre">get_query_arguments</span></code></a> 和
<a class="reference internal" href="index.html#tornado.web.RequestHandler.get_body_arguments" title="tornado.web.RequestHandler.get_body_arguments"><code class="xref py py-obj docutils literal"><span class="pre">get_body_arguments</span></code></a> 而不是它们的单数形式.</p>
<p>通过一个表单上传的文件可以使用 <code class="docutils literal"><span class="pre">self.request.files</span></code>,
它遍历名字(HTML 标签 <code class="docutils literal"><span class="pre">&lt;input</span> <span class="pre">type=&quot;file&quot;&gt;</span></code> 的name)到一个文件列表.
每个文件都是一个字典的形式
<code class="docutils literal"><span class="pre">{&quot;filename&quot;:...,</span> <span class="pre">&quot;content_type&quot;:...,</span> <span class="pre">&quot;body&quot;:...}</span></code>.  <code class="docutils literal"><span class="pre">files</span></code>
对象是当前唯一的如果文件上传是通过一个表单包装
(i.e. a <code class="docutils literal"><span class="pre">multipart/form-data</span></code> Content-Type); 如果没用这种格式,
原生上传的数据可以调用 <code class="docutils literal"><span class="pre">self.request.body</span></code> 使用.
默认上传的文件是完全缓存在内存中的; 如果你需要处理占用内存太大的文件
可以看看 <a class="reference internal" href="index.html#tornado.web.stream_request_body" title="tornado.web.stream_request_body"><code class="xref py py-obj docutils literal"><span class="pre">stream_request_body</span></code></a> 类装饰器.</p>
<p>由于HTML表单编码格式的怪异 (e.g. 在单数和复数参数的含糊不清), Tornado
不会试图统一表单参数和其他输入类型的参数. 特别是, 我们不解析JSON请求体.
应用程序希望使用JSON代替表单编码可以复写 <a class="reference internal" href="index.html#tornado.web.RequestHandler.prepare" title="tornado.web.RequestHandler.prepare"><code class="xref py py-obj docutils literal"><span class="pre">prepare</span></code></a>
来解析它们的请求:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;application/json&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">json_args</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">json_args</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>复写RequestHandler的方法<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>除了 <code class="docutils literal"><span class="pre">get()</span></code>/<code class="docutils literal"><span class="pre">post()</span></code>/等, 在 <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 中的某些其他方法
被设计成了在必要的时候让子类重写. 在每个请求中, 会发生下面的调用序
列:</p>
<ol class="arabic simple">
<li>在每次请求时生成一个新的 <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 对象</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.initialize" title="tornado.web.RequestHandler.initialize"><code class="xref py py-obj docutils literal"><span class="pre">initialize()</span></code></a> 被 <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 配置中的初始化
参数被调用. <code class="docutils literal"><span class="pre">initialize</span></code>  通常应该只保存成员变量传递的参数;
它不可能产生任何输出或者调用方法, 例如
<a class="reference internal" href="index.html#tornado.web.RequestHandler.send_error" title="tornado.web.RequestHandler.send_error"><code class="xref py py-obj docutils literal"><span class="pre">send_error</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.prepare" title="tornado.web.RequestHandler.prepare"><code class="xref py py-obj docutils literal"><span class="pre">prepare()</span></code></a> 被调用. 这在你所有处理子类共享的基
类中是最有用的, 无论是使用哪种HTTP方法, <code class="docutils literal"><span class="pre">prepare</span></code> 都会被调用.
<code class="docutils literal"><span class="pre">prepare</span></code> 可能会产生输出; 如果它调用 <a class="reference internal" href="index.html#tornado.web.RequestHandler.finish" title="tornado.web.RequestHandler.finish"><code class="xref py py-obj docutils literal"><span class="pre">finish</span></code></a>
(或者 <code class="docutils literal"><span class="pre">redirect</span></code>, 等), 处理会在这里结束.</li>
<li>其中一种HTTP方法被调用: <code class="docutils literal"><span class="pre">get()</span></code>, <code class="docutils literal"><span class="pre">post()</span></code>, <code class="docutils literal"><span class="pre">put()</span></code>,
等. 如果URL的正则表达式包含捕获组, 它们会被作为参数传递给这个方
法.</li>
<li>当请求结束, <a class="reference internal" href="index.html#tornado.web.RequestHandler.on_finish" title="tornado.web.RequestHandler.on_finish"><code class="xref py py-obj docutils literal"><span class="pre">on_finish()</span></code></a> 方法被调用. 对于同步
处理程序会在 <code class="docutils literal"><span class="pre">get()</span></code> (等)后立即返回; 对于异步处理程序,会在调用
<a class="reference internal" href="index.html#tornado.web.RequestHandler.finish" title="tornado.web.RequestHandler.finish"><code class="xref py py-obj docutils literal"><span class="pre">finish()</span></code></a> 后返回.</li>
</ol>
<p>所有这样设计被用来复写的方法被记录在了 <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 的文档中.
其中最常用的一些被复写的方法包括:</p>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.write_error" title="tornado.web.RequestHandler.write_error"><code class="xref py py-obj docutils literal"><span class="pre">write_error</span></code></a> -
输出对错误页面使用的HTML.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.on_connection_close" title="tornado.web.RequestHandler.on_connection_close"><code class="xref py py-obj docutils literal"><span class="pre">on_connection_close</span></code></a> - 当客户端断开时被调用;
应用程序可以检测这种情况,并中断后续处理. 注意这不能保证一个关闭
的连接及时被发现.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.get_current_user" title="tornado.web.RequestHandler.get_current_user"><code class="xref py py-obj docutils literal"><span class="pre">get_current_user</span></code></a> - 参考 <a class="reference internal" href="index.html#user-authentication"><span class="std std-ref">用户认证</span></a></li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.get_user_locale" title="tornado.web.RequestHandler.get_user_locale"><code class="xref py py-obj docutils literal"><span class="pre">get_user_locale</span></code></a> - 返回 <a class="reference internal" href="index.html#tornado.locale.Locale" title="tornado.locale.Locale"><code class="xref py py-obj docutils literal"><span class="pre">Locale</span></code></a> 对象给当前
用户使用</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.set_default_headers" title="tornado.web.RequestHandler.set_default_headers"><code class="xref py py-obj docutils literal"><span class="pre">set_default_headers</span></code></a> - 可以被用来设置额外的响应
头(例如自定义的 <code class="docutils literal"><span class="pre">Server</span></code> 头)</li>
</ul>
</div>
<div class="section" id="id3">
<h5>错误处理<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>如果一个处理程序抛出一个异常, Tornado会调用
<a class="reference internal" href="index.html#tornado.web.RequestHandler.write_error" title="tornado.web.RequestHandler.write_error"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.write_error</span></code></a> 来生成一个错误页.
<a class="reference internal" href="index.html#tornado.web.HTTPError" title="tornado.web.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.HTTPError</span></code></a> 可以被用来生成一个指定的状态码; 所有其他的异常
都会返回一个500状态.</p>
<p>默认的错误页面包含一个debug模式下的调用栈和另外一行错误描述
(e.g. &#8220;500: Internal Server Error&#8221;).  为了创建自定义的错误页面, 复写
<a class="reference internal" href="index.html#tornado.web.RequestHandler.write_error" title="tornado.web.RequestHandler.write_error"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.write_error</span></code></a> (可能在一个所有处理程序共享的一个基类里面).
这个方法可能产生输出通常通过一些方法, 例如 <a class="reference internal" href="index.html#tornado.web.RequestHandler.write" title="tornado.web.RequestHandler.write"><code class="xref py py-obj docutils literal"><span class="pre">write</span></code></a> 和
<a class="reference internal" href="index.html#tornado.web.RequestHandler.render" title="tornado.web.RequestHandler.render"><code class="xref py py-obj docutils literal"><span class="pre">render</span></code></a>. 如果错误是由异常引起的, 一个 <code class="docutils literal"><span class="pre">exc_info</span></code>
将作为一个关键字参数传递(注意这个异常不能保证是 <a class="reference external" href="https://docs.python.org/3.4/library/sys.html#sys.exc_info" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">sys.exc_info</span></code></a> 当前的
异常, 所以 <code class="docutils literal"><span class="pre">write_error</span></code> 必须使用 e.g.  <a class="reference external" href="https://docs.python.org/3.4/library/traceback.html#traceback.format_exception" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">traceback.format_exception</span></code></a> 代替
<a class="reference external" href="https://docs.python.org/3.4/library/traceback.html#traceback.format_exc" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">traceback.format_exc</span></code></a>).</p>
<p>也可以在常规的处理方法中调用 <a class="reference internal" href="index.html#tornado.web.RequestHandler.set_status" title="tornado.web.RequestHandler.set_status"><code class="xref py py-obj docutils literal"><span class="pre">set_status</span></code></a> 代替
<code class="docutils literal"><span class="pre">write_error</span></code> 返回一个(自定义)响应来生成一个错误页面. 特殊的例外
<a class="reference internal" href="index.html#tornado.web.Finish" title="tornado.web.Finish"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Finish</span></code></a> 在直接返回不方便的情况下能够在不调用 <code class="docutils literal"><span class="pre">write_error</span></code>
前结束处理程序.</p>
<p>对于404错误, 使用 <code class="docutils literal"><span class="pre">default_handler_class</span></code> <a class="reference internal" href="index.html#tornado.web.Application.settings" title="tornado.web.Application.settings"><code class="xref py py-obj docutils literal"><span class="pre">Application</span> <span class="pre">setting</span></code></a>. 这个处理程序会复写
<a class="reference internal" href="index.html#tornado.web.RequestHandler.prepare" title="tornado.web.RequestHandler.prepare"><code class="xref py py-obj docutils literal"><span class="pre">prepare</span></code></a> 而不是一个更具体的方法, 例如 <code class="docutils literal"><span class="pre">get()</span></code>
所以它可以在任何HTTP方法下工作. 它应该会产生如上所说的错误页面: 要么raise
一个 <code class="docutils literal"><span class="pre">HTTPError(404)</span></code> 要么复写 <code class="docutils literal"><span class="pre">write_error</span></code>, 或者调用
<code class="docutils literal"><span class="pre">self.set_status(404)</span></code> 或者在 <code class="docutils literal"><span class="pre">prepare()</span></code> 中直接生成响应.</p>
</div>
<div class="section" id="id4">
<h5>重定向<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>这里有两种主要的方式让你可以在Tornado中重定向请求:
<a class="reference internal" href="index.html#tornado.web.RequestHandler.redirect" title="tornado.web.RequestHandler.redirect"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.redirect</span></code></a> 和使用 <a class="reference internal" href="index.html#tornado.web.RedirectHandler" title="tornado.web.RedirectHandler"><code class="xref py py-obj docutils literal"><span class="pre">RedirectHandler</span></code></a>.</p>
<p>你可以在一个 <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 的方法中使用 <code class="docutils literal"><span class="pre">self.redirect()</span></code> 把用
户重定向到其他地方. 还有一个可选参数 <code class="docutils literal"><span class="pre">permanent</span></code> 你可以使用它来表明这个
重定向被认为是永久的. <code class="docutils literal"><span class="pre">permanent</span></code> 的默认值是 <code class="docutils literal"><span class="pre">False</span></code>, 这会生成一个
<code class="docutils literal"><span class="pre">302</span> <span class="pre">Found</span></code> HTTP响应状态码, 适合类似在用户的 <code class="docutils literal"><span class="pre">POST</span></code> 请求成功后的重定向.
如果 <code class="docutils literal"><span class="pre">permanent</span></code> 是true, 会使用 <code class="docutils literal"><span class="pre">301</span> <span class="pre">Moved</span>
<span class="pre">Permanently</span></code> HTTP响应, 更适合
e.g. 在SEO友好的方法中把一个页面重定向到一个权威的URL.</p>
<p><a class="reference internal" href="index.html#tornado.web.RedirectHandler" title="tornado.web.RedirectHandler"><code class="xref py py-obj docutils literal"><span class="pre">RedirectHandler</span></code></a> 让你直接在你 <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 路由表中配置. 例如, 配置一个
静态重定向:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/app&quot;</span><span class="p">,</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RedirectHandler</span><span class="p">,</span>
        <span class="nb">dict</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://itunes.apple.com/my-app-id&quot;</span><span class="p">)),</span>
    <span class="p">])</span>
</pre></div>
</div>
<p><a class="reference internal" href="index.html#tornado.web.RedirectHandler" title="tornado.web.RedirectHandler"><code class="xref py py-obj docutils literal"><span class="pre">RedirectHandler</span></code></a> 也支持正则表达式替换. 下面的规则重定向所有以 <code class="docutils literal"><span class="pre">/pictures/</span></code>
开始的请求用 <code class="docutils literal"><span class="pre">/photos/</span></code> 前缀代替:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/photos/(.*)&quot;</span><span class="p">,</span> <span class="n">MyPhotoHandler</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/pictures/(.*)&quot;</span><span class="p">,</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RedirectHandler</span><span class="p">,</span>
        <span class="nb">dict</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;/photos/\1&quot;</span><span class="p">)),</span>
    <span class="p">])</span>
</pre></div>
</div>
<p>不像 <a class="reference internal" href="index.html#tornado.web.RequestHandler.redirect" title="tornado.web.RequestHandler.redirect"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.redirect</span></code></a>, <a class="reference internal" href="index.html#tornado.web.RedirectHandler" title="tornado.web.RedirectHandler"><code class="xref py py-obj docutils literal"><span class="pre">RedirectHandler</span></code></a> 默认使用永久重定向.
这是因为路由表在运行时不会改变, 而且被认为是永久的.
当在处理程序中发现重定向的时候, 可能是其他可能改变的逻辑的结果.
用 <a class="reference internal" href="index.html#tornado.web.RedirectHandler" title="tornado.web.RedirectHandler"><code class="xref py py-obj docutils literal"><span class="pre">RedirectHandler</span></code></a> 发送临时重定向, 需要添加 <code class="docutils literal"><span class="pre">permanent=False</span></code> 到
<a class="reference internal" href="index.html#tornado.web.RedirectHandler" title="tornado.web.RedirectHandler"><code class="xref py py-obj docutils literal"><span class="pre">RedirectHandler</span></code></a> 的初始化参数.</p>
</div>
<div class="section" id="id5">
<h5>异步处理<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>Tornado默认会同步处理: 当 <code class="docutils literal"><span class="pre">get()</span></code>/<code class="docutils literal"><span class="pre">post()</span></code> 方法返回, 请求被认为结束
并且返回响应. 因为当一个处理程序正在运行的时候其他所有请求都被阻塞,
任何需要长时间运行的处理都应该是异步的, 这样它就可以在非阻塞的方式中调用
它的慢操作了. 这个话题更详细的内容包含在
<a class="reference internal" href="index.html#document-guide/async"><span class="doc">异步和非阻塞I/O</span></a> 中; 这部分是关于在 <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 子类中的异步技术的细节.</p>
<p>使用 <a class="reference internal" href="index.html#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">coroutine</span></code></a> 装饰器是做异步最简单的方式. 这允许你使用 <code class="docutils literal"><span class="pre">yield</span></code> 关键
字执行非阻塞I/O, 并且直到协程返回才发送响应. 查看 <a class="reference internal" href="index.html#document-guide/coroutines"><span class="doc">协程</span></a> 了解
更多细节.</p>
<p>在某些情况下, 协程不如回调为主的风格方便, 在这种情况下
<a class="reference internal" href="index.html#tornado.web.asynchronous" title="tornado.web.asynchronous"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.asynchronous</span></code></a> 装饰器可以用来代替. 当使用这个装饰器的时候,
响应不会自动发送; 而请求将一直保持开放直到callback调用
<a class="reference internal" href="index.html#tornado.web.RequestHandler.finish" title="tornado.web.RequestHandler.finish"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.finish</span></code></a>. 这需要应用程序确保这个方法被调用或者其他用户
的浏览器简单的挂起.</p>
<p>这里是一个使用Tornado&#8217;s 内置的 <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> 调用FriendFeed API的例
子:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">asynchronous</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">http</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">httpclient</span><span class="o">.</span><span class="n">AsyncHTTPClient</span><span class="p">()</span>
        <span class="n">http</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;http://friendfeed-api.com/v2/feed/bret&quot;</span><span class="p">,</span>
                   <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">error</span><span class="p">:</span> <span class="k">raise</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="n">json</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">escape</span><span class="o">.</span><span class="n">json_decode</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Fetched &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; entries &quot;</span>
                   <span class="s2">&quot;from the FriendFeed API&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</pre></div>
</div>
<p>当 <code class="docutils literal"><span class="pre">get()</span></code> 返回, 请求还没有完成. 当HTTP客户端最终调用
<code class="docutils literal"><span class="pre">on_response()</span></code>, 这个请求仍然是开放的, 通过调用 <code class="docutils literal"><span class="pre">self.finish()</span></code>, 响应最终刷到客户端.</p>
<p>为了方便对比, 这里有一个使用协程的相同的例子:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">http</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">httpclient</span><span class="o">.</span><span class="n">AsyncHTTPClient</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">http</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;http://friendfeed-api.com/v2/feed/bret&quot;</span><span class="p">)</span>
        <span class="n">json</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">escape</span><span class="o">.</span><span class="n">json_decode</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Fetched &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; entries &quot;</span>
                   <span class="s2">&quot;from the FriendFeed API&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>更多高级异步的示例, 请看 <a class="reference external" href="https://github.com/tornadoweb/tornado/tree/stable/demos/chat">chat
example application</a>, 实现了一个
使用 <a class="reference external" href="http://en.wikipedia.org/wiki/Push_technology#Long_polling">长轮询(long polling)</a> 的AJAX聊天室.
长轮询的可能想要覆盖 <code class="docutils literal"><span class="pre">on_connection_close()</span></code> 来在客户端关闭连接之后进行清
理(注意看方法的文档来查看警告).</p>
</div>
</div>
<span id="document-guide/templates"></span><div class="section" id="ui">
<h4>模板和UI<a class="headerlink" href="#ui" title="永久链接至标题">¶</a></h4>
<p>Tornado 包含一个简单,快速并灵活的模板语言. 本节介绍了语言以及相
关的问题,比如国际化.</p>
<p>Tornado 也可以使用其他的Python模板语言, 虽然没有准备把这些系统整合
到 <a class="reference internal" href="index.html#tornado.web.RequestHandler.render" title="tornado.web.RequestHandler.render"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.render</span></code></a> 里面. 而是简单的将模板转成字符串并传递
给 <a class="reference internal" href="index.html#tornado.web.RequestHandler.write" title="tornado.web.RequestHandler.write"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.write</span></code></a></p>
<div class="section" id="id1">
<h5>配置模板<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>默认情况下, Tornado会在和当前 <code class="docutils literal"><span class="pre">.py</span></code> 文件相同的目录查找关联的模板
文件. 如果想把你的模板文件放在不同的目录中, 可以使用
<code class="docutils literal"><span class="pre">template_path</span></code> <a class="reference internal" href="index.html#tornado.web.Application.settings" title="tornado.web.Application.settings"><code class="xref py py-obj docutils literal"><span class="pre">Application</span> <span class="pre">setting</span></code></a> (或复写 <a class="reference internal" href="index.html#tornado.web.RequestHandler.get_template_path" title="tornado.web.RequestHandler.get_template_path"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_template_path</span></code></a>
如果你不同的处理函数有不同的模板路径).</p>
<p>为了从非文件系统位置加载模板, 实例化子类 <a class="reference internal" href="index.html#tornado.template.BaseLoader" title="tornado.template.BaseLoader"><code class="xref py py-obj docutils literal"><span class="pre">tornado.template.BaseLoader</span></code></a>
并为其在应用设置(application setting)中配置
<code class="docutils literal"><span class="pre">template_loader</span></code> .</p>
<p>默认情况下编译出来的模板会被缓存; 为了关掉这个缓存也为了使(对目标的)
修改在重新加载后总是可见, 使用应用设置(application settings)中的
<code class="docutils literal"><span class="pre">compiled_template_cache=False</span></code> 或 <code class="docutils literal"><span class="pre">debug=True</span></code>.</p>
</div>
<div class="section" id="id2">
<h5>模板语法<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>一个Tornado模板仅仅是用一些标记把Python控制序列和表达式嵌入
HTML(或者任意其他文本格式)的文件中:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">title</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
       <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span> <span class="o">%</span><span class="p">}</span>
         <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">escape</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
       <span class="p">{</span><span class="o">%</span> <span class="n">end</span> <span class="o">%</span><span class="p">}</span>
     <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>如果你把这个目标保存为&#8221;template.html&#8221;并且把它放在你Python文件的
相同目录下, 你可以使用下面的代码渲染它:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Item 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Item 2&quot;</span><span class="p">,</span> <span class="s2">&quot;Item 3&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;template.html&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;My title&quot;</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span>
</pre></div>
</div>
<p>Tornado模板支持 <em>控制语句(control statements)</em> 和 <em>表达式(expressions)</em>.
控制语句被包在 <code class="docutils literal"><span class="pre">{%</span></code> 和 <code class="docutils literal"><span class="pre">%}</span></code> 中间, e.g.,
<code class="docutils literal"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">len(items)</span> <span class="pre">&gt;</span> <span class="pre">2</span> <span class="pre">%}</span></code>. 表达式被包在 <code class="docutils literal"><span class="pre">{{</span></code> 和
<code class="docutils literal"><span class="pre">}}</span></code> 之间, e.g., <code class="docutils literal"><span class="pre">{{</span> <span class="pre">items[0]</span> <span class="pre">}}</span></code>.</p>
<p>控制语句或多或少都和Python语句类似. 我们支持 <code class="docutils literal"><span class="pre">if</span></code>, <code class="docutils literal"><span class="pre">for</span></code>,
<code class="docutils literal"><span class="pre">while</span></code>, 和 <code class="docutils literal"><span class="pre">try</span></code>, 这些都必须使用 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">end</span> <span class="pre">%}</span></code> 来标识结束. 我们也
支持 <em>模板继承(template inheritance)</em> 使用 <code class="docutils literal"><span class="pre">extends</span></code> 和 <code class="docutils literal"><span class="pre">block</span></code>
标签声明, 这些内容的详细信息都可以在 <a class="reference internal" href="index.html#module-tornado.template" title="tornado.template"><code class="xref py py-obj docutils literal"><span class="pre">tornado.template</span></code></a> 中看到.</p>
<p>表达式可以是任意的Python表达式, 包括函数调用. 模板代码会在包含以下对象
和函数的命名空间中执行 (注意这个列表适用于使用 <a class="reference internal" href="index.html#tornado.web.RequestHandler.render" title="tornado.web.RequestHandler.render"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.render</span></code></a>
和 <a class="reference internal" href="index.html#tornado.web.RequestHandler.render_string" title="tornado.web.RequestHandler.render_string"><code class="xref py py-obj docutils literal"><span class="pre">render_string</span></code></a> 渲染模板的情况. 如果你直接在
<a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 之外使用 <a class="reference internal" href="index.html#module-tornado.template" title="tornado.template"><code class="xref py py-obj docutils literal"><span class="pre">tornado.template</span></code></a> 模块, 下面这些很多都不存
在).</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">escape</span></code>: <a class="reference internal" href="index.html#tornado.escape.xhtml_escape" title="tornado.escape.xhtml_escape"><code class="xref py py-obj docutils literal"><span class="pre">tornado.escape.xhtml_escape</span></code></a> 的别名</li>
<li><code class="docutils literal"><span class="pre">xhtml_escape</span></code>: <a class="reference internal" href="index.html#tornado.escape.xhtml_escape" title="tornado.escape.xhtml_escape"><code class="xref py py-obj docutils literal"><span class="pre">tornado.escape.xhtml_escape</span></code></a> 的别名</li>
<li><code class="docutils literal"><span class="pre">url_escape</span></code>: <a class="reference internal" href="index.html#tornado.escape.url_escape" title="tornado.escape.url_escape"><code class="xref py py-obj docutils literal"><span class="pre">tornado.escape.url_escape</span></code></a> 的别名</li>
<li><code class="docutils literal"><span class="pre">json_encode</span></code>: <a class="reference internal" href="index.html#tornado.escape.json_encode" title="tornado.escape.json_encode"><code class="xref py py-obj docutils literal"><span class="pre">tornado.escape.json_encode</span></code></a> 的别名</li>
<li><code class="docutils literal"><span class="pre">squeeze</span></code>: <a class="reference internal" href="index.html#tornado.escape.squeeze" title="tornado.escape.squeeze"><code class="xref py py-obj docutils literal"><span class="pre">tornado.escape.squeeze</span></code></a> 的别名</li>
<li><code class="docutils literal"><span class="pre">linkify</span></code>: <a class="reference internal" href="index.html#tornado.escape.linkify" title="tornado.escape.linkify"><code class="xref py py-obj docutils literal"><span class="pre">tornado.escape.linkify</span></code></a> 的别名</li>
<li><code class="docutils literal"><span class="pre">datetime</span></code>: Python <a class="reference external" href="https://docs.python.org/3.4/library/datetime.html#module-datetime" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">datetime</span></code></a> 模块</li>
<li><code class="docutils literal"><span class="pre">handler</span></code>: 当前的 <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 对象</li>
<li><code class="docutils literal"><span class="pre">request</span></code>: <a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest" title="tornado.httputil.HTTPServerRequest"><code class="xref py py-obj docutils literal"><span class="pre">handler.request</span></code></a> 的别名</li>
<li><code class="docutils literal"><span class="pre">current_user</span></code>: <a class="reference internal" href="index.html#tornado.web.RequestHandler.current_user" title="tornado.web.RequestHandler.current_user"><code class="xref py py-obj docutils literal"><span class="pre">handler.current_user</span></code></a> 的别名</li>
<li><code class="docutils literal"><span class="pre">locale</span></code>: <a class="reference internal" href="index.html#tornado.locale.Locale" title="tornado.locale.Locale"><code class="xref py py-obj docutils literal"><span class="pre">handler.locale</span></code></a> 的别名</li>
<li><code class="docutils literal"><span class="pre">_</span></code>: <a class="reference internal" href="index.html#tornado.locale.Locale.translate" title="tornado.locale.Locale.translate"><code class="xref py py-obj docutils literal"><span class="pre">handler.locale.translate</span></code></a> 的别名</li>
<li><code class="docutils literal"><span class="pre">static_url</span></code>: <a class="reference internal" href="index.html#tornado.web.RequestHandler.static_url" title="tornado.web.RequestHandler.static_url"><code class="xref py py-obj docutils literal"><span class="pre">handler.static_url</span></code></a> 的别名</li>
<li><code class="docutils literal"><span class="pre">xsrf_form_html</span></code>: <a class="reference internal" href="index.html#tornado.web.RequestHandler.xsrf_form_html" title="tornado.web.RequestHandler.xsrf_form_html"><code class="xref py py-obj docutils literal"><span class="pre">handler.xsrf_form_html</span></code></a> 的别名</li>
<li><code class="docutils literal"><span class="pre">reverse_url</span></code>: <a class="reference internal" href="index.html#tornado.web.Application.reverse_url" title="tornado.web.Application.reverse_url"><code class="xref py py-obj docutils literal"><span class="pre">Application.reverse_url</span></code></a> 的别名</li>
<li>所有从 <code class="docutils literal"><span class="pre">ui_methods</span></code> 和 <code class="docutils literal"><span class="pre">ui_modules</span></code>
<code class="docutils literal"><span class="pre">Application</span></code> 设置的条目</li>
<li>任何传递给 <a class="reference internal" href="index.html#tornado.web.RequestHandler.render" title="tornado.web.RequestHandler.render"><code class="xref py py-obj docutils literal"><span class="pre">render</span></code></a> 或
<a class="reference internal" href="index.html#tornado.web.RequestHandler.render_string" title="tornado.web.RequestHandler.render_string"><code class="xref py py-obj docutils literal"><span class="pre">render_string</span></code></a> 的关键字参数</li>
</ul>
<p>当你正在构建一个真正的应用, 你可能想要使用Tornado模板的所有特性,
尤其是目标继承. 阅读所有关于这些特性的介绍在 <a class="reference internal" href="index.html#module-tornado.template" title="tornado.template"><code class="xref py py-obj docutils literal"><span class="pre">tornado.template</span></code></a>
部分 (一些特性, 包括 <code class="docutils literal"><span class="pre">UIModules</span></code> 是在 <a class="reference internal" href="index.html#module-tornado.web" title="tornado.web"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web</span></code></a> 模块中实现的)</p>
<p>在引擎下, Tornado模板被直接转换为Python. 包含在你模板中的表达式会
逐字的复制到一个代表你模板的Python函数中. 我们不会试图阻止模板语言
中的任何东西; 我们明确的创造一个高度灵活的模板系统, 而不是有严格限制
的模板系统. 因此, 如果你在模板表达式中随意填充(代码), 当你执行它的时
候你也会得到各种随机错误.</p>
<p>所有模板输出默认都会使用 <a class="reference internal" href="index.html#tornado.escape.xhtml_escape" title="tornado.escape.xhtml_escape"><code class="xref py py-obj docutils literal"><span class="pre">tornado.escape.xhtml_escape</span></code></a> 函数转义.
这个行为可以通过传递 <code class="docutils literal"><span class="pre">autoescape=None</span></code> 给 <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 或者
<a class="reference internal" href="index.html#tornado.template.Loader" title="tornado.template.Loader"><code class="xref py py-obj docutils literal"><span class="pre">tornado.template.Loader</span></code></a> 构造器来全局改变, 对于一个模板文件可以使
用 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">autoescape</span> <span class="pre">None</span> <span class="pre">%}</span></code> 指令, 对于一个单一表达式可以使用
<code class="docutils literal"><span class="pre">{%</span> <span class="pre">raw</span> <span class="pre">...%}</span></code> 来代替 <code class="docutils literal"><span class="pre">{{</span> <span class="pre">...</span> <span class="pre">}}</span></code>. 此外, 在每个地方一个可选的
转义函数名可以被用来代替 <code class="docutils literal"><span class="pre">None</span></code>.</p>
<p>注意, 虽然Tornado的自动转义在预防XSS漏洞上是有帮助的, 但是它并不能
胜任所有的情况. 在某一位置出现的表达式, 例如Javascript 或 CSS, 可能需
要另外的转义. 此外, 要么是必须注意总是在可能包含不可信内容的HTML中
使用双引号和 <a class="reference internal" href="index.html#tornado.escape.xhtml_escape" title="tornado.escape.xhtml_escape"><code class="xref py py-obj docutils literal"><span class="pre">xhtml_escape</span></code></a> , 要么必须在属性中使用单独的转义函数
(参见 e.g. <a class="reference external" href="http://wonko.com/post/html-escaping">http://wonko.com/post/html-escaping</a>)</p>
</div>
<div class="section" id="id3">
<h5>国际化<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>当前用户的区域设置(无论他们是否登录)总是可以通过在请求处理程序中
使用 <code class="docutils literal"><span class="pre">self.locale</span></code> 或者在模板中使用 <code class="docutils literal"><span class="pre">locale</span></code> 进行访问. 区域的名字
(e.g., <code class="docutils literal"><span class="pre">en_US</span></code>) 可以通过 <code class="docutils literal"><span class="pre">locale.name</span></code> 获得, 你可以翻译字符串
通过 <a class="reference internal" href="index.html#tornado.locale.Locale.translate" title="tornado.locale.Locale.translate"><code class="xref py py-obj docutils literal"><span class="pre">Locale.translate</span></code></a> 方法. 模板也有一个叫做 <code class="docutils literal"><span class="pre">_()</span></code> 全局函数
用来进行字符串翻译. 翻译函数有两种形式:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Translate this string&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>是直接根据当前的区域设置进行翻译, 还有:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A person liked this&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%(num)d</span><span class="s2"> people liked this&quot;</span><span class="p">,</span>
  <span class="nb">len</span><span class="p">(</span><span class="n">people</span><span class="p">))</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;num&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">people</span><span class="p">)}</span>
</pre></div>
</div>
<p>是可以根据第三个参数的值来翻译字符串单复数的. 在上面的例子中,
如果 <code class="docutils literal"><span class="pre">len(people)</span></code> 是 <code class="docutils literal"><span class="pre">1</span></code>, 那么第一句翻译将被返回, 其他情况
第二句的翻译将会返回.</p>
<p>翻译最通用的模式四使用Python命名占位符变量(上面例子中的
<code class="docutils literal"><span class="pre">%(num)d</span></code> ) 因为占位符可以在翻译时变化.</p>
<p>这是一个正确的国际化模板:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">FriendFeed</span> <span class="o">-</span> <span class="p">{{</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Sign in&quot;</span><span class="p">)</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;{{ request.path }}&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Username&quot;</span><span class="p">)</span> <span class="p">}}</span> <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;username&quot;</span><span class="o">/&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Password&quot;</span><span class="p">)</span> <span class="p">}}</span> <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="o">/&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;{{ _(&quot;</span><span class="n">Sign</span> <span class="ow">in</span><span class="s2">&quot;) }}&quot;</span><span class="o">/&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
       <span class="p">{</span><span class="o">%</span> <span class="n">module</span> <span class="n">xsrf_form_html</span><span class="p">()</span> <span class="o">%</span><span class="p">}</span>
     <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>默认情况下, 我们通过用户的浏览器发送的 <code class="docutils literal"><span class="pre">Accept-Language</span></code> 头来发现
用户的区域设置. 如果我们没有发现恰当的 <code class="docutils literal"><span class="pre">Accept-Language</span></code> 值, 我们
会使用 <code class="docutils literal"><span class="pre">en_US</span></code> . 如果你让用户进行自己偏爱的区域设置, 你可以通过复
写 <a class="reference internal" href="index.html#tornado.web.RequestHandler.get_user_locale" title="tornado.web.RequestHandler.get_user_locale"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_user_locale</span></code></a> 来覆盖默认选择的区域:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BaseHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_current_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_secure_cookie</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_id</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get_user_by_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_user_locale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;locale&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_user</span><span class="o">.</span><span class="n">prefs</span><span class="p">:</span>
            <span class="c1"># Use the Accept-Language header</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_user</span><span class="o">.</span><span class="n">prefs</span><span class="p">[</span><span class="s2">&quot;locale&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal"><span class="pre">get_user_locale</span></code> 返回 <code class="docutils literal"><span class="pre">None</span></code>, 那我们(继续)依靠
<code class="docutils literal"><span class="pre">Accept-Language</span></code> 头(进行判断).</p>
<p><a class="reference internal" href="index.html#module-tornado.locale" title="tornado.locale"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locale</span></code></a> 模块支持两种形式加载翻译: 一种是用 <a class="reference external" href="https://docs.python.org/3.4/library/gettext.html#module-gettext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">gettext</span></code></a>
和相关的工具的 <code class="docutils literal"><span class="pre">.mo</span></code> 格式, 还有一种是简单的 <code class="docutils literal"><span class="pre">.csv</span></code> 格式.
应用程序在启动时通常会调用一次 <a class="reference internal" href="index.html#tornado.locale.load_translations" title="tornado.locale.load_translations"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locale.load_translations</span></code></a>
或者 <a class="reference internal" href="index.html#tornado.locale.load_gettext_translations" title="tornado.locale.load_gettext_translations"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locale.load_gettext_translations</span></code></a> 其中之一; 查看
这些方法来获取更多有关支持格式的详细信息..</p>
<p>你可以使用 <a class="reference internal" href="index.html#tornado.locale.get_supported_locales" title="tornado.locale.get_supported_locales"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locale.get_supported_locales()</span></code></a> 得到你的应用
所支持的区域(设置)列表. 用户的区域是从被支持的区域中选择距离最近
的匹配得到的. 例如, 如果用户的区域是 <code class="docutils literal"><span class="pre">es_GT</span></code>, 同时 <code class="docutils literal"><span class="pre">es</span></code> 区域
是被支持的, 请求中的 <code class="docutils literal"><span class="pre">self.locale</span></code> 将会设置为 <code class="docutils literal"><span class="pre">es</span></code> . 如果找不
到距离最近的匹配项, 我们将会使用 <code class="docutils literal"><span class="pre">en_US</span></code> .</p>
</div>
<div class="section" id="ui-modules">
<span id="id4"></span><h5>UI 模块<a class="headerlink" href="#ui-modules" title="永久链接至标题">¶</a></h5>
<p>Tornado支持 <em>UI modules</em> 使它易于支持标准, 在你的应用程序中复用
UI组件. UI模块像是特殊的函数调用来渲染你的页面上的组件并且它们可
以包装自己的CSS和JavaScript.</p>
<p>例如, 如果你实现一个博客, 并且你想要有博客入口出现在首页和每篇博
客页, 你可以实现一个 <code class="docutils literal"><span class="pre">Entry</span></code> 模块来在这些页面上渲染它们. 首先,
为你的UI模块新建一个Python模块, e.g., <code class="docutils literal"><span class="pre">uimodules.py</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Entry</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">UIModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">show_comments</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_string</span><span class="p">(</span>
            <span class="s2">&quot;module-entry.html&quot;</span><span class="p">,</span> <span class="n">entry</span><span class="o">=</span><span class="n">entry</span><span class="p">,</span> <span class="n">show_comments</span><span class="o">=</span><span class="n">show_comments</span><span class="p">)</span>
</pre></div>
</div>
<p>在你的应用设置中, 使用 <code class="docutils literal"><span class="pre">ui_modules</span></code> 配置, 告诉Tornado使用
<code class="docutils literal"><span class="pre">uimodules.py</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">uimodules</span>

<span class="k">class</span> <span class="nc">HomeHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM entries ORDER BY date DESC&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;home.html&quot;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="n">entries</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">EntryHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry_id</span><span class="p">):</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM entries WHERE id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">entry_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">:</span> <span class="k">raise</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;entry.html&quot;</span><span class="p">,</span> <span class="n">entry</span><span class="o">=</span><span class="n">entry</span><span class="p">)</span>

<span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ui_modules&quot;</span><span class="p">:</span> <span class="n">uimodules</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">HomeHandler</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/entry/([0-9]+)&quot;</span><span class="p">,</span> <span class="n">EntryHandler</span><span class="p">),</span>
<span class="p">],</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
</pre></div>
</div>
<p>在一个模板中, 你可以使用 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">module</span> <span class="pre">%}</span></code> 语法调用一个模块. 例如,
你可以调用 <code class="docutils literal"><span class="pre">Entry</span></code> 模块从 <code class="docutils literal"><span class="pre">home.html</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span> <span class="o">%</span><span class="p">}</span>
  <span class="p">{</span><span class="o">%</span> <span class="n">module</span> <span class="n">Entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">end</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>和 <code class="docutils literal"><span class="pre">entry.html</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">module</span> <span class="n">Entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">show_comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>模块可以包含自定义的CSS和JavaScript函数, 通过复写 <code class="docutils literal"><span class="pre">embedded_css</span></code>,
<code class="docutils literal"><span class="pre">embedded_javascript</span></code>, <code class="docutils literal"><span class="pre">javascript_files</span></code>, 或 <code class="docutils literal"><span class="pre">css_files</span></code>
方法:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Entry</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">UIModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">embedded_css</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;.entry { margin-bottom: 1em; }&quot;</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">show_comments</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_string</span><span class="p">(</span>
            <span class="s2">&quot;module-entry.html&quot;</span><span class="p">,</span> <span class="n">show_comments</span><span class="o">=</span><span class="n">show_comments</span><span class="p">)</span>
</pre></div>
</div>
<p>模块CSS和JavaScript将被加载(或包含)一次, 无论模块在一个页面上被使
用多少次. CSS总是包含在页面的 <code class="docutils literal"><span class="pre">&lt;head&gt;</span></code> 标签中, JavaScript 总是被
包含在页面最底部的 <code class="docutils literal"><span class="pre">&lt;/body&gt;</span></code> 标签之前.</p>
<p>当不需要额外的Python代码时, 一个模板文件本身可以作为一个模块. 例如,
先前的例子可以重写到下面的 <code class="docutils literal"><span class="pre">module-entry.html</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>{{ set_resources(embedded_css=&quot;.entry { margin-bottom: 1em; }&quot;) }}
&lt;!-- more template html... --&gt;
</pre></div>
</div>
<p>这个被修改过的模块模块可以被引用:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">module</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;module-entry.html&quot;</span><span class="p">,</span> <span class="n">show_comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">set_resources</span></code> 函数只能在模板中通过 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">module</span> <span class="pre">Template(...)</span> <span class="pre">%}</span></code>
才可用. 不像 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">...</span> <span class="pre">%}</span></code> 指令, 模板模块有一个明确的命名空间
它们的包含模板-它们只能看到全局模板命名空间和它们自己的关键字参数.</p>
</div>
</div>
<span id="document-guide/security"></span><div class="section" id="id1">
<h4>认证和安全<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="cookies-secure-cookies">
<h5>Cookies 和 secure cookies<a class="headerlink" href="#cookies-secure-cookies" title="永久链接至标题">¶</a></h5>
<p>你可以在用户浏览器中通过 <code class="docutils literal"><span class="pre">set_cookie</span></code> 方法设置 cookie:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cookie</span><span class="p">(</span><span class="s2">&quot;mycookie&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s2">&quot;mycookie&quot;</span><span class="p">,</span> <span class="s2">&quot;myvalue&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Your cookie was not set yet!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Your cookie was set!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>普通的cookie并不安全, 可以通过客户端修改. 如果你需要通过设置cookie,
例如来识别当前登录的用户, 就需要给你的cookie签名防止伪造. Tornado
支持通过 <a class="reference internal" href="index.html#tornado.web.RequestHandler.set_secure_cookie" title="tornado.web.RequestHandler.set_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">set_secure_cookie</span></code></a> 和
<a class="reference internal" href="index.html#tornado.web.RequestHandler.get_secure_cookie" title="tornado.web.RequestHandler.get_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">get_secure_cookie</span></code></a> 方法对cookie签名. 想要使用这
些方法, 你需要在你创建应用的时候, 指定一个名为 <code class="docutils literal"><span class="pre">cookie_secret</span></code>
的密钥. 你可以在应用的设置中以关键字参数的形式传递给应用程序:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
<span class="p">],</span> <span class="n">cookie_secret</span><span class="o">=</span><span class="s2">&quot;__TODO:_GENERATE_YOUR_OWN_RANDOM_VALUE_HERE__&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>签名后的cookie除了时间戳和一个
<a class="reference external" href="http://en.wikipedia.org/wiki/HMAC">HMAC</a> 签名还包含编码
后的cookie值. 如果cookie过期或者签名不匹配, <code class="docutils literal"><span class="pre">get_secure_cookie</span></code>
将返回 <code class="docutils literal"><span class="pre">None</span></code> 就像没有设置cookie一样. 上面例子的安全版本:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_secure_cookie</span><span class="p">(</span><span class="s2">&quot;mycookie&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_secure_cookie</span><span class="p">(</span><span class="s2">&quot;mycookie&quot;</span><span class="p">,</span> <span class="s2">&quot;myvalue&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Your cookie was not set yet!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Your cookie was set!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Tornado的安全cookie保证完整性但是不保证机密性. 也就是说, cookie不能被修改
但是它的内容对用户是可见的. 密钥 <code class="docutils literal"><span class="pre">cookie_secret</span></code> 是一个对称的key, 而且必
须保密&#8211;任何获得这个key的人都可以伪造出自己签名的cookie.</p>
<p>默认情况下, Tornado的安全cookie过期时间是30天. 可以给 <code class="docutils literal"><span class="pre">set_secure_cookie</span></code>
使用 <code class="docutils literal"><span class="pre">expires_days</span></code> 关键字参数 <em>同时</em> <code class="docutils literal"><span class="pre">get_secure_cookie</span></code> 设置
<code class="docutils literal"><span class="pre">max_age_days</span></code> 参数也可以达到效果. 这两个值分别通过这样(设置)你就可以达
到如下的效果, 例如大多数情况下有30天有效期的cookie, 但是对某些敏感操作(例
如修改账单信息)你可以使用一个较小的 <code class="docutils literal"><span class="pre">max_age_days</span></code> .</p>
<p>Tornado也支持多签名密钥, 使签名密钥轮换. 然后 <code class="docutils literal"><span class="pre">cookie_secret</span></code> 必须是一个
以整数key版本作为key, 以相对应的密钥作为值的字典. 当前使用的签名键
必须是 应用设置中 <code class="docutils literal"><span class="pre">key_version</span></code> 的集合. 不过字典中的其他key都允许做
cookie签名验证, 如果当前key版本在cookie集合中.为了实现cookie更新, 可以通过
<a class="reference internal" href="index.html#tornado.web.RequestHandler.get_secure_cookie_key_version" title="tornado.web.RequestHandler.get_secure_cookie_key_version"><code class="xref py py-obj docutils literal"><span class="pre">get_secure_cookie_key_version</span></code></a> 查询当前key版本.</p>
</div>
<div class="section" id="user-authentication">
<span id="id2"></span><h5>用户认证<a class="headerlink" href="#user-authentication" title="永久链接至标题">¶</a></h5>
<p>当前已经通过认证的用户在每个请求处理函数中都可以通过
<a class="reference internal" href="index.html#tornado.web.RequestHandler.current_user" title="tornado.web.RequestHandler.current_user"><code class="xref py py-obj docutils literal"><span class="pre">self.current_user</span></code></a> 得到, 在每个模板中
可以使用 <code class="docutils literal"><span class="pre">current_user</span></code> 获得. 默认情况下, <code class="docutils literal"><span class="pre">current_user</span></code> 是
<code class="docutils literal"><span class="pre">None</span></code>.</p>
<p>为了在你的应用程序中实现用户认证, 你需要在你的请求处理函数中复写
<code class="docutils literal"><span class="pre">get_current_user()</span></code> 方法来判断当前用户, 比如可以基于cookie的值.
这里有一个例子, 这个例子允许用户简单的通过一个保存在cookie中的特殊昵称
登录到应用程序中:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BaseHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_current_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_secure_cookie</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_user</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">escape</span><span class="o">.</span><span class="n">xhtml_escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">LoginHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;html&gt;&lt;body&gt;&lt;form action=&quot;/login&quot; method=&quot;post&quot;&gt;&#39;</span>
                   <span class="s1">&#39;Name: &lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;&#39;</span>
                   <span class="s1">&#39;&lt;input type=&quot;submit&quot; value=&quot;Sign in&quot;&gt;&#39;</span>
                   <span class="s1">&#39;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_secure_cookie</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>

<span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="n">LoginHandler</span><span class="p">),</span>
<span class="p">],</span> <span class="n">cookie_secret</span><span class="o">=</span><span class="s2">&quot;__TODO:_GENERATE_YOUR_OWN_RANDOM_VALUE_HERE__&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>你可以使用 <a class="reference external" href="http://www.python.org/dev/peps/pep-0318/">Python
装饰器(decorator)</a>
<a class="reference internal" href="index.html#tornado.web.authenticated" title="tornado.web.authenticated"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.authenticated</span></code></a> 要求用户登录. 如果请求方法带有这个装饰器
并且用户没有登录, 用户将会被重定向到 <code class="docutils literal"><span class="pre">login_url</span></code> (另一个应用设置).
上面的例子可以被重写:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">authenticated</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">escape</span><span class="o">.</span><span class="n">xhtml_escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>

<span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;cookie_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;__TODO:_GENERATE_YOUR_OWN_RANDOM_VALUE_HERE__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;login_url&quot;</span><span class="p">:</span> <span class="s2">&quot;/login&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="n">LoginHandler</span><span class="p">),</span>
<span class="p">],</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
</pre></div>
</div>
<p>如果你使用 <code class="docutils literal"><span class="pre">authenticated</span></code> 装饰 <code class="docutils literal"><span class="pre">post()</span></code> 方法并且用户没有登录,
服务将返回一个 <code class="docutils literal"><span class="pre">403</span></code> 响应. <code class="docutils literal"><span class="pre">&#64;authenticated</span></code> 装饰器是
<code class="docutils literal"><span class="pre">if</span> <span class="pre">not</span> <span class="pre">self.current_user:</span> <span class="pre">self.redirect()</span></code> 的简写. 可能不适合
非基于浏览器的登录方案.</p>
<p>通过 <a class="reference external" href="https://github.com/tornadoweb/tornado/tree/stable/demos/blog">Tornado Blog example application</a>
可以看到一个使用用户验证(并且在MySQL数据库中存储用户数据)的完整例子.</p>
</div>
<div class="section" id="id3">
<h5>第三方用户验证<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p><a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a> 模块实现了对一些网络上最流行的网站的身份认证和授权协议,
包括Google/Gmail, Facebook, Twitter,和FriendFeed. 该模块包括通过这些
网站登录用户的方法, 并在适用情况下允许访问该网站服务的方法, 例如, 下载
一个用户的地址簿或者在他们支持下发布一条Twitter信息.</p>
<p>这是个使用Google身份认证, 在cookie中保存Google的认证信息以供之后访问
的示例处理程序:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GoogleOAuth2LoginHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">,</span>
                               <span class="n">tornado</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">GoogleOAuth2Mixin</span><span class="p">):</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">user</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_authenticated_user</span><span class="p">(</span>
                <span class="n">redirect_uri</span><span class="o">=</span><span class="s1">&#39;http://your.site.com/auth/google&#39;</span><span class="p">,</span>
                <span class="n">code</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">))</span>
            <span class="c1"># Save the user with e.g. set_secure_cookie</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorize_redirect</span><span class="p">(</span>
                <span class="n">redirect_uri</span><span class="o">=</span><span class="s1">&#39;http://your.site.com/auth/google&#39;</span><span class="p">,</span>
                <span class="n">client_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;google_oauth&#39;</span><span class="p">][</span><span class="s1">&#39;key&#39;</span><span class="p">],</span>
                <span class="n">scope</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">],</span>
                <span class="n">response_type</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">,</span>
                <span class="n">extra_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;approval_prompt&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>查看 <a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a> 模块的文档以了解更多细节.</p>
</div>
<div class="section" id="xsrf">
<span id="id4"></span><h5>跨站请求伪造(防护)<a class="headerlink" href="#xsrf" title="永久链接至标题">¶</a></h5>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">跨站请求伪造(Cross-site request
forgery)</a>, 或
XSRF, 是所有web应用程序面临的一个主要问题. 可以通过
<a class="reference external" href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">Wikipedia
文章</a> 来了解
更多关于XSRF的细节.</p>
<p>普遍接受的预防XSRF攻击的方案是让每个用户的cookie都是不确定的值, 并且
把那个cookie值在你站点的每个form提交中作为额外的参数包含进来. 如果cookie
和form提交中的值不匹配, 则请求可能是伪造的.</p>
<p>Tornado内置XSRF保护. 你需要在你的应用设置中使用 <code class="docutils literal"><span class="pre">xsrf_cookies</span></code> 便可
以在你的网站上使用:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;cookie_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;__TODO:_GENERATE_YOUR_OWN_RANDOM_VALUE_HERE__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;login_url&quot;</span><span class="p">:</span> <span class="s2">&quot;/login&quot;</span><span class="p">,</span>
    <span class="s2">&quot;xsrf_cookies&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="n">LoginHandler</span><span class="p">),</span>
<span class="p">],</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
</pre></div>
</div>
<p>如果设置了 <code class="docutils literal"><span class="pre">xsrf_cookies</span></code> , Tornado web应用程序将会给所有用户设置
<code class="docutils literal"><span class="pre">_xsrf</span></code> cookie并且拒绝所有不包含一个正确的 <code class="docutils literal"><span class="pre">_xsrf</span></code> 值的
<code class="docutils literal"><span class="pre">POST</span></code>, <code class="docutils literal"><span class="pre">PUT</span></code>, 或 <code class="docutils literal"><span class="pre">DELETE</span></code> 请求. 如果你打开这个设置, 你必须给
所有通过 <code class="docutils literal"><span class="pre">POST</span></code> 请求的form提交添加这个字段. 你可以使用一个特性的
<a class="reference internal" href="index.html#tornado.web.UIModule" title="tornado.web.UIModule"><code class="xref py py-obj docutils literal"><span class="pre">UIModule</span></code></a> <code class="docutils literal"><span class="pre">xsrf_form_html()</span></code> 来做这件事情,
这个方法在所有模板中都是可用的:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;/new_message&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
  <span class="p">{</span><span class="o">%</span> <span class="n">module</span> <span class="n">xsrf_form_html</span><span class="p">()</span> <span class="o">%</span><span class="p">}</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;message&quot;</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Post&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>如果你提交一个AJAX的 <code class="docutils literal"><span class="pre">POST</span></code> 请求, 你也需要在每个请求中给你的
JavaScript添加 <code class="docutils literal"><span class="pre">_xsrf</span></code> 值. 这是我们在FriendFeed为了AJAX的
<code class="docutils literal"><span class="pre">POST</span></code> 请求使用的一个 <a class="reference external" href="http://jquery.com/">jQuery</a> 函数, 可以
自动的给所有请求添加 <code class="docutils literal"><span class="pre">_xsrf</span></code> 值:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>function getCookie(name) {
    var r = document.cookie.match(&quot;\\b&quot; + name + &quot;=([^;]*)\\b&quot;);
    return r ? r[1] : undefined;
}

jQuery.postJSON = function(url, args, callback) {
    args._xsrf = getCookie(&quot;_xsrf&quot;);
    $.ajax({url: url, data: $.param(args), dataType: &quot;text&quot;, type: &quot;POST&quot;,
        success: function(response) {
        callback(eval(&quot;(&quot; + response + &quot;)&quot;));
    }});
};
</pre></div>
</div>
<p>对于 <code class="docutils literal"><span class="pre">PUT</span></code> 和 <code class="docutils literal"><span class="pre">DELETE</span></code> 请求(除了不使用form编码(form-encoded) 参数
的 <code class="docutils literal"><span class="pre">POST</span></code> 请求, XSRF token也会通过一个 <code class="docutils literal"><span class="pre">X-XSRFToken</span></code> 的HTTP头传递.
XSRF cookie 通常在使用 <code class="docutils literal"><span class="pre">xsrf_form_html</span></code> 会设置, 但是在不使用正规
form的纯Javascript应用中, 你可能需要访问 <code class="docutils literal"><span class="pre">self.xsrf_token</span></code> 手动设置
(只读这个属性足够设置cookie了).</p>
<p>如果你需要自定义每一个处理程序基础的XSRF行为, 你可以复写
<a class="reference internal" href="index.html#tornado.web.RequestHandler.check_xsrf_cookie" title="tornado.web.RequestHandler.check_xsrf_cookie"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.check_xsrf_cookie()</span></code></a>. 例如, 如果你有一个没有使用
cookie验证的API, 你可能想禁用XSRF保护, 可以通过使 <code class="docutils literal"><span class="pre">check_xsrf_cookie()</span></code>
不做任何处理. 然而, 如果你支持基于cookie和非基于cookie的认证, 重要的是,
当前带有cookie认证的请求究竟什么时候使用XSRF保护.</p>
</div>
</div>
<span id="document-guide/running"></span><div class="section" id="id1">
<h4>运行和部署<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>因为Tornado内置了自己的HTTPServer, 运行和部署它与其他Python web框架不
太一样. 你需要写一个 <code class="docutils literal"><span class="pre">main()</span></code> 函数来启动服务, 而不是配置一个WSGI容器
来运行你的应用:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">make_app</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
    <span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>配置你的操作系统或者进程管理器来运行这个程序以启动服务. 请注意, 增加每个
进程允许打开的最大文件句柄数是可能是必要的(为了避免&#8221;Too many open files&#8221;
的错误). 为了增加这个上限(例如设置为50000 ) 你可以使用ulimit命令,
修改/etc/security/limits.conf 或者设置 <code class="docutils literal"><span class="pre">minfds</span></code> 在你的supervisord配置中.</p>
<div class="section" id="id2">
<h5>进程和端口<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>由于Python的GIL(全局解释器锁), 为了充分利用多CPU的机器, 运行多个Python
进程是很有必要的. 通常, 最好是每个CPU运行一个进程.</p>
<p>Tornado包含了一个内置的多进程模式来一次启动多个进程. 这需要一个在main
函数上做点微小的改变:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">make_app</span><span class="p">()</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">httpserver</span><span class="o">.</span><span class="n">HTTPServer</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># forks one process per cpu</span>
    <span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>这是最简单的方式来启动多进程并让他们共享同样的端口, 虽然它有一些局限
性. 首先, 每个子进程将有它自己的IOLoop, 所以fork之前, 不接触全局
IOLoop实例是重要的(甚至是间接的). 其次, 在这个模型中, 很难做到零停机
(zero-downtime)更新. 最后, 因为所有的进程共享相同的端口, 想单独监控
它们就更加困难了.</p>
<p>对更复杂的部署, 建议启动独立的进程, 并让它们各自监听不同的端口.
<a class="reference external" href="http://www.supervisord.org">supervisord</a> 的&#8221;进程组(process groups)&#8221;
功能是一个很好的方式来安排这些. 当每个进程使用不同的端口, 一个外部的
负载均衡器例如HAProxy 或nginx通常需要对外向访客提供一个单一的地址.</p>
</div>
<div class="section" id="id3">
<h5>运行在负载均衡器后面<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>当运行在一个负载均衡器例如nginx, 建议传递 <code class="docutils literal"><span class="pre">xheaders=True</span></code> 给
<a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> 的构造器. 这将告诉Tornado使用类似 <code class="docutils literal"><span class="pre">X-Real-IP</span></code>
这样的HTTP头来获取用户的IP地址而不是把所有流量都认为来自于
负载均衡器的IP地址.</p>
<p>这是一份原始的nginx配置文件, 在结构上类似于我们在FriendFeed所使用的
配置. 这是假设nginx和Tornado server运行在同一台机器上的, 并且四个
Tornado server正运行在8000 - 8003端口:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>user nginx;
worker_processes 1;

error_log /var/log/nginx/error.log;
pid /var/run/nginx.pid;

events {
    worker_connections 1024;
    use epoll;
}

http {
    # Enumerate all the Tornado servers here
    upstream frontends {
        server 127.0.0.1:8000;
        server 127.0.0.1:8001;
        server 127.0.0.1:8002;
        server 127.0.0.1:8003;
    }

    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    access_log /var/log/nginx/access.log;

    keepalive_timeout 65;
    proxy_read_timeout 200;
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    gzip on;
    gzip_min_length 1000;
    gzip_proxied any;
    gzip_types text/plain text/html text/css text/xml
               application/x-javascript application/xml
               application/atom+xml text/javascript;

    # Only retry if there was a communication error, not a timeout
    # on the Tornado server (to avoid propagating &quot;queries of death&quot;
    # to all frontends)
    proxy_next_upstream error;

    server {
        listen 80;

        # Allow file uploads
        client_max_body_size 50M;

        location ^~ /static/ {
            root /var/www;
            if ($query_string) {
                expires max;
            }
        }
        location = /favicon.ico {
            rewrite (.*) /static/favicon.ico;
        }
        location = /robots.txt {
            rewrite (.*) /static/robots.txt;
        }

        location / {
            proxy_pass_header Server;
            proxy_set_header Host $http_host;
            proxy_redirect off;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Scheme $scheme;
            proxy_pass http://frontends;
        }
    }
}
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>静态文件和文件缓存<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>Tornado中, 你可以通过在应用程序中指定特殊的 <code class="docutils literal"><span class="pre">static_path</span></code> 来提供静态文
件服务:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;static_path&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;static&quot;</span><span class="p">),</span>
    <span class="s2">&quot;cookie_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;__TODO:_GENERATE_YOUR_OWN_RANDOM_VALUE_HERE__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;login_url&quot;</span><span class="p">:</span> <span class="s2">&quot;/login&quot;</span><span class="p">,</span>
    <span class="s2">&quot;xsrf_cookies&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="n">LoginHandler</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/(apple-touch-icon\.png)&quot;</span><span class="p">,</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">StaticFileHandler</span><span class="p">,</span>
     <span class="nb">dict</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;static_path&#39;</span><span class="p">])),</span>
<span class="p">],</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
</pre></div>
</div>
<p>这些设置将自动的把所有以 <code class="docutils literal"><span class="pre">/static/</span></code> 开头的请求从static目录进行提供,
e.g., <code class="docutils literal"><span class="pre">http://localhost:8888/static/foo.png</span></code> 将会通过指定的static目录
提供 <code class="docutils literal"><span class="pre">foo.png</span></code> 文件. 我们也自动的会从static目录提供 <code class="docutils literal"><span class="pre">/robots.txt</span></code>
和 <code class="docutils literal"><span class="pre">/favicon.ico</span></code> (尽管它们并没有以 <code class="docutils literal"><span class="pre">/static/</span></code> 前缀开始).</p>
<p>在上面的设置中, 我们明确的配置Tornado 提供 <code class="docutils literal"><span class="pre">apple-touch-icon.png</span></code>
文件从 <a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> 根下, 虽然文件在static文件目录中.
(正则表达式捕获组必须告诉 <a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> 请求的文件名; 调用捕获组
把文件名作为方法的参数传递给处理程序.) 你可以做同样的事情 e.g.
从网站的根提供 <code class="docutils literal"><span class="pre">sitemap.xml</span></code> 文件. 当然, 你也可以通过在你的HTML中使用
<code class="docutils literal"><span class="pre">&lt;link</span> <span class="pre">/&gt;</span></code> 标签来避免伪造根目录的 <code class="docutils literal"><span class="pre">apple-touch-icon.png</span></code> .</p>
<p>为了改善性能, 通常情况下, 让浏览器主动缓存静态资源是个好主意, 这样浏览器
就不会发送不必要的可能在渲染页面时阻塞的 <code class="docutils literal"><span class="pre">If-Modified-Since</span></code> 或
<code class="docutils literal"><span class="pre">Etag</span></code> 请求了. Tornado使用 <em>静态内容版本(static content versioning)</em>
来支持此项功能.</p>
<p>为了使用这些功能, 在你的模板中使用 <a class="reference internal" href="index.html#tornado.web.RequestHandler.static_url" title="tornado.web.RequestHandler.static_url"><code class="xref py py-obj docutils literal"><span class="pre">static_url</span></code></a> 方法
而不是直接在你的HTML中输入静态文件的URL:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">FriendFeed</span> <span class="o">-</span> <span class="p">{{</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Home&quot;</span><span class="p">)</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;{{ static_url(&quot;</span><span class="n">images</span><span class="o">/</span><span class="n">logo</span><span class="o">.</span><span class="n">png</span><span class="s2">&quot;) }}&quot;</span><span class="o">/&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">static_url()</span></code> 函数将把相对路径翻译成一个URI类似于
<code class="docutils literal"><span class="pre">/static/images/logo.png?v=aae54</span></code>. 其中的 <code class="docutils literal"><span class="pre">v</span></code> 参数是 <code class="docutils literal"><span class="pre">logo.png</span></code>
内容的哈希(hash), 并且它的存在使得Tornado服务向用户的浏览器发送缓存头,
这将使浏览器无限期的缓存内容.</p>
<p>因为参数 <code class="docutils literal"><span class="pre">v</span></code> 是基于文件内容的, 如果你更新一个文件并重启服务, 它将发送
一个新的 <code class="docutils literal"><span class="pre">v</span></code> 值, 所以用户的浏览器将会自动的拉去新的文件. 如果文件的内
容没有改变, 浏览器将会继续使用本地缓存的副本, 而不会从服务器检查更新,
显著的提高了渲染性能.</p>
<p>在生产中, 你可能想提供静态文件通过一个更优的静态服务器, 比如
<a class="reference external" href="http://nginx.net/">nginx</a> . 你可以配置任何web服务器识别通过
<code class="docutils literal"><span class="pre">static_url()</span></code> 提供的版本标签并相应的设置缓存头. 下面是我们在
FriendFeed 使用的nginx相关配置的一部分:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>location /static/ {
    root /var/friendfeed/static;
    if ($query_string) {
        expires max;
    }
 }
</pre></div>
</div>
</div>
<div class="section" id="debug">
<span id="debug-mode"></span><h5>Debug模式和自动重载<a class="headerlink" href="#debug" title="永久链接至标题">¶</a></h5>
<p>如果传递 <code class="docutils literal"><span class="pre">debug=True</span></code> 配置给 <code class="docutils literal"><span class="pre">Application</span></code> 的构造函数, 应用程序将会
运行在debug/开发模式. 在这个模式下, 为了方便于开发的一些功能将被启用(
每一个也可以作为独立的标签使用; 如果它们都被专门指定, 那它们都将获得
独立的优先级):</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">autoreload=True</span></code>: 应用程序将会观察它的源文件是否改变, 并且当任何
文件改变的时候便重载它自己. 这减少了在开发中需要手动重启服务的需求.
然而, 在debug模式下, 某些错误(例如import的时候有语法错误)会导致服务
关闭, 并且无法自动恢复.</li>
<li><code class="docutils literal"><span class="pre">compiled_template_cache=False</span></code>: 模板将不会被缓存.</li>
<li><code class="docutils literal"><span class="pre">static_hash_cache=False</span></code>: 静态文件哈希 (被 <code class="docutils literal"><span class="pre">static_url</span></code> 函数
使用) 将不会被缓存</li>
<li><code class="docutils literal"><span class="pre">serve_traceback=True</span></code>: 当一个异常在 <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 中没有捕获,
将会生成一个包含调用栈信息的错误页.</li>
</ul>
<p>自动重载(autoreload)模式和 <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> 的多进程模式不兼容. 你不能给
<a class="reference internal" href="index.html#tornado.tcpserver.TCPServer.start" title="tornado.tcpserver.TCPServer.start"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer.start</span></code></a> 传递1以外的参数(或者调用
<a class="reference internal" href="index.html#tornado.process.fork_processes" title="tornado.process.fork_processes"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process.fork_processes</span></code></a>) 当你使用自动重载模式的时候.</p>
<p>debug模式的自动重载功能可作为一个独立的模块位于 <a class="reference internal" href="index.html#module-tornado.autoreload" title="tornado.autoreload"><code class="xref py py-obj docutils literal"><span class="pre">tornado.autoreload</span></code></a>.
以下两者可以结合使用, 在语法错误之时提供额外的健壮性: 设置
<code class="docutils literal"><span class="pre">autoreload=True</span></code> 可以在app运行时检测文件修改, 还有启动
<code class="docutils literal"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">tornado.autoreload</span> <span class="pre">myserver.py</span></code> 来捕获任意语法错误或者
其他的启动时错误.</p>
<p>重载会丢失任何Python解释器命令行参数(e.g. <code class="docutils literal"><span class="pre">-u</span></code>). 因为它使用
<a class="reference external" href="https://docs.python.org/3.4/library/sys.html#sys.executable" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">sys.executable</span></code></a> 和 <a class="reference external" href="https://docs.python.org/3.4/library/sys.html#sys.argv" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">sys.argv</span></code></a> 重新执行Python. 此外, 修改这些变量
将造成重载错误.</p>
<p>在一些平台(包括Windows 和Mac OSX 10.6之前), 进程不能被&#8221;原地&#8221;更新,
所以当检测到代码更新, 旧服务就会退出然后启动一个新服务. 这已经被公知
来混淆一些IDE.</p>
</div>
<div class="section" id="wsgigoogle-app-engine">
<h5>WSGI和Google App Engine<a class="headerlink" href="#wsgigoogle-app-engine" title="永久链接至标题">¶</a></h5>
<p>Tornado通常是独立运行的, 不需要一个WSGI容器. 然而, 在一些环境中
(例如Google App Engine), 只运行WSGI, 应用程序不能独立运行自己的
服务. 在这种情况下, Tornado支持一个有限制的操作模式, 不支持异步
操作但允许一个Tornado&#8217;s功能的子集在仅WSGI环境中. 以下功能在WSGI
模式下是不支持的, 包括协程, <code class="docutils literal"><span class="pre">&#64;asynchronous</span></code> 装饰器,
<a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a>, <code class="docutils literal"><span class="pre">auth</span></code> 模块和WebSockets.</p>
<p>你可以使用 <a class="reference internal" href="index.html#tornado.wsgi.WSGIAdapter" title="tornado.wsgi.WSGIAdapter"><code class="xref py py-obj docutils literal"><span class="pre">tornado.wsgi.WSGIAdapter</span></code></a> 把一个Tornado
<a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 转换成WSGI应用. 在这个例子中, 配置你的WSGI容器发
现 <code class="docutils literal"><span class="pre">application</span></code> 对象:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tornado.web</span>
<span class="kn">import</span> <span class="nn">tornado.wsgi</span>

<span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span>

<span class="n">tornado_app</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
<span class="p">])</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">wsgi</span><span class="o">.</span><span class="n">WSGIAdapter</span><span class="p">(</span><span class="n">tornado_app</span><span class="p">)</span>
</pre></div>
</div>
<p>查看 <a class="reference external" href="https://github.com/tornadoweb/tornado/tree/stable/demos/appengine">appengine example application</a> 以
了解AppEngine在Tornado上开发的完整功能.</p>
</div>
</div>
</div>
</div>
<span id="document-webframework"></span><div class="section" id="web">
<h3>web框架<a class="headerlink" href="#web" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-web"></span><div class="section" id="tornado-web-requesthandler-application">
<h4><code class="docutils literal"><span class="pre">tornado.web</span></code> &#8212; <code class="docutils literal"><span class="pre">RequestHandler</span></code> 和 <code class="docutils literal"><span class="pre">Application</span></code> 类<a class="headerlink" href="#tornado-web-requesthandler-application" title="永久链接至标题">¶</a></h4>
<span class="target" id="module-tornado.web"></span><p><code class="docutils literal"><span class="pre">tornado.web</span></code> 提供了一种带有异步功能并允许它扩展到大量开放连接的
简单的web 框架, 使其成为处理 <a class="reference external" href="http://en.wikipedia.org/wiki/Push_technology#Long_polling">长连接(long polling)</a> 的一种理想选择.</p>
<p>这里有一个简单的&#8221;Hello, world&#8221;示例应用:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tornado.ioloop</span>
<span class="kn">import</span> <span class="nn">tornado.web</span>

<span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
    <span class="p">])</span>
    <span class="n">application</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
    <span class="n">tornado</span><span class="o">.</span><span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>查看 <a class="reference internal" href="index.html#document-guide"><span class="doc">用户指南</span></a> 以了解更多信息.</p>
<div class="section" id="id1">
<h5>线程安全说明<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>一般情况下, 在 <a class="reference internal" href="#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 中的方法和Tornado 中其他的方法不是
线程安全的. 尤其是一些方法, 例如 <a class="reference internal" href="#tornado.web.RequestHandler.write" title="tornado.web.RequestHandler.write"><code class="xref py py-obj docutils literal"><span class="pre">write()</span></code></a>,
<a class="reference internal" href="#tornado.web.RequestHandler.finish" title="tornado.web.RequestHandler.finish"><code class="xref py py-obj docutils literal"><span class="pre">finish()</span></code></a>, 和 <a class="reference internal" href="#tornado.web.RequestHandler.flush" title="tornado.web.RequestHandler.flush"><code class="xref py py-obj docutils literal"><span class="pre">flush()</span></code></a> 要求只能从
主线程调用. 如果你使用多线程, 那么在结束请求之前, 使用
<a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_callback" title="tornado.ioloop.IOLoop.add_callback"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_callback</span></code></a> 来把控制权传送回主线程是很重要的.</p>
</div>
<div class="section" id="request-handlers">
<h5>Request handlers<a class="headerlink" href="#request-handlers" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.web.RequestHandler">
<em class="property">class </em><code class="descclassname">tornado.web.</code><code class="descname">RequestHandler</code><span class="sig-paren">(</span><em>application</em>, <em>request</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler" title="永久链接至目标">¶</a></dt>
<dd><p>HTTP请求处理的基类.</p>
<p>子类至少应该是以下&#8221;Entry points&#8221; 部分中被定义的方法其中之一.</p>
</dd></dl>

<div class="section" id="entry-points">
<h6>Entry points<a class="headerlink" href="#entry-points" title="永久链接至标题">¶</a></h6>
<dl class="method">
<dt id="tornado.web.RequestHandler.initialize">
<code class="descclassname">RequestHandler.</code><code class="descname">initialize</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.initialize"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.initialize" title="永久链接至目标">¶</a></dt>
<dd><p>子类初始化(Hook).</p>
<p>作为url spec的第三个参数传递的字典, 将作为关键字参数提供给
initialize().</p>
<p>例子:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ProfileHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
        <span class="o">...</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/user/(.*)&#39;</span><span class="p">,</span> <span class="n">ProfileHandler</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)),</span>
    <span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.prepare">
<code class="descclassname">RequestHandler.</code><code class="descname">prepare</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.prepare"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.prepare" title="永久链接至目标">¶</a></dt>
<dd><p>在每个请求的最开始被调用, 在 <a class="reference internal" href="#tornado.web.RequestHandler.get" title="tornado.web.RequestHandler.get"><code class="xref py py-obj docutils literal"><span class="pre">get</span></code></a>/<a class="reference internal" href="#tornado.web.RequestHandler.post" title="tornado.web.RequestHandler.post"><code class="xref py py-obj docutils literal"><span class="pre">post</span></code></a>/等方法之前.</p>
<p>通过复写这个方法, 可以执行共同的初始化, 而不用考虑每个请求方法.</p>
<p>异步支持: 这个方法使用 <a class="reference internal" href="index.html#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">gen.coroutine</span></code></a> 或 <a class="reference internal" href="index.html#tornado.concurrent.return_future" title="tornado.concurrent.return_future"><code class="xref py py-obj docutils literal"><span class="pre">return_future</span></code></a>
装饰器来使它异步( <a class="reference internal" href="#tornado.web.asynchronous" title="tornado.web.asynchronous"><code class="xref py py-obj docutils literal"><span class="pre">asynchronous</span></code></a> 装饰器不能被用在 <a class="reference internal" href="#tornado.web.RequestHandler.prepare" title="tornado.web.RequestHandler.prepare"><code class="xref py py-obj docutils literal"><span class="pre">prepare</span></code></a>).
如果这个方法返回一个 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 对象, 执行将不再进行, 直到
<a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 对象完成.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能: </span>异步支持.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.on_finish">
<code class="descclassname">RequestHandler.</code><code class="descname">on_finish</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.on_finish"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.on_finish" title="永久链接至目标">¶</a></dt>
<dd><p>在一个请求结束后被调用.</p>
<p>复写这个方法来执行清理, 日志记录等. 这个方法和 <a class="reference internal" href="#tornado.web.RequestHandler.prepare" title="tornado.web.RequestHandler.prepare"><code class="xref py py-obj docutils literal"><span class="pre">prepare</span></code></a> 是相
对应的. <code class="docutils literal"><span class="pre">on_finish</span></code> 可能不产生任何输出, 因为它是在响应被送
到客户端后才被调用.</p>
</dd></dl>

<p id="verbs">执行后面任何的方法 (统称为HTTP 动词(verb) 方法) 来处理相应的HTTP方法.
这些方法可以通过使用下面的装饰器: <a class="reference internal" href="index.html#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">gen.coroutine</span></code></a>, <a class="reference internal" href="index.html#tornado.concurrent.return_future" title="tornado.concurrent.return_future"><code class="xref py py-obj docutils literal"><span class="pre">return_future</span></code></a>,
或 <a class="reference internal" href="#tornado.web.asynchronous" title="tornado.web.asynchronous"><code class="xref py py-obj docutils literal"><span class="pre">asynchronous</span></code></a> 变成异步.</p>
<p>为了支持不再列表中的方法, 可以复写类变量 <code class="docutils literal"><span class="pre">SUPPORTED_METHODS</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WebDAVHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="n">SUPPORTED_METHODS</span> <span class="o">=</span> <span class="n">RequestHandler</span><span class="o">.</span><span class="n">SUPPORTED_METHODS</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;PROPFIND&#39;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">propfind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<dl class="method">
<dt id="tornado.web.RequestHandler.get">
<code class="descclassname">RequestHandler.</code><code class="descname">get</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.head">
<code class="descclassname">RequestHandler.</code><code class="descname">head</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.head"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.head" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.post">
<code class="descclassname">RequestHandler.</code><code class="descname">post</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.post"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.post" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.delete">
<code class="descclassname">RequestHandler.</code><code class="descname">delete</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.delete"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.delete" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.patch">
<code class="descclassname">RequestHandler.</code><code class="descname">patch</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.patch"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.patch" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.put">
<code class="descclassname">RequestHandler.</code><code class="descname">put</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.put"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.put" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.options">
<code class="descclassname">RequestHandler.</code><code class="descname">options</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.options"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.options" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="input">
<h6>Input<a class="headerlink" href="#input" title="永久链接至标题">¶</a></h6>
<dl class="method">
<dt id="tornado.web.RequestHandler.get_argument">
<code class="descclassname">RequestHandler.</code><code class="descname">get_argument</code><span class="sig-paren">(</span><em>name</em>, <em>default=[]</em>, <em>strip=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_argument"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_argument" title="永久链接至目标">¶</a></dt>
<dd><p>返回指定的name参数的值.</p>
<p>如果没有提供默认值, 那么这个参数将被视为是必须的, 并且当
找不到这个参数的时候我们会抛出一个 <a class="reference internal" href="#tornado.web.MissingArgumentError" title="tornado.web.MissingArgumentError"><code class="xref py py-obj docutils literal"><span class="pre">MissingArgumentError</span></code></a>.</p>
<p>如果一个参数在url上出现多次, 我们返回最后一个值.</p>
<p>返回值永远是unicode.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_arguments">
<code class="descclassname">RequestHandler.</code><code class="descname">get_arguments</code><span class="sig-paren">(</span><em>name</em>, <em>strip=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_arguments"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_arguments" title="永久链接至目标">¶</a></dt>
<dd><p>返回指定name的参数列表.</p>
<p>如果参数不存在, 返回一个空列表.</p>
<p>返回值永远是unicode.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_query_argument">
<code class="descclassname">RequestHandler.</code><code class="descname">get_query_argument</code><span class="sig-paren">(</span><em>name</em>, <em>default=[]</em>, <em>strip=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_query_argument"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_query_argument" title="永久链接至目标">¶</a></dt>
<dd><p>从请求的query string返回给定name的参数的值.</p>
<p>如果没有提供默认值, 这个参数将被视为必须的, 并且当找不到这个
参数的时候我们会抛出一个 <a class="reference internal" href="#tornado.web.MissingArgumentError" title="tornado.web.MissingArgumentError"><code class="xref py py-obj docutils literal"><span class="pre">MissingArgumentError</span></code></a> 异常.</p>
<p>如果这个参数在url中多次出现, 我们将返回最后一次的值.</p>
<p>返回值永远是unicode.</p>
<div class="versionadded">
<p><span class="versionmodified">3.2 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_query_arguments">
<code class="descclassname">RequestHandler.</code><code class="descname">get_query_arguments</code><span class="sig-paren">(</span><em>name</em>, <em>strip=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_query_arguments"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_query_arguments" title="永久链接至目标">¶</a></dt>
<dd><p>返回指定name的参数列表.</p>
<p>如果参数不存在, 将返回空列表.</p>
<p>返回值永远是unicode.</p>
<div class="versionadded">
<p><span class="versionmodified">3.2 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_body_argument">
<code class="descclassname">RequestHandler.</code><code class="descname">get_body_argument</code><span class="sig-paren">(</span><em>name</em>, <em>default=[]</em>, <em>strip=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_body_argument"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_body_argument" title="永久链接至目标">¶</a></dt>
<dd><p>返回请求体中指定name的参数的值.</p>
<p>如果没有提供默认值, 那么这个参数将被视为是必须的, 并且当
找不到这个参数的时候我们会抛出一个 <a class="reference internal" href="#tornado.web.MissingArgumentError" title="tornado.web.MissingArgumentError"><code class="xref py py-obj docutils literal"><span class="pre">MissingArgumentError</span></code></a>.</p>
<p>如果一个参数在url上出现多次, 我们返回最后一个值.</p>
<p>返回值永远是unicode.</p>
<div class="versionadded">
<p><span class="versionmodified">3.2 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_body_arguments">
<code class="descclassname">RequestHandler.</code><code class="descname">get_body_arguments</code><span class="sig-paren">(</span><em>name</em>, <em>strip=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_body_arguments"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_body_arguments" title="永久链接至目标">¶</a></dt>
<dd><p>返回由指定请求体中指定name的参数的列表.</p>
<p>如果参数不存在, 返回一个空列表.</p>
<p>返回值永远是unicode.</p>
<div class="versionadded">
<p><span class="versionmodified">3.2 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.decode_argument">
<code class="descclassname">RequestHandler.</code><code class="descname">decode_argument</code><span class="sig-paren">(</span><em>value</em>, <em>name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.decode_argument"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.decode_argument" title="永久链接至目标">¶</a></dt>
<dd><p>从请求中解码一个参数.</p>
<p>这个参数已经被解码现在是一个字节字符串(byte string). 默认情况下,
这个方法会把参数解码成utf-8并且返回一个unicode字符串, 但是它可以
被子类复写.</p>
<p>这个方法既可以在 <a class="reference internal" href="#tornado.web.RequestHandler.get_argument" title="tornado.web.RequestHandler.get_argument"><code class="xref py py-obj docutils literal"><span class="pre">get_argument()</span></code></a> 中被用作过滤器, 也可以用来从url
中提取值并传递给 <a class="reference internal" href="#tornado.web.RequestHandler.get" title="tornado.web.RequestHandler.get"><code class="xref py py-obj docutils literal"><span class="pre">get()</span></code></a>/<a class="reference internal" href="#tornado.web.RequestHandler.post" title="tornado.web.RequestHandler.post"><code class="xref py py-obj docutils literal"><span class="pre">post()</span></code></a>/等.</p>
<p>如果知道的话参数的name会被提供, 但也可能为None
(e.g. 在url正则表达式中未命名的组).</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.web.RequestHandler.request">
<code class="descclassname">RequestHandler.</code><code class="descname">request</code><a class="headerlink" href="#tornado.web.RequestHandler.request" title="永久链接至目标">¶</a></dt>
<dd><p><a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest" title="tornado.httputil.HTTPServerRequest"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httputil.HTTPServerRequest</span></code></a> 对象包含附加的
请求参数包括e.g. 头部和body数据.</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.web.RequestHandler.path_args">
<code class="descclassname">RequestHandler.</code><code class="descname">path_args</code><a class="headerlink" href="#tornado.web.RequestHandler.path_args" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="tornado.web.RequestHandler.path_kwargs">
<code class="descclassname">RequestHandler.</code><code class="descname">path_kwargs</code><a class="headerlink" href="#tornado.web.RequestHandler.path_kwargs" title="永久链接至目标">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">path_args</span></code> 和 <code class="docutils literal"><span class="pre">path_kwargs</span></code> 属性包含传递给
<a class="reference internal" href="#verbs"><span class="std std-ref">HTTP verb methods</span></a> 的位置和关键字参数.
这些属性被设置, 在这些方法被调用之前, 所以这些值
在 <a class="reference internal" href="#tornado.web.RequestHandler.prepare" title="tornado.web.RequestHandler.prepare"><code class="xref py py-obj docutils literal"><span class="pre">prepare</span></code></a> 之间是可用的.</p>
</dd></dl>

</div>
<div class="section" id="output">
<h6>Output<a class="headerlink" href="#output" title="永久链接至标题">¶</a></h6>
<dl class="method">
<dt id="tornado.web.RequestHandler.set_status">
<code class="descclassname">RequestHandler.</code><code class="descname">set_status</code><span class="sig-paren">(</span><em>status_code</em>, <em>reason=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.set_status"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.set_status" title="永久链接至目标">¶</a></dt>
<dd><p>设置响应的状态码.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>status_code</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#int" title="(在 Python v3.4)"><em>int</em></a>) &#8211; 响应状态码. 如果 <code class="docutils literal"><span class="pre">reason</span></code> 是 <code class="docutils literal"><span class="pre">None</span></code>,
它必须存在于 <a class="reference external" href="https://docs.python.org/3.4/library/http.client.html#http.client.responses" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">httplib.responses</span></code></a>.</li>
<li><strong>reason</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; 用人类可读的原因短语来描述状态码.
如果是 <code class="docutils literal"><span class="pre">None</span></code>, 它会由来自
<a class="reference external" href="https://docs.python.org/3.4/library/http.client.html#http.client.responses" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">httplib.responses</span></code></a> 的reason填满.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.set_header">
<code class="descclassname">RequestHandler.</code><code class="descname">set_header</code><span class="sig-paren">(</span><em>name</em>, <em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.set_header"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.set_header" title="永久链接至目标">¶</a></dt>
<dd><p>给响应设置指定的头部和对应的值.</p>
<p>如果给定了一个datetime, 我们会根据HTTP规范自动的对它格式化.
如果值不是一个字符串, 我们会把它转换成字符串. 之后所有头部的值
都将用UTF-8 编码.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.add_header">
<code class="descclassname">RequestHandler.</code><code class="descname">add_header</code><span class="sig-paren">(</span><em>name</em>, <em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.add_header"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.add_header" title="永久链接至目标">¶</a></dt>
<dd><p>添加指定的响应头和对应的值.</p>
<p>不像是 <a class="reference internal" href="#tornado.web.RequestHandler.set_header" title="tornado.web.RequestHandler.set_header"><code class="xref py py-obj docutils literal"><span class="pre">set_header</span></code></a>, <a class="reference internal" href="#tornado.web.RequestHandler.add_header" title="tornado.web.RequestHandler.add_header"><code class="xref py py-obj docutils literal"><span class="pre">add_header</span></code></a> 可以被多次调用来为相同的头
返回多个值.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.clear_header">
<code class="descclassname">RequestHandler.</code><code class="descname">clear_header</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.clear_header"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.clear_header" title="永久链接至目标">¶</a></dt>
<dd><p>清除输出头, 取消之前的 <a class="reference internal" href="#tornado.web.RequestHandler.set_header" title="tornado.web.RequestHandler.set_header"><code class="xref py py-obj docutils literal"><span class="pre">set_header</span></code></a> 调用.</p>
<p>注意这个方法不适用于被 <a class="reference internal" href="#tornado.web.RequestHandler.add_header" title="tornado.web.RequestHandler.add_header"><code class="xref py py-obj docutils literal"><span class="pre">add_header</span></code></a> 设置了多个值的头.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.set_default_headers">
<code class="descclassname">RequestHandler.</code><code class="descname">set_default_headers</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.set_default_headers"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.set_default_headers" title="永久链接至目标">¶</a></dt>
<dd><p>复写这个方法可以在请求开始的时候设置HTTP头.</p>
<p>例如, 在这里可以设置一个自定义 <code class="docutils literal"><span class="pre">Server</span></code> 头. 注意在一般的
请求过程流里可能不会实现你预期的效果, 因为头部可能在错误处
理(error handling)中被重置.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.write">
<code class="descclassname">RequestHandler.</code><code class="descname">write</code><span class="sig-paren">(</span><em>chunk</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.write"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.write" title="永久链接至目标">¶</a></dt>
<dd><p>把给定块写到输出buffer.</p>
<p>为了把输出写到网络, 使用下面的flush()方法.</p>
<p>如果给定的块是一个字典, 我们会把它作为JSON来写同时会把响应头
设置为 <code class="docutils literal"><span class="pre">application/json</span></code>. (如果你写JSON但是设置不同的
<code class="docutils literal"><span class="pre">Content-Type</span></code>,  可以调用set_header <em>在调用write()之后</em> ).</p>
<p>注意列表不能转换为JSON 因为一个潜在的跨域安全漏洞. 所有的JSON
输出应该包在一个字典中. 更多细节参考
<a class="reference external" href="http://haacked.com/archive/2009/06/25/json-hijacking.aspx/">http://haacked.com/archive/2009/06/25/json-hijacking.aspx/</a> 和
<a class="reference external" href="https://github.com/facebook/tornado/issues/1009">https://github.com/facebook/tornado/issues/1009</a></p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.flush">
<code class="descclassname">RequestHandler.</code><code class="descname">flush</code><span class="sig-paren">(</span><em>include_footers=False</em>, <em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.flush"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.flush" title="永久链接至目标">¶</a></dt>
<dd><p>将当前输出缓冲区写到网络.</p>
<p><code class="docutils literal"><span class="pre">callback</span></code> 参数, 如果给定则可用于流控制: 它会在所有数据被写到
socket后执行. 注意同一时间只能有一个flush callback停留; 如果另
一个flush在前一个flush的callback运行之前发生, 那么前一个callback
将会被丢弃.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>现在如果没有给定callback, 会返回一个 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 对象.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.finish">
<code class="descclassname">RequestHandler.</code><code class="descname">finish</code><span class="sig-paren">(</span><em>chunk=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.finish"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.finish" title="永久链接至目标">¶</a></dt>
<dd><p>完成响应, 结束HTTP 请求.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.render">
<code class="descclassname">RequestHandler.</code><code class="descname">render</code><span class="sig-paren">(</span><em>template_name</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.render"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.render" title="永久链接至目标">¶</a></dt>
<dd><p>使用给定参数渲染模板并作为响应.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.render_string">
<code class="descclassname">RequestHandler.</code><code class="descname">render_string</code><span class="sig-paren">(</span><em>template_name</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.render_string"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.render_string" title="永久链接至目标">¶</a></dt>
<dd><p>使用给定的参数生成指定模板.</p>
<p>我们返回生成的字节字符串(以utf8). 为了生成并写一个模板
作为响应, 使用上面的render().</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_template_namespace">
<code class="descclassname">RequestHandler.</code><code class="descname">get_template_namespace</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_template_namespace"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_template_namespace" title="永久链接至目标">¶</a></dt>
<dd><p>返回一个字典被用做默认的模板命名空间.</p>
<p>可以被子类复写来添加或修改值.</p>
<p>这个方法的结果将与 <a class="reference internal" href="index.html#module-tornado.template" title="tornado.template"><code class="xref py py-obj docutils literal"><span class="pre">tornado.template</span></code></a> 模块中其他的默认值
还有 <a class="reference internal" href="#tornado.web.RequestHandler.render" title="tornado.web.RequestHandler.render"><code class="xref py py-obj docutils literal"><span class="pre">render</span></code></a> 或 <a class="reference internal" href="#tornado.web.RequestHandler.render_string" title="tornado.web.RequestHandler.render_string"><code class="xref py py-obj docutils literal"><span class="pre">render_string</span></code></a> 的关键字参数相结合.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.redirect">
<code class="descclassname">RequestHandler.</code><code class="descname">redirect</code><span class="sig-paren">(</span><em>url</em>, <em>permanent=False</em>, <em>status=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.redirect"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.redirect" title="永久链接至目标">¶</a></dt>
<dd><p>重定向到给定的URL(可以选择相对路径).</p>
<p>如果指定了 <code class="docutils literal"><span class="pre">status</span></code> 参数, 这个值将作为HTTP状态码; 否则
将通过 <code class="docutils literal"><span class="pre">permanent</span></code> 参数选择301 (永久) 或者 302 (临时).
默认是 302 (临时重定向).</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.send_error">
<code class="descclassname">RequestHandler.</code><code class="descname">send_error</code><span class="sig-paren">(</span><em>status_code=500</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.send_error"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.send_error" title="永久链接至目标">¶</a></dt>
<dd><p>给浏览器发送给定的HTTP 错误码.</p>
<p>如果 <a class="reference internal" href="#tornado.web.RequestHandler.flush" title="tornado.web.RequestHandler.flush"><code class="xref py py-obj docutils literal"><span class="pre">flush()</span></code></a> 已经被调用, 它是不可能发送错误的, 所以这个方法将终止
响应. 如果输出已经被写但尚未flush, 它将被丢弃并被错误页代替.</p>
<p>复写 <a class="reference internal" href="#tornado.web.RequestHandler.write_error" title="tornado.web.RequestHandler.write_error"><code class="xref py py-obj docutils literal"><span class="pre">write_error()</span></code></a> 来自定义它返回的错误页. 额外的关键字参数将
被传递给 <a class="reference internal" href="#tornado.web.RequestHandler.write_error" title="tornado.web.RequestHandler.write_error"><code class="xref py py-obj docutils literal"><span class="pre">write_error</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.write_error">
<code class="descclassname">RequestHandler.</code><code class="descname">write_error</code><span class="sig-paren">(</span><em>status_code</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.write_error"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.write_error" title="永久链接至目标">¶</a></dt>
<dd><p>复写这个方法来实现自定义错误页.</p>
<p><code class="docutils literal"><span class="pre">write_error</span></code> 可能调用 <a class="reference internal" href="#tornado.web.RequestHandler.write" title="tornado.web.RequestHandler.write"><code class="xref py py-obj docutils literal"><span class="pre">write</span></code></a>, <a class="reference internal" href="#tornado.web.RequestHandler.render" title="tornado.web.RequestHandler.render"><code class="xref py py-obj docutils literal"><span class="pre">render</span></code></a>, <a class="reference internal" href="#tornado.web.RequestHandler.set_header" title="tornado.web.RequestHandler.set_header"><code class="xref py py-obj docutils literal"><span class="pre">set_header</span></code></a>,等
来产生一般的输出.</p>
<p>如果错误是由未捕获的异常造成的(包括HTTPError), 三个一组的
<code class="docutils literal"><span class="pre">exc_info</span></code> 将变成可用的通过 <code class="docutils literal"><span class="pre">kwargs[&quot;exc_info&quot;]</span></code>.
注意这个异常可能不是&#8221;当前(current)&#8221; 目的或方法的异常就像
<code class="docutils literal"><span class="pre">sys.exc_info()</span></code> 或 <code class="docutils literal"><span class="pre">traceback.format_exc</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.clear">
<code class="descclassname">RequestHandler.</code><code class="descname">clear</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.clear"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.clear" title="永久链接至目标">¶</a></dt>
<dd><p>重置这个响应的所有头部和内容.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.data_received">
<code class="descclassname">RequestHandler.</code><code class="descname">data_received</code><span class="sig-paren">(</span><em>chunk</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.data_received"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.data_received" title="永久链接至目标">¶</a></dt>
<dd><p>实现这个方法来处理请求数据流.</p>
<p>需要 <a class="reference internal" href="#tornado.web.stream_request_body" title="tornado.web.stream_request_body"><code class="xref py py-obj docutils literal"><span class="pre">stream_request_body</span></code></a> 装饰器.</p>
</dd></dl>

</div>
<div class="section" id="cookies">
<h6>Cookies<a class="headerlink" href="#cookies" title="永久链接至标题">¶</a></h6>
<dl class="attribute">
<dt id="tornado.web.RequestHandler.cookies">
<code class="descclassname">RequestHandler.</code><code class="descname">cookies</code><a class="headerlink" href="#tornado.web.RequestHandler.cookies" title="永久链接至目标">¶</a></dt>
<dd><p><a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest.cookies" title="tornado.httputil.HTTPServerRequest.cookies"><code class="xref py py-obj docutils literal"><span class="pre">self.request.cookies</span></code></a>
的别名.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_cookie">
<code class="descclassname">RequestHandler.</code><code class="descname">get_cookie</code><span class="sig-paren">(</span><em>name</em>, <em>default=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_cookie"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_cookie" title="永久链接至目标">¶</a></dt>
<dd><p>获取给定name的cookie值, 如果未获取到则返回默认值.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.set_cookie">
<code class="descclassname">RequestHandler.</code><code class="descname">set_cookie</code><span class="sig-paren">(</span><em>name</em>, <em>value</em>, <em>domain=None</em>, <em>expires=None</em>, <em>path='/'</em>, <em>expires_days=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.set_cookie"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.set_cookie" title="永久链接至目标">¶</a></dt>
<dd><p>设置给定的cookie 名称/值还有其他给定的选项.</p>
<p>另外的关键字参数在Cookie.Morsel直接设置.
参见 <a class="reference external" href="https://docs.python.org/2/library/cookie.html#morsel-objects">https://docs.python.org/2/library/cookie.html#morsel-objects</a>
查看可用的属性.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.clear_cookie">
<code class="descclassname">RequestHandler.</code><code class="descname">clear_cookie</code><span class="sig-paren">(</span><em>name</em>, <em>path='/'</em>, <em>domain=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.clear_cookie"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.clear_cookie" title="永久链接至目标">¶</a></dt>
<dd><p>删除给定名称的cookie.</p>
<p>受cookie协议的限制, 必须传递和设置该名称cookie时候相同的path
和domain来清除这个cookie(但是这里没有方法来找出在服务端所使
用的该cookie的值).</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.clear_all_cookies">
<code class="descclassname">RequestHandler.</code><code class="descname">clear_all_cookies</code><span class="sig-paren">(</span><em>path='/'</em>, <em>domain=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.clear_all_cookies"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.clear_all_cookies" title="永久链接至目标">¶</a></dt>
<dd><p>删除用户在本次请求中所有携带的cookie.</p>
<p>查看 <a class="reference internal" href="#tornado.web.RequestHandler.clear_cookie" title="tornado.web.RequestHandler.clear_cookie"><code class="xref py py-obj docutils literal"><span class="pre">clear_cookie</span></code></a> 方法来获取关于path和domain参数的更多信息.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.2 版更改: </span>添加 <code class="docutils literal"><span class="pre">path</span></code> 和 <code class="docutils literal"><span class="pre">domain</span></code> 参数.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_secure_cookie">
<code class="descclassname">RequestHandler.</code><code class="descname">get_secure_cookie</code><span class="sig-paren">(</span><em>name</em>, <em>value=None</em>, <em>max_age_days=31</em>, <em>min_version=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_secure_cookie"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_secure_cookie" title="永久链接至目标">¶</a></dt>
<dd><p>如果给定的签名过的cookie是有效的,则返回，否则返回None.</p>
<p>解码后的cookie值作为字节字符串返回(不像 <a class="reference internal" href="#tornado.web.RequestHandler.get_cookie" title="tornado.web.RequestHandler.get_cookie"><code class="xref py py-obj docutils literal"><span class="pre">get_cookie</span></code></a> ).</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.2.1 版更改: </span>添加 <code class="docutils literal"><span class="pre">min_version</span></code> 参数. 引进cookie version 2;
默认版本 1 和 2 都可以接受.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_secure_cookie_key_version">
<code class="descclassname">RequestHandler.</code><code class="descname">get_secure_cookie_key_version</code><span class="sig-paren">(</span><em>name</em>, <em>value=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_secure_cookie_key_version"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_secure_cookie_key_version" title="永久链接至目标">¶</a></dt>
<dd><p>返回安全cookie(secure cookie)的签名key版本.</p>
<p>返回的版本号是int型的.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.set_secure_cookie">
<code class="descclassname">RequestHandler.</code><code class="descname">set_secure_cookie</code><span class="sig-paren">(</span><em>name</em>, <em>value</em>, <em>expires_days=30</em>, <em>version=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.set_secure_cookie"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.set_secure_cookie" title="永久链接至目标">¶</a></dt>
<dd><p>给cookie签名和时间戳以防被伪造.</p>
<p>你必须在你的Application设置中指定 <code class="docutils literal"><span class="pre">cookie_secret</span></code> 来使用这个方法.
它应该是一个长的, 随机的字节序列作为HMAC密钥来做签名.</p>
<p>使用 <a class="reference internal" href="#tornado.web.RequestHandler.get_secure_cookie" title="tornado.web.RequestHandler.get_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">get_secure_cookie()</span></code></a> 方法来阅读通过这个方法设置的cookie.</p>
<p>注意 <code class="docutils literal"><span class="pre">expires_days</span></code> 参数设置cookie在浏览器中的有效期, 并且它是
独立于 <a class="reference internal" href="#tornado.web.RequestHandler.get_secure_cookie" title="tornado.web.RequestHandler.get_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">get_secure_cookie</span></code></a> 的 <code class="docutils literal"><span class="pre">max_age_days</span></code> 参数的.</p>
<p>安全cookie(Secure cookies)可以包含任意字节的值, 而不只是unicode
字符串(不像是普通cookie)</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.2.1 版更改: </span>添加 <code class="docutils literal"><span class="pre">version</span></code> 参数. 提出cookie version 2
并将它作为默认设置.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.create_signed_value">
<code class="descclassname">RequestHandler.</code><code class="descname">create_signed_value</code><span class="sig-paren">(</span><em>name</em>, <em>value</em>, <em>version=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.create_signed_value"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.create_signed_value" title="永久链接至目标">¶</a></dt>
<dd><p>产生用时间戳签名的字符串, 防止被伪造.</p>
<p>一般通过set_secure_cookie 使用, 但对于无cookie使用来说就
作为独立的方法来提供. 为了解码不作为cookie存储的值, 可以
在 get_secure_cookie 使用可选的value参数.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.2.1 版更改: </span>添加 <code class="docutils literal"><span class="pre">version</span></code> 参数. 提出cookie version 2
并将它作为默认设置.</p>
</div>
</dd></dl>

<dl class="data">
<dt id="tornado.web.MIN_SUPPORTED_SIGNED_VALUE_VERSION">
<code class="descclassname">tornado.web.</code><code class="descname">MIN_SUPPORTED_SIGNED_VALUE_VERSION</code><em class="property"> = 1</em><a class="headerlink" href="#tornado.web.MIN_SUPPORTED_SIGNED_VALUE_VERSION" title="永久链接至目标">¶</a></dt>
<dd><p>这个Tornado版本所支持的最旧的签名值版本.</p>
<p>比这个签名值更旧的版本将不能被解码.</p>
<div class="versionadded">
<p><span class="versionmodified">3.2.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="data">
<dt id="tornado.web.MAX_SUPPORTED_SIGNED_VALUE_VERSION">
<code class="descclassname">tornado.web.</code><code class="descname">MAX_SUPPORTED_SIGNED_VALUE_VERSION</code><em class="property"> = 2</em><a class="headerlink" href="#tornado.web.MAX_SUPPORTED_SIGNED_VALUE_VERSION" title="永久链接至目标">¶</a></dt>
<dd><p>这个Tornado版本所支持的最新的签名值版本.</p>
<p>比这个签名值更新的版本将不能被解码.</p>
<div class="versionadded">
<p><span class="versionmodified">3.2.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="data">
<dt id="tornado.web.DEFAULT_SIGNED_VALUE_VERSION">
<code class="descclassname">tornado.web.</code><code class="descname">DEFAULT_SIGNED_VALUE_VERSION</code><em class="property"> = 2</em><a class="headerlink" href="#tornado.web.DEFAULT_SIGNED_VALUE_VERSION" title="永久链接至目标">¶</a></dt>
<dd><p>签名值版本通过 <a class="reference internal" href="#tornado.web.RequestHandler.create_signed_value" title="tornado.web.RequestHandler.create_signed_value"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.create_signed_value</span></code></a> 产生.</p>
<p>可通过传递一个 <code class="docutils literal"><span class="pre">version</span></code> 关键字参数复写.</p>
<div class="versionadded">
<p><span class="versionmodified">3.2.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="data">
<dt id="tornado.web.DEFAULT_SIGNED_VALUE_MIN_VERSION">
<code class="descclassname">tornado.web.</code><code class="descname">DEFAULT_SIGNED_VALUE_MIN_VERSION</code><em class="property"> = 1</em><a class="headerlink" href="#tornado.web.DEFAULT_SIGNED_VALUE_MIN_VERSION" title="永久链接至目标">¶</a></dt>
<dd><p>可以被 <a class="reference internal" href="#tornado.web.RequestHandler.get_secure_cookie" title="tornado.web.RequestHandler.get_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_secure_cookie</span></code></a> 接受的最旧的签名值.</p>
<p>可通过传递一个 <code class="docutils literal"><span class="pre">min_version</span></code> 关键字参数复写.</p>
<div class="versionadded">
<p><span class="versionmodified">3.2.1 新版功能.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="other">
<h6>Other<a class="headerlink" href="#other" title="永久链接至标题">¶</a></h6>
<dl class="attribute">
<dt id="tornado.web.RequestHandler.application">
<code class="descclassname">RequestHandler.</code><code class="descname">application</code><a class="headerlink" href="#tornado.web.RequestHandler.application" title="永久链接至目标">¶</a></dt>
<dd><p>为请求提供服务的 <a class="reference internal" href="#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 对象</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.check_etag_header">
<code class="descclassname">RequestHandler.</code><code class="descname">check_etag_header</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.check_etag_header"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.check_etag_header" title="永久链接至目标">¶</a></dt>
<dd><p>针对请求的 <code class="docutils literal"><span class="pre">If-None-Match</span></code> 头检查 <code class="docutils literal"><span class="pre">Etag</span></code> 头.</p>
<p>如果请求的ETag 匹配则返回 <code class="docutils literal"><span class="pre">True</span></code> 并将返回一个304. 例如:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">set_etag_header</span><span class="p">()</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_etag_header</span><span class="p">():</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_status</span><span class="p">(</span><span class="mi">304</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
<p>这个方法在请求结束的时候会被自动调用, 但也可以被更早的调用
当复写了 <a class="reference internal" href="#tornado.web.RequestHandler.compute_etag" title="tornado.web.RequestHandler.compute_etag"><code class="xref py py-obj docutils literal"><span class="pre">compute_etag</span></code></a> 并且想在请求完成之前先做一个
<code class="docutils literal"><span class="pre">If-None-Match</span></code> 检查. <code class="docutils literal"><span class="pre">Etag</span></code> 头应该在这个方法被调用前设置
(可以使用 <a class="reference internal" href="#tornado.web.RequestHandler.set_etag_header" title="tornado.web.RequestHandler.set_etag_header"><code class="xref py py-obj docutils literal"><span class="pre">set_etag_header</span></code></a>).</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.check_xsrf_cookie">
<code class="descclassname">RequestHandler.</code><code class="descname">check_xsrf_cookie</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.check_xsrf_cookie"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.check_xsrf_cookie" title="永久链接至目标">¶</a></dt>
<dd><p>确认 <code class="docutils literal"><span class="pre">_xsrf</span></code> cookie匹配 <code class="docutils literal"><span class="pre">_xsrf</span></code> 参数.</p>
<p>为了预防cross-site请求伪造, 我们设置一个 <code class="docutils literal"><span class="pre">_xsrf</span></code>
cookie和包含相同值的一个non-cookie字段在所有
<code class="docutils literal"><span class="pre">POST</span></code> 请求中. 如果这两个不匹配, 我们拒绝这个
表单提交作为一个潜在的伪造请求.</p>
<p><code class="docutils literal"><span class="pre">_xsrf</span></code> 的值可以被设置为一个名为 <code class="docutils literal"><span class="pre">_xsrf</span></code> 的表单字段或
在一个名为 <code class="docutils literal"><span class="pre">X-XSRFToken</span></code> 或 <code class="docutils literal"><span class="pre">X-CSRFToken</span></code> 的自定义
HTTP头部(后者被接受为了兼容Django).</p>
<p>查看 <a class="reference external" href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">http://en.wikipedia.org/wiki/Cross-site_request_forgery</a></p>
<p>发布1.1.1 之前, 这个检查会被忽略如果当前的HTTP头部是
<code class="docutils literal"><span class="pre">X-Requested-With:</span> <span class="pre">XMLHTTPRequest</span></code> . 这个异常已被证明是
不安全的并且已经被移除. 更多信息请查看
<a class="reference external" href="http://www.djangoproject.com/weblog/2011/feb/08/security/">http://www.djangoproject.com/weblog/2011/feb/08/security/</a>
<a class="reference external" href="http://weblog.rubyonrails.org/2011/2/8/csrf-protection-bypass-in-ruby-on-rails">http://weblog.rubyonrails.org/2011/2/8/csrf-protection-bypass-in-ruby-on-rails</a></p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.2.2 版更改: </span>添加cookie 2版本的支持. 支持版本1和2.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.compute_etag">
<code class="descclassname">RequestHandler.</code><code class="descname">compute_etag</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.compute_etag"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.compute_etag" title="永久链接至目标">¶</a></dt>
<dd><p>计算被用于这个请求的etag头.</p>
<p>到目前为止默认使用输出内容的hash值.</p>
<p>可以被复写来提供自定义的etag实现, 或者可以返回None来禁止
tornado 默认的etag支持.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.create_template_loader">
<code class="descclassname">RequestHandler.</code><code class="descname">create_template_loader</code><span class="sig-paren">(</span><em>template_path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.create_template_loader"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.create_template_loader" title="永久链接至目标">¶</a></dt>
<dd><p>返回给定路径的新模板装载器.</p>
<p>可以被子类复写. 默认返回一个在给定路径上基于目录的装载器,
使用应用程序的 <code class="docutils literal"><span class="pre">autoescape</span></code> 和 <code class="docutils literal"><span class="pre">template_whitespace</span></code>
设置. 如果应用设置中提供了一个 <code class="docutils literal"><span class="pre">template_loader</span></code> ,
则使用它来替代.</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.web.RequestHandler.current_user">
<code class="descclassname">RequestHandler.</code><code class="descname">current_user</code><a class="headerlink" href="#tornado.web.RequestHandler.current_user" title="永久链接至目标">¶</a></dt>
<dd><p>返回请求中被认证的用户.</p>
<p>可以使用以下两者之一的方式来设置:</p>
<ul>
<li><p class="first">子类可以复写 <a class="reference internal" href="#tornado.web.RequestHandler.get_current_user" title="tornado.web.RequestHandler.get_current_user"><code class="xref py py-obj docutils literal"><span class="pre">get_current_user()</span></code></a>, 这将会在第一次访问
<code class="docutils literal"><span class="pre">self.current_user</span></code> 时自动被调用.
<a class="reference internal" href="#tornado.web.RequestHandler.get_current_user" title="tornado.web.RequestHandler.get_current_user"><code class="xref py py-obj docutils literal"><span class="pre">get_current_user()</span></code></a> 在每次请求时只会被调用一次, 并为
将来访问做缓存:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_current_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">user_cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_secure_cookie</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user_cookie</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">user_cookie</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</li>
<li><p class="first">它可以被设置为一个普通的变量, 通常在来自被复写的 <a class="reference internal" href="#tornado.web.RequestHandler.prepare" title="tornado.web.RequestHandler.prepare"><code class="xref py py-obj docutils literal"><span class="pre">prepare()</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">user_id_cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_secure_cookie</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user_id_cookie</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_user</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">load_user</span><span class="p">(</span><span class="n">user_id_cookie</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>注意 <a class="reference internal" href="#tornado.web.RequestHandler.prepare" title="tornado.web.RequestHandler.prepare"><code class="xref py py-obj docutils literal"><span class="pre">prepare()</span></code></a> 可能是一个协程, 尽管 <a class="reference internal" href="#tornado.web.RequestHandler.get_current_user" title="tornado.web.RequestHandler.get_current_user"><code class="xref py py-obj docutils literal"><span class="pre">get_current_user()</span></code></a>
可能不是, 所以如果加载用户需要异步操作后面的形式是必要的.</p>
<p>用户对象可以是application选择的任意类型.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_browser_locale">
<code class="descclassname">RequestHandler.</code><code class="descname">get_browser_locale</code><span class="sig-paren">(</span><em>default='en_US'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_browser_locale"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_browser_locale" title="永久链接至目标">¶</a></dt>
<dd><p>从 <code class="docutils literal"><span class="pre">Accept-Language</span></code> 头决定用户的位置.</p>
<p>参考 <a class="reference external" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.4">http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.4</a></p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_current_user">
<code class="descclassname">RequestHandler.</code><code class="descname">get_current_user</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_current_user"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_current_user" title="永久链接至目标">¶</a></dt>
<dd><p>复写来实现获取当前用户, e.g., 从cookie得到.</p>
<p>这个方法可能不是一个协程.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_login_url">
<code class="descclassname">RequestHandler.</code><code class="descname">get_login_url</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_login_url"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_login_url" title="永久链接至目标">¶</a></dt>
<dd><p>复写这个方法自定义基于请求的登陆URL.</p>
<p>默认情况下, 我们使用application设置中的 <code class="docutils literal"><span class="pre">login_url</span></code> 值.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_status">
<code class="descclassname">RequestHandler.</code><code class="descname">get_status</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_status"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_status" title="永久链接至目标">¶</a></dt>
<dd><p>返回响应的状态码.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_template_path">
<code class="descclassname">RequestHandler.</code><code class="descname">get_template_path</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_template_path"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_template_path" title="永久链接至目标">¶</a></dt>
<dd><p>可以复写为每个handler指定自定义模板路径.</p>
<p>默认情况下, 我们使用应用设置中的 <code class="docutils literal"><span class="pre">template_path</span></code> .
如果返回None则使用调用文件的相对路径加载模板.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.get_user_locale">
<code class="descclassname">RequestHandler.</code><code class="descname">get_user_locale</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.get_user_locale"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.get_user_locale" title="永久链接至目标">¶</a></dt>
<dd><p>复写这个方法确定认证过的用户所在位置.</p>
<p>如果返回了None , 我们退回选择 <a class="reference internal" href="#tornado.web.RequestHandler.get_browser_locale" title="tornado.web.RequestHandler.get_browser_locale"><code class="xref py py-obj docutils literal"><span class="pre">get_browser_locale()</span></code></a>.</p>
<p>这个方法应该返回一个 <a class="reference internal" href="index.html#tornado.locale.Locale" title="tornado.locale.Locale"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locale.Locale</span></code></a> 对象,
就像调用 <code class="docutils literal"><span class="pre">tornado.locale.get(&quot;en&quot;)</span></code> 得到的那样</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.web.RequestHandler.locale">
<code class="descclassname">RequestHandler.</code><code class="descname">locale</code><a class="headerlink" href="#tornado.web.RequestHandler.locale" title="永久链接至目标">¶</a></dt>
<dd><p>返回当前session的位置.</p>
<p>通过 <a class="reference internal" href="#tornado.web.RequestHandler.get_user_locale" title="tornado.web.RequestHandler.get_user_locale"><code class="xref py py-obj docutils literal"><span class="pre">get_user_locale</span></code></a> 来确定, 你可以复写这个方法设置
获取locale的条件, e.g., 记录在数据库中的用户偏好, 或
<a class="reference internal" href="#tornado.web.RequestHandler.get_browser_locale" title="tornado.web.RequestHandler.get_browser_locale"><code class="xref py py-obj docutils literal"><span class="pre">get_browser_locale</span></code></a>, 使用 <code class="docutils literal"><span class="pre">Accept-Language</span></code> 头部.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.log_exception">
<code class="descclassname">RequestHandler.</code><code class="descname">log_exception</code><span class="sig-paren">(</span><em>typ</em>, <em>value</em>, <em>tb</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.log_exception"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.log_exception" title="永久链接至目标">¶</a></dt>
<dd><p>复写来自定义未捕获异常的日志.</p>
<p>默认情况下 <a class="reference internal" href="#tornado.web.HTTPError" title="tornado.web.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">HTTPError</span></code></a> 的日志实例作为警告(warning)没有堆栈追踪(在
<code class="docutils literal"><span class="pre">tornado.general</span></code> logger), 其他作为错误(error)的异常带有堆栈
追踪(在 <code class="docutils literal"><span class="pre">tornado.application</span></code> logger).</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.on_connection_close">
<code class="descclassname">RequestHandler.</code><code class="descname">on_connection_close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.on_connection_close"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.on_connection_close" title="永久链接至目标">¶</a></dt>
<dd><p>在异步处理中, 如果客户端关闭了连接将会被调用.</p>
<p>复写这个方法来清除与长连接相关的资源. 注意这个方法只有当在异步处理
连接被关闭才会被调用; 如果你需要在每个请求之后做清理, 请复写
<a class="reference internal" href="#tornado.web.RequestHandler.on_finish" title="tornado.web.RequestHandler.on_finish"><code class="xref py py-obj docutils literal"><span class="pre">on_finish</span></code></a> 方法来代替.</p>
<p>在客户端离开后, 代理可能会保持连接一段时间 (也可能是无限期),
所以这个方法在终端用户关闭他们的连接时可能不会被立即执行.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.require_setting">
<code class="descclassname">RequestHandler.</code><code class="descname">require_setting</code><span class="sig-paren">(</span><em>name</em>, <em>feature='this feature'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.require_setting"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.require_setting" title="永久链接至目标">¶</a></dt>
<dd><p>如果给定的app设置未定义则抛出一个异常.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.reverse_url">
<code class="descclassname">RequestHandler.</code><code class="descname">reverse_url</code><span class="sig-paren">(</span><em>name</em>, <em>*args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.reverse_url"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.reverse_url" title="永久链接至目标">¶</a></dt>
<dd><p><a class="reference internal" href="#tornado.web.Application.reverse_url" title="tornado.web.Application.reverse_url"><code class="xref py py-obj docutils literal"><span class="pre">Application.reverse_url</span></code></a> 的别名.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.set_etag_header">
<code class="descclassname">RequestHandler.</code><code class="descname">set_etag_header</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.set_etag_header"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.set_etag_header" title="永久链接至目标">¶</a></dt>
<dd><p>设置响应的Etag头使用 <code class="docutils literal"><span class="pre">self.compute_etag()</span></code> 计算.</p>
<p>注意: 如果 <code class="docutils literal"><span class="pre">compute_etag()</span></code> 返回 <code class="docutils literal"><span class="pre">None</span></code> 将不会设置头.</p>
<p>这个方法在请求结束的时候自动调用.</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.web.RequestHandler.settings">
<code class="descclassname">RequestHandler.</code><code class="descname">settings</code><a class="headerlink" href="#tornado.web.RequestHandler.settings" title="永久链接至目标">¶</a></dt>
<dd><p><a class="reference internal" href="#tornado.web.Application.settings" title="tornado.web.Application.settings"><code class="xref py py-obj docutils literal"><span class="pre">self.application.settings</span></code></a> 的别名.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.static_url">
<code class="descclassname">RequestHandler.</code><code class="descname">static_url</code><span class="sig-paren">(</span><em>path</em>, <em>include_host=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.static_url"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.static_url" title="永久链接至目标">¶</a></dt>
<dd><p>为给定的相对路径的静态文件返回一个静态URL.</p>
<p>这个方法需要你在你的应用中设置 <code class="docutils literal"><span class="pre">static_path</span></code> (既你
静态文件的根目录).</p>
<p>这个方法返回一个带有版本的url (默认情况下会添加
<code class="docutils literal"><span class="pre">?v=&lt;signature&gt;</span></code>), 这会允许静态文件被无限期缓存. 这可以被
禁用通过传递 <code class="docutils literal"><span class="pre">include_version=False</span></code> (默认已经实现;
其他静态文件的实现不需要支持这一点, 但它们可能支持其他选项).</p>
<p>默认情况下这个方法返回当前host的相对URL, 但是如果
<code class="docutils literal"><span class="pre">include_host</span></code> 为true则返回的将是绝对路径的URL.
如果这个处理函数有一个 <code class="docutils literal"><span class="pre">include_host</span></code> 属性, 该值将被所有的
<a class="reference internal" href="#tornado.web.RequestHandler.static_url" title="tornado.web.RequestHandler.static_url"><code class="xref py py-obj docutils literal"><span class="pre">static_url</span></code></a> 调用默认使用, 而不需要传递 <code class="docutils literal"><span class="pre">include_host</span></code>
作为一个关键字参数.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.RequestHandler.xsrf_form_html">
<code class="descclassname">RequestHandler.</code><code class="descname">xsrf_form_html</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RequestHandler.xsrf_form_html"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RequestHandler.xsrf_form_html" title="永久链接至目标">¶</a></dt>
<dd><p>一个将被包含在所有POST表单中的HTML <code class="docutils literal"><span class="pre">&lt;input/&gt;</span></code> 标签.</p>
<p>它定义了我们在所有POST请求中为了预防伪造跨站请求所检查的
<code class="docutils literal"><span class="pre">_xsrf</span></code> 的输入值. 如果你设置了 <code class="docutils literal"><span class="pre">xsrf_cookies</span></code> application设置,
你必须包含这个HTML 在你所有的HTML表单.</p>
<p>在一个模板中, 这个方法应该使用 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">module</span> <span class="pre">xsrf_form_html()</span> <span class="pre">%}</span></code>
这种方式调用</p>
<p>查看上面的 <a class="reference internal" href="#tornado.web.RequestHandler.check_xsrf_cookie" title="tornado.web.RequestHandler.check_xsrf_cookie"><code class="xref py py-obj docutils literal"><span class="pre">check_xsrf_cookie()</span></code></a> 了解更多信息.</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.web.RequestHandler.xsrf_token">
<code class="descclassname">RequestHandler.</code><code class="descname">xsrf_token</code><a class="headerlink" href="#tornado.web.RequestHandler.xsrf_token" title="永久链接至目标">¶</a></dt>
<dd><p>当前用户/会话的XSRF-prevention token.</p>
<p>为了防止伪造跨站请求, 我们设置一个 &#8216;_xsrf&#8217; cookie 并在所有POST
请求中包含相同的 &#8216;_xsrf&#8217; 值作为一个参数. 如果这两个不匹配,
我们会把这个提交当作潜在的伪造请求而拒绝掉.</p>
<p>查看 <a class="reference external" href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">http://en.wikipedia.org/wiki/Cross-site_request_forgery</a></p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.2.2 版更改: </span>该xsrf token现在已经在每个请求都有一个随机mask这使得它
可以简洁的把token包含在页面中是安全的. 查看
<a class="reference external" href="http://breachattack.com">http://breachattack.com</a> 浏览更多信息关于这个更改修复的
问题. 旧(版本1)cookies 将被转换到版本2 当这个方法被调用
除非 <code class="docutils literal"><span class="pre">xsrf_cookie_version</span></code> <a class="reference internal" href="#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 被设置为1.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>该 <code class="docutils literal"><span class="pre">xsrf_cookie_kwargs</span></code> <a class="reference internal" href="#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 设置可能被用来
补充额外的cookie 选项(将会直接传递给 <a class="reference internal" href="#tornado.web.RequestHandler.set_cookie" title="tornado.web.RequestHandler.set_cookie"><code class="xref py py-obj docutils literal"><span class="pre">set_cookie</span></code></a>).
例如, <code class="docutils literal"><span class="pre">xsrf_cookie_kwargs=dict(httponly=True,</span> <span class="pre">secure=True)</span></code>
将设置 <code class="docutils literal"><span class="pre">secure</span></code> 和 <code class="docutils literal"><span class="pre">httponly</span></code> 标志在 <code class="docutils literal"><span class="pre">_xsrf</span></code> cookie.</p>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="id2">
<h5>应用程序配置<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.web.Application">
<em class="property">class </em><code class="descclassname">tornado.web.</code><code class="descname">Application</code><span class="sig-paren">(</span><em>handlers=None</em>, <em>default_host=''</em>, <em>transforms=None</em>, <em>**settings</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#Application"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.Application" title="永久链接至目标">¶</a></dt>
<dd><p>组成一个web应用程序的请求处理程序的集合.</p>
<p>该类的实例是可调用的并且可以被直接传递给HTTPServer为应用程序
提供服务:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">application</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">MainPageHandler</span><span class="p">),</span>
<span class="p">])</span>
<span class="n">http_server</span> <span class="o">=</span> <span class="n">httpserver</span><span class="o">.</span><span class="n">HTTPServer</span><span class="p">(</span><span class="n">application</span><span class="p">)</span>
<span class="n">http_server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">)</span>
<span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>这个类的构造器带有一个列表包含 <a class="reference internal" href="#tornado.web.URLSpec" title="tornado.web.URLSpec"><code class="xref py py-obj docutils literal"><span class="pre">URLSpec</span></code></a> 对象或
(正则表达式, 请求类)元组. 当我们接收到请求, 我们按顺序迭代该列表
并且实例化和请求路径相匹配的正则表达式所对应的第一个请求类.
请求类可以被指定为一个类对象或一个(完全有资格的)名字.</p>
<p>每个元组可以包含另外的部分, 只要符合 <a class="reference internal" href="#tornado.web.URLSpec" title="tornado.web.URLSpec"><code class="xref py py-obj docutils literal"><span class="pre">URLSpec</span></code></a> 构造器参数的条件.
(在Tornado 3.2之前, 只允许包含两个或三个元素的元组).</p>
<p>一个字典可以作为该元组的第三个元素被传递, 它将被用作处理程序
构造器的关键字参数和 <a class="reference internal" href="#tornado.web.RequestHandler.initialize" title="tornado.web.RequestHandler.initialize"><code class="xref py py-obj docutils literal"><span class="pre">initialize</span></code></a> 方法.
这种模式也被用于例子中的 <a class="reference internal" href="#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> (注意一个
<a class="reference internal" href="#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> 可以被自动挂载连带下面的static_path设置):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">application</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/static/(.*)&quot;</span><span class="p">,</span> <span class="n">web</span><span class="o">.</span><span class="n">StaticFileHandler</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/www&quot;</span><span class="p">}),</span>
<span class="p">])</span>
</pre></div>
</div>
<p>我们支持虚拟主机通过 <a class="reference internal" href="#tornado.web.Application.add_handlers" title="tornado.web.Application.add_handlers"><code class="xref py py-obj docutils literal"><span class="pre">add_handlers</span></code></a> 方法, 该方法带有一个主机
正则表达式作为第一个参数:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">application</span><span class="o">.</span><span class="n">add_handlers</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;www\.myhost\.com&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/article/([0-9]+)&quot;</span><span class="p">,</span> <span class="n">ArticleHandler</span><span class="p">),</span>
<span class="p">])</span>
</pre></div>
</div>
<p>你可以提供静态文件服务通过传递 <code class="docutils literal"><span class="pre">static_path</span></code> 配置作为关键字
参数. 我们将提供这些文件从 <code class="docutils literal"><span class="pre">/static/</span></code> URI (这是可配置的通过
<code class="docutils literal"><span class="pre">static_url_prefix</span></code> 配置), 并且我们将提供 <code class="docutils literal"><span class="pre">/favicon.ico</span></code>
和 <code class="docutils literal"><span class="pre">/robots.txt</span></code> 从相同目录下. 一个 <a class="reference internal" href="#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> 的
自定义子类可以被指定, 通过 <code class="docutils literal"><span class="pre">static_handler_class</span></code> 设置.</p>
<dl class="attribute">
<dt id="tornado.web.Application.settings">
<code class="descname">settings</code><a class="headerlink" href="#tornado.web.Application.settings" title="永久链接至目标">¶</a></dt>
<dd><p>传递给构造器的附加关键字参数保存在 <a class="reference internal" href="#tornado.web.Application.settings" title="tornado.web.Application.settings"><code class="xref py py-obj docutils literal"><span class="pre">settings</span></code></a> 字典中,
并经常在文档中被称为&#8221;application settings&#8221;. Settings被用于
自定义Tornado的很多方面(虽然在一些情况下, 更丰富的定制可能
是通过在 <a class="reference internal" href="#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 的子类中复写方法). 一些应用程序
也喜欢使用 <a class="reference internal" href="#tornado.web.Application.settings" title="tornado.web.Application.settings"><code class="xref py py-obj docutils literal"><span class="pre">settings</span></code></a> 字典作为使一些处理程序可以使用应用
程序的特定设置的方法, 而无需使用全局变量. Tornado中使用的
Setting描述如下.</p>
<p>一般设置(General settings):</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">autoreload</span></code>: 如果为 <code class="docutils literal"><span class="pre">True</span></code>, 服务进程将会在任意资源文件
改变的时候重启, 正如 <a class="reference internal" href="index.html#debug-mode"><span class="std std-ref">Debug模式和自动重载</span></a> 中描述的那样.
这个选项是Tornado 3.2中新增的; 在这之前这个功能是由
<code class="docutils literal"><span class="pre">debug</span></code> 设置控制的.</li>
<li><code class="docutils literal"><span class="pre">debug</span></code>: 一些调试模式设置的速记, 正如 <a class="reference internal" href="index.html#debug-mode"><span class="std std-ref">Debug模式和自动重载</span></a>
中描述的那样. <code class="docutils literal"><span class="pre">debug=True</span></code> 设置等同于 <code class="docutils literal"><span class="pre">autoreload=True</span></code>,
<code class="docutils literal"><span class="pre">compiled_template_cache=False</span></code>,
<code class="docutils literal"><span class="pre">static_hash_cache=False</span></code>, <code class="docutils literal"><span class="pre">serve_traceback=True</span></code>.</li>
<li><code class="docutils literal"><span class="pre">default_handler_class</span></code> 和 <code class="docutils literal"><span class="pre">default_handler_args</span></code>:
如果没有发现其他匹配则会使用这个处理程序; 使用这个来实现自
定义404页面(Tornado 3.2新增).</li>
<li><code class="docutils literal"><span class="pre">compress_response</span></code>: 如果为 <code class="docutils literal"><span class="pre">True</span></code>, 以文本格式的响应
将被自动压缩. Tornado 4.0新增.</li>
<li><code class="docutils literal"><span class="pre">gzip</span></code>: 不推荐使用的 <code class="docutils literal"><span class="pre">compress_response</span></code> 别名自从
Tornado 4.0.</li>
<li><code class="docutils literal"><span class="pre">log_function</span></code>: 这个函数将在每次请求结束的时候调用以记录
结果(有一次参数, 该 <a class="reference internal" href="#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 对象). 默认实现是写入
<a class="reference external" href="https://docs.python.org/3.4/library/logging.html#module-logging" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">logging</span></code></a> 模块的根logger. 也可以通过复写
<a class="reference internal" href="#tornado.web.Application.log_request" title="tornado.web.Application.log_request"><code class="xref py py-obj docutils literal"><span class="pre">Application.log_request</span></code></a> 自定义.</li>
<li><code class="docutils literal"><span class="pre">serve_traceback</span></code>: 如果为true, 默认的错误页将包含错误信息
的回溯. 这个选项是在Tornado 3.2中新增的; 在此之前这个功能
由 <code class="docutils literal"><span class="pre">debug</span></code> 设置控制.</li>
<li><code class="docutils literal"><span class="pre">ui_modules</span></code> 和 <code class="docutils literal"><span class="pre">ui_methods</span></code>: 可以被设置为 <a class="reference internal" href="#tornado.web.UIModule" title="tornado.web.UIModule"><code class="xref py py-obj docutils literal"><span class="pre">UIModule</span></code></a>
或UI methods 的映射提供给模板. 可以被设置为一个模块, 字典,
或一个模块的列表和/或字典. 参见 <a class="reference internal" href="index.html#ui-modules"><span class="std std-ref">UI 模块</span></a> 了解更多
细节.</li>
</ul>
<p>认证和安全设置(Authentication and security settings):</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">cookie_secret</span></code>: 被 <a class="reference internal" href="#tornado.web.RequestHandler.get_secure_cookie" title="tornado.web.RequestHandler.get_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_secure_cookie</span></code></a>
使用, <a class="reference internal" href="#tornado.web.RequestHandler.set_secure_cookie" title="tornado.web.RequestHandler.set_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">set_secure_cookie</span></code></a> 用来给cookies签名.</li>
<li><code class="docutils literal"><span class="pre">key_version</span></code>: 被requestHandler <a class="reference internal" href="#tornado.web.RequestHandler.set_secure_cookie" title="tornado.web.RequestHandler.set_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">set_secure_cookie</span></code></a>
使用一个特殊的key给cookie签名当 <code class="docutils literal"><span class="pre">cookie_secret</span></code> 是一个
key字典.</li>
<li><code class="docutils literal"><span class="pre">login_url</span></code>: <a class="reference internal" href="#tornado.web.authenticated" title="tornado.web.authenticated"><code class="xref py py-obj docutils literal"><span class="pre">authenticated</span></code></a> 装饰器将会重定向到这个url
如果该用户没有登陆. 更多自定义特性可以通过复写
<a class="reference internal" href="#tornado.web.RequestHandler.get_login_url" title="tornado.web.RequestHandler.get_login_url"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_login_url</span></code></a> 实现</li>
<li><code class="docutils literal"><span class="pre">xsrf_cookies</span></code>: 如果true, <a class="reference internal" href="index.html#xsrf"><span class="std std-ref">跨站请求伪造(防护)</span></a> 将被开启.</li>
<li><code class="docutils literal"><span class="pre">xsrf_cookie_version</span></code>: 控制由该server产生的新XSRF
cookie的版本. 一般应在默认情况下(这将是最高支持的版本),
但是可以被暂时设置为一个较低的值, 在版本切换之间.
在Tornado 3.2.2 中新增, 这里引入了XSRF cookie 版本2.</li>
<li><code class="docutils literal"><span class="pre">xsrf_cookie_kwargs</span></code>: 可设置为额外的参数字典传递给
<a class="reference internal" href="#tornado.web.RequestHandler.set_cookie" title="tornado.web.RequestHandler.set_cookie"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.set_cookie</span></code></a> 为该XSRF cookie.</li>
<li><code class="docutils literal"><span class="pre">twitter_consumer_key</span></code>, <code class="docutils literal"><span class="pre">twitter_consumer_secret</span></code>,
<code class="docutils literal"><span class="pre">friendfeed_consumer_key</span></code>, <code class="docutils literal"><span class="pre">friendfeed_consumer_secret</span></code>,
<code class="docutils literal"><span class="pre">google_consumer_key</span></code>, <code class="docutils literal"><span class="pre">google_consumer_secret</span></code>,
<code class="docutils literal"><span class="pre">facebook_api_key</span></code>, <code class="docutils literal"><span class="pre">facebook_secret</span></code>:  在
<a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a> 模块中使用来验证各种APIs.</li>
</ul>
<p>模板设置:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">autoescape</span></code>: 控制对模板的自动转义. 可以被设置为 <code class="docutils literal"><span class="pre">None</span></code>
以禁止转义, 或设置为一个所有输出都该传递过去的函数 <em>name</em> .
默认是 <code class="docutils literal"><span class="pre">&quot;xhtml_escape&quot;</span></code>. 可以在每个模板中改变使用
<code class="docutils literal"><span class="pre">{%</span> <span class="pre">autoescape</span> <span class="pre">%}</span></code> 指令.</li>
<li><code class="docutils literal"><span class="pre">compiled_template_cache</span></code>: 默认是 <code class="docutils literal"><span class="pre">True</span></code>; 如果是 <code class="docutils literal"><span class="pre">False</span></code>
模板将会在每次请求重新编译. 这个选项是Tornado 3.2中新增的;
在这之前这个功能由 <code class="docutils literal"><span class="pre">debug</span></code> 设置控制.</li>
<li><code class="docutils literal"><span class="pre">template_path</span></code>: 包含模板文件的文件夹. 可以通过复写
<a class="reference internal" href="#tornado.web.RequestHandler.get_template_path" title="tornado.web.RequestHandler.get_template_path"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_template_path</span></code></a> 进一步定制</li>
<li><code class="docutils literal"><span class="pre">template_loader</span></code>: 分配给 <a class="reference internal" href="index.html#tornado.template.BaseLoader" title="tornado.template.BaseLoader"><code class="xref py py-obj docutils literal"><span class="pre">tornado.template.BaseLoader</span></code></a>
的一个实例自定义模板加载. 如果使用了此设置, 则
<code class="docutils literal"><span class="pre">template_path</span></code> 和 <code class="docutils literal"><span class="pre">autoescape</span></code> 设置都会被忽略. 可
通过复写 <a class="reference internal" href="#tornado.web.RequestHandler.create_template_loader" title="tornado.web.RequestHandler.create_template_loader"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.create_template_loader</span></code></a> 进一步
定制.</li>
<li><code class="docutils literal"><span class="pre">template_whitespace</span></code>: 控制处理模板中的空格; 参见
<a class="reference internal" href="index.html#tornado.template.filter_whitespace" title="tornado.template.filter_whitespace"><code class="xref py py-obj docutils literal"><span class="pre">tornado.template.filter_whitespace</span></code></a> 查看允许的值.
在Tornado 4.3中新增.</li>
</ul>
<p>静态文件设置:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">static_hash_cache</span></code>: 默认为 <code class="docutils literal"><span class="pre">True</span></code>; 如果是 <code class="docutils literal"><span class="pre">False</span></code>
静态url将会在每次请求重新计算. 这个选项是Tornado 3.2中
新增的; 在这之前这个功能由 <code class="docutils literal"><span class="pre">debug</span></code> 设置控制.</li>
<li><code class="docutils literal"><span class="pre">static_path</span></code>: 将被提供服务的静态文件所在的文件夹.</li>
<li><code class="docutils literal"><span class="pre">static_url_prefix</span></code>: 静态文件的Url前缀, 默认是
<code class="docutils literal"><span class="pre">&quot;/static/&quot;</span></code>.</li>
<li><code class="docutils literal"><span class="pre">static_handler_class</span></code>, <code class="docutils literal"><span class="pre">static_handler_args</span></code>: 可
设置成为静态文件使用不同的处理程序代替默认的
<a class="reference internal" href="#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.StaticFileHandler</span></code></a>.  <code class="docutils literal"><span class="pre">static_handler_args</span></code>,
如果设置, 应该是一个关键字参数的字典传递给处理程序
的 <code class="docutils literal"><span class="pre">initialize</span></code> 方法.</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="tornado.web.Application.listen">
<code class="descname">listen</code><span class="sig-paren">(</span><em>port</em>, <em>address=''</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#Application.listen"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.Application.listen" title="永久链接至目标">¶</a></dt>
<dd><p>为应用程序在给定端口上启动一个HTTP server.</p>
<p>这是一个方便的别名用来创建一个 <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> 对象并调用它
的listen方法. <a class="reference internal" href="index.html#tornado.tcpserver.TCPServer.listen" title="tornado.tcpserver.TCPServer.listen"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer.listen</span></code></a>
不支持传递关键字参数给 <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> 构造器. 对于高级用途
(e.g. 多进程模式), 不要使用这个方法; 创建一个
<a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> 并直接调用它的
<a class="reference internal" href="index.html#tornado.tcpserver.TCPServer.bind" title="tornado.tcpserver.TCPServer.bind"><code class="xref py py-obj docutils literal"><span class="pre">TCPServer.bind</span></code></a>/<a class="reference internal" href="index.html#tornado.tcpserver.TCPServer.start" title="tornado.tcpserver.TCPServer.start"><code class="xref py py-obj docutils literal"><span class="pre">TCPServer.start</span></code></a> 方法.</p>
<p>注意在调用这个方法之后你仍然需要调用
<code class="docutils literal"><span class="pre">IOLoop.current().start()</span></code> 来启动该服务.</p>
<p>返回 <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> 对象.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>现在返回 <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> 对象.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.Application.add_handlers">
<code class="descname">add_handlers</code><span class="sig-paren">(</span><em>host_pattern</em>, <em>host_handlers</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#Application.add_handlers"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.Application.add_handlers" title="永久链接至目标">¶</a></dt>
<dd><p>添加给定的handler到我们的handler表.</p>
<p>Host 模式将按照它们的添加顺序进行处理.
所有匹配模式将被考虑.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.Application.reverse_url">
<code class="descname">reverse_url</code><span class="sig-paren">(</span><em>name</em>, <em>*args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#Application.reverse_url"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.Application.reverse_url" title="永久链接至目标">¶</a></dt>
<dd><p>返回名为 <code class="docutils literal"><span class="pre">name</span></code> 的handler的URL路径</p>
<p>处理程序必须作为 <a class="reference internal" href="#tornado.web.URLSpec" title="tornado.web.URLSpec"><code class="xref py py-obj docutils literal"><span class="pre">URLSpec</span></code></a> 添加到应用程序.</p>
<p>捕获组的参数将在 <a class="reference internal" href="#tornado.web.URLSpec" title="tornado.web.URLSpec"><code class="xref py py-obj docutils literal"><span class="pre">URLSpec</span></code></a> 的正则表达式被替换.
如有必要它们将被转换成string, 编码成utf8,及
网址转义(url-escaped).</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.Application.log_request">
<code class="descname">log_request</code><span class="sig-paren">(</span><em>handler</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#Application.log_request"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.Application.log_request" title="永久链接至目标">¶</a></dt>
<dd><p>写一个完成的HTTP 请求到日志中.</p>
<p>默认情况下会写到python 根(root)logger. 要改变这种行为
无论是子类应用和复写这个方法, 或者传递一个函数到应用的
设置字典中作为 <code class="docutils literal"><span class="pre">log_function</span></code>.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.web.URLSpec">
<em class="property">class </em><code class="descclassname">tornado.web.</code><code class="descname">URLSpec</code><span class="sig-paren">(</span><em>pattern</em>, <em>handler</em>, <em>kwargs=None</em>, <em>name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#URLSpec"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.URLSpec" title="永久链接至目标">¶</a></dt>
<dd><p>指定URL和处理程序之间的映射.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">pattern</span></code>: 被匹配的正则表达式. 任何在正则表达式的group
都将作为参数传递给处理程序的get/post/等方法.</li>
<li><code class="docutils literal"><span class="pre">handler</span></code>: 被调用的 <a class="reference internal" href="#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 子类.</li>
<li><code class="docutils literal"><span class="pre">kwargs</span></code> (optional): 将被传递给处理程序构造器的额外
参数组成的字典.</li>
<li><code class="docutils literal"><span class="pre">name</span></code> (optional): 该处理程序的名称. 被
<a class="reference internal" href="#tornado.web.Application.reverse_url" title="tornado.web.Application.reverse_url"><code class="xref py py-obj docutils literal"><span class="pre">Application.reverse_url</span></code></a> 使用.</li>
</ul>
<p><code class="docutils literal"><span class="pre">URLSpec</span></code> 类在 <code class="docutils literal"><span class="pre">tornado.web.url</span></code> 名称下也是可用的.</p>
</dd></dl>

</div>
<div class="section" id="decorators">
<h5>装饰器(Decorators)<a class="headerlink" href="#decorators" title="永久链接至标题">¶</a></h5>
<dl class="function">
<dt id="tornado.web.asynchronous">
<code class="descclassname">tornado.web.</code><code class="descname">asynchronous</code><span class="sig-paren">(</span><em>method</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#asynchronous"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.asynchronous" title="永久链接至目标">¶</a></dt>
<dd><p>用这个包装请求处理方法如果它们是异步的.</p>
<p>这个装饰器适用于回调式异步方法; 对于协程, 使用 <code class="docutils literal"><span class="pre">&#64;gen.coroutine</span></code>
装饰器而没有 <code class="docutils literal"><span class="pre">&#64;asynchronous</span></code>. (这是合理的, 因为遗留原因使用两个
装饰器一起来提供 <code class="docutils literal"><span class="pre">&#64;asynchronous</span></code> 在第一个, 但是在这种情况下
<code class="docutils literal"><span class="pre">&#64;asynchronous</span></code> 将被忽略)</p>
<p>这个装饰器应仅适用于 <a class="reference internal" href="#verbs"><span class="std std-ref">HTTP verb
methods</span></a>; 它的行为是未定义的对于任何其他方法.
这个装饰器不会 <em>使</em> 一个方法异步; 它告诉框架该方法 <em>是</em>
异步(执行)的. 对于这个装饰器, 该方法必须(至少有时)异步的做一
些事情这是有用的.</p>
<p>如果给定了这个装饰器, 当方法返回的时候响应并没有结束.
它是由请求处理程序调用 <a class="reference internal" href="#tornado.web.RequestHandler.finish" title="tornado.web.RequestHandler.finish"><code class="xref py py-obj docutils literal"><span class="pre">self.finish()</span></code></a>
来结束该HTTP请求的. 没有这个装饰器, 请求会自动结束当
<code class="docutils literal"><span class="pre">get()</span></code> 或 <code class="docutils literal"><span class="pre">post()</span></code> 方法返回时. 例如:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyRequestHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="nd">@asynchronous</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="n">http</span> <span class="o">=</span> <span class="n">httpclient</span><span class="o">.</span><span class="n">AsyncHTTPClient</span><span class="p">()</span>
       <span class="n">http</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;http://friendfeed.com/&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_download</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Downloaded!&quot;</span><span class="p">)</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 3.1 版更改: </span>可以使用 <code class="docutils literal"><span class="pre">&#64;gen.coroutine</span></code> 而不需 <code class="docutils literal"><span class="pre">&#64;asynchronous</span></code>.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>可以返回任何东西但 <code class="docutils literal"><span class="pre">None</span></code> 或者一个
可yield的对象来自于被 <code class="docutils literal"><span class="pre">&#64;asynchronous</span></code> 装饰的方法是错误的.
这样的返回值之前是默认忽略的.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.web.authenticated">
<code class="descclassname">tornado.web.</code><code class="descname">authenticated</code><span class="sig-paren">(</span><em>method</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#authenticated"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.authenticated" title="永久链接至目标">¶</a></dt>
<dd><p>使用这个装饰的方法要求用户必须登陆.</p>
<p>如果用户未登陆, 他们将被重定向到已经配置的
<a class="reference internal" href="#tornado.web.RequestHandler.get_login_url" title="tornado.web.RequestHandler.get_login_url"><code class="xref py py-obj docutils literal"><span class="pre">login</span> <span class="pre">url</span></code></a>.</p>
<p>如果你配置login url带有查询参数, Tornado将假设你知道你正在
做什么并使用它. 如果不是, 它将添加一个 <a class="reference external" href="https://docs.python.org/3.4/library/functions.html#next" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">next</span></code></a> 参数这样登陆
页就会知道一旦你登陆后将把你送到哪里.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.web.addslash">
<code class="descclassname">tornado.web.</code><code class="descname">addslash</code><span class="sig-paren">(</span><em>method</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#addslash"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.addslash" title="永久链接至目标">¶</a></dt>
<dd><p>使用这个装饰器给请求路径中添加丢失的slash.</p>
<p>例如, 使用了这个装饰器请求 <code class="docutils literal"><span class="pre">/foo</span></code> 将被重定向到 <code class="docutils literal"><span class="pre">/foo/</span></code> .
你的请求处理映射应该使用正则表达式类似 <code class="docutils literal"><span class="pre">r'/foo/?'</span></code>
和使用装饰器相结合.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.web.removeslash">
<code class="descclassname">tornado.web.</code><code class="descname">removeslash</code><span class="sig-paren">(</span><em>method</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#removeslash"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.removeslash" title="永久链接至目标">¶</a></dt>
<dd><p>使用这个装饰器移除请求路径尾部的斜杠(slashes).</p>
<p>例如, 使用了这个装饰器请求 <code class="docutils literal"><span class="pre">/foo/</span></code> 将被重定向到 <code class="docutils literal"><span class="pre">/foo</span></code> .
你的请求处理映射应该使用正则表达式类似 <code class="docutils literal"><span class="pre">r'/foo/*'</span></code>
和使用装饰器相结合.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.web.stream_request_body">
<code class="descclassname">tornado.web.</code><code class="descname">stream_request_body</code><span class="sig-paren">(</span><em>cls</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#stream_request_body"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.stream_request_body" title="永久链接至目标">¶</a></dt>
<dd><p>适用于 <a class="reference internal" href="#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 子类以开启流式body支持.</p>
<p>这个装饰器意味着以下变化:</p>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest.body" title="tornado.httputil.HTTPServerRequest.body"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerRequest.body</span></code></a> 变成了未定义, 并且body参数将不再被
<a class="reference internal" href="#tornado.web.RequestHandler.get_argument" title="tornado.web.RequestHandler.get_argument"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_argument</span></code></a> 所包含.</li>
<li><a class="reference internal" href="#tornado.web.RequestHandler.prepare" title="tornado.web.RequestHandler.prepare"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.prepare</span></code></a> 被调用当读到请求头而不是在整个请求体
都被读到之后.</li>
<li>子类必须定义一个方法 <code class="docutils literal"><span class="pre">data_received(self,</span> <span class="pre">data):</span></code>, 这将被调
用0次或多次当数据是可用状态时. 注意如果该请求的body是空的,
<code class="docutils literal"><span class="pre">data_received</span></code> 可能不会被调用.</li>
<li><code class="docutils literal"><span class="pre">prepare</span></code> 和 <code class="docutils literal"><span class="pre">data_received</span></code> 可能返回Futures对象(就像通过
<code class="docutils literal"><span class="pre">&#64;gen.coroutine</span></code>, 在这种情况下下一个方法将不会被调用直到这些
futures完成.</li>
<li>常规的HTTP方法 (<code class="docutils literal"><span class="pre">post</span></code>, <code class="docutils literal"><span class="pre">put</span></code>, 等)将在整个body被读取后被
调用.</li>
</ul>
<p>在 <code class="docutils literal"><span class="pre">data_received</span></code> 和asynchronous之间有一个微妙的互动
<code class="docutils literal"><span class="pre">prepare</span></code>: <code class="docutils literal"><span class="pre">data_received</span></code> 的第一次调用可能出现在任何地方
在调用 <code class="docutils literal"><span class="pre">prepare</span></code> 已经返回 <em>或 yielded</em>.</p>
</dd></dl>

</div>
<div class="section" id="everything-else">
<h5>其他(Everything else)<a class="headerlink" href="#everything-else" title="永久链接至标题">¶</a></h5>
<dl class="exception">
<dt id="tornado.web.HTTPError">
<em class="property">exception </em><code class="descclassname">tornado.web.</code><code class="descname">HTTPError</code><span class="sig-paren">(</span><em>status_code=500</em>, <em>log_message=None</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#HTTPError"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.HTTPError" title="永久链接至目标">¶</a></dt>
<dd><p>一个将会成为HTTP错误响应的异常.</p>
<p>抛出一个 <a class="reference internal" href="#tornado.web.HTTPError" title="tornado.web.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">HTTPError</span></code></a> 是一个更方便的选择比起调用
<a class="reference internal" href="#tornado.web.RequestHandler.send_error" title="tornado.web.RequestHandler.send_error"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.send_error</span></code></a> 因为它自动结束当前的函数.</p>
<p>为了自定义 <a class="reference internal" href="#tornado.web.HTTPError" title="tornado.web.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">HTTPError</span></code></a> 的响应, 复写
<a class="reference internal" href="#tornado.web.RequestHandler.write_error" title="tornado.web.RequestHandler.write_error"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.write_error</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>status_code</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#int" title="(在 Python v3.4)"><em>int</em></a>) &#8211; HTTP状态码. 必须列在
<a class="reference external" href="https://docs.python.org/3.4/library/http.client.html#http.client.responses" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">httplib.responses</span></code></a> 之中除非给定了
<code class="docutils literal"><span class="pre">reason</span></code> 关键字参数.</li>
<li><strong>log_message</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; 这个错误将会被写入日志的信息(除非该
<a class="reference internal" href="#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 是debug模式否则不会展示给用户). 可能含有
<code class="docutils literal"><span class="pre">%s</span></code>-风格的占位符, 它将填补剩余的位置参数.</li>
<li><strong>reason</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; 唯一的关键字参数. HTTP &#8220;reason&#8221; 短语
将随着 <code class="docutils literal"><span class="pre">status_code</span></code> 传递给状态行. 通常从 <code class="docutils literal"><span class="pre">status_code</span></code>,
自动确定但可以使用一个非标准的数字代码.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="exception">
<dt id="tornado.web.Finish">
<em class="property">exception </em><code class="descclassname">tornado.web.</code><code class="descname">Finish</code><a class="reference internal" href="_modules/tornado/web.html#Finish"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.Finish" title="永久链接至目标">¶</a></dt>
<dd><p>一个会结束请求但不会产生错误响应的异常.</p>
<p>当一个 <a class="reference internal" href="#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 抛出 <a class="reference internal" href="#tornado.web.Finish" title="tornado.web.Finish"><code class="xref py py-obj docutils literal"><span class="pre">Finish</span></code></a> , 该请求将会结束(调用
<a class="reference internal" href="#tornado.web.RequestHandler.finish" title="tornado.web.RequestHandler.finish"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.finish</span></code></a> 如果该方法尚未被调用), 但是错误处理方法
(包括 <a class="reference internal" href="#tornado.web.RequestHandler.write_error" title="tornado.web.RequestHandler.write_error"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.write_error</span></code></a>)将不会被调用.</p>
<p>如果 <a class="reference internal" href="#tornado.web.Finish" title="tornado.web.Finish"><code class="xref py py-obj docutils literal"><span class="pre">Finish()</span></code></a> 创建的时候没有携带参数, 则会发送一个pending响应.
如果 <a class="reference internal" href="#tornado.web.Finish" title="tornado.web.Finish"><code class="xref py py-obj docutils literal"><span class="pre">Finish()</span></code></a> 给定了参数, 则参数将会传递给
<a class="reference internal" href="#tornado.web.RequestHandler.finish" title="tornado.web.RequestHandler.finish"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.finish()</span></code></a>.</p>
<p>这是比复写 <code class="docutils literal"><span class="pre">write_error</span></code> 更加便利的方式用来实现自定义错误页
(尤其是在library代码中):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_status</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_header</span><span class="p">(</span><span class="s1">&#39;WWW-Authenticate&#39;</span><span class="p">,</span> <span class="s1">&#39;Basic realm=&quot;something&quot;&#39;</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">Finish</span><span class="p">()</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>传递给 <code class="docutils literal"><span class="pre">Finish()</span></code> 的参数将被传递给
<a class="reference internal" href="#tornado.web.RequestHandler.finish" title="tornado.web.RequestHandler.finish"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.finish</span></code></a>.</p>
</div>
</dd></dl>

<dl class="exception">
<dt id="tornado.web.MissingArgumentError">
<em class="property">exception </em><code class="descclassname">tornado.web.</code><code class="descname">MissingArgumentError</code><span class="sig-paren">(</span><em>arg_name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#MissingArgumentError"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.MissingArgumentError" title="永久链接至目标">¶</a></dt>
<dd><p>由 <a class="reference internal" href="#tornado.web.RequestHandler.get_argument" title="tornado.web.RequestHandler.get_argument"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_argument</span></code></a> 抛出的异常.</p>
<p>这是 <a class="reference internal" href="#tornado.web.HTTPError" title="tornado.web.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">HTTPError</span></code></a> 的一个子类, 所以如果是未捕获的400响应码将被
用来代替500(并且栈追踪不会被记录到日志).</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.web.UIModule">
<em class="property">class </em><code class="descclassname">tornado.web.</code><code class="descname">UIModule</code><span class="sig-paren">(</span><em>handler</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#UIModule"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.UIModule" title="永久链接至目标">¶</a></dt>
<dd><p>一个在页面上可复用, 模块化的UI单元.</p>
<p>UI模块经常执行附加的查询, 它们也可以包含额外的CSS和
JavaScript, 这些将包含在输出页面上, 在页面渲染的时候自动插入.</p>
<p>UIModule的子类必须复写 <a class="reference internal" href="#tornado.web.UIModule.render" title="tornado.web.UIModule.render"><code class="xref py py-obj docutils literal"><span class="pre">render</span></code></a> 方法.</p>
<dl class="method">
<dt id="tornado.web.UIModule.render">
<code class="descname">render</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#UIModule.render"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.UIModule.render" title="永久链接至目标">¶</a></dt>
<dd><p>在子类中复写以返回这个模块的输出.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.UIModule.embedded_javascript">
<code class="descname">embedded_javascript</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#UIModule.embedded_javascript"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.UIModule.embedded_javascript" title="永久链接至目标">¶</a></dt>
<dd><p>复写以返回一个被嵌入页面的JavaScript字符串.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.UIModule.javascript_files">
<code class="descname">javascript_files</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#UIModule.javascript_files"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.UIModule.javascript_files" title="永久链接至目标">¶</a></dt>
<dd><p>复写以返回这个模块需要的JavaScript文件列表.</p>
<p>如果返回值是相对路径, 它们将被传递给
<a class="reference internal" href="#tornado.web.RequestHandler.static_url" title="tornado.web.RequestHandler.static_url"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.static_url</span></code></a>; 否则会被原样使用.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.UIModule.embedded_css">
<code class="descname">embedded_css</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#UIModule.embedded_css"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.UIModule.embedded_css" title="永久链接至目标">¶</a></dt>
<dd><p>复写以返回一个将被嵌入页面的CSS字符串.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.UIModule.css_files">
<code class="descname">css_files</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#UIModule.css_files"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.UIModule.css_files" title="永久链接至目标">¶</a></dt>
<dd><p>复写以返回这个模块需要的CSS文件列表.</p>
<p>如果返回值是相对路径, 它们将被传递给
<a class="reference internal" href="#tornado.web.RequestHandler.static_url" title="tornado.web.RequestHandler.static_url"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.static_url</span></code></a>; 否则会被原样使用.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.UIModule.html_head">
<code class="descname">html_head</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#UIModule.html_head"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.UIModule.html_head" title="永久链接至目标">¶</a></dt>
<dd><p>复写以返回一个将被放入&lt;head/&gt;标签的HTML字符串.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.UIModule.html_body">
<code class="descname">html_body</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#UIModule.html_body"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.UIModule.html_body" title="永久链接至目标">¶</a></dt>
<dd><p>复写以返回一个将被放入&lt;body/&gt;标签最后的HTML字符串.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.UIModule.render_string">
<code class="descname">render_string</code><span class="sig-paren">(</span><em>path</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#UIModule.render_string"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.UIModule.render_string" title="永久链接至目标">¶</a></dt>
<dd><p>渲染一个模板并且将它作为一个字符串返回.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.web.ErrorHandler">
<em class="property">class </em><code class="descclassname">tornado.web.</code><code class="descname">ErrorHandler</code><span class="sig-paren">(</span><em>application</em>, <em>request</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#ErrorHandler"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.ErrorHandler" title="永久链接至目标">¶</a></dt>
<dd><p>为所有请求生成一个带有 <code class="docutils literal"><span class="pre">status_code</span></code> 的错误响应.</p>
</dd></dl>

<dl class="class">
<dt id="tornado.web.FallbackHandler">
<em class="property">class </em><code class="descclassname">tornado.web.</code><code class="descname">FallbackHandler</code><span class="sig-paren">(</span><em>application</em>, <em>request</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#FallbackHandler"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.FallbackHandler" title="永久链接至目标">¶</a></dt>
<dd><p>包装其他HTTP server回调的 <a class="reference internal" href="#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> .</p>
<p>fallback是一个可调用的对象, 它接收一个
<a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest" title="tornado.httputil.HTTPServerRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerRequest</span></code></a>, 诸如一个 <a class="reference internal" href="#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 或
<a class="reference internal" href="index.html#tornado.wsgi.WSGIContainer" title="tornado.wsgi.WSGIContainer"><code class="xref py py-obj docutils literal"><span class="pre">tornado.wsgi.WSGIContainer</span></code></a>. 这对于在相同server中同时使用
Tornado <code class="docutils literal"><span class="pre">RequestHandlers</span></code> 和WSGI是非常有用的. 用法:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">wsgi</span><span class="o">.</span><span class="n">WSGIContainer</span><span class="p">(</span>
    <span class="n">django</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">wsgi</span><span class="o">.</span><span class="n">WSGIHandler</span><span class="p">())</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/foo&quot;</span><span class="p">,</span> <span class="n">FooHandler</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;.*&quot;</span><span class="p">,</span> <span class="n">FallbackHandler</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fallback</span><span class="o">=</span><span class="n">wsgi_app</span><span class="p">),</span>
<span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.web.RedirectHandler">
<em class="property">class </em><code class="descclassname">tornado.web.</code><code class="descname">RedirectHandler</code><span class="sig-paren">(</span><em>application</em>, <em>request</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#RedirectHandler"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.RedirectHandler" title="永久链接至目标">¶</a></dt>
<dd><p>将所有GET请求重定向到给定的URL.</p>
<p>你需要为处理程序提供 <code class="docutils literal"><span class="pre">url</span></code> 关键字参数, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">application</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/oldpath&quot;</span><span class="p">,</span> <span class="n">web</span><span class="o">.</span><span class="n">RedirectHandler</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/newpath&quot;</span><span class="p">}),</span>
<span class="p">])</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.web.StaticFileHandler">
<em class="property">class </em><code class="descclassname">tornado.web.</code><code class="descname">StaticFileHandler</code><span class="sig-paren">(</span><em>application</em>, <em>request</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler" title="永久链接至目标">¶</a></dt>
<dd><p>可以为一个目录提供静态内容服务的简单处理程序.</p>
<p><a class="reference internal" href="#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> 是自动配置的如果你传递了 <code class="docutils literal"><span class="pre">static_path</span></code> 关键字参数给
<a class="reference internal" href="#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a>. 这个处理程序可以被自定义通过 <code class="docutils literal"><span class="pre">static_url_prefix</span></code>,
<code class="docutils literal"><span class="pre">static_handler_class</span></code>, 和 <code class="docutils literal"><span class="pre">static_handler_args</span></code> 配置.</p>
<p>为了将静态数据目录映射一个额外的路径给这个处理程序你可以在你应用程序中
添加一行例如:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">application</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/content/(.*)&quot;</span><span class="p">,</span> <span class="n">web</span><span class="o">.</span><span class="n">StaticFileHandler</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/www&quot;</span><span class="p">}),</span>
<span class="p">])</span>
</pre></div>
</div>
<p>处理程序构造器需要一个 <code class="docutils literal"><span class="pre">path</span></code> 参数, 该参数指定了将被服务内容的本地根
目录.</p>
<p>注意在正则表达式的捕获组需要解析 <code class="docutils literal"><span class="pre">path</span></code> 参数的值给get()方法(不同于
上面的构造器的参数); 参见 <a class="reference internal" href="#tornado.web.URLSpec" title="tornado.web.URLSpec"><code class="xref py py-obj docutils literal"><span class="pre">URLSpec</span></code></a> 了解细节.</p>
<p>为了自动的提供一个文件例如 <code class="docutils literal"><span class="pre">index.html</span></code> 当一个目录被请求的时候,
设置 <code class="docutils literal"><span class="pre">static_handler_args=dict(default_filename=&quot;index.html&quot;)</span></code>
在你的应用程序设置中(application settings), 或添加
<code class="docutils literal"><span class="pre">default_filename</span></code> 作为你的 <code class="docutils literal"><span class="pre">StaticFileHandler</span></code> 的初始化参数.</p>
<p>为了最大限度的提高浏览器缓存的有效性, 这个类支持版本化的url(默认情
况下使用 <code class="docutils literal"><span class="pre">?v=</span></code> 参数). 如果给定了一个版本, 我们指示浏览器无限期
的缓存该文件. <a class="reference internal" href="#tornado.web.StaticFileHandler.make_static_url" title="tornado.web.StaticFileHandler.make_static_url"><code class="xref py py-obj docutils literal"><span class="pre">make_static_url</span></code></a> (也可作为 <a class="reference internal" href="#tornado.web.RequestHandler.static_url" title="tornado.web.RequestHandler.static_url"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.static_url</span></code></a>)
可以被用来构造一个版本化的url.</p>
<p>该处理程序主要用户开发和轻量级处理文件服务; 对重型传输,使用专用的
静态文件服务是更高效的(例如nginx或Apache). 我们支持HTTP
<code class="docutils literal"><span class="pre">Accept-Ranges</span></code> 机制来返回部分内容(因为一些浏览器需要此功能是
为了查找在HTML5音频或视频中).</p>
<p><strong>子类注意事项</strong></p>
<p>这个类被设计是可以让子类继承的, 但由于静态url是被类方法生成的
而不是实例方法的方式, 继承模式有点不同寻常. 一定要使用
<code class="docutils literal"><span class="pre">&#64;classmethod</span></code> 装饰器当复写一个类方法时. 实例方法可以使用
<code class="docutils literal"><span class="pre">self.path</span></code> <code class="docutils literal"><span class="pre">self.absolute_path</span></code>, 和 <code class="docutils literal"><span class="pre">self.modified</span></code> 属性.</p>
<p>子类应该只复写在本节讨论的方法; 复写其他方法很容易出错. 最重要的
<code class="docutils literal"><span class="pre">StaticFileHandler.get</span></code> 问题尤其严重, 由于与 <code class="docutils literal"><span class="pre">compute_etag</span></code>
还有其他方法紧密耦合.</p>
<p>为了改变静态url生成的方式(e.g. 匹配其他服务或CDN), 复写
<a class="reference internal" href="#tornado.web.StaticFileHandler.make_static_url" title="tornado.web.StaticFileHandler.make_static_url"><code class="xref py py-obj docutils literal"><span class="pre">make_static_url</span></code></a>, <a class="reference internal" href="#tornado.web.StaticFileHandler.parse_url_path" title="tornado.web.StaticFileHandler.parse_url_path"><code class="xref py py-obj docutils literal"><span class="pre">parse_url_path</span></code></a>,
<a class="reference internal" href="#tornado.web.StaticFileHandler.get_cache_time" title="tornado.web.StaticFileHandler.get_cache_time"><code class="xref py py-obj docutils literal"><span class="pre">get_cache_time</span></code></a>, 和/或 <a class="reference internal" href="#tornado.web.StaticFileHandler.get_version" title="tornado.web.StaticFileHandler.get_version"><code class="xref py py-obj docutils literal"><span class="pre">get_version</span></code></a>.</p>
<p>为了代替所有与文件系统的相互作用(e.g. 从数据库提供静态内容服务),
复写 <a class="reference internal" href="#tornado.web.StaticFileHandler.get_content" title="tornado.web.StaticFileHandler.get_content"><code class="xref py py-obj docutils literal"><span class="pre">get_content</span></code></a>, <a class="reference internal" href="#tornado.web.StaticFileHandler.get_content_size" title="tornado.web.StaticFileHandler.get_content_size"><code class="xref py py-obj docutils literal"><span class="pre">get_content_size</span></code></a>, <a class="reference internal" href="#tornado.web.StaticFileHandler.get_modified_time" title="tornado.web.StaticFileHandler.get_modified_time"><code class="xref py py-obj docutils literal"><span class="pre">get_modified_time</span></code></a>,
<a class="reference internal" href="#tornado.web.StaticFileHandler.get_absolute_path" title="tornado.web.StaticFileHandler.get_absolute_path"><code class="xref py py-obj docutils literal"><span class="pre">get_absolute_path</span></code></a>, 和 <a class="reference internal" href="#tornado.web.StaticFileHandler.validate_absolute_path" title="tornado.web.StaticFileHandler.validate_absolute_path"><code class="xref py py-obj docutils literal"><span class="pre">validate_absolute_path</span></code></a>.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.1 版更改: </span>一些为子类设计的方法在Tornado 3.1 被添加.</p>
</div>
<dl class="method">
<dt id="tornado.web.StaticFileHandler.compute_etag">
<code class="descname">compute_etag</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.compute_etag"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.compute_etag" title="永久链接至目标">¶</a></dt>
<dd><p>设置 <code class="docutils literal"><span class="pre">Etag</span></code> 头基于static url版本.</p>
<p>这允许高效的针对缓存版本的 <code class="docutils literal"><span class="pre">If-None-Match</span></code> 检查,
并发送正确的 <code class="docutils literal"><span class="pre">Etag</span></code> 给局部的响应(i.e. 相同的
<code class="docutils literal"><span class="pre">Etag</span></code> 为完整的文件).</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.StaticFileHandler.set_headers">
<code class="descname">set_headers</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.set_headers"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.set_headers" title="永久链接至目标">¶</a></dt>
<dd><p>设置响应的内容和缓存头.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.StaticFileHandler.should_return_304">
<code class="descname">should_return_304</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.should_return_304"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.should_return_304" title="永久链接至目标">¶</a></dt>
<dd><p>如果头部表明我们应该返回304则返回True.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="tornado.web.StaticFileHandler.get_absolute_path">
<em class="property">classmethod </em><code class="descname">get_absolute_path</code><span class="sig-paren">(</span><em>root</em>, <em>path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.get_absolute_path"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.get_absolute_path" title="永久链接至目标">¶</a></dt>
<dd><p>返回 <code class="docutils literal"><span class="pre">path</span></code> 相对于 <code class="docutils literal"><span class="pre">root</span></code> 的绝对路径.</p>
<p><code class="docutils literal"><span class="pre">root</span></code> 是这个 <a class="reference internal" href="#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> 配置的路径(在大多数情
况下是 <a class="reference internal" href="#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 的 <code class="docutils literal"><span class="pre">static_path</span></code> 设置).</p>
<p>这个类方法可能在子类中被复写. 默认情况下它返回一个文件系统
路径, 但其他字符串可以被使用, 只要它们是独特的并且被
子类复写的 <a class="reference internal" href="#tornado.web.StaticFileHandler.get_content" title="tornado.web.StaticFileHandler.get_content"><code class="xref py py-obj docutils literal"><span class="pre">get_content</span></code></a> 理解.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.StaticFileHandler.validate_absolute_path">
<code class="descname">validate_absolute_path</code><span class="sig-paren">(</span><em>root</em>, <em>absolute_path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.validate_absolute_path"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.validate_absolute_path" title="永久链接至目标">¶</a></dt>
<dd><p>验证并返回绝对路径.</p>
<p><code class="docutils literal"><span class="pre">root</span></code> 是 <a class="reference internal" href="#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> 配置的路径,并且
<code class="docutils literal"><span class="pre">path</span></code> 是 <a class="reference internal" href="#tornado.web.StaticFileHandler.get_absolute_path" title="tornado.web.StaticFileHandler.get_absolute_path"><code class="xref py py-obj docutils literal"><span class="pre">get_absolute_path</span></code></a> 的结果.</p>
<p>这是一个实例方法在请求过程中被调用, 所以它可能抛出
<a class="reference internal" href="#tornado.web.HTTPError" title="tornado.web.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">HTTPError</span></code></a> 或者使用类似 <a class="reference internal" href="#tornado.web.RequestHandler.redirect" title="tornado.web.RequestHandler.redirect"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.redirect</span></code></a>
(返回None在重定向到停止进一步处理之后) 这种方法.
如果丢失文件将会生成404错误.</p>
<p>这个方法可能在返回路径之前修改它, 但是注意任何这样的
修改将不会被 <a class="reference internal" href="#tornado.web.StaticFileHandler.make_static_url" title="tornado.web.StaticFileHandler.make_static_url"><code class="xref py py-obj docutils literal"><span class="pre">make_static_url</span></code></a> 理解.</p>
<p>在实例方法, 这个方法的结果对 <code class="docutils literal"><span class="pre">self.absolute_path</span></code>
是可用的.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="tornado.web.StaticFileHandler.get_content">
<em class="property">classmethod </em><code class="descname">get_content</code><span class="sig-paren">(</span><em>abspath</em>, <em>start=None</em>, <em>end=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.get_content"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.get_content" title="永久链接至目标">¶</a></dt>
<dd><p>检索位于所给定绝对路径的请求资源的内容.</p>
<p>这个类方法可以被子类复写. 注意它的特征不同于其他可复写
的类方法(没有 <code class="docutils literal"><span class="pre">settings</span></code> 参数); 这是经过深思熟虑的以
确保 <code class="docutils literal"><span class="pre">abspath</span></code> 能依靠自己作为缓存键(cache key) .</p>
<p>这个方法返回一个字节串或一个可迭代的字节串. 对于大文件
后者是更优的选择因为它有助于减少内存碎片.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="tornado.web.StaticFileHandler.get_content_version">
<em class="property">classmethod </em><code class="descname">get_content_version</code><span class="sig-paren">(</span><em>abspath</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.get_content_version"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.get_content_version" title="永久链接至目标">¶</a></dt>
<dd><p>返回给定路径资源的一个版本字符串.</p>
<p>这个类方法可以被子类复写. 默认的实现是对文件内容的hash.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.StaticFileHandler.get_content_size">
<code class="descname">get_content_size</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.get_content_size"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.get_content_size" title="永久链接至目标">¶</a></dt>
<dd><p>检索给定路径中资源的总大小.</p>
<p>这个方法可以被子类复写.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>这个方法总是被调用, 而不是仅在部分结果被请求时.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.StaticFileHandler.get_modified_time">
<code class="descname">get_modified_time</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.get_modified_time"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.get_modified_time" title="永久链接至目标">¶</a></dt>
<dd><p>返回 <code class="docutils literal"><span class="pre">self.absolute_path</span></code> 的最后修改时间.</p>
<p>可以被子类复写. 应当返回一个 <a class="reference external" href="https://docs.python.org/3.4/library/datetime.html#datetime.datetime" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">datetime</span></code></a>
对象或None.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.StaticFileHandler.get_content_type">
<code class="descname">get_content_type</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.get_content_type"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.get_content_type" title="永久链接至目标">¶</a></dt>
<dd><p>返回这个请求使用的 <code class="docutils literal"><span class="pre">Content-Type</span></code> 头.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.web.StaticFileHandler.set_extra_headers">
<code class="descname">set_extra_headers</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.set_extra_headers"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.set_extra_headers" title="永久链接至目标">¶</a></dt>
<dd><p>为了子类给响应添加额外的头部</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.StaticFileHandler.get_cache_time">
<code class="descname">get_cache_time</code><span class="sig-paren">(</span><em>path</em>, <em>modified</em>, <em>mime_type</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.get_cache_time"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.get_cache_time" title="永久链接至目标">¶</a></dt>
<dd><p>复写来自定义缓存控制行为.</p>
<p>返回一个正的秒数作为结果可缓存的时间的量或者返回0标记资源
可以被缓存一个未指定的时间段(受浏览器自身的影响).</p>
<p>默认情况下带有 <code class="docutils literal"><span class="pre">v</span></code> 请求参数的资源返回的缓存过期时间是10年.</p>
</dd></dl>

<dl class="classmethod">
<dt id="tornado.web.StaticFileHandler.make_static_url">
<em class="property">classmethod </em><code class="descname">make_static_url</code><span class="sig-paren">(</span><em>settings</em>, <em>path</em>, <em>include_version=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.make_static_url"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.make_static_url" title="永久链接至目标">¶</a></dt>
<dd><p>为给定路径构造一个的有版本的url.</p>
<p>这个方法可以在子类中被复写(但是注意他是一个类方法而不是一个
实例方法). 子类只需实现签名
<code class="docutils literal"><span class="pre">make_static_url(cls,</span> <span class="pre">settings,</span> <span class="pre">path)</span></code>; 其他关键字参数可
以通过 <a class="reference internal" href="#tornado.web.RequestHandler.static_url" title="tornado.web.RequestHandler.static_url"><code class="xref py py-obj docutils literal"><span class="pre">static_url</span></code></a> 传递, 但这不是标准.</p>
<p><code class="docutils literal"><span class="pre">settings</span></code> 是 <a class="reference internal" href="#tornado.web.Application.settings" title="tornado.web.Application.settings"><code class="xref py py-obj docutils literal"><span class="pre">Application.settings</span></code></a> 字典. <code class="docutils literal"><span class="pre">path</span></code>
是被请求的静态路径. 返回的url应该是相对于当前host的.</p>
<p><code class="docutils literal"><span class="pre">include_version</span></code> 决定生成的URL是否应该包含含有给定
<code class="docutils literal"><span class="pre">path</span></code> 相对应文件的hash版本查询字符串.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.web.StaticFileHandler.parse_url_path">
<code class="descname">parse_url_path</code><span class="sig-paren">(</span><em>url_path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.parse_url_path"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.parse_url_path" title="永久链接至目标">¶</a></dt>
<dd><p>将静态URL路径转换成文件系统路径.</p>
<p><code class="docutils literal"><span class="pre">url_path</span></code> 是由去掉 <code class="docutils literal"><span class="pre">static_url_prefix</span></code> 的URL组成.
返回值应该是相对于 <code class="docutils literal"><span class="pre">static_path</span></code> 的文件系统路径.</p>
<p>这是逆 <a class="reference internal" href="#tornado.web.StaticFileHandler.make_static_url" title="tornado.web.StaticFileHandler.make_static_url"><code class="xref py py-obj docutils literal"><span class="pre">make_static_url</span></code></a> .</p>
</dd></dl>

<dl class="classmethod">
<dt id="tornado.web.StaticFileHandler.get_version">
<em class="property">classmethod </em><code class="descname">get_version</code><span class="sig-paren">(</span><em>settings</em>, <em>path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/web.html#StaticFileHandler.get_version"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.web.StaticFileHandler.get_version" title="永久链接至目标">¶</a></dt>
<dd><p>生成用于静态URL的版本字符串.</p>
<p><code class="docutils literal"><span class="pre">settings</span></code> 是 <a class="reference internal" href="#tornado.web.Application.settings" title="tornado.web.Application.settings"><code class="xref py py-obj docutils literal"><span class="pre">Application.settings</span></code></a> 字典并且 <code class="docutils literal"><span class="pre">path</span></code>
是请求资源在文件系统中的相对位置. 返回值应该是一个字符串
或 <code class="docutils literal"><span class="pre">None</span></code> 如果没有版本可以被确定.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.1 版更改: </span>这个方法之前建议在子类中复写; <a class="reference internal" href="#tornado.web.StaticFileHandler.get_content_version" title="tornado.web.StaticFileHandler.get_content_version"><code class="xref py py-obj docutils literal"><span class="pre">get_content_version</span></code></a>
现在是首选因为它允许基类来处理结果的缓存.</p>
</div>
</dd></dl>

</dd></dl>

</div>
</div>
<span id="document-template"></span><div class="section" id="module-tornado.template">
<span id="tornado-template"></span><h4><code class="docutils literal"><span class="pre">tornado.template</span></code> &#8212; 产生灵活的输出<a class="headerlink" href="#module-tornado.template" title="永久链接至标题">¶</a></h4>
<p>一个简单的模板系统, 将模板编译成Python代码.</p>
<p>基本用法如下:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="s2">&quot;&lt;html&gt;{{ myvalue }}&lt;/html&gt;&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">t</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">myvalue</span><span class="o">=</span><span class="s2">&quot;XXX&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#tornado.template.Loader" title="tornado.template.Loader"><code class="xref py py-obj docutils literal"><span class="pre">Loader</span></code></a> 是一个从根目录加载模板并缓存编译过的模板的类:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">loader</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Loader</span><span class="p">(</span><span class="s2">&quot;/home/btaylor&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">loader</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;test.html&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">myvalue</span><span class="o">=</span><span class="s2">&quot;XXX&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>我们编译所有模板至原生的Python. 错误报告是目前... uh,
很有趣. 模板语法如下:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">### base.html</span>
<span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">title</span> <span class="o">%</span><span class="p">}</span><span class="n">Default</span> <span class="n">title</span><span class="p">{</span><span class="o">%</span> <span class="n">end</span> <span class="o">%</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">student</span> <span class="ow">in</span> <span class="n">students</span> <span class="o">%</span><span class="p">}</span>
        <span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">student</span> <span class="o">%</span><span class="p">}</span>
          <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">escape</span><span class="p">(</span><span class="n">student</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="o">%</span> <span class="n">end</span> <span class="o">%</span><span class="p">}</span>
      <span class="p">{</span><span class="o">%</span> <span class="n">end</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>

<span class="c1">### bold.html</span>
<span class="p">{</span><span class="o">%</span> <span class="n">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">title</span> <span class="o">%</span><span class="p">}</span><span class="n">A</span> <span class="n">bolder</span> <span class="n">title</span><span class="p">{</span><span class="o">%</span> <span class="n">end</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">student</span> <span class="o">%</span><span class="p">}</span>
  <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">escape</span><span class="p">(</span><span class="n">student</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">end</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>与大多数其他模板系统不同, 我们没有在你的语句中可包含的表达式上放置任何约束.
<code class="docutils literal"><span class="pre">if</span></code> 和 <code class="docutils literal"><span class="pre">for</span></code> 语句块完全翻译成了Python, 所以你可以写复杂的表达式例如:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">student</span> <span class="ow">in</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">people</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">student</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">23</span><span class="p">]</span> <span class="o">%</span><span class="p">}</span>
  <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">escape</span><span class="p">(</span><span class="n">student</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">end</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>直接翻译成Python意味着你可以很简单的在表达式中使用函数, 就像在上面例子中的
<code class="docutils literal"><span class="pre">escape()</span></code> 函数. 你可以把函数传递到你的模板中就像其他任何变量一样(在一个
<a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> 中, 复写 <a class="reference internal" href="index.html#tornado.web.RequestHandler.get_template_namespace" title="tornado.web.RequestHandler.get_template_namespace"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_template_namespace</span></code></a>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">### Python code</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
   <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="n">template</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">add</span><span class="o">=</span><span class="n">add</span><span class="p">)</span>

<span class="c1">### The template</span>
<span class="p">{{</span> <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>
</div>
<p>默认情况下我们提供了 <a class="reference internal" href="index.html#tornado.escape.xhtml_escape" title="tornado.escape.xhtml_escape"><code class="xref py py-obj docutils literal"><span class="pre">escape()</span></code></a>, <a class="reference internal" href="index.html#tornado.escape.url_escape" title="tornado.escape.url_escape"><code class="xref py py-obj docutils literal"><span class="pre">url_escape()</span></code></a>,
<a class="reference internal" href="index.html#tornado.escape.json_encode" title="tornado.escape.json_encode"><code class="xref py py-obj docutils literal"><span class="pre">json_encode()</span></code></a>, 和 <a class="reference internal" href="index.html#tornado.escape.squeeze" title="tornado.escape.squeeze"><code class="xref py py-obj docutils literal"><span class="pre">squeeze()</span></code></a> 函数给所有模板.</p>
<p>典型的应用程序不会手动创建 <a class="reference internal" href="#tornado.template.Template" title="tornado.template.Template"><code class="xref py py-obj docutils literal"><span class="pre">Template</span></code></a> 或 <a class="reference internal" href="#tornado.template.Loader" title="tornado.template.Loader"><code class="xref py py-obj docutils literal"><span class="pre">Loader</span></code></a> 实例, 而是使用
<a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.RequestHandler</span></code></a> 中的 <a class="reference internal" href="index.html#tornado.web.RequestHandler.render" title="tornado.web.RequestHandler.render"><code class="xref py py-obj docutils literal"><span class="pre">render</span></code></a> 和
<a class="reference internal" href="index.html#tornado.web.RequestHandler.render_string" title="tornado.web.RequestHandler.render_string"><code class="xref py py-obj docutils literal"><span class="pre">render_string</span></code></a> 方法, 这些方法自动的基于
<code class="docutils literal"><span class="pre">template_path</span></code> <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 设置加载模板.</p>
<p>以 <code class="docutils literal"><span class="pre">_tt_</span></code> 为前缀命名的变量是模板系统保留的, 不应该被应用程序的
代码使用.</p>
<div class="section" id="id1">
<h5>语法参考<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>模板表达式被双花括号包围: <code class="docutils literal"><span class="pre">{{</span> <span class="pre">...</span> <span class="pre">}}</span></code>. 内容可以是任何python表达式,
会根据当前自动转义(autoescape)设置被转义并且插入到输出. 其他模板指令
使用 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">%}</span></code>. 这些标签可以被转义作为 <code class="docutils literal"><span class="pre">{{!</span></code> 和 <code class="docutils literal"><span class="pre">{%!</span></code> 如果你需要
在输出中包含一个原义的 <code class="docutils literal"><span class="pre">{{</span></code> 或 <code class="docutils literal"><span class="pre">{%</span></code> .</p>
<p>为了注释掉一段让它从输出中省略, 使用 <code class="docutils literal"><span class="pre">{#</span> <span class="pre">...</span> <span class="pre">#}</span></code> 包住它.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">apply</span> <span class="pre">*function*</span> <span class="pre">%}...{%</span> <span class="pre">end</span> <span class="pre">%}</span></code></dt>
<dd><p class="first">在 <code class="docutils literal"><span class="pre">apply</span></code> 和 <code class="docutils literal"><span class="pre">end</span></code> 之间应用一个函数到所有模板代码的输出:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">apply</span> <span class="n">linkify</span> <span class="o">%</span><span class="p">}{{</span><span class="n">name</span><span class="p">}}</span> <span class="n">said</span><span class="p">:</span> <span class="p">{{</span><span class="n">message</span><span class="p">}}{</span><span class="o">%</span> <span class="n">end</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p class="last">注意作为一个实现细节使用块会执行嵌套函数, 因此可能产生奇怪的
相互作用, 包括通过 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">set</span> <span class="pre">%}</span></code> 设置的变量, 或者在循环中使用
<code class="docutils literal"><span class="pre">{%</span> <span class="pre">break</span> <span class="pre">%}</span></code> 或 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">continue</span> <span class="pre">%}</span></code> .</p>
</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">autoescape</span> <span class="pre">*function*</span> <span class="pre">%}</span></code></dt>
<dd><p class="first">为当前文件设置自动转义(autoescape)模式. 这不会影响其他文件, 即使
是那些通过 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">%}</span></code> 引用的文件. 注意自动转义也可以全局
设置, 在 <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> 或 <a class="reference internal" href="#tornado.template.Loader" title="tornado.template.Loader"><code class="xref py py-obj docutils literal"><span class="pre">Loader</span></code></a> 中.:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">autoescape</span> <span class="n">xhtml_escape</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">autoescape</span> <span class="kc">None</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">*name*</span> <span class="pre">%}...{%</span> <span class="pre">end</span> <span class="pre">%}</span></code></dt>
<dd><p class="first">标明了一个已命名的, 可以使用 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">extends</span> <span class="pre">%}</span></code> 被替换的块.
在父模板中的块将会被子模板中同名块的内容替换.:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span>&lt;!-- base.html --&gt;
&lt;title&gt;{% block title %}Default title{% end %}&lt;/title&gt;

&lt;!-- mypage.html --&gt;
{% extends &quot;base.html&quot; %}
{% block title %}My page title{% end %}
</pre></div>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">comment</span> <span class="pre">...</span> <span class="pre">%}</span></code></dt>
<dd>一个将会从模板的输出中移除的注释. 注意这里没有 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">end</span> <span class="pre">%}</span></code> 标签;
该注释从 <code class="docutils literal"><span class="pre">comment</span></code> 这个词开始到 <code class="docutils literal"><span class="pre">%}</span></code> 标签关闭.</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">extends</span> <span class="pre">*filename*</span> <span class="pre">%}</span></code></dt>
<dd>从另一个模板继承. 使用 <code class="docutils literal"><span class="pre">extends</span></code> 的模板应该包含一个或多个
<code class="docutils literal"><span class="pre">block</span></code> 标签以替换父模板中的内容. 子模板内任何不包含在一个
<code class="docutils literal"><span class="pre">block</span></code> 标签中的内容都将被忽略. 例如, 参见 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">%}</span></code> 标签.</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">*var*</span> <span class="pre">in</span> <span class="pre">*expr*</span> <span class="pre">%}...{%</span> <span class="pre">end</span> <span class="pre">%}</span></code></dt>
<dd>和python的 <code class="docutils literal"><span class="pre">for</span></code> 语句一样.  <code class="docutils literal"><span class="pre">{%</span> <span class="pre">break</span> <span class="pre">%}</span></code> 和
<code class="docutils literal"><span class="pre">{%</span> <span class="pre">continue</span> <span class="pre">%}</span></code> 可以用在循环里.</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">from</span> <span class="pre">*x*</span> <span class="pre">import</span> <span class="pre">*y*</span> <span class="pre">%}</span></code></dt>
<dd>和python的 <code class="docutils literal"><span class="pre">import</span></code> 语句一样.</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">*condition*</span> <span class="pre">%}...{%</span> <span class="pre">elif</span> <span class="pre">*condition*</span> <span class="pre">%}...{%</span> <span class="pre">else</span> <span class="pre">%}...{%</span> <span class="pre">end</span> <span class="pre">%}</span></code></dt>
<dd>条件语句 - 输出第一个条件为true 的部分.  ( <code class="docutils literal"><span class="pre">elif</span></code> 和 <code class="docutils literal"><span class="pre">else</span></code> 部分是
可选的)</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">import</span> <span class="pre">*module*</span> <span class="pre">%}</span></code></dt>
<dd>和python的 <code class="docutils literal"><span class="pre">import</span></code> 语句一样.</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">*filename*</span> <span class="pre">%}</span></code></dt>
<dd>包含另一个模板文件. 被包含的文件可以看到所有局部变量就像它被直接
复制到了该 <code class="docutils literal"><span class="pre">include</span></code> 指令的位置( <code class="docutils literal"><span class="pre">{%</span> <span class="pre">autoescape</span> <span class="pre">%}</span></code> 指令是一
个异常). 替代的, <code class="docutils literal"><span class="pre">{%</span> <span class="pre">module</span> <span class="pre">Template(filename,</span> <span class="pre">**kwargs)</span> <span class="pre">%}</span></code>
可能被用来包含另外的有独立命名空间的模板.</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">module</span> <span class="pre">*expr*</span> <span class="pre">%}</span></code></dt>
<dd><p class="first">渲染一个 <a class="reference internal" href="index.html#tornado.web.UIModule" title="tornado.web.UIModule"><code class="xref py py-obj docutils literal"><span class="pre">UIModule</span></code></a>. 该 <code class="docutils literal"><span class="pre">UIModule</span></code> 的输出没有
转义:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">module</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;foo.html&quot;</span><span class="p">,</span> <span class="n">arg</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p class="last"><code class="docutils literal"><span class="pre">UIModules</span></code> 是 <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.RequestHandler</span></code></a> 类(尤其是它的
<code class="docutils literal"><span class="pre">render</span></code> 方法)的一个方法, 并且当模板系统在其他上下文中使用
时, 它将不工作.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">raw</span> <span class="pre">*expr*</span> <span class="pre">%}</span></code></dt>
<dd>输出给定表达式的结果并且不会转义.</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">set</span> <span class="pre">*x*</span> <span class="pre">=</span> <span class="pre">*y*</span> <span class="pre">%}</span></code></dt>
<dd>设置一个局部变量.</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">try</span> <span class="pre">%}...{%</span> <span class="pre">except</span> <span class="pre">%}...{%</span> <span class="pre">else</span> <span class="pre">%}...{%</span> <span class="pre">finally</span> <span class="pre">%}...{%</span> <span class="pre">end</span> <span class="pre">%}</span></code></dt>
<dd>和python的 <code class="docutils literal"><span class="pre">try</span></code> 语句一样.</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">while</span> <span class="pre">*condition*</span> <span class="pre">%}...</span> <span class="pre">{%</span> <span class="pre">end</span> <span class="pre">%}</span></code></dt>
<dd>和python的 <code class="docutils literal"><span class="pre">while</span></code> 语句一样. <code class="docutils literal"><span class="pre">{%</span> <span class="pre">break</span> <span class="pre">%}</span></code> 和
<code class="docutils literal"><span class="pre">{%</span> <span class="pre">continue</span> <span class="pre">%}</span></code> 可以用在循环里.</dd>
<dt><code class="docutils literal"><span class="pre">{%</span> <span class="pre">whitespace</span> <span class="pre">*mode*</span> <span class="pre">%}</span></code></dt>
<dd>为当前文件的剩余部分设置空白模式(whitespace mode)
(或直到下一个 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">whitespace</span> <span class="pre">%}</span></code> 指令). 参见
<a class="reference internal" href="#tornado.template.filter_whitespace" title="tornado.template.filter_whitespace"><code class="xref py py-obj docutils literal"><span class="pre">filter_whitespace</span></code></a> 查看可用参数. Tornado 4.3中新增.</dd>
</dl>
</div>
<div class="section" id="class-reference">
<h5>Class reference<a class="headerlink" href="#class-reference" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.template.Template">
<em class="property">class </em><code class="descclassname">tornado.template.</code><code class="descname">Template</code><span class="sig-paren">(</span><em>template_string</em>, <em>name=&quot;&lt;string&gt;&quot;</em>, <em>loader=None</em>, <em>compress_whitespace=None</em>, <em>autoescape=&quot;xhtml_escape&quot;</em>, <em>whitespace=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/template.html#Template"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.template.Template" title="永久链接至目标">¶</a></dt>
<dd><p>编译模板.</p>
<p>我们从给定的template_string编译到Python. 你可以使用generate()
用变量生成模板.</p>
<p>构造一个模板.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>template_string</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#str" title="(在 Python v3.4)"><em>str</em></a>) &#8211; 模板文件的内容.</li>
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#str" title="(在 Python v3.4)"><em>str</em></a>) &#8211; 被加载的模板文件名(用于错误信息).</li>
<li><strong>loader</strong> (<a class="reference internal" href="index.html#tornado.template.BaseLoader" title="tornado.template.BaseLoader"><em>tornado.template.BaseLoader</em></a>) &#8211; <a class="reference internal" href="#tornado.template.BaseLoader" title="tornado.template.BaseLoader"><code class="xref py py-obj docutils literal"><span class="pre">BaseLoader</span></code></a>
负责该模板, 用于解决 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">%}</span></code> 和 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">extend</span> <span class="pre">%}</span></code> 指令.</li>
<li><strong>compress_whitespace</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#bool" title="(在 Python v3.4)"><em>bool</em></a>) &#8211; 自从Tornado 4.3过时了.
如果为true, 相当于 <code class="docutils literal"><span class="pre">whitespace=&quot;single&quot;</span></code> ,
如果为false, 相当于 <code class="docutils literal"><span class="pre">whitespace=&quot;all&quot;</span></code> .</li>
<li><strong>autoescape</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#str" title="(在 Python v3.4)"><em>str</em></a>) &#8211; 在模板命名空间中的函数名, 默认情况下为 <code class="docutils literal"><span class="pre">None</span></code>
以禁用转义.</li>
<li><strong>whitespace</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#str" title="(在 Python v3.4)"><em>str</em></a>) &#8211; 一个指定处理whitespace 的字符串; 参见
<a class="reference internal" href="#tornado.template.filter_whitespace" title="tornado.template.filter_whitespace"><code class="xref py py-obj docutils literal"><span class="pre">filter_whitespace</span></code></a> 了解可选项.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>增加 <code class="docutils literal"><span class="pre">whitespace</span></code> 参数; 弃用 <code class="docutils literal"><span class="pre">compress_whitespace</span></code>.</p>
</div>
<dl class="method">
<dt id="tornado.template.Template.generate">
<code class="descname">generate</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/template.html#Template.generate"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.template.Template.generate" title="永久链接至目标">¶</a></dt>
<dd><p>用给定参数生成此模板.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.template.BaseLoader">
<em class="property">class </em><code class="descclassname">tornado.template.</code><code class="descname">BaseLoader</code><span class="sig-paren">(</span><em>autoescape='xhtml_escape'</em>, <em>namespace=None</em>, <em>whitespace=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/template.html#BaseLoader"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.template.BaseLoader" title="永久链接至目标">¶</a></dt>
<dd><p>模板加载器的基类.</p>
<p>你必须使用一个模板加载器来使用模板的构造器例如 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">extends</span> <span class="pre">%}</span></code>
和 <code class="docutils literal"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">%}</span></code>. 加载器在所有模板首次加载之后进行缓存.</p>
<p>构造一个模板加载器.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>autoescape</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#str" title="(在 Python v3.4)"><em>str</em></a>) &#8211; 在模板命名空间中的函数名, 例如 &#8220;xhtml_escape&#8221;,
或默认情况下为 <code class="docutils literal"><span class="pre">None</span></code> 来禁用自动转义.</li>
<li><strong>namespace</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#dict" title="(在 Python v3.4)"><em>dict</em></a>) &#8211; 一个被加入默认模板命名空间中的字典或 <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>whitespace</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#str" title="(在 Python v3.4)"><em>str</em></a>) &#8211; 一个指定模板中whitespace默认行为的字符串;
参见 <a class="reference internal" href="#tornado.template.filter_whitespace" title="tornado.template.filter_whitespace"><code class="xref py py-obj docutils literal"><span class="pre">filter_whitespace</span></code></a> 查看可选项. 默认是 &#8220;single&#8221; 对于
&#8221;.html&#8221; 和 &#8221;.js&#8221; 文件的结束, &#8220;all&#8221; 是为了其他文件.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>添加 <code class="docutils literal"><span class="pre">whitespace</span></code> 参数.</p>
</div>
<dl class="method">
<dt id="tornado.template.BaseLoader.reset">
<code class="descname">reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/template.html#BaseLoader.reset"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.template.BaseLoader.reset" title="永久链接至目标">¶</a></dt>
<dd><p>重置已编译模板的缓存.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.template.BaseLoader.resolve_path">
<code class="descname">resolve_path</code><span class="sig-paren">(</span><em>name</em>, <em>parent_path=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/template.html#BaseLoader.resolve_path"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.template.BaseLoader.resolve_path" title="永久链接至目标">¶</a></dt>
<dd><p>转化一个可能相对的路径为绝对路径(内部使用).</p>
</dd></dl>

<dl class="method">
<dt id="tornado.template.BaseLoader.load">
<code class="descname">load</code><span class="sig-paren">(</span><em>name</em>, <em>parent_path=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/template.html#BaseLoader.load"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.template.BaseLoader.load" title="永久链接至目标">¶</a></dt>
<dd><p>加载一个模板.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.template.Loader">
<em class="property">class </em><code class="descclassname">tornado.template.</code><code class="descname">Loader</code><span class="sig-paren">(</span><em>root_directory</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/template.html#Loader"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.template.Loader" title="永久链接至目标">¶</a></dt>
<dd><p>一个从单一根文件夹加载的模板加载器.</p>
</dd></dl>

<dl class="class">
<dt id="tornado.template.DictLoader">
<em class="property">class </em><code class="descclassname">tornado.template.</code><code class="descname">DictLoader</code><span class="sig-paren">(</span><em>dict</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/template.html#DictLoader"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.template.DictLoader" title="永久链接至目标">¶</a></dt>
<dd><p>一个从字典加载的模板加载器.</p>
</dd></dl>

<dl class="exception">
<dt id="tornado.template.ParseError">
<em class="property">exception </em><code class="descclassname">tornado.template.</code><code class="descname">ParseError</code><span class="sig-paren">(</span><em>message</em>, <em>filename</em>, <em>lineno</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/template.html#ParseError"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.template.ParseError" title="永久链接至目标">¶</a></dt>
<dd><p>抛出模板的语法错误.</p>
<p><code class="docutils literal"><span class="pre">ParseError</span></code> 实例有 <code class="docutils literal"><span class="pre">filename</span></code> 和 <code class="docutils literal"><span class="pre">lineno</span></code> 属性指出错误所在位置.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>添加 <code class="docutils literal"><span class="pre">filename</span></code> 和 <code class="docutils literal"><span class="pre">lineno</span></code> 属性.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.template.filter_whitespace">
<code class="descclassname">tornado.template.</code><code class="descname">filter_whitespace</code><span class="sig-paren">(</span><em>mode</em>, <em>text</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/template.html#filter_whitespace"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.template.filter_whitespace" title="永久链接至目标">¶</a></dt>
<dd><p>根据 <code class="docutils literal"><span class="pre">mode</span></code> 转换空白到 <code class="docutils literal"><span class="pre">text</span></code> .</p>
<p>可用的模式有:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">all</span></code>: 返回所有未更改的空白.</li>
<li><code class="docutils literal"><span class="pre">single</span></code>: 压缩连串的空白用一个空白字符代替, 保留换行符.</li>
<li><code class="docutils literal"><span class="pre">oneline</span></code>: 压缩所有空白到一个空格字符, 在这个过程中移除所有换行符.</li>
</ul>
<div class="versionadded">
<p><span class="versionmodified">4.3 新版功能.</span></p>
</div>
</dd></dl>

</div>
</div>
<span id="document-escape"></span><div class="section" id="module-tornado.escape">
<span id="tornado-escape"></span><h4><code class="docutils literal"><span class="pre">tornado.escape</span></code> &#8212; 转义和字符串操作<a class="headerlink" href="#module-tornado.escape" title="永久链接至标题">¶</a></h4>
<p>HTML, JSON, URLs, 和其他(格式)的转义/非转义方法.</p>
<p>也包含一些其他的各种字符串操作函数.</p>
<div class="section" id="id1">
<h5>转义函数<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<dl class="function">
<dt id="tornado.escape.xhtml_escape">
<code class="descclassname">tornado.escape.</code><code class="descname">xhtml_escape</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/escape.html#xhtml_escape"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.escape.xhtml_escape" title="永久链接至目标">¶</a></dt>
<dd><p>转义一个字符串使它在HTML 或XML 中有效.</p>
<p>转义这些字符 <code class="docutils literal"><span class="pre">&lt;</span></code>, <code class="docutils literal"><span class="pre">&gt;</span></code>, <code class="docutils literal"><span class="pre">&quot;</span></code>, <code class="docutils literal"><span class="pre">'</span></code>, 和 <code class="docutils literal"><span class="pre">&amp;</span></code>.
当属性值使用转义字符串必须用引号括起来.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.2 版更改: </span>添加了单引号到转义字符串列表.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.escape.xhtml_unescape">
<code class="descclassname">tornado.escape.</code><code class="descname">xhtml_unescape</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/escape.html#xhtml_unescape"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.escape.xhtml_unescape" title="永久链接至目标">¶</a></dt>
<dd><p>反转义一个已经XML转义过的字符串.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.escape.url_escape">
<code class="descclassname">tornado.escape.</code><code class="descname">url_escape</code><span class="sig-paren">(</span><em>value</em>, <em>plus=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/escape.html#url_escape"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.escape.url_escape" title="永久链接至目标">¶</a></dt>
<dd><p>返回一个给定值的URL 编码版本.</p>
<p>如果 <code class="docutils literal"><span class="pre">plus</span></code> 为true (默认值), 空格将被表示为&#8221;+&#8221;而不是&#8221;%20&#8221;.
这是适当的为查询字符串, 但不是一个URL路径组件. 注意此默认设置
和Python的urllib 模块是相反的.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能: </span>该 <code class="docutils literal"><span class="pre">plus</span></code> 参数</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.escape.url_unescape">
<code class="descclassname">tornado.escape.</code><code class="descname">url_unescape</code><span class="sig-paren">(</span><em>value</em>, <em>encoding='utf-8'</em>, <em>plus=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/escape.html#url_unescape"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.escape.url_unescape" title="永久链接至目标">¶</a></dt>
<dd><p>解码来自于URL 的给定值.</p>
<p>该参数可以是一个字节或unicode 字符串.</p>
<p>如果encoding 是None , 该结果将会是一个字节串. 否则, 该结果会是
指定编码的unicode 字符串.</p>
<p>如果 <code class="docutils literal"><span class="pre">plus</span></code> 是true (默认值), 加号将被解释为空格(文字加号必须被
表示为&#8221;%2B&#8221;). 这是适用于查询字符串和form-encoded 的值, 但不是URL
的路径组件. 注意该默认设置和Python 的urllib 模块是相反的.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能: </span>该 <code class="docutils literal"><span class="pre">plus</span></code> 参数</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.escape.json_encode">
<code class="descclassname">tornado.escape.</code><code class="descname">json_encode</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/escape.html#json_encode"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.escape.json_encode" title="永久链接至目标">¶</a></dt>
<dd><p>将给定的Python 对象进行JSON 编码.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.escape.json_decode">
<code class="descclassname">tornado.escape.</code><code class="descname">json_decode</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/escape.html#json_decode"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.escape.json_decode" title="永久链接至目标">¶</a></dt>
<dd><p>返回给定JSON 字符串的Python 对象.</p>
</dd></dl>

</div>
<div class="section" id="byte-unicode">
<h5>Byte/unicode 转换<a class="headerlink" href="#byte-unicode" title="永久链接至标题">¶</a></h5>
<p>这些函数在Tornado自身中被广泛使用, 但不应该被大多数应用程序直接
需要. 值得注意的是,许多这些功能的复杂性来源于这样一个事实:
Tornado 同时支持Python 2 和Python 3.</p>
<dl class="function">
<dt id="tornado.escape.utf8">
<code class="descclassname">tornado.escape.</code><code class="descname">utf8</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/escape.html#utf8"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.escape.utf8" title="永久链接至目标">¶</a></dt>
<dd><p>将字符串参数转换为字节字符串.</p>
<p>如果该参数已经是一个字节字符串或None, 则原样返回.
否则它必须是一个unicode 字符串并且被编码成utf8.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.escape.to_unicode">
<code class="descclassname">tornado.escape.</code><code class="descname">to_unicode</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/escape.html#to_unicode"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.escape.to_unicode" title="永久链接至目标">¶</a></dt>
<dd><p>将字符串参数转换为unicode 字符串.</p>
<p>如果该参数已经是一个unicode 字符串或None, 则原样返回.
否则它必须是一个字节字符串并且被解码成utf8.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.escape.native_str">
<code class="descclassname">tornado.escape.</code><code class="descname">native_str</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tornado.escape.native_str" title="永久链接至目标">¶</a></dt>
<dd><p>转换一个byte 或unicode 字符串到 <a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#str" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">str</span></code></a> 类型. 等价于
Python 2的 <a class="reference internal" href="#tornado.escape.utf8" title="tornado.escape.utf8"><code class="xref py py-obj docutils literal"><span class="pre">utf8</span></code></a> 和Python 3的 <a class="reference internal" href="#tornado.escape.to_unicode" title="tornado.escape.to_unicode"><code class="xref py py-obj docutils literal"><span class="pre">to_unicode</span></code></a> .</p>
</dd></dl>

<dl class="function">
<dt id="tornado.escape.to_basestring">
<code class="descclassname">tornado.escape.</code><code class="descname">to_basestring</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/escape.html#to_basestring"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.escape.to_basestring" title="永久链接至目标">¶</a></dt>
<dd><p>将字符串参数转换为basestring 的子类.</p>
<p>在python2 中, 字节字符串和unicode 字符串几乎是可以互换的,
所以函数处理一个用户提供的参数与ascii 字符串常量相结合,
可以使用和应该返回用户提供的类型. 在python3 中, 这两个类型
不可以互换, 所以这个方法必须转换字节字符串为unicode 字符串.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.escape.recursive_unicode">
<code class="descclassname">tornado.escape.</code><code class="descname">recursive_unicode</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/escape.html#recursive_unicode"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.escape.recursive_unicode" title="永久链接至目标">¶</a></dt>
<dd><p>伴随一个简单的数据结构, 转换字节字符串为unicode 字符串.</p>
<p>支持列表, 元组, 和字典.</p>
</dd></dl>

</div>
<div class="section" id="id2">
<h5>其他函数<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<dl class="function">
<dt id="tornado.escape.linkify">
<code class="descclassname">tornado.escape.</code><code class="descname">linkify</code><span class="sig-paren">(</span><em>text, shorten=False, extra_params='', require_protocol=False, permitted_protocols=['http', 'https']</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/escape.html#linkify"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.escape.linkify" title="永久链接至目标">¶</a></dt>
<dd><p>转换纯文本为带有链接的HTML.</p>
<p>例如: <code class="docutils literal"><span class="pre">linkify(&quot;Hello</span> <span class="pre">http://tornadoweb.org!&quot;)</span></code> 将返回
<code class="docutils literal"><span class="pre">Hello</span> <span class="pre">&lt;a</span> <span class="pre">href=&quot;http://tornadoweb.org&quot;&gt;http://tornadoweb.org&lt;/a&gt;!</span></code></p>
<p>参数:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">shorten</span></code>: 长url 将被缩短展示.</p>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">extra_params</span></code>: 额外的文本中的链接标签, 或一个可调用的</dt>
<dd><p class="first">带有该链接作为一个参数并返回该额外的文本.
e.g. <code class="docutils literal"><span class="pre">linkify(text,</span> <span class="pre">extra_params='rel=&quot;nofollow&quot;</span> <span class="pre">class=&quot;external&quot;')</span></code>,
或:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extra_params_cb</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http://example.com&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;class=&quot;internal&quot;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;class=&quot;external&quot; rel=&quot;nofollow&quot;&#39;</span>
<span class="n">linkify</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">extra_params</span><span class="o">=</span><span class="n">extra_params_cb</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">require_protocol</span></code>: 只有链接url 包括一个协议. 如果这是False,</dt>
<dd><p class="first last">例如www.facebook.com 这样的url 也将被linkified.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">permitted_protocols</span></code>: 协议的列表(或集合)应该被linkified,</dt>
<dd><p class="first last">e.g. <code class="docutils literal"><span class="pre">linkify(text,</span> <span class="pre">permitted_protocols=[&quot;http&quot;,</span> <span class="pre">&quot;ftp&quot;,</span>
<span class="pre">&quot;mailto&quot;])</span></code>. 这是非常不安全的, 包括协议, 比如 <code class="docutils literal"><span class="pre">javascript</span></code>.</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="tornado.escape.squeeze">
<code class="descclassname">tornado.escape.</code><code class="descname">squeeze</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/escape.html#squeeze"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.escape.squeeze" title="永久链接至目标">¶</a></dt>
<dd><p>使用单个空格代替所有空格字符组成的序列.</p>
</dd></dl>

</div>
</div>
<span id="document-locale"></span><div class="section" id="module-tornado.locale">
<span id="tornado-locale"></span><h4><code class="docutils literal"><span class="pre">tornado.locale</span></code> &#8212; 国际化支持<a class="headerlink" href="#module-tornado.locale" title="永久链接至标题">¶</a></h4>
<p>生成本地化字符串的翻译方法.</p>
<p>要加载区域设置并生成一个翻译后的字符串:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">user_locale</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">locale</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;es_LA&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">user_locale</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;Sign out&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#tornado.locale.get" title="tornado.locale.get"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locale.get()</span></code></a> 返回最匹配的语言环境, 不一定是你请求的特定的语言
环境. 你可以用额外的参数来支持多元化给 <a class="reference internal" href="#tornado.locale.Locale.translate" title="tornado.locale.Locale.translate"><code class="xref py py-obj docutils literal"><span class="pre">translate()</span></code></a>, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">people</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">user_locale</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span>
    <span class="s2">&quot;</span><span class="si">%(list)s</span><span class="s2"> is online&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%(list)s</span><span class="s2"> are online&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">people</span><span class="p">))</span>
<span class="nb">print</span> <span class="n">message</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;list&quot;</span><span class="p">:</span> <span class="n">user_locale</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">people</span><span class="p">)}</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal"><span class="pre">len(people)</span> <span class="pre">==</span> <span class="pre">1</span></code> 则选择第一个字符串, 否则选择第二个字符串.</p>
<p>应用程序应该调用 <a class="reference internal" href="#tornado.locale.load_translations" title="tornado.locale.load_translations"><code class="xref py py-obj docutils literal"><span class="pre">load_translations</span></code></a> (它使用一个简单的CSV 格式) 或
<a class="reference internal" href="#tornado.locale.load_gettext_translations" title="tornado.locale.load_gettext_translations"><code class="xref py py-obj docutils literal"><span class="pre">load_gettext_translations</span></code></a> (它通过使用 <a class="reference external" href="https://docs.python.org/3.4/library/gettext.html#module-gettext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">gettext</span></code></a> 和相关工具支持
<code class="docutils literal"><span class="pre">.mo</span></code> 格式) 其中之一.  如果没有方法被调用, <a class="reference internal" href="#tornado.locale.Locale.translate" title="tornado.locale.Locale.translate"><code class="xref py py-obj docutils literal"><span class="pre">Locale.translate</span></code></a>
方法将会直接的返回原本的字符串.</p>
<dl class="function">
<dt id="tornado.locale.get">
<code class="descclassname">tornado.locale.</code><code class="descname">get</code><span class="sig-paren">(</span><em>*locale_codes</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#get"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.get" title="永久链接至目标">¶</a></dt>
<dd><p>返回给定区域代码的最近匹配.</p>
<p>我们按顺序遍历所有给定的区域代码. 如果我们有一个确定的或模糊的匹配
代码(e.g., &#8220;en&#8221; 匹配 &#8220;en_US&#8221;), 则我们返回该区域. 否则我们移动到列表
中的下一个代码.</p>
<p>默认情况下我们返回 <code class="docutils literal"><span class="pre">en_US</span></code> 如果没有发现任何对指定区域的翻译.
你可以改变默认区域通过 <a class="reference internal" href="#tornado.locale.set_default_locale" title="tornado.locale.set_default_locale"><code class="xref py py-obj docutils literal"><span class="pre">set_default_locale()</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.locale.set_default_locale">
<code class="descclassname">tornado.locale.</code><code class="descname">set_default_locale</code><span class="sig-paren">(</span><em>code</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#set_default_locale"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.set_default_locale" title="永久链接至目标">¶</a></dt>
<dd><p>设置默认区域.</p>
<p>默认语言环境被假定为用于系统中所有的字符串的语言. 从磁盘加载的翻译
是从默认的语言环境到目标区域的映射. 因此, 你不需要为默认的语言环境
创建翻译文件.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.locale.load_translations">
<code class="descclassname">tornado.locale.</code><code class="descname">load_translations</code><span class="sig-paren">(</span><em>directory</em>, <em>encoding=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#load_translations"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.load_translations" title="永久链接至目标">¶</a></dt>
<dd><p>从目录中的CSV 文件加载翻译.</p>
<p>翻译是带有任意的Python 风格指定的占位符的字符串(e.g., <code class="docutils literal"><span class="pre">My</span> <span class="pre">name</span> <span class="pre">is</span> <span class="pre">%(name)s</span></code>)
及其相关翻译.</p>
<p>该目录应该有以下形式的翻译文件 <code class="docutils literal"><span class="pre">LOCALE.csv</span></code>, e.g. <code class="docutils literal"><span class="pre">es_GT.csv</span></code>.
该CSV 文件应该有两列或三列: 字符串, 翻译, 和可选的多个指标. 复数的指标
应该是&#8221;plural&#8221; 或 &#8220;singular&#8221; 其中之一. 一个给定的字符串可以同时有单数和
复数形式. 例如 <code class="docutils literal"><span class="pre">%(name)s</span> <span class="pre">liked</span> <span class="pre">this</span></code> 可能有一个不同的动词组合, 这取决于
%(name)s 是一个名字还是一个名字列表. 在CSV文件里应该有两个针对于该字符串
的行, 一个用指示器指示&#8221;singular&#8221; (奇数), 一个指示&#8221;plural&#8221; (复数).
对于没有动词的字符串，将改变翻译, 简单的使用&#8221;unknown&#8221; 或空字符串
(或者不包括在所有列中的).</p>
<p>这个文件默认使用 <a class="reference external" href="https://docs.python.org/3.4/library/csv.html#module-csv" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">csv</span></code></a> 模块的&#8221;excel&#8221;进行读操作. 这种格式在逗号后面不
应该包含空格.</p>
<p>如果没有给定 <code class="docutils literal"><span class="pre">encoding</span></code> 参数, 如果该文件包含一个
byte-order marker (BOM), 编码格式将会自动检测(在UTF-8 和UTF-16
之间), 如果没有BOM将默认为UTF-8.</p>
<p>例如翻译 <code class="docutils literal"><span class="pre">es_LA.csv</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;I love you&quot;</span><span class="p">,</span><span class="s2">&quot;Te amo&quot;</span>
<span class="s2">&quot;</span><span class="si">%(name)s</span><span class="s2"> liked this&quot;</span><span class="p">,</span><span class="s2">&quot;A </span><span class="si">%(name)s</span><span class="s2"> les gustó esto&quot;</span><span class="p">,</span><span class="s2">&quot;plural&quot;</span>
<span class="s2">&quot;</span><span class="si">%(name)s</span><span class="s2"> liked this&quot;</span><span class="p">,</span><span class="s2">&quot;A </span><span class="si">%(name)s</span><span class="s2"> le gustó esto&quot;</span><span class="p">,</span><span class="s2">&quot;singular&quot;</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>添加 <code class="docutils literal"><span class="pre">encoding</span></code> 参数. 添加对BOM-based 的编码检测, UTF-16,
和 UTF-8-with-BOM.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.locale.load_gettext_translations">
<code class="descclassname">tornado.locale.</code><code class="descname">load_gettext_translations</code><span class="sig-paren">(</span><em>directory</em>, <em>domain</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#load_gettext_translations"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.load_gettext_translations" title="永久链接至目标">¶</a></dt>
<dd><p>从 <a class="reference external" href="https://docs.python.org/3.4/library/gettext.html#module-gettext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">gettext</span></code></a> 的区域树加载翻译</p>
<p>区域树和系统的 <code class="docutils literal"><span class="pre">/usr/share/locale</span></code> 很类似, 例如:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">directory</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">lang</span><span class="p">}</span><span class="o">/</span><span class="n">LC_MESSAGES</span><span class="o">/</span><span class="p">{</span><span class="n">domain</span><span class="p">}</span><span class="o">.</span><span class="n">mo</span>
</pre></div>
</div>
<p>让你的应用程序翻译有三步是必须的:</p>
<ol class="arabic">
<li><p class="first">生成POT翻译文件:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">xgettext</span> <span class="o">--</span><span class="n">language</span><span class="o">=</span><span class="n">Python</span> <span class="o">--</span><span class="n">keyword</span><span class="o">=</span><span class="n">_</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="o">-</span><span class="n">d</span> <span class="n">mydomain</span> <span class="n">file1</span><span class="o">.</span><span class="n">py</span> <span class="n">file2</span><span class="o">.</span><span class="n">html</span> <span class="n">etc</span>
</pre></div>
</div>
</li>
<li><p class="first">合并现有的POT文件:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">msgmerge</span> <span class="n">old</span><span class="o">.</span><span class="n">po</span> <span class="n">mydomain</span><span class="o">.</span><span class="n">po</span> <span class="o">&gt;</span> <span class="n">new</span><span class="o">.</span><span class="n">po</span>
</pre></div>
</div>
</li>
<li><p class="first">编译:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">msgfmt</span> <span class="n">mydomain</span><span class="o">.</span><span class="n">po</span> <span class="o">-</span><span class="n">o</span> <span class="p">{</span><span class="n">directory</span><span class="p">}</span><span class="o">/</span><span class="n">pt_BR</span><span class="o">/</span><span class="n">LC_MESSAGES</span><span class="o">/</span><span class="n">mydomain</span><span class="o">.</span><span class="n">mo</span>
</pre></div>
</div>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="tornado.locale.get_supported_locales">
<code class="descclassname">tornado.locale.</code><code class="descname">get_supported_locales</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#get_supported_locales"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.get_supported_locales" title="永久链接至目标">¶</a></dt>
<dd><p>返回所有支持的语言代码列表.</p>
</dd></dl>

<dl class="class">
<dt id="tornado.locale.Locale">
<em class="property">class </em><code class="descclassname">tornado.locale.</code><code class="descname">Locale</code><span class="sig-paren">(</span><em>code</em>, <em>translations</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#Locale"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.Locale" title="永久链接至目标">¶</a></dt>
<dd><p>对象代表一个区域.</p>
<p>在调用 <a class="reference internal" href="#tornado.locale.load_translations" title="tornado.locale.load_translations"><code class="xref py py-obj docutils literal"><span class="pre">load_translations</span></code></a> 或 <a class="reference internal" href="#tornado.locale.load_gettext_translations" title="tornado.locale.load_gettext_translations"><code class="xref py py-obj docutils literal"><span class="pre">load_gettext_translations</span></code></a> 之后,
调用 <a class="reference internal" href="#tornado.locale.get" title="tornado.locale.get"><code class="xref py py-obj docutils literal"><span class="pre">get</span></code></a> 或 <a class="reference internal" href="#tornado.locale.Locale.get_closest" title="tornado.locale.Locale.get_closest"><code class="xref py py-obj docutils literal"><span class="pre">get_closest</span></code></a> 以得到一个Locale对象.</p>
<dl class="classmethod">
<dt id="tornado.locale.Locale.get_closest">
<em class="property">classmethod </em><code class="descname">get_closest</code><span class="sig-paren">(</span><em>*locale_codes</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#Locale.get_closest"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.Locale.get_closest" title="永久链接至目标">¶</a></dt>
<dd><p>返回给定区域代码的最近匹配.</p>
</dd></dl>

<dl class="classmethod">
<dt id="tornado.locale.Locale.get">
<em class="property">classmethod </em><code class="descname">get</code><span class="sig-paren">(</span><em>code</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#Locale.get"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.Locale.get" title="永久链接至目标">¶</a></dt>
<dd><p>返回给定区域代码的Locale.</p>
<p>如果这个方法不支持, 我们将抛出一个异常.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.locale.Locale.translate">
<code class="descname">translate</code><span class="sig-paren">(</span><em>message</em>, <em>plural_message=None</em>, <em>count=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#Locale.translate"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.Locale.translate" title="永久链接至目标">¶</a></dt>
<dd><p>返回给定信息在当前区域环境下的翻译.</p>
<p>如果给定了 <code class="docutils literal"><span class="pre">plural_message</span></code> , 你也必须有提供 <code class="docutils literal"><span class="pre">count</span></code>.
当 <code class="docutils literal"><span class="pre">count</span> <span class="pre">!=</span> <span class="pre">1</span></code> 时, 我们返回 <code class="docutils literal"><span class="pre">plural_message</span></code> 并且当
<code class="docutils literal"><span class="pre">count</span> <span class="pre">==</span> <span class="pre">1</span></code> 时, 我们返回给定消息的单数形式.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.locale.Locale.format_date">
<code class="descname">format_date</code><span class="sig-paren">(</span><em>date</em>, <em>gmt_offset=0</em>, <em>relative=True</em>, <em>shorter=False</em>, <em>full_format=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#Locale.format_date"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.Locale.format_date" title="永久链接至目标">¶</a></dt>
<dd><p>格式化给定的日期(应该是GMT时间).</p>
<p>默认情况下, 我们返回一个相对时间(e.g., &#8220;2 minutes ago&#8221;). 你
可以返回一个绝对日期字符串通过 <code class="docutils literal"><span class="pre">relative=False</span></code> 参数.</p>
<p>你可以强制使用一个完整的格式化日期(&#8220;July 10, 1980&#8221;) 通过
<code class="docutils literal"><span class="pre">full_format=True</span></code> 参数.</p>
<p>这个方法主要用于过去的日期. 对于将来的日期, 我们退回到
全格式.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.locale.Locale.format_day">
<code class="descname">format_day</code><span class="sig-paren">(</span><em>date</em>, <em>gmt_offset=0</em>, <em>dow=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#Locale.format_day"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.Locale.format_day" title="永久链接至目标">¶</a></dt>
<dd><p>将给定日期格式化为一周的某一天.</p>
<p>例如: &#8220;Monday, January 22&#8221;. 你可以移除星期几通过
<code class="docutils literal"><span class="pre">dow=False</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.locale.Locale.list">
<code class="descname">list</code><span class="sig-paren">(</span><em>parts</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#Locale.list"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.Locale.list" title="永久链接至目标">¶</a></dt>
<dd><p>返回给定列表的一个由逗号分隔的部分.</p>
<p>格式是, e.g., &#8220;A, B and C&#8221;, &#8220;A and B&#8221; 或者&#8221;A&#8221;当列表长度为1.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.locale.Locale.friendly_number">
<code class="descname">friendly_number</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#Locale.friendly_number"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.Locale.friendly_number" title="永久链接至目标">¶</a></dt>
<dd><p>返回给定整数的一个由逗号分隔的字符串.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.locale.CSVLocale">
<em class="property">class </em><code class="descclassname">tornado.locale.</code><code class="descname">CSVLocale</code><span class="sig-paren">(</span><em>code</em>, <em>translations</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#CSVLocale"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.CSVLocale" title="永久链接至目标">¶</a></dt>
<dd><p>区域设置使用tornado 的CSV翻译格式.</p>
</dd></dl>

<dl class="class">
<dt id="tornado.locale.GettextLocale">
<em class="property">class </em><code class="descclassname">tornado.locale.</code><code class="descname">GettextLocale</code><span class="sig-paren">(</span><em>code</em>, <em>translations</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#GettextLocale"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.GettextLocale" title="永久链接至目标">¶</a></dt>
<dd><p>使用 <a class="reference external" href="https://docs.python.org/3.4/library/gettext.html#module-gettext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">gettext</span></code></a> 模块实现Locale.</p>
<dl class="method">
<dt id="tornado.locale.GettextLocale.pgettext">
<code class="descname">pgettext</code><span class="sig-paren">(</span><em>context</em>, <em>message</em>, <em>plural_message=None</em>, <em>count=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locale.html#GettextLocale.pgettext"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locale.GettextLocale.pgettext" title="永久链接至目标">¶</a></dt>
<dd><p>允许为翻译设置上下文, 接受复数形式.</p>
<p>使用示例:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pgettext</span><span class="p">(</span><span class="s2">&quot;law&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
<span class="n">pgettext</span><span class="p">(</span><span class="s2">&quot;good&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>复数信息示例:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pgettext</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">,</span> <span class="s2">&quot;club&quot;</span><span class="p">,</span> <span class="s2">&quot;clubs&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">clubs</span><span class="p">))</span>
<span class="n">pgettext</span><span class="p">(</span><span class="s2">&quot;stick&quot;</span><span class="p">,</span> <span class="s2">&quot;club&quot;</span><span class="p">,</span> <span class="s2">&quot;clubs&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">clubs</span><span class="p">))</span>
</pre></div>
</div>
<p>为了使用上下文生成POT文件, 给第1步添加下面的选项到
<a class="reference internal" href="#tornado.locale.load_gettext_translations" title="tornado.locale.load_gettext_translations"><code class="xref py py-obj docutils literal"><span class="pre">load_gettext_translations</span></code></a> 序列:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">xgettext</span> <span class="p">[</span><span class="n">basic</span> <span class="n">options</span><span class="p">]</span> <span class="o">--</span><span class="n">keyword</span><span class="o">=</span><span class="n">pgettext</span><span class="p">:</span><span class="mi">1</span><span class="n">c</span><span class="p">,</span><span class="mi">2</span> <span class="o">--</span><span class="n">keyword</span><span class="o">=</span><span class="n">pgettext</span><span class="p">:</span><span class="mi">1</span><span class="n">c</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">4.2 新版功能.</span></p>
</div>
</dd></dl>

</dd></dl>

</div>
<span id="document-websocket"></span><div class="section" id="tornado-websocket">
<h4><code class="docutils literal"><span class="pre">tornado.websocket</span></code> &#8212; 浏览器与服务器双向通信<a class="headerlink" href="#tornado-websocket" title="永久链接至标题">¶</a></h4>
<span class="target" id="module-tornado.websocket"></span><p>WebSocket 协议的实现</p>
<p><a class="reference external" href="http://dev.w3.org/html5/websockets/">WebSockets</a> 允许浏览器和服务器之间进行
双向通信</p>
<p>所有主流浏览器的现代版本都支持WebSockets(支持情况详见：<a class="reference external" href="http://caniuse.com/websockets">http://caniuse.com/websockets</a>)</p>
<p>该模块依照最新 WebSocket 协议 <a class="reference external" href="http://tools.ietf.org/html/rfc6455">RFC 6455</a> 实现.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>删除了对76 草案协议版本的支持.</p>
</div>
<dl class="class">
<dt id="tornado.websocket.WebSocketHandler">
<em class="property">class </em><code class="descclassname">tornado.websocket.</code><code class="descname">WebSocketHandler</code><span class="sig-paren">(</span><em>application</em>, <em>request</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketHandler"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketHandler" title="永久链接至目标">¶</a></dt>
<dd><p>通过继承该类来创建一个基本的 WebSocket handler.</p>
<p>重写 <a class="reference internal" href="#tornado.websocket.WebSocketHandler.on_message" title="tornado.websocket.WebSocketHandler.on_message"><code class="xref py py-obj docutils literal"><span class="pre">on_message</span></code></a> 来处理收到的消息, 使用 <a class="reference internal" href="#tornado.websocket.WebSocketHandler.write_message" title="tornado.websocket.WebSocketHandler.write_message"><code class="xref py py-obj docutils literal"><span class="pre">write_message</span></code></a> 来发送消息到客户端.
你也可以重写 <a class="reference internal" href="#tornado.websocket.WebSocketHandler.open" title="tornado.websocket.WebSocketHandler.open"><code class="xref py py-obj docutils literal"><span class="pre">open</span></code></a> 和 <a class="reference internal" href="#tornado.websocket.WebSocketHandler.on_close" title="tornado.websocket.WebSocketHandler.on_close"><code class="xref py py-obj docutils literal"><span class="pre">on_close</span></code></a> 来处理连接打开和关闭这两个动作.</p>
<p>有关JavaScript 接口的详细信息： <a class="reference external" href="http://dev.w3.org/html5/websockets/">http://dev.w3.org/html5/websockets/</a>
具体的协议： <a class="reference external" href="http://tools.ietf.org/html/rfc6455">http://tools.ietf.org/html/rfc6455</a></p>
<p>一个简单的 WebSocket handler 的实例： 服务端直接返回所有收到的消息给客户端</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EchoWebSocket</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">websocket</span><span class="o">.</span><span class="n">WebSocketHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WebSocket opened&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_message</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;You said: &quot;</span> <span class="o">+</span> <span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WebSocket closed&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>WebSockets 并不是标准的 HTTP 连接. “握手”动作符合 HTTP 标准,但是在”握手”动作之后,
协议是基于消息的. 因此,Tornado 里大多数的 HTTP 工具对于这类 handler 都是不可用的.
用来通讯的方法只有 <a class="reference internal" href="#tornado.websocket.WebSocketHandler.write_message" title="tornado.websocket.WebSocketHandler.write_message"><code class="xref py py-obj docutils literal"><span class="pre">write_message()</span></code></a> , <a class="reference internal" href="#tornado.websocket.WebSocketHandler.ping" title="tornado.websocket.WebSocketHandler.ping"><code class="xref py py-obj docutils literal"><span class="pre">ping()</span></code></a> , 和 <a class="reference internal" href="#tornado.websocket.WebSocketHandler.close" title="tornado.websocket.WebSocketHandler.close"><code class="xref py py-obj docutils literal"><span class="pre">close()</span></code></a> .
同样的,你的 request handler 类里应该使用 <a class="reference internal" href="#tornado.websocket.WebSocketHandler.open" title="tornado.websocket.WebSocketHandler.open"><code class="xref py py-obj docutils literal"><span class="pre">open()</span></code></a> 而不是 <code class="docutils literal"><span class="pre">get()</span></code> 或者 <code class="docutils literal"><span class="pre">post()</span></code></p>
<p>如果你在应用中将这个 handler 分配到 <code class="docutils literal"><span class="pre">/websocket</span></code>, 你可以通过如下代码实现:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">ws</span> <span class="o">=</span> <span class="n">new</span> <span class="n">WebSocket</span><span class="p">(</span><span class="s2">&quot;ws://localhost:8888/websocket&quot;</span><span class="p">);</span>
<span class="n">ws</span><span class="o">.</span><span class="n">onopen</span> <span class="o">=</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">);</span>
<span class="p">};</span>
<span class="n">ws</span><span class="o">.</span><span class="n">onmessage</span> <span class="o">=</span> <span class="n">function</span> <span class="p">(</span><span class="n">evt</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">alert</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>这个脚本将会弹出一个提示框 :&#8221;You said: Hello, world&#8221;</p>
<p>浏览器并没有遵循同源策略(same-origin policy),相应的允许了任意站点使用 javascript
发起任意 WebSocket 连接来支配其他网络.这令人惊讶,并且是一个潜在的安全漏洞,所以
从 Tornado 4.0 开始 <a class="reference internal" href="#tornado.websocket.WebSocketHandler" title="tornado.websocket.WebSocketHandler"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler</span></code></a> 需要对希望接受跨域请求的应用通过重写.</p>
<p><a class="reference internal" href="#tornado.websocket.WebSocketHandler.check_origin" title="tornado.websocket.WebSocketHandler.check_origin"><code class="xref py py-obj docutils literal"><span class="pre">check_origin</span></code></a> (详细信息请查看文档中有关该方法的部分)来进行设置.
没有正确配置这个属性,在建立 WebSocket 连接时候很可能会导致 403 错误.</p>
<p>当使用安全的 websocket 连接(<code class="docutils literal"><span class="pre">wss://</span></code>) 时, 来自浏览器的连接可能会失败,因为
websocket 没有地方输出 &#8220;认证成功&#8221; 的对话. 你在 websocket 连接建立成功之前,必须
使用相同的证书访问一个常规的 HTML 页面.</p>
</dd></dl>

<div class="section" id="event-handlers">
<h5>Event handlers<a class="headerlink" href="#event-handlers" title="永久链接至标题">¶</a></h5>
<dl class="method">
<dt id="tornado.websocket.WebSocketHandler.open">
<code class="descclassname">WebSocketHandler.</code><code class="descname">open</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketHandler.open"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketHandler.open" title="永久链接至目标">¶</a></dt>
<dd><p>当打开一个新的 WebSocket 时调用</p>
<p><a class="reference internal" href="#tornado.websocket.WebSocketHandler.open" title="tornado.websocket.WebSocketHandler.open"><code class="xref py py-obj docutils literal"><span class="pre">open</span></code></a> 的参数是从 <a class="reference internal" href="index.html#tornado.web.URLSpec" title="tornado.web.URLSpec"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.URLSpec</span></code></a> 通过正则表达式获取的, 就像获取
<a class="reference internal" href="index.html#tornado.web.RequestHandler.get" title="tornado.web.RequestHandler.get"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.RequestHandler.get</span></code></a> 的参数一样</p>
</dd></dl>

<dl class="method">
<dt id="tornado.websocket.WebSocketHandler.on_message">
<code class="descclassname">WebSocketHandler.</code><code class="descname">on_message</code><span class="sig-paren">(</span><em>message</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketHandler.on_message"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketHandler.on_message" title="永久链接至目标">¶</a></dt>
<dd><p>处理在 WebSocket 中收到的消息</p>
<p>这个方法必须被重写</p>
</dd></dl>

<dl class="method">
<dt id="tornado.websocket.WebSocketHandler.on_close">
<code class="descclassname">WebSocketHandler.</code><code class="descname">on_close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketHandler.on_close"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketHandler.on_close" title="永久链接至目标">¶</a></dt>
<dd><p>当关闭该 WebSocket 时调用</p>
<p>当连接被彻底关闭并且支持 status code 或 reason phtase 的时候, 可以通过
<code class="docutils literal"><span class="pre">self.close_code</span></code> 和 <code class="docutils literal"><span class="pre">self.close_reason</span></code> 这两个属性来获取它们</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>Added <code class="docutils literal"><span class="pre">close_code</span></code> and <code class="docutils literal"><span class="pre">close_reason</span></code> attributes.
添加 <code class="docutils literal"><span class="pre">close_code</span></code> 和 <code class="docutils literal"><span class="pre">close_reason</span></code> 这两个属性</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.websocket.WebSocketHandler.select_subprotocol">
<code class="descclassname">WebSocketHandler.</code><code class="descname">select_subprotocol</code><span class="sig-paren">(</span><em>subprotocols</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketHandler.select_subprotocol"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketHandler.select_subprotocol" title="永久链接至目标">¶</a></dt>
<dd><p>当一个新的 WebSocket 请求特定子协议(subprotocols)时调用</p>
<p><code class="docutils literal"><span class="pre">subprotocols</span></code> 是一个由一系列能够被客户端正确识别出相应的子协议
（subprotocols）的字符串构成的 list . 这个方法可能会被重载,用来返回 list 中某
个匹配字符串, 没有匹配到则返回 <code class="docutils literal"><span class="pre">None</span></code>. 如果没有找到相应的子协议,虽然服务端并
不会自动关闭 WebSocket 连接,但是客户端可以选择关闭连接.</p>
</dd></dl>

</div>
<div class="section" id="output">
<h5>Output<a class="headerlink" href="#output" title="永久链接至标题">¶</a></h5>
<dl class="method">
<dt id="tornado.websocket.WebSocketHandler.write_message">
<code class="descclassname">WebSocketHandler.</code><code class="descname">write_message</code><span class="sig-paren">(</span><em>message</em>, <em>binary=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketHandler.write_message"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketHandler.write_message" title="永久链接至目标">¶</a></dt>
<dd><p>将给出的 message 发送到客户端</p>
<p>message 可以是 string 或者 dict（将会被编码成 json ) 如果 <code class="docutils literal"><span class="pre">binary</span></code> 为
false, message 将会以 utf8 的编码发送; 在 binary 模式下 message 可以是
任何 byte string.</p>
<p>如果连接已经关闭, 则会触发 <a class="reference internal" href="#tornado.websocket.WebSocketClosedError" title="tornado.websocket.WebSocketClosedError"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketClosedError</span></code></a></p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.2 版更改: </span>添加了 <a class="reference internal" href="#tornado.websocket.WebSocketClosedError" title="tornado.websocket.WebSocketClosedError"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketClosedError</span></code></a> (在之前版本会触发 <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#AttributeError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">AttributeError</span></code></a>)</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>返回能够被用于 flow control 的 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.websocket.WebSocketHandler.close">
<code class="descclassname">WebSocketHandler.</code><code class="descname">close</code><span class="sig-paren">(</span><em>code=None</em>, <em>reason=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketHandler.close"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketHandler.close" title="永久链接至目标">¶</a></dt>
<dd><p>关闭当前 WebSocket</p>
<p>一旦挥手动作成功,socket将会被关闭.</p>
<p><code class="docutils literal"><span class="pre">code</span></code> 可能是一个数字构成的状态码, 采用 <a class="reference external" href="https://tools.ietf.org/html/rfc6455#section-7.4.1">RFC 6455 section 7.4.1</a>. 定义的值.</p>
<p><code class="docutils literal"><span class="pre">reason</span></code> 可能是描述连接关闭的文本消息. 这个值被提给客户端,但是不会被
WebSocket 协议单独解释.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>Added the <code class="docutils literal"><span class="pre">code</span></code> and <code class="docutils literal"><span class="pre">reason</span></code> arguments.</p>
</div>
</dd></dl>

</div>
<div class="section" id="configuration">
<h5>Configuration<a class="headerlink" href="#configuration" title="永久链接至标题">¶</a></h5>
<dl class="method">
<dt id="tornado.websocket.WebSocketHandler.check_origin">
<code class="descclassname">WebSocketHandler.</code><code class="descname">check_origin</code><span class="sig-paren">(</span><em>origin</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketHandler.check_origin"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketHandler.check_origin" title="永久链接至目标">¶</a></dt>
<dd><p>通过重写这个方法来实现域的切换</p>
<p>参数 <code class="docutils literal"><span class="pre">origin</span></code> 的值来自 HTTP header 中的 <code class="docutils literal"><span class="pre">Origin</span></code> ,url 负责初始化这个请求.
这个方法并不是要求客户端不发送这样的 heder;这样的请求一直被允许（因为所有的浏览器
实现的 websockets 都支持这个 header ,并且非浏览器客户端没有同样的跨域安全问题.</p>
<p>返回 True 代表接受,相应的返回 False 代表拒绝.默认拒绝除 host 外其他域的请求.</p>
<p>这个是一个浏览器防止 XSS 攻击的安全策略,因为 WebSocket 允许绕过通常的同源策略
以及不使用 CORS 头.</p>
<p>要允许所有跨域通信的话（这在 Tornado 4.0 之前是默认的）,只要简单的重写这个方法
让它一直返回 true 就可以了:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<p>要允许所有所有子域下的连接,可以这样实现:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">):</span>
    <span class="n">parsed_origin</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parsed_origin</span><span class="o">.</span><span class="n">netloc</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.mydomain.com&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.websocket.WebSocketHandler.get_compression_options">
<code class="descclassname">WebSocketHandler.</code><code class="descname">get_compression_options</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketHandler.get_compression_options"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketHandler.get_compression_options" title="永久链接至目标">¶</a></dt>
<dd><p>重写该方法返回当前连接的 compression 选项</p>
<p>如果这个方法返回 None (默认), compression 将会被禁用. 如果它返回 dict (即使
是空的),compression 都会被开启. dict 的内容将会被用来控制 compression 所
使用的内存和CPU.但是这类的设置现在还没有被实现.</p>
<div class="versionadded">
<p><span class="versionmodified">4.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.websocket.WebSocketHandler.set_nodelay">
<code class="descclassname">WebSocketHandler.</code><code class="descname">set_nodelay</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketHandler.set_nodelay"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketHandler.set_nodelay" title="永久链接至目标">¶</a></dt>
<dd><p>为当前 stream 设置 no-delay</p>
<p>在默认情况下, 小块数据会被延迟和/或合并以减少发送包的数量. 这在有些时候会因为
Nagle&#8217;s 算法和 TCP ACKs 相互作用会造成 200-500ms 的延迟.在 WebSocket 连接
已经建立的情况下,可以通过设置 <code class="docutils literal"><span class="pre">self.set_nodelay(True)</span></code> 来降低延迟（这可能
会占用更多带宽）</p>
<p>更多详细信息： <a class="reference internal" href="index.html#tornado.iostream.BaseIOStream.set_nodelay" title="tornado.iostream.BaseIOStream.set_nodelay"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream.set_nodelay</span></code></a>.</p>
<p>在 <a class="reference internal" href="index.html#tornado.iostream.BaseIOStream.set_nodelay" title="tornado.iostream.BaseIOStream.set_nodelay"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream.set_nodelay</span></code></a> 查看详细信息.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="other">
<h5>Other<a class="headerlink" href="#other" title="永久链接至标题">¶</a></h5>
<dl class="method">
<dt id="tornado.websocket.WebSocketHandler.ping">
<code class="descclassname">WebSocketHandler.</code><code class="descname">ping</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketHandler.ping"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketHandler.ping" title="永久链接至目标">¶</a></dt>
<dd><p>发送 ping 包到远端.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.websocket.WebSocketHandler.on_pong">
<code class="descclassname">WebSocketHandler.</code><code class="descname">on_pong</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketHandler.on_pong"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketHandler.on_pong" title="永久链接至目标">¶</a></dt>
<dd><p>当收到ping 包的响应时执行.</p>
</dd></dl>

<dl class="exception">
<dt id="tornado.websocket.WebSocketClosedError">
<em class="property">exception </em><code class="descclassname">tornado.websocket.</code><code class="descname">WebSocketClosedError</code><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketClosedError"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketClosedError" title="永久链接至目标">¶</a></dt>
<dd><p>出现关闭连接错误触发.</p>
<div class="versionadded">
<p><span class="versionmodified">3.2 新版功能.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="client-side-support">
<h5>Client-side support<a class="headerlink" href="#client-side-support" title="永久链接至标题">¶</a></h5>
<dl class="function">
<dt id="tornado.websocket.websocket_connect">
<code class="descclassname">tornado.websocket.</code><code class="descname">websocket_connect</code><span class="sig-paren">(</span><em>url</em>, <em>io_loop=None</em>, <em>callback=None</em>, <em>connect_timeout=None</em>, <em>on_message_callback=None</em>, <em>compression_options=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#websocket_connect"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.websocket_connect" title="永久链接至目标">¶</a></dt>
<dd><p>客户端 WebSocket 支持
需要指定 url, 返回一个结果为 <a class="reference internal" href="#tornado.websocket.WebSocketClientConnection" title="tornado.websocket.WebSocketClientConnection"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketClientConnection</span></code></a> 的 Future 对象</p>
<p><code class="docutils literal"><span class="pre">compression_options</span></code> 作为 <a class="reference internal" href="#tornado.websocket.WebSocketHandler.get_compression_options" title="tornado.websocket.WebSocketHandler.get_compression_options"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler.get_compression_options</span></code></a> 的
返回值, 将会以同样的方式执行.</p>
<p>这个连接支持两种类型的操作.在协程风格下,应用程序通常在一个循环里调用
<a class="reference internal" href="#tornado.websocket.WebSocketClientConnection.read_message" title="tornado.websocket.WebSocketClientConnection.read_message"><code class="xref py py-obj docutils literal"><span class="pre">read_message</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">websocket_connect</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">conn</span><span class="o">.</span><span class="n">read_message</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">break</span>
    <span class="c1"># Do something with msg</span>
</pre></div>
</div>
<p>在回调风格下,需要传递 <code class="docutils literal"><span class="pre">on_message_callback</span></code> 到 <code class="docutils literal"><span class="pre">websocket_connect</span></code> 里.
在这两种风格里,一个内容是 <code class="docutils literal"><span class="pre">None</span></code> 的 message 都标志着 WebSocket 连接已经.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.2 版更改: </span>允许使用 <code class="docutils literal"><span class="pre">HTTPRequest</span></code> 对象来代替 urls.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>添加 <code class="docutils literal"><span class="pre">compression_options</span></code> 和 <code class="docutils literal"><span class="pre">on_message_callback</span></code> .</p>
<p>不赞成使用 <code class="docutils literal"><span class="pre">compression_options</span></code> .</p>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.websocket.WebSocketClientConnection">
<em class="property">class </em><code class="descclassname">tornado.websocket.</code><code class="descname">WebSocketClientConnection</code><span class="sig-paren">(</span><em>io_loop</em>, <em>request</em>, <em>on_message_callback=None</em>, <em>compression_options=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketClientConnection"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketClientConnection" title="永久链接至目标">¶</a></dt>
<dd><p>WebSocket 客户端连接</p>
<p>这个类不应当直接被实例化, 请使用 <a class="reference internal" href="#tornado.websocket.websocket_connect" title="tornado.websocket.websocket_connect"><code class="xref py py-obj docutils literal"><span class="pre">websocket_connect</span></code></a></p>
<dl class="method">
<dt id="tornado.websocket.WebSocketClientConnection.close">
<code class="descname">close</code><span class="sig-paren">(</span><em>code=None</em>, <em>reason=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketClientConnection.close"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketClientConnection.close" title="永久链接至目标">¶</a></dt>
<dd><p>关闭 websocket 连接</p>
<p><code class="docutils literal"><span class="pre">code</span></code> 和 <code class="docutils literal"><span class="pre">reason</span></code> 的文档在 <a class="reference internal" href="#tornado.websocket.WebSocketHandler.close" title="tornado.websocket.WebSocketHandler.close"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler.close</span></code></a> 下已给出.</p>
<div class="versionadded">
<p><span class="versionmodified">3.2 新版功能.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>添加 <code class="docutils literal"><span class="pre">code</span></code> 和 <code class="docutils literal"><span class="pre">reason</span></code> 这两个参数</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.websocket.WebSocketClientConnection.write_message">
<code class="descname">write_message</code><span class="sig-paren">(</span><em>message</em>, <em>binary=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketClientConnection.write_message"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketClientConnection.write_message" title="永久链接至目标">¶</a></dt>
<dd><p>发送消息到 websocket 服务器.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.websocket.WebSocketClientConnection.read_message">
<code class="descname">read_message</code><span class="sig-paren">(</span><em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/websocket.html#WebSocketClientConnection.read_message"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.websocket.WebSocketClientConnection.read_message" title="永久链接至目标">¶</a></dt>
<dd><p>读取来自 WebSocket 服务器的消息.</p>
<p>如果在 WebSocket 初始化时指定了 on_message_callback ,那么这个方法永远不会返回消息</p>
<p>如果连接已经关闭,返回结果会是一个结果是 message 的 future 对象或者是 None.
如果 future 给出了回调参数, 这个参数将会在 future 完成时调用.</p>
</dd></dl>

</dd></dl>

</div>
</div>
</div>
</div>
<span id="document-http"></span><div class="section" id="http-servers-and-clients">
<h3>HTTP servers and clients<a class="headerlink" href="#http-servers-and-clients" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-httpserver"></span><div class="section" id="module-tornado.httpserver">
<span id="tornado-httpserver-http-server"></span><h4><code class="docutils literal"><span class="pre">tornado.httpserver</span></code> &#8212; 非阻塞 HTTP server<a class="headerlink" href="#module-tornado.httpserver" title="永久链接至标题">¶</a></h4>
<p>非阻塞，单线程 HTTP server。</p>
<p>典型的应用很少与 <a class="reference internal" href="#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> 类直接交互，除非在进程开始时开启server
（尽管这经常间接的通过 <a class="reference internal" href="index.html#tornado.web.Application.listen" title="tornado.web.Application.listen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Application.listen</span></code></a> 来完成）。</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>曾经在此模块中的 <code class="docutils literal"><span class="pre">HTTPRequest</span></code> 类
已经被移到 <a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest" title="tornado.httputil.HTTPServerRequest"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httputil.HTTPServerRequest</span></code></a> 。
其旧名称仍作为一个别名。</p>
</div>
<div class="section" id="http-server">
<h5>HTTP Server<a class="headerlink" href="#http-server" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.httpserver.HTTPServer">
<em class="property">class </em><code class="descclassname">tornado.httpserver.</code><code class="descname">HTTPServer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httpserver.html#HTTPServer"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httpserver.HTTPServer" title="永久链接至目标">¶</a></dt>
<dd><p>非阻塞，单线程 HTTP server。</p>
<p>一个server可以由一个 <a class="reference internal" href="index.html#tornado.httputil.HTTPServerConnectionDelegate" title="tornado.httputil.HTTPServerConnectionDelegate"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerConnectionDelegate</span></code></a> 的子类定义，
或者，为了向后兼容，由一个以 <a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest" title="tornado.httputil.HTTPServerRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerRequest</span></code></a> 为参数的callback定义。
它的委托对象(delegate)通常是 <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Application</span></code></a> 。</p>
<p><a class="reference internal" href="#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> 默认支持keep-alive链接（对于HTTP/1.1自动开启，而对于HTTP/1.0，
需要client发起 <code class="docutils literal"><span class="pre">Connection:</span> <span class="pre">keep-alive</span></code> 请求）。</p>
<p>如果 <code class="docutils literal"><span class="pre">xheaders</span></code> 是 <code class="docutils literal"><span class="pre">True</span></code> ，我们支持
<code class="docutils literal"><span class="pre">X-Real-Ip</span></code>/<code class="docutils literal"><span class="pre">X-Forwarded-For</span></code> 和
<code class="docutils literal"><span class="pre">X-Scheme</span></code>/<code class="docutils literal"><span class="pre">X-Forwarded-Proto</span></code> 首部字段，他们将会覆盖
所有请求的 remote IP 与 URI scheme/protocol 。
当Tornado运行在反向代理或者负载均衡(load balancer)之后时，
这些首部字段非常有用。如果Tornado运行在一个不设置任何一个支持的
<code class="docutils literal"><span class="pre">xheaders</span></code> 的SSL-decoding代理之后， <code class="docutils literal"><span class="pre">protocol</span></code> 参数也能设置为 <code class="docutils literal"><span class="pre">https</span></code> 。</p>
<p>要使server可以服务于SSL加密的流量，需要把 <code class="docutils literal"><span class="pre">ssl_option</span></code> 参数
设置为一个 <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.SSLContext</span></code></a> 对象。为了兼容旧版本的Python <code class="docutils literal"><span class="pre">ssl_options</span></code>
可能也是一个字典(dictionary)，其中包含传给 <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.wrap_socket" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.wrap_socket</span></code></a> 方法的关键
字参数。:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ssl_ctx</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">Purpose</span><span class="o">.</span><span class="n">CLIENT_AUTH</span><span class="p">)</span>
<span class="n">ssl_ctx</span><span class="o">.</span><span class="n">load_cert_chain</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;mydomain.crt&quot;</span><span class="p">),</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;mydomain.key&quot;</span><span class="p">))</span>
<span class="n">HTTPServer</span><span class="p">(</span><span class="n">applicaton</span><span class="p">,</span> <span class="n">ssl_options</span><span class="o">=</span><span class="n">ssl_ctx</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> 的初始化依照以下三种模式之一（初始化方法定义
在 <a class="reference internal" href="index.html#tornado.tcpserver.TCPServer" title="tornado.tcpserver.TCPServer"><code class="xref py py-obj docutils literal"><span class="pre">tornado.tcpserver.TCPServer</span></code></a> ）：</p>
<ol class="arabic">
<li><p class="first"><a class="reference internal" href="index.html#tornado.tcpserver.TCPServer.listen" title="tornado.tcpserver.TCPServer.listen"><code class="xref py py-obj docutils literal"><span class="pre">listen</span></code></a>: 简单的单进程:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
<span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>在很多情形下， <a class="reference internal" href="index.html#tornado.web.Application.listen" title="tornado.web.Application.listen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Application.listen</span></code></a> 可以用来避免显式的
创建 <a class="reference internal" href="#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> 。</p>
</li>
<li><p class="first"><a class="reference internal" href="index.html#tornado.tcpserver.TCPServer.bind" title="tornado.tcpserver.TCPServer.bind"><code class="xref py py-obj docutils literal"><span class="pre">bind</span></code></a>/<a class="reference internal" href="index.html#tornado.tcpserver.TCPServer.start" title="tornado.tcpserver.TCPServer.start"><code class="xref py py-obj docutils literal"><span class="pre">start</span></code></a>:
简单的多进程:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Fork 多个子进程</span>
<span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>当使用这个接口时，一个 <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> 不能被传给 <a class="reference internal" href="#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a>
的构造方法(constructor)。 <a class="reference internal" href="index.html#tornado.tcpserver.TCPServer.start" title="tornado.tcpserver.TCPServer.start"><code class="xref py py-obj docutils literal"><span class="pre">start</span></code></a> 将默认
在单例 <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> 上开启server。</p>
</li>
<li><p class="first"><a class="reference internal" href="index.html#tornado.tcpserver.TCPServer.add_sockets" title="tornado.tcpserver.TCPServer.add_sockets"><code class="xref py py-obj docutils literal"><span class="pre">add_sockets</span></code></a>: 高级多进程:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sockets</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">netutil</span><span class="o">.</span><span class="n">bind_sockets</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
<span class="n">tornado</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">fork_processes</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">add_sockets</span><span class="p">(</span><span class="n">sockets</span><span class="p">)</span>
<span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p><a class="reference internal" href="index.html#tornado.tcpserver.TCPServer.add_sockets" title="tornado.tcpserver.TCPServer.add_sockets"><code class="xref py py-obj docutils literal"><span class="pre">add_sockets</span></code></a> 接口更加复杂，
但是，当fork发生的时候，它可以与 <a class="reference internal" href="index.html#tornado.process.fork_processes" title="tornado.process.fork_processes"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process.fork_processes</span></code></a>
一起使用来提供更好的灵活性。
如果你想使用其他的方法，而不是 <a class="reference internal" href="index.html#tornado.netutil.bind_sockets" title="tornado.netutil.bind_sockets"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil.bind_sockets</span></code></a> ，
来创建监听socket， <a class="reference internal" href="index.html#tornado.tcpserver.TCPServer.add_sockets" title="tornado.tcpserver.TCPServer.add_sockets"><code class="xref py py-obj docutils literal"><span class="pre">add_sockets</span></code></a> 也可以被用在单进程server中。</p>
</li>
</ol>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>增加了 <code class="docutils literal"><span class="pre">decompress_request</span></code>, <code class="docutils literal"><span class="pre">chunk_size</span></code>, <code class="docutils literal"><span class="pre">max_header_size</span></code>,
<code class="docutils literal"><span class="pre">idle_connection_timeout</span></code>, <code class="docutils literal"><span class="pre">body_timeout</span></code>, <code class="docutils literal"><span class="pre">max_body_size</span></code>
参数。支持 <a class="reference internal" href="index.html#tornado.httputil.HTTPServerConnectionDelegate" title="tornado.httputil.HTTPServerConnectionDelegate"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerConnectionDelegate</span></code></a> 实例化为 <code class="docutils literal"><span class="pre">request_callback</span></code> 。</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span><a class="reference internal" href="index.html#tornado.httputil.HTTPServerConnectionDelegate.start_request" title="tornado.httputil.HTTPServerConnectionDelegate.start_request"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerConnectionDelegate.start_request</span></code></a> 现在需要传入两个参数来调用
<code class="docutils literal"><span class="pre">(server_conn,</span> <span class="pre">request_conn)</span></code> （根据文档内容）而不是一个 <code class="docutils literal"><span class="pre">(request_conn)</span></code>.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.2 版更改: </span><a class="reference internal" href="#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> 现在是 <a class="reference internal" href="index.html#tornado.util.Configurable" title="tornado.util.Configurable"><code class="xref py py-obj docutils literal"><span class="pre">tornado.util.Configurable</span></code></a> 的一个子类。</p>
</div>
</dd></dl>

</div>
</div>
<span id="document-httpclient"></span><div class="section" id="module-tornado.httpclient">
<span id="tornado-httpclient-http"></span><h4><code class="docutils literal"><span class="pre">tornado.httpclient</span></code> &#8212; 异步 HTTP 客户端<a class="headerlink" href="#module-tornado.httpclient" title="永久链接至标题">¶</a></h4>
<p>阻塞和非阻塞的 HTTP 客户端接口.</p>
<p>这个模块定义了一个被两种实现方式 <code class="docutils literal"><span class="pre">simple_httpclient</span></code> 和
<code class="docutils literal"><span class="pre">curl_httpclient</span></code> 共享的通用接口 . 应用程序可以选择直接实例化相对应的实现类,
或使用本模块提供的 <a class="reference internal" href="#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> 类, 通过复写
<a class="reference internal" href="#tornado.httpclient.AsyncHTTPClient.configure" title="tornado.httpclient.AsyncHTTPClient.configure"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient.configure</span></code></a> 方法来选择一种实现 .</p>
<p>默认的实现是 <code class="docutils literal"><span class="pre">simple_httpclient</span></code>, 这可以能满足大多数用户的需要 . 然而, 一
些应用程序可能会因为以下原因想切换到 <code class="docutils literal"><span class="pre">curl_httpclient</span></code> :</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">curl_httpclient</span></code> 有一些 <code class="docutils literal"><span class="pre">simple_httpclient</span></code> 不具有的功能特性,
包括对 HTTP 代理和使用指定网络接口能力的支持.</li>
<li><code class="docutils literal"><span class="pre">curl_httpclient</span></code> 更有可能与不完全符合 HTTP 规范的网站兼容, 或者与
使用很少使用 HTTP 特性的网站兼容.</li>
<li><code class="docutils literal"><span class="pre">curl_httpclient</span></code> 更快.</li>
<li><code class="docutils literal"><span class="pre">curl_httpclient</span></code> 是 Tornado 2.0 之前的默认值.</li>
</ul>
<p>注意, 如果你正在使用 <code class="docutils literal"><span class="pre">curl_httpclient</span></code>, 强力建议你使用最新版本的
<code class="docutils literal"><span class="pre">libcurl</span></code> 和 <code class="docutils literal"><span class="pre">pycurl</span></code>.  当前 libcurl 能被支持的最小版本是
7.21.1, pycurl 能被支持的最小版本是 7.18.2. 强烈建议你所安装的 <code class="docutils literal"><span class="pre">libcurl</span></code>
是和异步 DNS 解析器 (threaded 或 c-ares) 一起构建的,
否则你可能会遇到各种请求超时的问题 (更多信息请查看
<a class="reference external" href="http://curl.haxx.se/libcurl/c/curl_easy_setopt.html#CURLOPTCONNECTTIMEOUTMS">http://curl.haxx.se/libcurl/c/curl_easy_setopt.html#CURLOPTCONNECTTIMEOUTMS</a>
和 curl_httpclient.py 里面的注释).</p>
<p>为了选择 <code class="docutils literal"><span class="pre">curl_httpclient</span></code>, 只需要在启动的时候调用
<a class="reference internal" href="#tornado.httpclient.AsyncHTTPClient.configure" title="tornado.httpclient.AsyncHTTPClient.configure"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient.configure</span></code></a></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">AsyncHTTPClient</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;tornado.curl_httpclient.CurlAsyncHTTPClient&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="http">
<h5>HTTP 客户端接口<a class="headerlink" href="#http" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.httpclient.HTTPClient">
<em class="property">class </em><code class="descclassname">tornado.httpclient.</code><code class="descname">HTTPClient</code><span class="sig-paren">(</span><em>async_client_class=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httpclient.html#HTTPClient"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httpclient.HTTPClient" title="永久链接至目标">¶</a></dt>
<dd><p>一个阻塞的 HTTP 客户端.</p>
<p>提供这个接口是为了方便使用和测试; 大多数运行于 IOLoop 的应用程序
会使用 <a class="reference internal" href="#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> 来替代它.
一般的用法就像这样</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http_client</span> <span class="o">=</span> <span class="n">httpclient</span><span class="o">.</span><span class="n">HTTPClient</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;http://www.google.com/&quot;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
<span class="k">except</span> <span class="n">httpclient</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># HTTPError is raised for non-200 responses; the response</span>
    <span class="c1"># can be found in e.response.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># Other errors are possible, such as IOError.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<span class="n">http_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="tornado.httpclient.HTTPClient.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httpclient.html#HTTPClient.close"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httpclient.HTTPClient.close" title="永久链接至目标">¶</a></dt>
<dd><p>关闭该 HTTPClient, 释放所有使用的资源.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.httpclient.HTTPClient.fetch">
<code class="descname">fetch</code><span class="sig-paren">(</span><em>request</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httpclient.html#HTTPClient.fetch"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httpclient.HTTPClient.fetch" title="永久链接至目标">¶</a></dt>
<dd><p>执行一个请求, 返回一个 <a class="reference internal" href="#tornado.httpclient.HTTPResponse" title="tornado.httpclient.HTTPResponse"><code class="xref py py-obj docutils literal"><span class="pre">HTTPResponse</span></code></a> 对象.</p>
<p>该请求可以是一个 URL 字符串或是一个 <a class="reference internal" href="#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPRequest</span></code></a> 对象.
如果它是一个字符串, 我们会使用任意关键字参数构造一个
<a class="reference internal" href="#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPRequest</span></code></a> : <code class="docutils literal"><span class="pre">HTTPRequest(request,</span> <span class="pre">**kwargs)</span></code></p>
<p>如果在 fetch 过程中发生错误, 我们将抛出一个 <a class="reference internal" href="#tornado.httpclient.HTTPError" title="tornado.httpclient.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">HTTPError</span></code></a> 除非
<code class="docutils literal"><span class="pre">raise_error</span></code> 关键字参数被设置为 False.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.httpclient.AsyncHTTPClient">
<em class="property">class </em><code class="descclassname">tornado.httpclient.</code><code class="descname">AsyncHTTPClient</code><a class="reference internal" href="_modules/tornado/httpclient.html#AsyncHTTPClient"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httpclient.AsyncHTTPClient" title="永久链接至目标">¶</a></dt>
<dd><p>一个非阻塞 HTTP 客户端.</p>
<p>使用示例:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s2">&quot;Error:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">error</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>

<span class="n">http_client</span> <span class="o">=</span> <span class="n">AsyncHTTPClient</span><span class="p">()</span>
<span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;http://www.google.com/&quot;</span><span class="p">,</span> <span class="n">handle_request</span><span class="p">)</span>
</pre></div>
</div>
<p>这个类的构造器有几个比较神奇的考虑: 它实际创建了一个基于特定实现的子
类的实例, 并且该实例被作为一种伪单例重用 (每一个 <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> ).
使用关键字参数 <code class="docutils literal"><span class="pre">force_instance=True</span></code> 可以用来限制这种单例行为.
只有使用了 <code class="docutils literal"><span class="pre">force_instance=True</span></code> 时候, 才可以传递 <code class="docutils literal"><span class="pre">io_loop</span></code> 以外其他
的参数给 <a class="reference internal" href="#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> 构造器.
实现的子类以及它的构造器的参数可以通过静态方法 <a class="reference internal" href="#tornado.httpclient.AsyncHTTPClient.configure" title="tornado.httpclient.AsyncHTTPClient.configure"><code class="xref py py-obj docutils literal"><span class="pre">configure()</span></code></a> 设置.</p>
<p>所有 <a class="reference internal" href="#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> 实现都支持一个 <code class="docutils literal"><span class="pre">defaults</span></code> 关键字参数,
可以被用来设置默认 <a class="reference internal" href="#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPRequest</span></code></a> 属性的值. 例如:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">AsyncHTTPClient</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">user_agent</span><span class="o">=</span><span class="s2">&quot;MyUserAgent&quot;</span><span class="p">))</span>
<span class="c1"># or with force_instance:</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">AsyncHTTPClient</span><span class="p">(</span><span class="n">force_instance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">user_agent</span><span class="o">=</span><span class="s2">&quot;MyUserAgent&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span><code class="docutils literal"><span class="pre">io_loop</span></code> 参数被废弃.</p>
</div>
<dl class="method">
<dt id="tornado.httpclient.AsyncHTTPClient.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httpclient.html#AsyncHTTPClient.close"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httpclient.AsyncHTTPClient.close" title="永久链接至目标">¶</a></dt>
<dd><p>销毁该 HTTP 客户端, 释放所有被使用的文件描述符.</p>
<p>因为 <a class="reference internal" href="#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> 对象透明重用的方式, 该方法
<strong>在正常使用时并不需要</strong> .
<code class="docutils literal"><span class="pre">close()</span></code> 一般只有在 <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> 也被关闭, 或在创建
<a class="reference internal" href="#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> 的时候使用了 <code class="docutils literal"><span class="pre">force_instance=True</span></code> 参数才需要.</p>
<p>在 <a class="reference internal" href="#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> 调用 <code class="docutils literal"><span class="pre">close()</span></code> 方法后, 其他方法就不能被调用
了.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.httpclient.AsyncHTTPClient.fetch">
<code class="descname">fetch</code><span class="sig-paren">(</span><em>request</em>, <em>callback=None</em>, <em>raise_error=True</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httpclient.html#AsyncHTTPClient.fetch"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httpclient.AsyncHTTPClient.fetch" title="永久链接至目标">¶</a></dt>
<dd><p>执行一个请求, 并且异步的返回 <a class="reference internal" href="#tornado.httpclient.HTTPResponse" title="tornado.httpclient.HTTPResponse"><code class="xref py py-obj docutils literal"><span class="pre">HTTPResponse</span></code></a>.</p>
<p>request 参数可以是一个 URL 字符串也可以是一个 <a class="reference internal" href="#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPRequest</span></code></a> 对象.
如果是一个字符串, 我们将使用全部的关键字参数一起构造一个
<a class="reference internal" href="#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPRequest</span></code></a> 对象: <code class="docutils literal"><span class="pre">HTTPRequest(request,</span> <span class="pre">**kwargs)</span></code></p>
<p>这个方法返回一个结果为 <a class="reference internal" href="#tornado.httpclient.HTTPResponse" title="tornado.httpclient.HTTPResponse"><code class="xref py py-obj docutils literal"><span class="pre">HTTPResponse</span></code></a> 的 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 对象.
默认情况下, 如果该请求返回一个非 200 的响应码, 这个 <code class="docutils literal"><span class="pre">Future</span></code>
将会抛出一个 <a class="reference internal" href="#tornado.httpclient.HTTPError" title="tornado.httpclient.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">HTTPError</span></code></a> 错误. 相反, 如果 <code class="docutils literal"><span class="pre">raise_error</span></code> 设置为
False, 则无论响应码如何, 都将返回该 response (响应).</p>
<p>如果给定了 <code class="docutils literal"><span class="pre">callback</span></code> , 它将被 <a class="reference internal" href="#tornado.httpclient.HTTPResponse" title="tornado.httpclient.HTTPResponse"><code class="xref py py-obj docutils literal"><span class="pre">HTTPResponse</span></code></a> 调用.
在回调接口中, <a class="reference internal" href="#tornado.httpclient.HTTPError" title="tornado.httpclient.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">HTTPError</span></code></a> 不会自动抛出. 相反你必须检查该响应的
<code class="docutils literal"><span class="pre">error</span></code> 属性或者调用它的 <a class="reference internal" href="#tornado.httpclient.HTTPResponse.rethrow" title="tornado.httpclient.HTTPResponse.rethrow"><code class="xref py py-obj docutils literal"><span class="pre">rethrow</span></code></a> 方法.</p>
</dd></dl>

<dl class="classmethod">
<dt id="tornado.httpclient.AsyncHTTPClient.configure">
<em class="property">classmethod </em><code class="descname">configure</code><span class="sig-paren">(</span><em>impl</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httpclient.html#AsyncHTTPClient.configure"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httpclient.AsyncHTTPClient.configure" title="永久链接至目标">¶</a></dt>
<dd><p>配置要使用的 <a class="reference internal" href="#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> 子类.</p>
<p><code class="docutils literal"><span class="pre">AsyncHTTPClient()</span></code> 实际上是创建一个子类的实例.
此方法可以使用一个类对象或此类的完全限定名称(或为 <code class="docutils literal"><span class="pre">None</span></code> 则使用默认的,
<code class="docutils literal"><span class="pre">SimpleAsyncHTTPClient</span></code>) 调用.</p>
<p>如果给定了额外的关键字参数, 它们将会被传递给创建的每个子类实例的
构造函数. 关键字参数 <code class="docutils literal"><span class="pre">max_clients</span></code> 确定了可以在每个 <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> 上
并行执行的 <a class="reference internal" href="#tornado.httpclient.AsyncHTTPClient.fetch" title="tornado.httpclient.AsyncHTTPClient.fetch"><code class="xref py py-obj docutils literal"><span class="pre">fetch()</span></code></a> 操作的最大数量. 根据使用的
实现类不同, 可能支持其他参数.</p>
<p>例如:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">AsyncHTTPClient</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;tornado.curl_httpclient.CurlAsyncHTTPClient&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="request">
<h5>Request 对象<a class="headerlink" href="#request" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.httpclient.HTTPRequest">
<em class="property">class </em><code class="descclassname">tornado.httpclient.</code><code class="descname">HTTPRequest</code><span class="sig-paren">(</span><em>url</em>, <em>method='GET'</em>, <em>headers=None</em>, <em>body=None</em>, <em>auth_username=None</em>, <em>auth_password=None</em>, <em>auth_mode=None</em>, <em>connect_timeout=None</em>, <em>request_timeout=None</em>, <em>if_modified_since=None</em>, <em>follow_redirects=None</em>, <em>max_redirects=None</em>, <em>user_agent=None</em>, <em>use_gzip=None</em>, <em>network_interface=None</em>, <em>streaming_callback=None</em>, <em>header_callback=None</em>, <em>prepare_curl_callback=None</em>, <em>proxy_host=None</em>, <em>proxy_port=None</em>, <em>proxy_username=None</em>, <em>proxy_password=None</em>, <em>allow_nonstandard_methods=None</em>, <em>validate_cert=None</em>, <em>ca_certs=None</em>, <em>allow_ipv6=None</em>, <em>client_key=None</em>, <em>client_cert=None</em>, <em>body_producer=None</em>, <em>expect_100_continue=False</em>, <em>decompress_response=None</em>, <em>ssl_options=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httpclient.html#HTTPRequest"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httpclient.HTTPRequest" title="永久链接至目标">¶</a></dt>
<dd><p>HTTP 客户端请求对象.</p>
<p>除了 <code class="docutils literal"><span class="pre">url</span></code> 以外所有参数都是可选的.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>url</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; fetch 的 URL</li>
<li><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; HTTP 方法, e.g. &#8220;GET&#8221; or &#8220;POST&#8221;</li>
<li><strong>headers</strong> (<a class="reference internal" href="index.html#tornado.httputil.HTTPHeaders" title="tornado.httputil.HTTPHeaders"><code class="xref py py-obj docutils literal"><span class="pre">HTTPHeaders</span></code></a> 或 <a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#dict" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">dict</span></code></a>) &#8211; 额外的 HTTP 请求头</li>
<li><strong>body</strong> &#8211; HTTP 请求体字符串 (byte 或 unicode; 如果是 unicode
则使用 utf-8 编码)</li>
<li><strong>body_producer</strong> &#8211; 可以被用于延迟/异步请求体调用.
它可以被调用, 带有一个参数, 一个 <code class="docutils literal"><span class="pre">write</span></code> 函数, 并应该
返回一个 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 对象.  它应该在新的数据可用时调用 write 函数.
write 函数返回一个可用于流程控制的 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 对象.
只能指定 <code class="docutils literal"><span class="pre">body</span></code> 和 <code class="docutils literal"><span class="pre">body_producer</span></code> 其中之一.
<code class="docutils literal"><span class="pre">body_producer</span></code> 不被 <code class="docutils literal"><span class="pre">curl_httpclient</span></code> 支持.
当使用 <code class="docutils literal"><span class="pre">body_producer</span></code> 时, 建议传递一个
<code class="docutils literal"><span class="pre">Content-Length</span></code> 头, 否则将使用其他的分块编码,
并且很多服务断不支持请求的分块编码.  Tornado 4.0 新增</li>
<li><strong>auth_username</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; HTTP 认证的用户名</li>
<li><strong>auth_password</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; HTTP 认证的密码</li>
<li><strong>auth_mode</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; 认证模式; 默认是 &#8220;basic&#8221;.
所允许的值是根据实现方式定义的; <code class="docutils literal"><span class="pre">curl_httpclient</span></code>
支持 &#8220;basic&#8221; 和 &#8220;digest&#8221;; <code class="docutils literal"><span class="pre">simple_httpclient</span></code> 只支持 &#8220;basic&#8221;</li>
<li><strong>connect_timeout</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#float" title="(在 Python v3.4)"><em>float</em></a>) &#8211; 初始化连接的超时时间</li>
<li><strong>request_timeout</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#float" title="(在 Python v3.4)"><em>float</em></a>) &#8211; 整个请求的超时时间</li>
<li><strong>if_modified_since</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/datetime.html#module-datetime" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">datetime</span></code></a> 或 <a class="reference external" href="https://docs.python.org/3.4/library/functions.html#float" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">float</span></code></a>) &#8211; <code class="docutils literal"><span class="pre">If-Modified-Since</span></code> 头的时间戳</li>
<li><strong>follow_redirects</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#bool" title="(在 Python v3.4)"><em>bool</em></a>) &#8211; 是否应该自动跟随重定向还是返回 3xx 响应?</li>
<li><strong>max_redirects</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#int" title="(在 Python v3.4)"><em>int</em></a>) &#8211; <code class="docutils literal"><span class="pre">follow_redirects</span></code> 的最大次数限制</li>
<li><strong>user_agent</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; <code class="docutils literal"><span class="pre">User-Agent</span></code> 头</li>
<li><strong>decompress_response</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#bool" title="(在 Python v3.4)"><em>bool</em></a>) &#8211; 从服务器请求一个压缩过的响应, 在下载
后对其解压缩.  默认是 True.
Tornado 4.0 新增.</li>
<li><strong>use_gzip</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#bool" title="(在 Python v3.4)"><em>bool</em></a>) &#8211; <code class="docutils literal"><span class="pre">decompress_response</span></code> 的别名从 Tornado 4.0 已弃用.</li>
<li><strong>network_interface</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; 请求所使用的网络接口.
只有 <code class="docutils literal"><span class="pre">curl_httpclient</span></code> ; 请看下面的备注.</li>
<li><strong>streaming_callback</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#callable" title="(在 Python v3.4)"><em>callable</em></a>) &#8211; 如果设置了, <code class="docutils literal"><span class="pre">streaming_callback</span></code> 将
用它接收到的数据块执行, 并且
<code class="docutils literal"><span class="pre">HTTPResponse.body</span></code> 和 <code class="docutils literal"><span class="pre">HTTPResponse.buffer</span></code> 在最后的响应中将为空.</li>
<li><strong>header_callback</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#callable" title="(在 Python v3.4)"><em>callable</em></a>) &#8211; 如果设置了, <code class="docutils literal"><span class="pre">header_callback</span></code> 将
在接收到每行头信息时运行(包括第一行, e.g. <code class="docutils literal"><span class="pre">HTTP/1.0</span> <span class="pre">200</span> <span class="pre">OK\r\n</span></code>,
最后一行只包含 <code class="docutils literal"><span class="pre">\r\n</span></code>.  所有行都包含结尾的换行符).
<code class="docutils literal"><span class="pre">HTTPResponse.headers</span></code> 在最终响应中将为空.  这与
<code class="docutils literal"><span class="pre">streaming_callback</span></code> 结合是最有用的, 因为它是在请求正在进行时
访问头信息唯一的方法.</li>
<li><strong>prepare_curl_callback</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#callable" title="(在 Python v3.4)"><em>callable</em></a>) &#8211; 如果设置, 将使用
<code class="docutils literal"><span class="pre">pycurl.Curl</span></code> 对象调用, 以允许应用程序进行额外的
<code class="docutils literal"><span class="pre">setopt</span></code> 调用.</li>
<li><strong>proxy_host</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; HTTP 代理主机名.  如果想要使用代理,
<code class="docutils literal"><span class="pre">proxy_host</span></code> 和 <code class="docutils literal"><span class="pre">proxy_port</span></code> 必须设置; <code class="docutils literal"><span class="pre">proxy_username</span></code> 和
<code class="docutils literal"><span class="pre">proxy_pass</span></code> 是可选项.  目前只有 <code class="docutils literal"><span class="pre">curl_httpclient</span></code> 支持代理.</li>
<li><strong>proxy_port</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#int" title="(在 Python v3.4)"><em>int</em></a>) &#8211; HTTP 代理端口</li>
<li><strong>proxy_username</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; HTTP 代理用户名</li>
<li><strong>proxy_password</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; HTTP 代理密码</li>
<li><strong>allow_nonstandard_methods</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#bool" title="(在 Python v3.4)"><em>bool</em></a>) &#8211; 允许 <code class="docutils literal"><span class="pre">method</span></code> 参数使用未知值?</li>
<li><strong>validate_cert</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#bool" title="(在 Python v3.4)"><em>bool</em></a>) &#8211; 对于 HTTPS 请求, 是否验证服务器的证书?</li>
<li><strong>ca_certs</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; PEM 格式的 CA 证书的文件名, 或者默认为 None.
当与 <code class="docutils literal"><span class="pre">curl_httpclient</span></code> 一起使用时参阅下面的注释.</li>
<li><strong>client_key</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; 客户端 SSL key 文件名(如果有).
当与 <code class="docutils literal"><span class="pre">curl_httpclient</span></code> 一起使用时参阅下面的注释.</li>
<li><strong>client_cert</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; 客户端 SSL 证书的文件名(如果有).
当与 <code class="docutils literal"><span class="pre">curl_httpclient</span></code> 一起使用时参阅下面的注释.</li>
<li><strong>ssl_options</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><em>ssl.SSLContext</em></a>) &#8211; 用在
<code class="docutils literal"><span class="pre">simple_httpclient</span></code> (<code class="docutils literal"><span class="pre">curl_httpclient</span></code> 不支持) 的
<a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.SSLContext</span></code></a> 对象.
覆写 <code class="docutils literal"><span class="pre">validate_cert</span></code>, <code class="docutils literal"><span class="pre">ca_certs</span></code>, <code class="docutils literal"><span class="pre">client_key</span></code>,
和 <code class="docutils literal"><span class="pre">client_cert</span></code>.</li>
<li><strong>allow_ipv6</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#bool" title="(在 Python v3.4)"><em>bool</em></a>) &#8211; 当 IPv6 可用时是否使用?  默认是 true.</li>
<li><strong>expect_100_continue</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#bool" title="(在 Python v3.4)"><em>bool</em></a>) &#8211; 如果为 true, 发送
<code class="docutils literal"><span class="pre">Expect:</span> <span class="pre">100-continue</span></code> 头并在发送请求体前等待继续响应.
只被 simple_httpclient 支持.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能: </span><code class="docutils literal"><span class="pre">auth_mode</span></code> 参数.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能: </span><code class="docutils literal"><span class="pre">body_producer</span></code> 和 <code class="docutils literal"><span class="pre">expect_100_continue</span></code> 参数.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">4.2 新版功能: </span><code class="docutils literal"><span class="pre">ssl_options</span></code> 参数.</p>
</div>
</dd></dl>

</div>
<div class="section" id="response">
<h5>Response 对象<a class="headerlink" href="#response" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.httpclient.HTTPResponse">
<em class="property">class </em><code class="descclassname">tornado.httpclient.</code><code class="descname">HTTPResponse</code><span class="sig-paren">(</span><em>request</em>, <em>code</em>, <em>headers=None</em>, <em>buffer=None</em>, <em>effective_url=None</em>, <em>error=None</em>, <em>request_time=None</em>, <em>time_info=None</em>, <em>reason=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httpclient.html#HTTPResponse"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httpclient.HTTPResponse" title="永久链接至目标">¶</a></dt>
<dd><p>HTTP 响应对象.</p>
<p>属性:</p>
<ul class="simple">
<li>request: HTTPRequest 对象</li>
<li>code: HTTP 状态码数值, e.g. 200 或 404</li>
<li>reason: 人类可读的, 对状态码原因的简短描述</li>
<li>headers: <a class="reference internal" href="index.html#tornado.httputil.HTTPHeaders" title="tornado.httputil.HTTPHeaders"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httputil.HTTPHeaders</span></code></a> 对象</li>
<li>effective_url: 跟随重定向后资源的最后位置</li>
<li>buffer: 响应体的 <code class="docutils literal"><span class="pre">cStringIO</span></code> 对象</li>
<li>body: string 化的响应体 (从 <code class="docutils literal"><span class="pre">self.buffer</span></code> 的需求创建)</li>
<li>error: 任何异常对象</li>
<li>request_time: 请求开始到结束的时间(秒)</li>
<li>time_info: 来自请求的诊断时间信息的字典.
可用数据可能会更改, 不过当前在用的时间信息是
<a class="reference external" href="http://curl.haxx.se/libcurl/c/curl_easy_getinfo.html">http://curl.haxx.se/libcurl/c/curl_easy_getinfo.html</a>,
加上 <code class="docutils literal"><span class="pre">queue</span></code>, 这是通过等待在 <a class="reference internal" href="#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> 的 <code class="docutils literal"><span class="pre">max_clients</span></code>
设置下的插槽引入的延迟(如果有的话).</li>
</ul>
<dl class="method">
<dt id="tornado.httpclient.HTTPResponse.rethrow">
<code class="descname">rethrow</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httpclient.html#HTTPResponse.rethrow"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httpclient.HTTPResponse.rethrow" title="永久链接至目标">¶</a></dt>
<dd><p>如果请求中有错误发生, 将抛出一个 <a class="reference internal" href="#tornado.httpclient.HTTPError" title="tornado.httpclient.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">HTTPError</span></code></a>.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id1">
<h5>异常<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<dl class="exception">
<dt id="tornado.httpclient.HTTPError">
<em class="property">exception </em><code class="descclassname">tornado.httpclient.</code><code class="descname">HTTPError</code><span class="sig-paren">(</span><em>code</em>, <em>message=None</em>, <em>response=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httpclient.html#HTTPError"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httpclient.HTTPError" title="永久链接至目标">¶</a></dt>
<dd><p>一个 HTTP 请求失败后抛出的异常.</p>
<p>属性:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">code</span></code> - 整数的 HTTP 错误码, e.g. 404. 当没有接收到 HTTP 响应时
将会使用 599 错误码, e.g. 超时.</li>
<li><code class="docutils literal"><span class="pre">response</span></code> - 全部的 <a class="reference internal" href="#tornado.httpclient.HTTPResponse" title="tornado.httpclient.HTTPResponse"><code class="xref py py-obj docutils literal"><span class="pre">HTTPResponse</span></code></a> 对象.</li>
</ul>
<p>注意如果 <code class="docutils literal"><span class="pre">follow_redirects</span></code> 为 False, 重定向将导致 HTTPErrors,
并且你可以通过 <code class="docutils literal"><span class="pre">error.response.headers['Location']</span></code> 查看重定向的
描述.</p>
</dd></dl>

</div>
<div class="section" id="command-line">
<h5>Command-line 接口<a class="headerlink" href="#command-line" title="永久链接至标题">¶</a></h5>
<p>This module provides a simple command-line interface to fetch a url
using Tornado&#8217;s HTTP client.  Example usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Fetch the url and print its body</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">tornado</span><span class="o">.</span><span class="n">httpclient</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">google</span><span class="o">.</span><span class="n">com</span>

<span class="c1"># Just print the headers</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">tornado</span><span class="o">.</span><span class="n">httpclient</span> <span class="o">--</span><span class="n">print_headers</span> <span class="o">--</span><span class="n">print_body</span><span class="o">=</span><span class="n">false</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">google</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
</div>
<div class="section" id="module-tornado.simple_httpclient">
<span id="implementations"></span><h5>Implementations<a class="headerlink" href="#module-tornado.simple_httpclient" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.simple_httpclient.SimpleAsyncHTTPClient">
<em class="property">class </em><code class="descclassname">tornado.simple_httpclient.</code><code class="descname">SimpleAsyncHTTPClient</code><a class="reference internal" href="_modules/tornado/simple_httpclient.html#SimpleAsyncHTTPClient"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.simple_httpclient.SimpleAsyncHTTPClient" title="永久链接至目标">¶</a></dt>
<dd><p>Non-blocking HTTP client with no external dependencies.</p>
<p>This class implements an HTTP 1.1 client on top of Tornado&#8217;s IOStreams.
Some features found in the curl-based AsyncHTTPClient are not yet
supported.  In particular, proxies are not supported, connections
are not reused, and callers cannot select the network interface to be
used.</p>
<dl class="method">
<dt id="tornado.simple_httpclient.SimpleAsyncHTTPClient.initialize">
<code class="descname">initialize</code><span class="sig-paren">(</span><em>io_loop</em>, <em>max_clients=10</em>, <em>hostname_mapping=None</em>, <em>max_buffer_size=104857600</em>, <em>resolver=None</em>, <em>defaults=None</em>, <em>max_header_size=None</em>, <em>max_body_size=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/simple_httpclient.html#SimpleAsyncHTTPClient.initialize"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.simple_httpclient.SimpleAsyncHTTPClient.initialize" title="永久链接至目标">¶</a></dt>
<dd><p>Creates a AsyncHTTPClient.</p>
<p>Only a single AsyncHTTPClient instance exists per IOLoop
in order to provide limitations on the number of pending connections.
<code class="docutils literal"><span class="pre">force_instance=True</span></code> may be used to suppress this behavior.</p>
<p>Note that because of this implicit reuse, unless <code class="docutils literal"><span class="pre">force_instance</span></code>
is used, only the first call to the constructor actually uses
its arguments. It is recommended to use the <code class="docutils literal"><span class="pre">configure</span></code> method
instead of the constructor to ensure that arguments take effect.</p>
<p><code class="docutils literal"><span class="pre">max_clients</span></code> is the number of concurrent requests that can be
in progress; when this limit is reached additional requests will be
queued. Note that time spent waiting in this queue still counts
against the <code class="docutils literal"><span class="pre">request_timeout</span></code>.</p>
<p><code class="docutils literal"><span class="pre">hostname_mapping</span></code> is a dictionary mapping hostnames to IP addresses.
It can be used to make local DNS changes when modifying system-wide
settings like <code class="docutils literal"><span class="pre">/etc/hosts</span></code> is not possible or desirable (e.g. in
unittests).</p>
<p><code class="docutils literal"><span class="pre">max_buffer_size</span></code> (default 100MB) is the number of bytes
that can be read into memory at once. <code class="docutils literal"><span class="pre">max_body_size</span></code>
(defaults to <code class="docutils literal"><span class="pre">max_buffer_size</span></code>) is the largest response body
that the client will accept.  Without a
<code class="docutils literal"><span class="pre">streaming_callback</span></code>, the smaller of these two limits
applies; with a <code class="docutils literal"><span class="pre">streaming_callback</span></code> only <code class="docutils literal"><span class="pre">max_body_size</span></code>
does.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.2 版更改: </span>Added the <code class="docutils literal"><span class="pre">max_body_size</span></code> argument.</p>
</div>
</dd></dl>

</dd></dl>

<span class="target" id="module-tornado.curl_httpclient"></span><dl class="class">
<dt id="tornado.curl_httpclient.CurlAsyncHTTPClient">
<em class="property">class </em><code class="descclassname">tornado.curl_httpclient.</code><code class="descname">CurlAsyncHTTPClient</code><span class="sig-paren">(</span><em>io_loop</em>, <em>max_clients=10</em>, <em>defaults=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/curl_httpclient.html#CurlAsyncHTTPClient"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.curl_httpclient.CurlAsyncHTTPClient" title="永久链接至目标">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">libcurl</span></code>-based HTTP client.</p>
</dd></dl>

</div>
</div>
<span id="document-httputil"></span><div class="section" id="tornado-httputil-manipulate-http-headers-and-urls">
<h4><code class="docutils literal"><span class="pre">tornado.httputil</span></code> &#8212; Manipulate HTTP headers and URLs<a class="headerlink" href="#tornado-httputil-manipulate-http-headers-and-urls" title="永久链接至标题">¶</a></h4>
<span class="target" id="module-tornado.httputil"></span><p>HTTP utility code shared by clients and servers.</p>
<p>This module also defines the <a class="reference internal" href="#tornado.httputil.HTTPServerRequest" title="tornado.httputil.HTTPServerRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerRequest</span></code></a> class which is exposed
via <a class="reference internal" href="index.html#tornado.web.RequestHandler.request" title="tornado.web.RequestHandler.request"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.RequestHandler.request</span></code></a>.</p>
<dl class="class">
<dt id="tornado.httputil.HTTPHeaders">
<em class="property">class </em><code class="descclassname">tornado.httputil.</code><code class="descname">HTTPHeaders</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPHeaders"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPHeaders" title="永久链接至目标">¶</a></dt>
<dd><p>A dictionary that maintains <code class="docutils literal"><span class="pre">Http-Header-Case</span></code> for all keys.</p>
<p>Supports multiple values per key via a pair of new methods,
<a class="reference internal" href="#tornado.httputil.HTTPHeaders.add" title="tornado.httputil.HTTPHeaders.add"><code class="xref py py-obj docutils literal"><span class="pre">add()</span></code></a> and <a class="reference internal" href="#tornado.httputil.HTTPHeaders.get_list" title="tornado.httputil.HTTPHeaders.get_list"><code class="xref py py-obj docutils literal"><span class="pre">get_list()</span></code></a>.  The regular dictionary interface
returns a single value per key, with multiple values joined by a
comma.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">HTTPHeaders</span><span class="p">({</span><span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html&quot;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">[&#39;Content-Type&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="p">[</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">]</span>
<span class="go">&#39;text/html&#39;</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;Set-Cookie&quot;</span><span class="p">,</span> <span class="s2">&quot;A=B&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;Set-Cookie&quot;</span><span class="p">,</span> <span class="s2">&quot;C=D&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="p">[</span><span class="s2">&quot;set-cookie&quot;</span><span class="p">]</span>
<span class="go">&#39;A=B,C=D&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span><span class="s2">&quot;set-cookie&quot;</span><span class="p">)</span>
<span class="go">[&#39;A=B&#39;, &#39;C=D&#39;]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">get_all</span><span class="p">()):</span>
<span class="gp">... </span>   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>
<span class="gp">...</span>
<span class="go">Content-Type: text/html</span>
<span class="go">Set-Cookie: A=B</span>
<span class="go">Set-Cookie: C=D</span>
</pre></div>
</div>
<dl class="method">
<dt id="tornado.httputil.HTTPHeaders.add">
<code class="descname">add</code><span class="sig-paren">(</span><em>name</em>, <em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPHeaders.add"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPHeaders.add" title="永久链接至目标">¶</a></dt>
<dd><p>Adds a new value for the given key.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.httputil.HTTPHeaders.get_list">
<code class="descname">get_list</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPHeaders.get_list"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPHeaders.get_list" title="永久链接至目标">¶</a></dt>
<dd><p>Returns all values for the given header as a list.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.httputil.HTTPHeaders.get_all">
<code class="descname">get_all</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPHeaders.get_all"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPHeaders.get_all" title="永久链接至目标">¶</a></dt>
<dd><p>Returns an iterable of all (name, value) pairs.</p>
<p>If a header has multiple values, multiple pairs will be
returned with the same name.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.httputil.HTTPHeaders.parse_line">
<code class="descname">parse_line</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPHeaders.parse_line"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPHeaders.parse_line" title="永久链接至目标">¶</a></dt>
<dd><p>Updates the dictionary with a single header line.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">HTTPHeaders</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">parse_line</span><span class="p">(</span><span class="s2">&quot;Content-Type: text/html&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-type&#39;</span><span class="p">)</span>
<span class="go">&#39;text/html&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="tornado.httputil.HTTPHeaders.parse">
<em class="property">classmethod </em><code class="descname">parse</code><span class="sig-paren">(</span><em>headers</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPHeaders.parse"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPHeaders.parse" title="永久链接至目标">¶</a></dt>
<dd><p>Returns a dictionary from HTTP header text.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">HTTPHeaders</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;Content-Type: text/html</span><span class="se">\r\n</span><span class="s2">Content-Length: 42</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;Content-Length&#39;, &#39;42&#39;), (&#39;Content-Type&#39;, &#39;text/html&#39;)]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.httputil.HTTPServerRequest">
<em class="property">class </em><code class="descclassname">tornado.httputil.</code><code class="descname">HTTPServerRequest</code><span class="sig-paren">(</span><em>method=None</em>, <em>uri=None</em>, <em>version='HTTP/1.0'</em>, <em>headers=None</em>, <em>body=None</em>, <em>host=None</em>, <em>files=None</em>, <em>connection=None</em>, <em>start_line=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPServerRequest"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPServerRequest" title="永久链接至目标">¶</a></dt>
<dd><p>A single HTTP request.</p>
<p>All attributes are type <a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#str" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">str</span></code></a> unless otherwise noted.</p>
<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.method">
<code class="descname">method</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.method" title="永久链接至目标">¶</a></dt>
<dd><p>HTTP request method, e.g. &#8220;GET&#8221; or &#8220;POST&#8221;</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.uri">
<code class="descname">uri</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.uri" title="永久链接至目标">¶</a></dt>
<dd><p>The requested uri.</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.path">
<code class="descname">path</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.path" title="永久链接至目标">¶</a></dt>
<dd><p>The path portion of <a class="reference internal" href="#tornado.httputil.HTTPServerRequest.uri" title="tornado.httputil.HTTPServerRequest.uri"><code class="xref py py-obj docutils literal"><span class="pre">uri</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.query">
<code class="descname">query</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.query" title="永久链接至目标">¶</a></dt>
<dd><p>The query portion of <a class="reference internal" href="#tornado.httputil.HTTPServerRequest.uri" title="tornado.httputil.HTTPServerRequest.uri"><code class="xref py py-obj docutils literal"><span class="pre">uri</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.version">
<code class="descname">version</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.version" title="永久链接至目标">¶</a></dt>
<dd><p>HTTP version specified in request, e.g. &#8220;HTTP/1.1&#8221;</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.headers">
<code class="descname">headers</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.headers" title="永久链接至目标">¶</a></dt>
<dd><p><a class="reference internal" href="#tornado.httputil.HTTPHeaders" title="tornado.httputil.HTTPHeaders"><code class="xref py py-obj docutils literal"><span class="pre">HTTPHeaders</span></code></a> dictionary-like object for request headers.  Acts like
a case-insensitive dictionary with additional methods for repeated
headers.</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.body">
<code class="descname">body</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.body" title="永久链接至目标">¶</a></dt>
<dd><p>Request body, if present, as a byte string.</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.remote_ip">
<code class="descname">remote_ip</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.remote_ip" title="永久链接至目标">¶</a></dt>
<dd><p>Client&#8217;s IP address as a string.  If <code class="docutils literal"><span class="pre">HTTPServer.xheaders</span></code> is set,
will pass along the real IP address provided by a load balancer
in the <code class="docutils literal"><span class="pre">X-Real-Ip</span></code> or <code class="docutils literal"><span class="pre">X-Forwarded-For</span></code> header.</p>
</dd></dl>

<div class="versionchanged">
<p><span class="versionmodified">在 3.1 版更改: </span>The list format of <code class="docutils literal"><span class="pre">X-Forwarded-For</span></code> is now supported.</p>
</div>
<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.protocol">
<code class="descname">protocol</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.protocol" title="永久链接至目标">¶</a></dt>
<dd><p>The protocol used, either &#8220;http&#8221; or &#8220;https&#8221;.  If <code class="docutils literal"><span class="pre">HTTPServer.xheaders</span></code>
is set, will pass along the protocol used by a load balancer if
reported via an <code class="docutils literal"><span class="pre">X-Scheme</span></code> header.</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.host">
<code class="descname">host</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.host" title="永久链接至目标">¶</a></dt>
<dd><p>The requested hostname, usually taken from the <code class="docutils literal"><span class="pre">Host</span></code> header.</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.arguments">
<code class="descname">arguments</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.arguments" title="永久链接至目标">¶</a></dt>
<dd><p>GET/POST arguments are available in the arguments property, which
maps arguments names to lists of values (to support multiple values
for individual names). Names are of type <a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#str" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">str</span></code></a>, while arguments
are byte strings.  Note that this is different from
<a class="reference internal" href="index.html#tornado.web.RequestHandler.get_argument" title="tornado.web.RequestHandler.get_argument"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_argument</span></code></a>, which returns argument values as
unicode strings.</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.query_arguments">
<code class="descname">query_arguments</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.query_arguments" title="永久链接至目标">¶</a></dt>
<dd><p>Same format as <code class="docutils literal"><span class="pre">arguments</span></code>, but contains only arguments extracted
from the query string.</p>
<div class="versionadded">
<p><span class="versionmodified">3.2 新版功能.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.body_arguments">
<code class="descname">body_arguments</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.body_arguments" title="永久链接至目标">¶</a></dt>
<dd><p>Same format as <code class="docutils literal"><span class="pre">arguments</span></code>, but contains only arguments extracted
from the request body.</p>
<div class="versionadded">
<p><span class="versionmodified">3.2 新版功能.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.files">
<code class="descname">files</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.files" title="永久链接至目标">¶</a></dt>
<dd><p>File uploads are available in the files property, which maps file
names to lists of <a class="reference internal" href="#tornado.httputil.HTTPFile" title="tornado.httputil.HTTPFile"><code class="xref py py-obj docutils literal"><span class="pre">HTTPFile</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.connection">
<code class="descname">connection</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.connection" title="永久链接至目标">¶</a></dt>
<dd><p>An HTTP request is attached to a single HTTP connection, which can
be accessed through the &#8220;connection&#8221; attribute. Since connections
are typically kept open in HTTP/1.1, multiple requests can be handled
sequentially on a single connection.</p>
</dd></dl>

<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>Moved from <code class="docutils literal"><span class="pre">tornado.httpserver.HTTPRequest</span></code>.</p>
</div>
<dl class="method">
<dt id="tornado.httputil.HTTPServerRequest.supports_http_1_1">
<code class="descname">supports_http_1_1</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPServerRequest.supports_http_1_1"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.supports_http_1_1" title="永久链接至目标">¶</a></dt>
<dd><p>Returns True if this request supports HTTP/1.1 semantics.</p>
<div class="deprecated">
<p><span class="versionmodified">4.0 版后已移除: </span>Applications are less likely to need this information with the
introduction of <a class="reference internal" href="#tornado.httputil.HTTPConnection" title="tornado.httputil.HTTPConnection"><code class="xref py py-obj docutils literal"><span class="pre">HTTPConnection</span></code></a>.  If you still need it, access
the <code class="docutils literal"><span class="pre">version</span></code> attribute directly.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.HTTPServerRequest.cookies">
<code class="descname">cookies</code><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.cookies" title="永久链接至目标">¶</a></dt>
<dd><p>A dictionary of Cookie.Morsel objects.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.httputil.HTTPServerRequest.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>chunk</em>, <em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPServerRequest.write"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.write" title="永久链接至目标">¶</a></dt>
<dd><p>Writes the given chunk to the response stream.</p>
<div class="deprecated">
<p><span class="versionmodified">4.0 版后已移除: </span>Use <code class="docutils literal"><span class="pre">request.connection</span></code> and the <a class="reference internal" href="#tornado.httputil.HTTPConnection" title="tornado.httputil.HTTPConnection"><code class="xref py py-obj docutils literal"><span class="pre">HTTPConnection</span></code></a> methods
to write the response.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.httputil.HTTPServerRequest.finish">
<code class="descname">finish</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPServerRequest.finish"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.finish" title="永久链接至目标">¶</a></dt>
<dd><p>Finishes this HTTP request on the open connection.</p>
<div class="deprecated">
<p><span class="versionmodified">4.0 版后已移除: </span>Use <code class="docutils literal"><span class="pre">request.connection</span></code> and the <a class="reference internal" href="#tornado.httputil.HTTPConnection" title="tornado.httputil.HTTPConnection"><code class="xref py py-obj docutils literal"><span class="pre">HTTPConnection</span></code></a> methods
to write the response.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.httputil.HTTPServerRequest.full_url">
<code class="descname">full_url</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPServerRequest.full_url"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.full_url" title="永久链接至目标">¶</a></dt>
<dd><p>Reconstructs the full URL for this request.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.httputil.HTTPServerRequest.request_time">
<code class="descname">request_time</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPServerRequest.request_time"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.request_time" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the amount of time it took for this request to execute.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.httputil.HTTPServerRequest.get_ssl_certificate">
<code class="descname">get_ssl_certificate</code><span class="sig-paren">(</span><em>binary_form=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPServerRequest.get_ssl_certificate"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPServerRequest.get_ssl_certificate" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the client&#8217;s SSL certificate, if any.</p>
<p>To use client certificates, the HTTPServer&#8217;s
<a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext.verify_mode" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.SSLContext.verify_mode</span></code></a> field must be set, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ssl_ctx</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">Purpose</span><span class="o">.</span><span class="n">CLIENT_AUTH</span><span class="p">)</span>
<span class="n">ssl_ctx</span><span class="o">.</span><span class="n">load_cert_chain</span><span class="p">(</span><span class="s2">&quot;foo.crt&quot;</span><span class="p">,</span> <span class="s2">&quot;foo.key&quot;</span><span class="p">)</span>
<span class="n">ssl_ctx</span><span class="o">.</span><span class="n">load_verify_locations</span><span class="p">(</span><span class="s2">&quot;cacerts.pem&quot;</span><span class="p">)</span>
<span class="n">ssl_ctx</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_REQUIRED</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">ssl_options</span><span class="o">=</span><span class="n">ssl_ctx</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, the return value is a dictionary (or None, if no
client certificate is present).  If <code class="docutils literal"><span class="pre">binary_form</span></code> is true, a
DER-encoded form of the certificate is returned instead.  See
SSLSocket.getpeercert() in the standard library for more
details.
<a class="reference external" href="http://docs.python.org/library/ssl.html#sslsocket-objects">http://docs.python.org/library/ssl.html#sslsocket-objects</a></p>
</dd></dl>

</dd></dl>

<dl class="exception">
<dt id="tornado.httputil.HTTPInputError">
<em class="property">exception </em><code class="descclassname">tornado.httputil.</code><code class="descname">HTTPInputError</code><a class="reference internal" href="_modules/tornado/httputil.html#HTTPInputError"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPInputError" title="永久链接至目标">¶</a></dt>
<dd><p>Exception class for malformed HTTP requests or responses
from remote sources.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
</dd></dl>

<dl class="exception">
<dt id="tornado.httputil.HTTPOutputError">
<em class="property">exception </em><code class="descclassname">tornado.httputil.</code><code class="descname">HTTPOutputError</code><a class="reference internal" href="_modules/tornado/httputil.html#HTTPOutputError"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPOutputError" title="永久链接至目标">¶</a></dt>
<dd><p>Exception class for errors in HTTP output.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.httputil.HTTPServerConnectionDelegate">
<em class="property">class </em><code class="descclassname">tornado.httputil.</code><code class="descname">HTTPServerConnectionDelegate</code><a class="reference internal" href="_modules/tornado/httputil.html#HTTPServerConnectionDelegate"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPServerConnectionDelegate" title="永久链接至目标">¶</a></dt>
<dd><p>Implement this interface to handle requests from <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
<dl class="method">
<dt id="tornado.httputil.HTTPServerConnectionDelegate.start_request">
<code class="descname">start_request</code><span class="sig-paren">(</span><em>server_conn</em>, <em>request_conn</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPServerConnectionDelegate.start_request"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPServerConnectionDelegate.start_request" title="永久链接至目标">¶</a></dt>
<dd><p>This method is called by the server when a new request has started.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>server_conn</strong> &#8211; is an opaque object representing the long-lived
(e.g. tcp-level) connection.</li>
<li><strong>request_conn</strong> &#8211; is a <a class="reference internal" href="#tornado.httputil.HTTPConnection" title="tornado.httputil.HTTPConnection"><code class="xref py py-obj docutils literal"><span class="pre">HTTPConnection</span></code></a> object for a single
request/response exchange.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method should return a <a class="reference internal" href="#tornado.httputil.HTTPMessageDelegate" title="tornado.httputil.HTTPMessageDelegate"><code class="xref py py-obj docutils literal"><span class="pre">HTTPMessageDelegate</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.httputil.HTTPServerConnectionDelegate.on_close">
<code class="descname">on_close</code><span class="sig-paren">(</span><em>server_conn</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPServerConnectionDelegate.on_close"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPServerConnectionDelegate.on_close" title="永久链接至目标">¶</a></dt>
<dd><p>This method is called when a connection has been closed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><strong>server_conn</strong> &#8211; is a server connection that has previously been
passed to <code class="docutils literal"><span class="pre">start_request</span></code>.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.httputil.HTTPMessageDelegate">
<em class="property">class </em><code class="descclassname">tornado.httputil.</code><code class="descname">HTTPMessageDelegate</code><a class="reference internal" href="_modules/tornado/httputil.html#HTTPMessageDelegate"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPMessageDelegate" title="永久链接至目标">¶</a></dt>
<dd><p>Implement this interface to handle an HTTP request or response.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
<dl class="method">
<dt id="tornado.httputil.HTTPMessageDelegate.headers_received">
<code class="descname">headers_received</code><span class="sig-paren">(</span><em>start_line</em>, <em>headers</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPMessageDelegate.headers_received"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPMessageDelegate.headers_received" title="永久链接至目标">¶</a></dt>
<dd><p>Called when the HTTP headers have been received and parsed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>start_line</strong> &#8211; a <a class="reference internal" href="#tornado.httputil.RequestStartLine" title="tornado.httputil.RequestStartLine"><code class="xref py py-obj docutils literal"><span class="pre">RequestStartLine</span></code></a> or <a class="reference internal" href="#tornado.httputil.ResponseStartLine" title="tornado.httputil.ResponseStartLine"><code class="xref py py-obj docutils literal"><span class="pre">ResponseStartLine</span></code></a>
depending on whether this is a client or server message.</li>
<li><strong>headers</strong> &#8211; a <a class="reference internal" href="#tornado.httputil.HTTPHeaders" title="tornado.httputil.HTTPHeaders"><code class="xref py py-obj docutils literal"><span class="pre">HTTPHeaders</span></code></a> instance.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Some <a class="reference internal" href="#tornado.httputil.HTTPConnection" title="tornado.httputil.HTTPConnection"><code class="xref py py-obj docutils literal"><span class="pre">HTTPConnection</span></code></a> methods can only be called during
<code class="docutils literal"><span class="pre">headers_received</span></code>.</p>
<p>May return a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>; if it does the body will not be read
until it is done.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.httputil.HTTPMessageDelegate.data_received">
<code class="descname">data_received</code><span class="sig-paren">(</span><em>chunk</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPMessageDelegate.data_received"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPMessageDelegate.data_received" title="永久链接至目标">¶</a></dt>
<dd><p>Called when a chunk of data has been received.</p>
<p>May return a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> for flow control.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.httputil.HTTPMessageDelegate.finish">
<code class="descname">finish</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPMessageDelegate.finish"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPMessageDelegate.finish" title="永久链接至目标">¶</a></dt>
<dd><p>Called after the last chunk of data has been received.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.httputil.HTTPMessageDelegate.on_connection_close">
<code class="descname">on_connection_close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPMessageDelegate.on_connection_close"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPMessageDelegate.on_connection_close" title="永久链接至目标">¶</a></dt>
<dd><p>Called if the connection is closed without finishing the request.</p>
<p>If <code class="docutils literal"><span class="pre">headers_received</span></code> is called, either <code class="docutils literal"><span class="pre">finish</span></code> or
<code class="docutils literal"><span class="pre">on_connection_close</span></code> will be called, but not both.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.httputil.HTTPConnection">
<em class="property">class </em><code class="descclassname">tornado.httputil.</code><code class="descname">HTTPConnection</code><a class="reference internal" href="_modules/tornado/httputil.html#HTTPConnection"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPConnection" title="永久链接至目标">¶</a></dt>
<dd><p>Applications use this interface to write their responses.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
<dl class="method">
<dt id="tornado.httputil.HTTPConnection.write_headers">
<code class="descname">write_headers</code><span class="sig-paren">(</span><em>start_line</em>, <em>headers</em>, <em>chunk=None</em>, <em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPConnection.write_headers"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPConnection.write_headers" title="永久链接至目标">¶</a></dt>
<dd><p>Write an HTTP header block.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>start_line</strong> &#8211; a <a class="reference internal" href="#tornado.httputil.RequestStartLine" title="tornado.httputil.RequestStartLine"><code class="xref py py-obj docutils literal"><span class="pre">RequestStartLine</span></code></a> or <a class="reference internal" href="#tornado.httputil.ResponseStartLine" title="tornado.httputil.ResponseStartLine"><code class="xref py py-obj docutils literal"><span class="pre">ResponseStartLine</span></code></a>.</li>
<li><strong>headers</strong> &#8211; a <a class="reference internal" href="#tornado.httputil.HTTPHeaders" title="tornado.httputil.HTTPHeaders"><code class="xref py py-obj docutils literal"><span class="pre">HTTPHeaders</span></code></a> instance.</li>
<li><strong>chunk</strong> &#8211; the first (optional) chunk of data.  This is an optimization
so that small responses can be written in the same call as their
headers.</li>
<li><strong>callback</strong> &#8211; a callback to be run when the write is complete.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal"><span class="pre">version</span></code> field of <code class="docutils literal"><span class="pre">start_line</span></code> is ignored.</p>
<p>Returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> if no callback is given.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.httputil.HTTPConnection.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>chunk</em>, <em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPConnection.write"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPConnection.write" title="永久链接至目标">¶</a></dt>
<dd><p>Writes a chunk of body data.</p>
<p>The callback will be run when the write is complete.  If no callback
is given, returns a Future.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.httputil.HTTPConnection.finish">
<code class="descname">finish</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#HTTPConnection.finish"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPConnection.finish" title="永久链接至目标">¶</a></dt>
<dd><p>Indicates that the last body data has been written.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tornado.httputil.url_concat">
<code class="descclassname">tornado.httputil.</code><code class="descname">url_concat</code><span class="sig-paren">(</span><em>url</em>, <em>args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#url_concat"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.url_concat" title="永久链接至目标">¶</a></dt>
<dd><p>Concatenate url and arguments regardless of whether
url has existing query parameters.</p>
<p><code class="docutils literal"><span class="pre">args</span></code> may be either a dictionary or a list of key-value pairs
(the latter allows for multiple values with the same key.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">url_concat</span><span class="p">(</span><span class="s2">&quot;http://example.com/foo&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">))</span>
<span class="go">&#39;http://example.com/foo?c=d&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url_concat</span><span class="p">(</span><span class="s2">&quot;http://example.com/foo?a=b&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">))</span>
<span class="go">&#39;http://example.com/foo?a=b&amp;c=d&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url_concat</span><span class="p">(</span><span class="s2">&quot;http://example.com/foo?a=b&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d2&quot;</span><span class="p">)])</span>
<span class="go">&#39;http://example.com/foo?a=b&amp;c=d&amp;c=d2&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.httputil.HTTPFile">
<em class="property">class </em><code class="descclassname">tornado.httputil.</code><code class="descname">HTTPFile</code><a class="reference internal" href="_modules/tornado/httputil.html#HTTPFile"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.HTTPFile" title="永久链接至目标">¶</a></dt>
<dd><p>Represents a file uploaded via a form.</p>
<p>For backwards compatibility, its instance attributes are also
accessible as dictionary keys.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">filename</span></code></li>
<li><code class="docutils literal"><span class="pre">body</span></code></li>
<li><code class="docutils literal"><span class="pre">content_type</span></code></li>
</ul>
</dd></dl>

<dl class="function">
<dt id="tornado.httputil.parse_body_arguments">
<code class="descclassname">tornado.httputil.</code><code class="descname">parse_body_arguments</code><span class="sig-paren">(</span><em>content_type</em>, <em>body</em>, <em>arguments</em>, <em>files</em>, <em>headers=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#parse_body_arguments"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.parse_body_arguments" title="永久链接至目标">¶</a></dt>
<dd><p>Parses a form request body.</p>
<p>Supports <code class="docutils literal"><span class="pre">application/x-www-form-urlencoded</span></code> and
<code class="docutils literal"><span class="pre">multipart/form-data</span></code>.  The <code class="docutils literal"><span class="pre">content_type</span></code> parameter should be
a string and <code class="docutils literal"><span class="pre">body</span></code> should be a byte string.  The <code class="docutils literal"><span class="pre">arguments</span></code>
and <code class="docutils literal"><span class="pre">files</span></code> parameters are dictionaries that will be updated
with the parsed contents.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.httputil.parse_multipart_form_data">
<code class="descclassname">tornado.httputil.</code><code class="descname">parse_multipart_form_data</code><span class="sig-paren">(</span><em>boundary</em>, <em>data</em>, <em>arguments</em>, <em>files</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#parse_multipart_form_data"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.parse_multipart_form_data" title="永久链接至目标">¶</a></dt>
<dd><p>Parses a <code class="docutils literal"><span class="pre">multipart/form-data</span></code> body.</p>
<p>The <code class="docutils literal"><span class="pre">boundary</span></code> and <code class="docutils literal"><span class="pre">data</span></code> parameters are both byte strings.
The dictionaries given in the arguments and files parameters
will be updated with the contents of the body.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.httputil.format_timestamp">
<code class="descclassname">tornado.httputil.</code><code class="descname">format_timestamp</code><span class="sig-paren">(</span><em>ts</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#format_timestamp"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.format_timestamp" title="永久链接至目标">¶</a></dt>
<dd><p>Formats a timestamp in the format used by HTTP.</p>
<p>The argument may be a numeric timestamp as returned by <a class="reference external" href="https://docs.python.org/3.4/library/time.html#time.time" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">time.time</span></code></a>,
a time tuple as returned by <a class="reference external" href="https://docs.python.org/3.4/library/time.html#time.gmtime" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">time.gmtime</span></code></a>, or a <a class="reference external" href="https://docs.python.org/3.4/library/datetime.html#datetime.datetime" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">datetime.datetime</span></code></a>
object.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">format_timestamp</span><span class="p">(</span><span class="mi">1359312200</span><span class="p">)</span>
<span class="go">&#39;Sun, 27 Jan 2013 18:43:20 GMT&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.httputil.RequestStartLine">
<em class="property">class </em><code class="descclassname">tornado.httputil.</code><code class="descname">RequestStartLine</code><a class="headerlink" href="#tornado.httputil.RequestStartLine" title="永久链接至目标">¶</a></dt>
<dd><p>RequestStartLine(method, path, version)</p>
<p>Create new instance of RequestStartLine(method, path, version)</p>
<dl class="attribute">
<dt id="tornado.httputil.RequestStartLine.method">
<code class="descname">method</code><a class="headerlink" href="#tornado.httputil.RequestStartLine.method" title="永久链接至目标">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.RequestStartLine.path">
<code class="descname">path</code><a class="headerlink" href="#tornado.httputil.RequestStartLine.path" title="永久链接至目标">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.RequestStartLine.version">
<code class="descname">version</code><a class="headerlink" href="#tornado.httputil.RequestStartLine.version" title="永久链接至目标">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tornado.httputil.parse_request_start_line">
<code class="descclassname">tornado.httputil.</code><code class="descname">parse_request_start_line</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#parse_request_start_line"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.parse_request_start_line" title="永久链接至目标">¶</a></dt>
<dd><p>Returns a (method, path, version) tuple for an HTTP 1.x request line.</p>
<p>The response is a <a class="reference external" href="https://docs.python.org/3.4/library/collections.html#collections.namedtuple" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">collections.namedtuple</span></code></a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parse_request_start_line</span><span class="p">(</span><span class="s2">&quot;GET /foo HTTP/1.1&quot;</span><span class="p">)</span>
<span class="go">RequestStartLine(method=&#39;GET&#39;, path=&#39;/foo&#39;, version=&#39;HTTP/1.1&#39;)</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.httputil.ResponseStartLine">
<em class="property">class </em><code class="descclassname">tornado.httputil.</code><code class="descname">ResponseStartLine</code><a class="headerlink" href="#tornado.httputil.ResponseStartLine" title="永久链接至目标">¶</a></dt>
<dd><p>ResponseStartLine(version, code, reason)</p>
<p>Create new instance of ResponseStartLine(version, code, reason)</p>
<dl class="attribute">
<dt id="tornado.httputil.ResponseStartLine.code">
<code class="descname">code</code><a class="headerlink" href="#tornado.httputil.ResponseStartLine.code" title="永久链接至目标">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.ResponseStartLine.reason">
<code class="descname">reason</code><a class="headerlink" href="#tornado.httputil.ResponseStartLine.reason" title="永久链接至目标">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.httputil.ResponseStartLine.version">
<code class="descname">version</code><a class="headerlink" href="#tornado.httputil.ResponseStartLine.version" title="永久链接至目标">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tornado.httputil.parse_response_start_line">
<code class="descclassname">tornado.httputil.</code><code class="descname">parse_response_start_line</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#parse_response_start_line"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.parse_response_start_line" title="永久链接至目标">¶</a></dt>
<dd><p>Returns a (version, code, reason) tuple for an HTTP 1.x response line.</p>
<p>The response is a <a class="reference external" href="https://docs.python.org/3.4/library/collections.html#collections.namedtuple" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">collections.namedtuple</span></code></a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parse_response_start_line</span><span class="p">(</span><span class="s2">&quot;HTTP/1.1 200 OK&quot;</span><span class="p">)</span>
<span class="go">ResponseStartLine(version=&#39;HTTP/1.1&#39;, code=200, reason=&#39;OK&#39;)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.httputil.split_host_and_port">
<code class="descclassname">tornado.httputil.</code><code class="descname">split_host_and_port</code><span class="sig-paren">(</span><em>netloc</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/httputil.html#split_host_and_port"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.httputil.split_host_and_port" title="永久链接至目标">¶</a></dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">(host,</span> <span class="pre">port)</span></code> tuple from <code class="docutils literal"><span class="pre">netloc</span></code>.</p>
<p>Returned <code class="docutils literal"><span class="pre">port</span></code> will be <code class="docutils literal"><span class="pre">None</span></code> if not present.</p>
<div class="versionadded">
<p><span class="versionmodified">4.1 新版功能.</span></p>
</div>
</dd></dl>

</div>
<span id="document-http1connection"></span><div class="section" id="module-tornado.http1connection">
<span id="tornado-http1connection-http-1-x-client-server-implementation"></span><h4><code class="docutils literal"><span class="pre">tornado.http1connection</span></code> &#8211; HTTP/1.x client/server implementation<a class="headerlink" href="#module-tornado.http1connection" title="永久链接至标题">¶</a></h4>
<p>Client and server implementations of HTTP/1.x.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
<dl class="class">
<dt id="tornado.http1connection.HTTP1ConnectionParameters">
<em class="property">class </em><code class="descclassname">tornado.http1connection.</code><code class="descname">HTTP1ConnectionParameters</code><span class="sig-paren">(</span><em>no_keep_alive=False</em>, <em>chunk_size=None</em>, <em>max_header_size=None</em>, <em>header_timeout=None</em>, <em>max_body_size=None</em>, <em>body_timeout=None</em>, <em>decompress=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/http1connection.html#HTTP1ConnectionParameters"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.http1connection.HTTP1ConnectionParameters" title="永久链接至目标">¶</a></dt>
<dd><p>Parameters for <a class="reference internal" href="#tornado.http1connection.HTTP1Connection" title="tornado.http1connection.HTTP1Connection"><code class="xref py py-obj docutils literal"><span class="pre">HTTP1Connection</span></code></a> and <a class="reference internal" href="#tornado.http1connection.HTTP1ServerConnection" title="tornado.http1connection.HTTP1ServerConnection"><code class="xref py py-obj docutils literal"><span class="pre">HTTP1ServerConnection</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>no_keep_alive</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#bool" title="(在 Python v3.4)"><em>bool</em></a>) &#8211; If true, always close the connection after
one request.</li>
<li><strong>chunk_size</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#int" title="(在 Python v3.4)"><em>int</em></a>) &#8211; how much data to read into memory at once</li>
<li><strong>max_header_size</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#int" title="(在 Python v3.4)"><em>int</em></a>) &#8211; maximum amount of data for HTTP headers</li>
<li><strong>header_timeout</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#float" title="(在 Python v3.4)"><em>float</em></a>) &#8211; how long to wait for all headers (seconds)</li>
<li><strong>max_body_size</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#int" title="(在 Python v3.4)"><em>int</em></a>) &#8211; maximum amount of data for body</li>
<li><strong>body_timeout</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#float" title="(在 Python v3.4)"><em>float</em></a>) &#8211; how long to wait while reading body (seconds)</li>
<li><strong>decompress</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#bool" title="(在 Python v3.4)"><em>bool</em></a>) &#8211; if true, decode incoming
<code class="docutils literal"><span class="pre">Content-Encoding:</span> <span class="pre">gzip</span></code></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="tornado.http1connection.HTTP1Connection">
<em class="property">class </em><code class="descclassname">tornado.http1connection.</code><code class="descname">HTTP1Connection</code><span class="sig-paren">(</span><em>stream</em>, <em>is_client</em>, <em>params=None</em>, <em>context=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/http1connection.html#HTTP1Connection"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.http1connection.HTTP1Connection" title="永久链接至目标">¶</a></dt>
<dd><p>Implements the HTTP/1.x protocol.</p>
<p>This class can be on its own for clients, or via <a class="reference internal" href="#tornado.http1connection.HTTP1ServerConnection" title="tornado.http1connection.HTTP1ServerConnection"><code class="xref py py-obj docutils literal"><span class="pre">HTTP1ServerConnection</span></code></a>
for servers.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>stream</strong> &#8211; an <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a></li>
<li><strong>is_client</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#bool" title="(在 Python v3.4)"><em>bool</em></a>) &#8211; client or server</li>
<li><strong>params</strong> &#8211; a <a class="reference internal" href="#tornado.http1connection.HTTP1ConnectionParameters" title="tornado.http1connection.HTTP1ConnectionParameters"><code class="xref py py-obj docutils literal"><span class="pre">HTTP1ConnectionParameters</span></code></a> instance or <code class="docutils literal"><span class="pre">None</span></code></li>
<li><strong>context</strong> &#8211; an opaque application-defined object that can be accessed
as <code class="docutils literal"><span class="pre">connection.context</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="tornado.http1connection.HTTP1Connection.read_response">
<code class="descname">read_response</code><span class="sig-paren">(</span><em>delegate</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/http1connection.html#HTTP1Connection.read_response"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.http1connection.HTTP1Connection.read_response" title="永久链接至目标">¶</a></dt>
<dd><p>Read a single HTTP response.</p>
<p>Typical client-mode usage is to write a request using <a class="reference internal" href="#tornado.http1connection.HTTP1Connection.write_headers" title="tornado.http1connection.HTTP1Connection.write_headers"><code class="xref py py-obj docutils literal"><span class="pre">write_headers</span></code></a>,
<a class="reference internal" href="#tornado.http1connection.HTTP1Connection.write" title="tornado.http1connection.HTTP1Connection.write"><code class="xref py py-obj docutils literal"><span class="pre">write</span></code></a>, and <a class="reference internal" href="#tornado.http1connection.HTTP1Connection.finish" title="tornado.http1connection.HTTP1Connection.finish"><code class="xref py py-obj docutils literal"><span class="pre">finish</span></code></a>, and then call <code class="docutils literal"><span class="pre">read_response</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><strong>delegate</strong> &#8211; a <a class="reference internal" href="index.html#tornado.httputil.HTTPMessageDelegate" title="tornado.httputil.HTTPMessageDelegate"><code class="xref py py-obj docutils literal"><span class="pre">HTTPMessageDelegate</span></code></a></td>
</tr>
</tbody>
</table>
<p>Returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> that resolves to None after the full response has
been read.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.http1connection.HTTP1Connection.set_close_callback">
<code class="descname">set_close_callback</code><span class="sig-paren">(</span><em>callback</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/http1connection.html#HTTP1Connection.set_close_callback"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.http1connection.HTTP1Connection.set_close_callback" title="永久链接至目标">¶</a></dt>
<dd><p>Sets a callback that will be run when the connection is closed.</p>
<div class="deprecated">
<p><span class="versionmodified">4.0 版后已移除: </span>Use <a class="reference internal" href="index.html#tornado.httputil.HTTPMessageDelegate.on_connection_close" title="tornado.httputil.HTTPMessageDelegate.on_connection_close"><code class="xref py py-obj docutils literal"><span class="pre">HTTPMessageDelegate.on_connection_close</span></code></a> instead.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.http1connection.HTTP1Connection.detach">
<code class="descname">detach</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/http1connection.html#HTTP1Connection.detach"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.http1connection.HTTP1Connection.detach" title="永久链接至目标">¶</a></dt>
<dd><p>Take control of the underlying stream.</p>
<p>Returns the underlying <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> object and stops all further
HTTP processing.  May only be called during
<a class="reference internal" href="index.html#tornado.httputil.HTTPMessageDelegate.headers_received" title="tornado.httputil.HTTPMessageDelegate.headers_received"><code class="xref py py-obj docutils literal"><span class="pre">HTTPMessageDelegate.headers_received</span></code></a>.  Intended for implementing
protocols like websockets that tunnel over an HTTP handshake.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.http1connection.HTTP1Connection.set_body_timeout">
<code class="descname">set_body_timeout</code><span class="sig-paren">(</span><em>timeout</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/http1connection.html#HTTP1Connection.set_body_timeout"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.http1connection.HTTP1Connection.set_body_timeout" title="永久链接至目标">¶</a></dt>
<dd><p>Sets the body timeout for a single request.</p>
<p>Overrides the value from <a class="reference internal" href="#tornado.http1connection.HTTP1ConnectionParameters" title="tornado.http1connection.HTTP1ConnectionParameters"><code class="xref py py-obj docutils literal"><span class="pre">HTTP1ConnectionParameters</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.http1connection.HTTP1Connection.set_max_body_size">
<code class="descname">set_max_body_size</code><span class="sig-paren">(</span><em>max_body_size</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/http1connection.html#HTTP1Connection.set_max_body_size"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.http1connection.HTTP1Connection.set_max_body_size" title="永久链接至目标">¶</a></dt>
<dd><p>Sets the body size limit for a single request.</p>
<p>Overrides the value from <a class="reference internal" href="#tornado.http1connection.HTTP1ConnectionParameters" title="tornado.http1connection.HTTP1ConnectionParameters"><code class="xref py py-obj docutils literal"><span class="pre">HTTP1ConnectionParameters</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.http1connection.HTTP1Connection.write_headers">
<code class="descname">write_headers</code><span class="sig-paren">(</span><em>start_line</em>, <em>headers</em>, <em>chunk=None</em>, <em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/http1connection.html#HTTP1Connection.write_headers"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.http1connection.HTTP1Connection.write_headers" title="永久链接至目标">¶</a></dt>
<dd><p>Implements <a class="reference internal" href="index.html#tornado.httputil.HTTPConnection.write_headers" title="tornado.httputil.HTTPConnection.write_headers"><code class="xref py py-obj docutils literal"><span class="pre">HTTPConnection.write_headers</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.http1connection.HTTP1Connection.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>chunk</em>, <em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/http1connection.html#HTTP1Connection.write"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.http1connection.HTTP1Connection.write" title="永久链接至目标">¶</a></dt>
<dd><p>Implements <a class="reference internal" href="index.html#tornado.httputil.HTTPConnection.write" title="tornado.httputil.HTTPConnection.write"><code class="xref py py-obj docutils literal"><span class="pre">HTTPConnection.write</span></code></a>.</p>
<p>For backwards compatibility is is allowed but deprecated to
skip <a class="reference internal" href="#tornado.http1connection.HTTP1Connection.write_headers" title="tornado.http1connection.HTTP1Connection.write_headers"><code class="xref py py-obj docutils literal"><span class="pre">write_headers</span></code></a> and instead call <a class="reference internal" href="#tornado.http1connection.HTTP1Connection.write" title="tornado.http1connection.HTTP1Connection.write"><code class="xref py py-obj docutils literal"><span class="pre">write()</span></code></a> with a
pre-encoded header block.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.http1connection.HTTP1Connection.finish">
<code class="descname">finish</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/http1connection.html#HTTP1Connection.finish"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.http1connection.HTTP1Connection.finish" title="永久链接至目标">¶</a></dt>
<dd><p>Implements <a class="reference internal" href="index.html#tornado.httputil.HTTPConnection.finish" title="tornado.httputil.HTTPConnection.finish"><code class="xref py py-obj docutils literal"><span class="pre">HTTPConnection.finish</span></code></a>.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.http1connection.HTTP1ServerConnection">
<em class="property">class </em><code class="descclassname">tornado.http1connection.</code><code class="descname">HTTP1ServerConnection</code><span class="sig-paren">(</span><em>stream</em>, <em>params=None</em>, <em>context=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/http1connection.html#HTTP1ServerConnection"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.http1connection.HTTP1ServerConnection" title="永久链接至目标">¶</a></dt>
<dd><p>An HTTP/1.x server.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>stream</strong> &#8211; an <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a></li>
<li><strong>params</strong> &#8211; a <a class="reference internal" href="#tornado.http1connection.HTTP1ConnectionParameters" title="tornado.http1connection.HTTP1ConnectionParameters"><code class="xref py py-obj docutils literal"><span class="pre">HTTP1ConnectionParameters</span></code></a> or None</li>
<li><strong>context</strong> &#8211; an opaque application-defined object that is accessible
as <code class="docutils literal"><span class="pre">connection.context</span></code></li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="tornado.http1connection.HTTP1ServerConnection.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/http1connection.html#HTTP1ServerConnection.close"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.http1connection.HTTP1ServerConnection.close" title="永久链接至目标">¶</a></dt>
<dd><p>Closes the connection.</p>
<p>Returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> that resolves after the serving loop has exited.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.http1connection.HTTP1ServerConnection.start_serving">
<code class="descname">start_serving</code><span class="sig-paren">(</span><em>delegate</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/http1connection.html#HTTP1ServerConnection.start_serving"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.http1connection.HTTP1ServerConnection.start_serving" title="永久链接至目标">¶</a></dt>
<dd><p>Starts serving requests on this connection.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><strong>delegate</strong> &#8211; a <a class="reference internal" href="index.html#tornado.httputil.HTTPServerConnectionDelegate" title="tornado.httputil.HTTPServerConnectionDelegate"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerConnectionDelegate</span></code></a></td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>
</div>
<span id="document-networking"></span><div class="section" id="id1">
<h3>异步网络<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-ioloop"></span><div class="section" id="module-tornado.ioloop">
<span id="tornado-ioloop-main-event-loop"></span><h4><code class="docutils literal"><span class="pre">tornado.ioloop</span></code> &#8212; Main event loop<a class="headerlink" href="#module-tornado.ioloop" title="永久链接至标题">¶</a></h4>
<p>An I/O event loop for non-blocking sockets.</p>
<p>Typical applications will use a single <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> object, in the
<a class="reference internal" href="#tornado.ioloop.IOLoop.instance" title="tornado.ioloop.IOLoop.instance"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.instance</span></code></a> singleton.  The <a class="reference internal" href="#tornado.ioloop.IOLoop.start" title="tornado.ioloop.IOLoop.start"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.start</span></code></a> method should usually
be called at the end of the <code class="docutils literal"><span class="pre">main()</span></code> function.  Atypical applications may
use more than one <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>, such as one <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> per thread, or per <a class="reference external" href="https://docs.python.org/3.4/library/unittest.html#module-unittest" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">unittest</span></code></a>
case.</p>
<p>In addition to I/O events, the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> can also schedule time-based events.
<a class="reference internal" href="#tornado.ioloop.IOLoop.add_timeout" title="tornado.ioloop.IOLoop.add_timeout"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_timeout</span></code></a> is a non-blocking alternative to <a class="reference external" href="https://docs.python.org/3.4/library/time.html#time.sleep" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">time.sleep</span></code></a>.</p>
<div class="section" id="ioloop-objects">
<h5>IOLoop objects<a class="headerlink" href="#ioloop-objects" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.ioloop.IOLoop">
<em class="property">class </em><code class="descclassname">tornado.ioloop.</code><code class="descname">IOLoop</code><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop" title="永久链接至目标">¶</a></dt>
<dd><p>A level-triggered I/O loop.</p>
<p>We use <code class="docutils literal"><span class="pre">epoll</span></code> (Linux) or <code class="docutils literal"><span class="pre">kqueue</span></code> (BSD and Mac OS X) if they
are available, or else we fall back on select(). If you are
implementing a system that needs to handle thousands of
simultaneous connections, you should use a system that supports
either <code class="docutils literal"><span class="pre">epoll</span></code> or <code class="docutils literal"><span class="pre">kqueue</span></code>.</p>
<p>Example usage for a simple TCP server:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">tornado.ioloop</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="k">def</span> <span class="nf">connection_ready</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">connection</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">errno</span><span class="o">.</span><span class="n">EWOULDBLOCK</span><span class="p">,</span> <span class="n">errno</span><span class="o">.</span><span class="n">EAGAIN</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="k">return</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">setblocking</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">handle_connection</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">setblocking</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>

    <span class="n">io_loop</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span>
    <span class="n">callback</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">connection_ready</span><span class="p">,</span> <span class="n">sock</span><span class="p">)</span>
    <span class="n">io_loop</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">callback</span><span class="p">,</span> <span class="n">io_loop</span><span class="o">.</span><span class="n">READ</span><span class="p">)</span>
    <span class="n">io_loop</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>By default, a newly-constructed <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> becomes the thread&#8217;s current
<a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>, unless there already is a current <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>. This behavior
can be controlled with the <code class="docutils literal"><span class="pre">make_current</span></code> argument to the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>
constructor: if <code class="docutils literal"><span class="pre">make_current=True</span></code>, the new <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> will always
try to become current and it raises an error if there is already a
current instance. If <code class="docutils literal"><span class="pre">make_current=False</span></code>, the new <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> will
not try to become current.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.2 版更改: </span>Added the <code class="docutils literal"><span class="pre">make_current</span></code> keyword argument to the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>
constructor.</p>
</div>
</dd></dl>

<div class="section" id="running-an-ioloop">
<h6>Running an IOLoop<a class="headerlink" href="#running-an-ioloop" title="永久链接至标题">¶</a></h6>
<dl class="staticmethod">
<dt id="tornado.ioloop.IOLoop.current">
<em class="property">static </em><code class="descclassname">IOLoop.</code><code class="descname">current</code><span class="sig-paren">(</span><em>instance=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.current"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.current" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the current thread&#8217;s <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>.</p>
<p>If an <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> is currently running or has been marked as
current by <a class="reference internal" href="#tornado.ioloop.IOLoop.make_current" title="tornado.ioloop.IOLoop.make_current"><code class="xref py py-obj docutils literal"><span class="pre">make_current</span></code></a>, returns that instance.  If there is
no current <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>, returns <a class="reference internal" href="#tornado.ioloop.IOLoop.instance" title="tornado.ioloop.IOLoop.instance"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.instance()</span></code></a> (i.e. the
main thread&#8217;s <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>, creating one if necessary) if <code class="docutils literal"><span class="pre">instance</span></code>
is true.</p>
<p>In general you should use <a class="reference internal" href="#tornado.ioloop.IOLoop.current" title="tornado.ioloop.IOLoop.current"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.current</span></code></a> as the default when
constructing an asynchronous object, and use <a class="reference internal" href="#tornado.ioloop.IOLoop.instance" title="tornado.ioloop.IOLoop.instance"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.instance</span></code></a>
when you mean to communicate to the main thread from a different
one.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>Added <code class="docutils literal"><span class="pre">instance</span></code> argument to control the fallback to
<a class="reference internal" href="#tornado.ioloop.IOLoop.instance" title="tornado.ioloop.IOLoop.instance"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.instance()</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.make_current">
<code class="descclassname">IOLoop.</code><code class="descname">make_current</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.make_current"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.make_current" title="永久链接至目标">¶</a></dt>
<dd><p>Makes this the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> for the current thread.</p>
<p>An <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> automatically becomes current for its thread
when it is started, but it is sometimes useful to call
<a class="reference internal" href="#tornado.ioloop.IOLoop.make_current" title="tornado.ioloop.IOLoop.make_current"><code class="xref py py-obj docutils literal"><span class="pre">make_current</span></code></a> explicitly before starting the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>,
so that code run at startup time can find the right
instance.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>An <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> created while there is no current <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>
will automatically become current.</p>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="tornado.ioloop.IOLoop.instance">
<em class="property">static </em><code class="descclassname">IOLoop.</code><code class="descname">instance</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.instance"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.instance" title="永久链接至目标">¶</a></dt>
<dd><p>Returns a global <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> instance.</p>
<p>Most applications have a single, global <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> running on the
main thread.  Use this method to get this instance from
another thread.  In most other cases, it is better to use <a class="reference internal" href="#tornado.ioloop.IOLoop.current" title="tornado.ioloop.IOLoop.current"><code class="xref py py-obj docutils literal"><span class="pre">current()</span></code></a>
to get the current thread&#8217;s <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="tornado.ioloop.IOLoop.initialized">
<em class="property">static </em><code class="descclassname">IOLoop.</code><code class="descname">initialized</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.initialized"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.initialized" title="永久链接至目标">¶</a></dt>
<dd><p>Returns true if the singleton instance has been created.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.install">
<code class="descclassname">IOLoop.</code><code class="descname">install</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.install"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.install" title="永久链接至目标">¶</a></dt>
<dd><p>Installs this <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> object as the singleton instance.</p>
<p>This is normally not necessary as <a class="reference internal" href="#tornado.ioloop.IOLoop.instance" title="tornado.ioloop.IOLoop.instance"><code class="xref py py-obj docutils literal"><span class="pre">instance()</span></code></a> will create
an <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> on demand, but you may want to call <a class="reference internal" href="#tornado.ioloop.IOLoop.install" title="tornado.ioloop.IOLoop.install"><code class="xref py py-obj docutils literal"><span class="pre">install</span></code></a> to use
a custom subclass of <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="tornado.ioloop.IOLoop.clear_instance">
<em class="property">static </em><code class="descclassname">IOLoop.</code><code class="descname">clear_instance</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.clear_instance"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.clear_instance" title="永久链接至目标">¶</a></dt>
<dd><p>Clear the global <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> instance.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.start">
<code class="descclassname">IOLoop.</code><code class="descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.start"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.start" title="永久链接至目标">¶</a></dt>
<dd><p>Starts the I/O loop.</p>
<p>The loop will run until one of the callbacks calls <a class="reference internal" href="#tornado.ioloop.IOLoop.stop" title="tornado.ioloop.IOLoop.stop"><code class="xref py py-obj docutils literal"><span class="pre">stop()</span></code></a>, which
will make the loop stop after the current event iteration completes.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.stop">
<code class="descclassname">IOLoop.</code><code class="descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.stop"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.stop" title="永久链接至目标">¶</a></dt>
<dd><p>Stop the I/O loop.</p>
<p>If the event loop is not currently running, the next call to <a class="reference internal" href="#tornado.ioloop.IOLoop.start" title="tornado.ioloop.IOLoop.start"><code class="xref py py-obj docutils literal"><span class="pre">start()</span></code></a>
will return immediately.</p>
<p>To use asynchronous methods from otherwise-synchronous code (such as
unit tests), you can start and stop the event loop like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ioloop</span> <span class="o">=</span> <span class="n">IOLoop</span><span class="p">()</span>
<span class="n">async_method</span><span class="p">(</span><span class="n">ioloop</span><span class="o">=</span><span class="n">ioloop</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">ioloop</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
<span class="n">ioloop</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">ioloop.start()</span></code> will return after <code class="docutils literal"><span class="pre">async_method</span></code> has run
its callback, whether that callback was invoked before or
after <code class="docutils literal"><span class="pre">ioloop.start</span></code>.</p>
<p>Note that even after <a class="reference internal" href="#tornado.ioloop.IOLoop.stop" title="tornado.ioloop.IOLoop.stop"><code class="xref py py-obj docutils literal"><span class="pre">stop</span></code></a> has been called, the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> is not
completely stopped until <a class="reference internal" href="#tornado.ioloop.IOLoop.start" title="tornado.ioloop.IOLoop.start"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.start</span></code></a> has also returned.
Some work that was scheduled before the call to <a class="reference internal" href="#tornado.ioloop.IOLoop.stop" title="tornado.ioloop.IOLoop.stop"><code class="xref py py-obj docutils literal"><span class="pre">stop</span></code></a> may still
be run before the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> shuts down.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.run_sync">
<code class="descclassname">IOLoop.</code><code class="descname">run_sync</code><span class="sig-paren">(</span><em>func</em>, <em>timeout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.run_sync"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.run_sync" title="永久链接至目标">¶</a></dt>
<dd><p>Starts the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>, runs the given function, and stops the loop.</p>
<p>The function must return either a yieldable object or
<code class="docutils literal"><span class="pre">None</span></code>. If the function returns a yieldable object, the
<a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> will run until the yieldable is resolved (and
<a class="reference internal" href="#tornado.ioloop.IOLoop.run_sync" title="tornado.ioloop.IOLoop.run_sync"><code class="xref py py-obj docutils literal"><span class="pre">run_sync()</span></code></a> will return the yieldable&#8217;s result). If it raises
an exception, the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> will stop and the exception will be
re-raised to the caller.</p>
<p>The keyword-only argument <code class="docutils literal"><span class="pre">timeout</span></code> may be used to set
a maximum duration for the function.  If the timeout expires,
a <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#TimeoutError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">TimeoutError</span></code></a> is raised.</p>
<p>This method is useful in conjunction with <a class="reference internal" href="index.html#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.coroutine</span></code></a>
to allow asynchronous calls in a <code class="docutils literal"><span class="pre">main()</span></code> function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># do stuff...</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>Returning a non-<code class="docutils literal"><span class="pre">None</span></code>, non-yieldable value is now an error.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.close">
<code class="descclassname">IOLoop.</code><code class="descname">close</code><span class="sig-paren">(</span><em>all_fds=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.close"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.close" title="永久链接至目标">¶</a></dt>
<dd><p>Closes the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>, freeing any resources used.</p>
<p>If <code class="docutils literal"><span class="pre">all_fds</span></code> is true, all file descriptors registered on the
IOLoop will be closed (not just the ones created by the
<a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> itself).</p>
<p>Many applications will only use a single <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> that runs for the
entire lifetime of the process.  In that case closing the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>
is not necessary since everything will be cleaned up when the
process exits.  <a class="reference internal" href="#tornado.ioloop.IOLoop.close" title="tornado.ioloop.IOLoop.close"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.close</span></code></a> is provided mainly for scenarios
such as unit tests, which create and destroy a large number of
<code class="docutils literal"><span class="pre">IOLoops</span></code>.</p>
<p>An <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> must be completely stopped before it can be closed.  This
means that <a class="reference internal" href="#tornado.ioloop.IOLoop.stop" title="tornado.ioloop.IOLoop.stop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.stop()</span></code></a> must be called <em>and</em> <a class="reference internal" href="#tornado.ioloop.IOLoop.start" title="tornado.ioloop.IOLoop.start"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.start()</span></code></a> must
be allowed to return before attempting to call <a class="reference internal" href="#tornado.ioloop.IOLoop.close" title="tornado.ioloop.IOLoop.close"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.close()</span></code></a>.
Therefore the call to <a class="reference internal" href="#tornado.ioloop.IOLoop.close" title="tornado.ioloop.IOLoop.close"><code class="xref py py-obj docutils literal"><span class="pre">close</span></code></a> will usually appear just after
the call to <a class="reference internal" href="#tornado.ioloop.IOLoop.start" title="tornado.ioloop.IOLoop.start"><code class="xref py py-obj docutils literal"><span class="pre">start</span></code></a> rather than near the call to <a class="reference internal" href="#tornado.ioloop.IOLoop.stop" title="tornado.ioloop.IOLoop.stop"><code class="xref py py-obj docutils literal"><span class="pre">stop</span></code></a>.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.1 版更改: </span>If the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> implementation supports non-integer objects
for &#8220;file descriptors&#8221;, those objects will have their
<code class="docutils literal"><span class="pre">close</span></code> method when <code class="docutils literal"><span class="pre">all_fds</span></code> is true.</p>
</div>
</dd></dl>

</div>
<div class="section" id="i-o-events">
<h6>I/O events<a class="headerlink" href="#i-o-events" title="永久链接至标题">¶</a></h6>
<dl class="method">
<dt id="tornado.ioloop.IOLoop.add_handler">
<code class="descclassname">IOLoop.</code><code class="descname">add_handler</code><span class="sig-paren">(</span><em>fd</em>, <em>handler</em>, <em>events</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.add_handler"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.add_handler" title="永久链接至目标">¶</a></dt>
<dd><p>Registers the given handler to receive the given events for <code class="docutils literal"><span class="pre">fd</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">fd</span></code> argument may either be an integer file descriptor or
a file-like object with a <code class="docutils literal"><span class="pre">fileno()</span></code> method (and optionally a
<code class="docutils literal"><span class="pre">close()</span></code> method, which may be called when the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> is shut
down).</p>
<p>The <code class="docutils literal"><span class="pre">events</span></code> argument is a bitwise or of the constants
<code class="docutils literal"><span class="pre">IOLoop.READ</span></code>, <code class="docutils literal"><span class="pre">IOLoop.WRITE</span></code>, and <code class="docutils literal"><span class="pre">IOLoop.ERROR</span></code>.</p>
<p>When an event occurs, <code class="docutils literal"><span class="pre">handler(fd,</span> <span class="pre">events)</span></code> will be run.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>Added the ability to pass file-like objects in addition to
raw file descriptors.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.update_handler">
<code class="descclassname">IOLoop.</code><code class="descname">update_handler</code><span class="sig-paren">(</span><em>fd</em>, <em>events</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.update_handler"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.update_handler" title="永久链接至目标">¶</a></dt>
<dd><p>Changes the events we listen for <code class="docutils literal"><span class="pre">fd</span></code>.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>Added the ability to pass file-like objects in addition to
raw file descriptors.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.remove_handler">
<code class="descclassname">IOLoop.</code><code class="descname">remove_handler</code><span class="sig-paren">(</span><em>fd</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.remove_handler"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.remove_handler" title="永久链接至目标">¶</a></dt>
<dd><p>Stop listening for events on <code class="docutils literal"><span class="pre">fd</span></code>.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>Added the ability to pass file-like objects in addition to
raw file descriptors.</p>
</div>
</dd></dl>

</div>
<div class="section" id="callbacks-and-timeouts">
<h6>Callbacks and timeouts<a class="headerlink" href="#callbacks-and-timeouts" title="永久链接至标题">¶</a></h6>
<dl class="method">
<dt id="tornado.ioloop.IOLoop.add_callback">
<code class="descclassname">IOLoop.</code><code class="descname">add_callback</code><span class="sig-paren">(</span><em>callback</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.add_callback"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.add_callback" title="永久链接至目标">¶</a></dt>
<dd><p>Calls the given callback on the next I/O loop iteration.</p>
<p>It is safe to call this method from any thread at any time,
except from a signal handler.  Note that this is the <strong>only</strong>
method in <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> that makes this thread-safety guarantee; all
other interaction with the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> must be done from that
<a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>&#8216;s thread.  <a class="reference internal" href="#tornado.ioloop.IOLoop.add_callback" title="tornado.ioloop.IOLoop.add_callback"><code class="xref py py-obj docutils literal"><span class="pre">add_callback()</span></code></a> may be used to transfer
control from other threads to the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>&#8216;s thread.</p>
<p>To add a callback from a signal handler, see
<a class="reference internal" href="#tornado.ioloop.IOLoop.add_callback_from_signal" title="tornado.ioloop.IOLoop.add_callback_from_signal"><code class="xref py py-obj docutils literal"><span class="pre">add_callback_from_signal</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.add_callback_from_signal">
<code class="descclassname">IOLoop.</code><code class="descname">add_callback_from_signal</code><span class="sig-paren">(</span><em>callback</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.add_callback_from_signal"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.add_callback_from_signal" title="永久链接至目标">¶</a></dt>
<dd><p>Calls the given callback on the next I/O loop iteration.</p>
<p>Safe for use from a Python signal handler; should not be used
otherwise.</p>
<p>Callbacks added with this method will be run without any
<a class="reference internal" href="index.html#module-tornado.stack_context" title="tornado.stack_context"><code class="xref py py-obj docutils literal"><span class="pre">stack_context</span></code></a>, to avoid picking up the context of the function
that was interrupted by the signal.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.add_future">
<code class="descclassname">IOLoop.</code><code class="descname">add_future</code><span class="sig-paren">(</span><em>future</em>, <em>callback</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.add_future"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.add_future" title="永久链接至目标">¶</a></dt>
<dd><p>Schedules a callback on the <code class="docutils literal"><span class="pre">IOLoop</span></code> when the given
<a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> is finished.</p>
<p>The callback is invoked with one argument, the
<a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.add_timeout">
<code class="descclassname">IOLoop.</code><code class="descname">add_timeout</code><span class="sig-paren">(</span><em>deadline</em>, <em>callback</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.add_timeout"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.add_timeout" title="永久链接至目标">¶</a></dt>
<dd><p>Runs the <code class="docutils literal"><span class="pre">callback</span></code> at the time <code class="docutils literal"><span class="pre">deadline</span></code> from the I/O loop.</p>
<p>Returns an opaque handle that may be passed to
<a class="reference internal" href="#tornado.ioloop.IOLoop.remove_timeout" title="tornado.ioloop.IOLoop.remove_timeout"><code class="xref py py-obj docutils literal"><span class="pre">remove_timeout</span></code></a> to cancel.</p>
<p><code class="docutils literal"><span class="pre">deadline</span></code> may be a number denoting a time (on the same
scale as <a class="reference internal" href="#tornado.ioloop.IOLoop.time" title="tornado.ioloop.IOLoop.time"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.time</span></code></a>, normally <a class="reference external" href="https://docs.python.org/3.4/library/time.html#time.time" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">time.time</span></code></a>), or a
<a class="reference external" href="https://docs.python.org/3.4/library/datetime.html#datetime.timedelta" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">datetime.timedelta</span></code></a> object for a deadline relative to the
current time.  Since Tornado 4.0, <a class="reference internal" href="#tornado.ioloop.IOLoop.call_later" title="tornado.ioloop.IOLoop.call_later"><code class="xref py py-obj docutils literal"><span class="pre">call_later</span></code></a> is a more
convenient alternative for the relative case since it does not
require a timedelta object.</p>
<p>Note that it is not safe to call <a class="reference internal" href="#tornado.ioloop.IOLoop.add_timeout" title="tornado.ioloop.IOLoop.add_timeout"><code class="xref py py-obj docutils literal"><span class="pre">add_timeout</span></code></a> from other threads.
Instead, you must use <a class="reference internal" href="#tornado.ioloop.IOLoop.add_callback" title="tornado.ioloop.IOLoop.add_callback"><code class="xref py py-obj docutils literal"><span class="pre">add_callback</span></code></a> to transfer control to the
<a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>&#8216;s thread, and then call <a class="reference internal" href="#tornado.ioloop.IOLoop.add_timeout" title="tornado.ioloop.IOLoop.add_timeout"><code class="xref py py-obj docutils literal"><span class="pre">add_timeout</span></code></a> from there.</p>
<p>Subclasses of IOLoop must implement either <a class="reference internal" href="#tornado.ioloop.IOLoop.add_timeout" title="tornado.ioloop.IOLoop.add_timeout"><code class="xref py py-obj docutils literal"><span class="pre">add_timeout</span></code></a> or
<a class="reference internal" href="#tornado.ioloop.IOLoop.call_at" title="tornado.ioloop.IOLoop.call_at"><code class="xref py py-obj docutils literal"><span class="pre">call_at</span></code></a>; the default implementations of each will call
the other.  <a class="reference internal" href="#tornado.ioloop.IOLoop.call_at" title="tornado.ioloop.IOLoop.call_at"><code class="xref py py-obj docutils literal"><span class="pre">call_at</span></code></a> is usually easier to implement, but
subclasses that wish to maintain compatibility with Tornado
versions prior to 4.0 must use <a class="reference internal" href="#tornado.ioloop.IOLoop.add_timeout" title="tornado.ioloop.IOLoop.add_timeout"><code class="xref py py-obj docutils literal"><span class="pre">add_timeout</span></code></a> instead.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>Now passes through <code class="docutils literal"><span class="pre">*args</span></code> and <code class="docutils literal"><span class="pre">**kwargs</span></code> to the callback.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.call_at">
<code class="descclassname">IOLoop.</code><code class="descname">call_at</code><span class="sig-paren">(</span><em>when</em>, <em>callback</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.call_at"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.call_at" title="永久链接至目标">¶</a></dt>
<dd><p>Runs the <code class="docutils literal"><span class="pre">callback</span></code> at the absolute time designated by <code class="docutils literal"><span class="pre">when</span></code>.</p>
<p><code class="docutils literal"><span class="pre">when</span></code> must be a number using the same reference point as
<a class="reference internal" href="#tornado.ioloop.IOLoop.time" title="tornado.ioloop.IOLoop.time"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.time</span></code></a>.</p>
<p>Returns an opaque handle that may be passed to <a class="reference internal" href="#tornado.ioloop.IOLoop.remove_timeout" title="tornado.ioloop.IOLoop.remove_timeout"><code class="xref py py-obj docutils literal"><span class="pre">remove_timeout</span></code></a>
to cancel.  Note that unlike the <a class="reference external" href="https://docs.python.org/3.4/library/asyncio.html#module-asyncio" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">asyncio</span></code></a> method of the same
name, the returned object does not have a <code class="docutils literal"><span class="pre">cancel()</span></code> method.</p>
<p>See <a class="reference internal" href="#tornado.ioloop.IOLoop.add_timeout" title="tornado.ioloop.IOLoop.add_timeout"><code class="xref py py-obj docutils literal"><span class="pre">add_timeout</span></code></a> for comments on thread-safety and subclassing.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.call_later">
<code class="descclassname">IOLoop.</code><code class="descname">call_later</code><span class="sig-paren">(</span><em>delay</em>, <em>callback</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.call_later"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.call_later" title="永久链接至目标">¶</a></dt>
<dd><p>Runs the <code class="docutils literal"><span class="pre">callback</span></code> after <code class="docutils literal"><span class="pre">delay</span></code> seconds have passed.</p>
<p>Returns an opaque handle that may be passed to <a class="reference internal" href="#tornado.ioloop.IOLoop.remove_timeout" title="tornado.ioloop.IOLoop.remove_timeout"><code class="xref py py-obj docutils literal"><span class="pre">remove_timeout</span></code></a>
to cancel.  Note that unlike the <a class="reference external" href="https://docs.python.org/3.4/library/asyncio.html#module-asyncio" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">asyncio</span></code></a> method of the same
name, the returned object does not have a <code class="docutils literal"><span class="pre">cancel()</span></code> method.</p>
<p>See <a class="reference internal" href="#tornado.ioloop.IOLoop.add_timeout" title="tornado.ioloop.IOLoop.add_timeout"><code class="xref py py-obj docutils literal"><span class="pre">add_timeout</span></code></a> for comments on thread-safety and subclassing.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.remove_timeout">
<code class="descclassname">IOLoop.</code><code class="descname">remove_timeout</code><span class="sig-paren">(</span><em>timeout</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.remove_timeout"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.remove_timeout" title="永久链接至目标">¶</a></dt>
<dd><p>Cancels a pending timeout.</p>
<p>The argument is a handle as returned by <a class="reference internal" href="#tornado.ioloop.IOLoop.add_timeout" title="tornado.ioloop.IOLoop.add_timeout"><code class="xref py py-obj docutils literal"><span class="pre">add_timeout</span></code></a>.  It is
safe to call <a class="reference internal" href="#tornado.ioloop.IOLoop.remove_timeout" title="tornado.ioloop.IOLoop.remove_timeout"><code class="xref py py-obj docutils literal"><span class="pre">remove_timeout</span></code></a> even if the callback has already
been run.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.spawn_callback">
<code class="descclassname">IOLoop.</code><code class="descname">spawn_callback</code><span class="sig-paren">(</span><em>callback</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.spawn_callback"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.spawn_callback" title="永久链接至目标">¶</a></dt>
<dd><p>Calls the given callback on the next IOLoop iteration.</p>
<p>Unlike all other callback-related methods on IOLoop,
<code class="docutils literal"><span class="pre">spawn_callback</span></code> does not associate the callback with its caller&#8217;s
<code class="docutils literal"><span class="pre">stack_context</span></code>, so it is suitable for fire-and-forget callbacks
that should not interfere with the caller.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.time">
<code class="descclassname">IOLoop.</code><code class="descname">time</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.time"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.time" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the current time according to the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>&#8216;s clock.</p>
<p>The return value is a floating-point number relative to an
unspecified time in the past.</p>
<p>By default, the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>&#8216;s time function is <a class="reference external" href="https://docs.python.org/3.4/library/time.html#time.time" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">time.time</span></code></a>.  However,
it may be configured to use e.g. <a class="reference external" href="https://docs.python.org/3.4/library/time.html#time.monotonic" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">time.monotonic</span></code></a> instead.
Calls to <a class="reference internal" href="#tornado.ioloop.IOLoop.add_timeout" title="tornado.ioloop.IOLoop.add_timeout"><code class="xref py py-obj docutils literal"><span class="pre">add_timeout</span></code></a> that pass a number instead of a
<a class="reference external" href="https://docs.python.org/3.4/library/datetime.html#datetime.timedelta" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">datetime.timedelta</span></code></a> should use this function to compute the
appropriate time, so they can work no matter what time function
is chosen.</p>
</dd></dl>

<dl class="class">
<dt id="tornado.ioloop.PeriodicCallback">
<em class="property">class </em><code class="descclassname">tornado.ioloop.</code><code class="descname">PeriodicCallback</code><span class="sig-paren">(</span><em>callback</em>, <em>callback_time</em>, <em>io_loop=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#PeriodicCallback"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.PeriodicCallback" title="永久链接至目标">¶</a></dt>
<dd><p>Schedules the given callback to be called periodically.</p>
<p>The callback is called every <code class="docutils literal"><span class="pre">callback_time</span></code> milliseconds.
Note that the timeout is given in milliseconds, while most other
time-related functions in Tornado use seconds.</p>
<p>If the callback runs for longer than <code class="docutils literal"><span class="pre">callback_time</span></code> milliseconds,
subsequent invocations will be skipped to get back on schedule.</p>
<p><a class="reference internal" href="#tornado.ioloop.PeriodicCallback.start" title="tornado.ioloop.PeriodicCallback.start"><code class="xref py py-obj docutils literal"><span class="pre">start</span></code></a> must be called after the <a class="reference internal" href="#tornado.ioloop.PeriodicCallback" title="tornado.ioloop.PeriodicCallback"><code class="xref py py-obj docutils literal"><span class="pre">PeriodicCallback</span></code></a> is created.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>The <code class="docutils literal"><span class="pre">io_loop</span></code> argument is deprecated.</p>
</div>
<dl class="method">
<dt id="tornado.ioloop.PeriodicCallback.start">
<code class="descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#PeriodicCallback.start"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.PeriodicCallback.start" title="永久链接至目标">¶</a></dt>
<dd><p>Starts the timer.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.PeriodicCallback.stop">
<code class="descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#PeriodicCallback.stop"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.PeriodicCallback.stop" title="永久链接至目标">¶</a></dt>
<dd><p>Stops the timer.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.PeriodicCallback.is_running">
<code class="descname">is_running</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#PeriodicCallback.is_running"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.PeriodicCallback.is_running" title="永久链接至目标">¶</a></dt>
<dd><p>Return True if this <a class="reference internal" href="#tornado.ioloop.PeriodicCallback" title="tornado.ioloop.PeriodicCallback"><code class="xref py py-obj docutils literal"><span class="pre">PeriodicCallback</span></code></a> has been started.</p>
<div class="versionadded">
<p><span class="versionmodified">4.1 新版功能.</span></p>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="debugging-and-error-handling">
<h6>Debugging and error handling<a class="headerlink" href="#debugging-and-error-handling" title="永久链接至标题">¶</a></h6>
<dl class="method">
<dt id="tornado.ioloop.IOLoop.handle_callback_exception">
<code class="descclassname">IOLoop.</code><code class="descname">handle_callback_exception</code><span class="sig-paren">(</span><em>callback</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.handle_callback_exception"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.handle_callback_exception" title="永久链接至目标">¶</a></dt>
<dd><p>This method is called whenever a callback run by the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>
throws an exception.</p>
<p>By default simply logs the exception as an error.  Subclasses
may override this method to customize reporting of exceptions.</p>
<p>The exception itself is not passed explicitly, but is available
in <a class="reference external" href="https://docs.python.org/3.4/library/sys.html#sys.exc_info" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">sys.exc_info</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.set_blocking_signal_threshold">
<code class="descclassname">IOLoop.</code><code class="descname">set_blocking_signal_threshold</code><span class="sig-paren">(</span><em>seconds</em>, <em>action</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.set_blocking_signal_threshold"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.set_blocking_signal_threshold" title="永久链接至目标">¶</a></dt>
<dd><p>Sends a signal if the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> is blocked for more than
<code class="docutils literal"><span class="pre">s</span></code> seconds.</p>
<p>Pass <code class="docutils literal"><span class="pre">seconds=None</span></code> to disable.  Requires Python 2.6 on a unixy
platform.</p>
<p>The action parameter is a Python signal handler.  Read the
documentation for the <a class="reference external" href="https://docs.python.org/3.4/library/signal.html#module-signal" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">signal</span></code></a> module for more information.
If <code class="docutils literal"><span class="pre">action</span></code> is None, the process will be killed if it is
blocked for too long.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.set_blocking_log_threshold">
<code class="descclassname">IOLoop.</code><code class="descname">set_blocking_log_threshold</code><span class="sig-paren">(</span><em>seconds</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.set_blocking_log_threshold"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.set_blocking_log_threshold" title="永久链接至目标">¶</a></dt>
<dd><p>Logs a stack trace if the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> is blocked for more than
<code class="docutils literal"><span class="pre">s</span></code> seconds.</p>
<p>Equivalent to <code class="docutils literal"><span class="pre">set_blocking_signal_threshold(seconds,</span>
<span class="pre">self.log_stack)</span></code></p>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.log_stack">
<code class="descclassname">IOLoop.</code><code class="descname">log_stack</code><span class="sig-paren">(</span><em>signal</em>, <em>frame</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.log_stack"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.log_stack" title="永久链接至目标">¶</a></dt>
<dd><p>Signal handler to log the stack trace of the current thread.</p>
<p>For use with <a class="reference internal" href="#tornado.ioloop.IOLoop.set_blocking_signal_threshold" title="tornado.ioloop.IOLoop.set_blocking_signal_threshold"><code class="xref py py-obj docutils literal"><span class="pre">set_blocking_signal_threshold</span></code></a>.</p>
</dd></dl>

</div>
<div class="section" id="methods-for-subclasses">
<h6>Methods for subclasses<a class="headerlink" href="#methods-for-subclasses" title="永久链接至标题">¶</a></h6>
<dl class="method">
<dt id="tornado.ioloop.IOLoop.initialize">
<code class="descclassname">IOLoop.</code><code class="descname">initialize</code><span class="sig-paren">(</span><em>make_current=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.initialize"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.initialize" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.close_fd">
<code class="descclassname">IOLoop.</code><code class="descname">close_fd</code><span class="sig-paren">(</span><em>fd</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.close_fd"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.close_fd" title="永久链接至目标">¶</a></dt>
<dd><p>Utility method to close an <code class="docutils literal"><span class="pre">fd</span></code>.</p>
<p>If <code class="docutils literal"><span class="pre">fd</span></code> is a file-like object, we close it directly; otherwise
we use <a class="reference external" href="https://docs.python.org/3.4/library/os.html#os.close" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">os.close</span></code></a>.</p>
<p>This method is provided for use by <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> subclasses (in
implementations of <code class="docutils literal"><span class="pre">IOLoop.close(all_fds=True)</span></code> and should
not generally be used by application code.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.ioloop.IOLoop.split_fd">
<code class="descclassname">IOLoop.</code><code class="descname">split_fd</code><span class="sig-paren">(</span><em>fd</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/ioloop.html#IOLoop.split_fd"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.ioloop.IOLoop.split_fd" title="永久链接至目标">¶</a></dt>
<dd><p>Returns an (fd, obj) pair from an <code class="docutils literal"><span class="pre">fd</span></code> parameter.</p>
<p>We accept both raw file descriptors and file-like objects as
input to <a class="reference internal" href="#tornado.ioloop.IOLoop.add_handler" title="tornado.ioloop.IOLoop.add_handler"><code class="xref py py-obj docutils literal"><span class="pre">add_handler</span></code></a> and related methods.  When a file-like
object is passed, we must retain the object itself so we can
close it correctly when the <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> shuts down, but the
poller interfaces favor file descriptors (they will accept
file-like objects and call <code class="docutils literal"><span class="pre">fileno()</span></code> for you, but they
always return the descriptor itself).</p>
<p>This method is provided for use by <a class="reference internal" href="#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> subclasses and should
not generally be used by application code.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
</dd></dl>

</div>
</div>
</div>
<span id="document-iostream"></span><div class="section" id="module-tornado.iostream">
<span id="tornado-iostream-convenient-wrappers-for-non-blocking-sockets"></span><h4><code class="docutils literal"><span class="pre">tornado.iostream</span></code> &#8212; Convenient wrappers for non-blocking sockets<a class="headerlink" href="#module-tornado.iostream" title="永久链接至标题">¶</a></h4>
<p>Utility classes to write to and read from non-blocking files and sockets.</p>
<p>Contents:</p>
<ul class="simple">
<li><a class="reference internal" href="#tornado.iostream.BaseIOStream" title="tornado.iostream.BaseIOStream"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream</span></code></a>: Generic interface for reading and writing.</li>
<li><a class="reference internal" href="#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a>: Implementation of BaseIOStream using non-blocking sockets.</li>
<li><a class="reference internal" href="#tornado.iostream.SSLIOStream" title="tornado.iostream.SSLIOStream"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream</span></code></a>: SSL-aware version of IOStream.</li>
<li><a class="reference internal" href="#tornado.iostream.PipeIOStream" title="tornado.iostream.PipeIOStream"><code class="xref py py-obj docutils literal"><span class="pre">PipeIOStream</span></code></a>: Pipe-based IOStream implementation.</li>
</ul>
<div class="section" id="base-class">
<h5>Base class<a class="headerlink" href="#base-class" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.iostream.BaseIOStream">
<em class="property">class </em><code class="descclassname">tornado.iostream.</code><code class="descname">BaseIOStream</code><span class="sig-paren">(</span><em>io_loop=None</em>, <em>max_buffer_size=None</em>, <em>read_chunk_size=None</em>, <em>max_write_buffer_size=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream" title="永久链接至目标">¶</a></dt>
<dd><p>A utility class to write to and read from a non-blocking file or socket.</p>
<p>We support a non-blocking <code class="docutils literal"><span class="pre">write()</span></code> and a family of <code class="docutils literal"><span class="pre">read_*()</span></code> methods.
All of the methods take an optional <code class="docutils literal"><span class="pre">callback</span></code> argument and return a
<a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> only if no callback is given.  When the operation completes,
the callback will be run or the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> will resolve with the data
read (or <code class="docutils literal"><span class="pre">None</span></code> for <code class="docutils literal"><span class="pre">write()</span></code>).  All outstanding <code class="docutils literal"><span class="pre">Futures</span></code> will
resolve with a <a class="reference internal" href="#tornado.iostream.StreamClosedError" title="tornado.iostream.StreamClosedError"><code class="xref py py-obj docutils literal"><span class="pre">StreamClosedError</span></code></a> when the stream is closed; users
of the callback interface will be notified via
<a class="reference internal" href="#tornado.iostream.BaseIOStream.set_close_callback" title="tornado.iostream.BaseIOStream.set_close_callback"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream.set_close_callback</span></code></a> instead.</p>
<p>When a stream is closed due to an error, the IOStream&#8217;s <code class="docutils literal"><span class="pre">error</span></code>
attribute contains the exception object.</p>
<p>Subclasses must implement <a class="reference internal" href="#tornado.iostream.BaseIOStream.fileno" title="tornado.iostream.BaseIOStream.fileno"><code class="xref py py-obj docutils literal"><span class="pre">fileno</span></code></a>, <a class="reference internal" href="#tornado.iostream.BaseIOStream.close_fd" title="tornado.iostream.BaseIOStream.close_fd"><code class="xref py py-obj docutils literal"><span class="pre">close_fd</span></code></a>, <a class="reference internal" href="#tornado.iostream.BaseIOStream.write_to_fd" title="tornado.iostream.BaseIOStream.write_to_fd"><code class="xref py py-obj docutils literal"><span class="pre">write_to_fd</span></code></a>,
<a class="reference internal" href="#tornado.iostream.BaseIOStream.read_from_fd" title="tornado.iostream.BaseIOStream.read_from_fd"><code class="xref py py-obj docutils literal"><span class="pre">read_from_fd</span></code></a>, and optionally <a class="reference internal" href="#tornado.iostream.BaseIOStream.get_fd_error" title="tornado.iostream.BaseIOStream.get_fd_error"><code class="xref py py-obj docutils literal"><span class="pre">get_fd_error</span></code></a>.</p>
<p><a class="reference internal" href="#tornado.iostream.BaseIOStream" title="tornado.iostream.BaseIOStream"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream</span></code></a> constructor.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>io_loop</strong> &#8211; The <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> to use; defaults to <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.current" title="tornado.ioloop.IOLoop.current"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.current</span></code></a>.
Deprecated since Tornado 4.1.</li>
<li><strong>max_buffer_size</strong> &#8211; Maximum amount of incoming data to buffer;
defaults to 100MB.</li>
<li><strong>read_chunk_size</strong> &#8211; Amount of data to read at one time from the
underlying transport; defaults to 64KB.</li>
<li><strong>max_write_buffer_size</strong> &#8211; Amount of outgoing data to buffer;
defaults to unlimited.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>Add the <code class="docutils literal"><span class="pre">max_write_buffer_size</span></code> parameter.  Changed default
<code class="docutils literal"><span class="pre">read_chunk_size</span></code> to 64KB.</p>
</div>
</dd></dl>

<div class="section" id="main-interface">
<h6>Main interface<a class="headerlink" href="#main-interface" title="永久链接至标题">¶</a></h6>
<dl class="method">
<dt id="tornado.iostream.BaseIOStream.write">
<code class="descclassname">BaseIOStream.</code><code class="descname">write</code><span class="sig-paren">(</span><em>data</em>, <em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.write"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.write" title="永久链接至目标">¶</a></dt>
<dd><p>Asynchronously write the given data to this stream.</p>
<p>If <code class="docutils literal"><span class="pre">callback</span></code> is given, we call it when all of the buffered write
data has been successfully written to the stream. If there was
previously buffered write data and an old write callback, that
callback is simply overwritten with this new callback.</p>
<p>If no <code class="docutils literal"><span class="pre">callback</span></code> is given, this method returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> that
resolves (with a result of <code class="docutils literal"><span class="pre">None</span></code>) when the write has been
completed.  If <a class="reference internal" href="#tornado.iostream.BaseIOStream.write" title="tornado.iostream.BaseIOStream.write"><code class="xref py py-obj docutils literal"><span class="pre">write</span></code></a> is called again before that <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> has
resolved, the previous future will be orphaned and will never resolve.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>Now returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> if no callback is given.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.BaseIOStream.read_bytes">
<code class="descclassname">BaseIOStream.</code><code class="descname">read_bytes</code><span class="sig-paren">(</span><em>num_bytes</em>, <em>callback=None</em>, <em>streaming_callback=None</em>, <em>partial=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.read_bytes"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.read_bytes" title="永久链接至目标">¶</a></dt>
<dd><p>Asynchronously read a number of bytes.</p>
<p>If a <code class="docutils literal"><span class="pre">streaming_callback</span></code> is given, it will be called with chunks
of data as they become available, and the final result will be empty.
Otherwise, the result is all the data that was read.
If a callback is given, it will be run with the data as an argument;
if not, this method returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.</p>
<p>If <code class="docutils literal"><span class="pre">partial</span></code> is true, the callback is run as soon as we have
any bytes to return (but never more than <code class="docutils literal"><span class="pre">num_bytes</span></code>)</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>Added the <code class="docutils literal"><span class="pre">partial</span></code> argument.  The callback argument is now
optional and a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> will be returned if it is omitted.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.BaseIOStream.read_until">
<code class="descclassname">BaseIOStream.</code><code class="descname">read_until</code><span class="sig-paren">(</span><em>delimiter</em>, <em>callback=None</em>, <em>max_bytes=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.read_until"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.read_until" title="永久链接至目标">¶</a></dt>
<dd><p>Asynchronously read until we have found the given delimiter.</p>
<p>The result includes all the data read including the delimiter.
If a callback is given, it will be run with the data as an argument;
if not, this method returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.</p>
<p>If <code class="docutils literal"><span class="pre">max_bytes</span></code> is not None, the connection will be closed
if more than <code class="docutils literal"><span class="pre">max_bytes</span></code> bytes have been read and the delimiter
is not found.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>Added the <code class="docutils literal"><span class="pre">max_bytes</span></code> argument.  The <code class="docutils literal"><span class="pre">callback</span></code> argument is
now optional and a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> will be returned if it is omitted.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.BaseIOStream.read_until_regex">
<code class="descclassname">BaseIOStream.</code><code class="descname">read_until_regex</code><span class="sig-paren">(</span><em>regex</em>, <em>callback=None</em>, <em>max_bytes=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.read_until_regex"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.read_until_regex" title="永久链接至目标">¶</a></dt>
<dd><p>Asynchronously read until we have matched the given regex.</p>
<p>The result includes the data that matches the regex and anything
that came before it.  If a callback is given, it will be run
with the data as an argument; if not, this method returns a
<a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.</p>
<p>If <code class="docutils literal"><span class="pre">max_bytes</span></code> is not None, the connection will be closed
if more than <code class="docutils literal"><span class="pre">max_bytes</span></code> bytes have been read and the regex is
not satisfied.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>Added the <code class="docutils literal"><span class="pre">max_bytes</span></code> argument.  The <code class="docutils literal"><span class="pre">callback</span></code> argument is
now optional and a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> will be returned if it is omitted.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.BaseIOStream.read_until_close">
<code class="descclassname">BaseIOStream.</code><code class="descname">read_until_close</code><span class="sig-paren">(</span><em>callback=None</em>, <em>streaming_callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.read_until_close"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.read_until_close" title="永久链接至目标">¶</a></dt>
<dd><p>Asynchronously reads all data from the socket until it is closed.</p>
<p>If a <code class="docutils literal"><span class="pre">streaming_callback</span></code> is given, it will be called with chunks
of data as they become available, and the final result will be empty.
Otherwise, the result is all the data that was read.
If a callback is given, it will be run with the data as an argument;
if not, this method returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.</p>
<p>Note that if a <code class="docutils literal"><span class="pre">streaming_callback</span></code> is used, data will be
read from the socket as quickly as it becomes available; there
is no way to apply backpressure or cancel the reads. If flow
control or cancellation are desired, use a loop with
<a class="reference internal" href="#tornado.iostream.BaseIOStream.read_bytes" title="tornado.iostream.BaseIOStream.read_bytes"><code class="xref py py-obj docutils literal"><span class="pre">read_bytes(partial=True)</span></code></a> instead.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>The callback argument is now optional and a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> will
be returned if it is omitted.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.BaseIOStream.close">
<code class="descclassname">BaseIOStream.</code><code class="descname">close</code><span class="sig-paren">(</span><em>exc_info=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.close"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.close" title="永久链接至目标">¶</a></dt>
<dd><p>Close this stream.</p>
<p>If <code class="docutils literal"><span class="pre">exc_info</span></code> is true, set the <code class="docutils literal"><span class="pre">error</span></code> attribute to the current
exception from <a class="reference external" href="https://docs.python.org/3.4/library/sys.html#sys.exc_info" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">sys.exc_info</span></code></a> (or if <code class="docutils literal"><span class="pre">exc_info</span></code> is a tuple,
use that instead of <a class="reference external" href="https://docs.python.org/3.4/library/sys.html#sys.exc_info" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">sys.exc_info</span></code></a>).</p>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.BaseIOStream.set_close_callback">
<code class="descclassname">BaseIOStream.</code><code class="descname">set_close_callback</code><span class="sig-paren">(</span><em>callback</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.set_close_callback"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.set_close_callback" title="永久链接至目标">¶</a></dt>
<dd><p>Call the given callback when the stream is closed.</p>
<p>This is not necessary for applications that use the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>
interface; all outstanding <code class="docutils literal"><span class="pre">Futures</span></code> will resolve with a
<a class="reference internal" href="#tornado.iostream.StreamClosedError" title="tornado.iostream.StreamClosedError"><code class="xref py py-obj docutils literal"><span class="pre">StreamClosedError</span></code></a> when the stream is closed.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.BaseIOStream.closed">
<code class="descclassname">BaseIOStream.</code><code class="descname">closed</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.closed"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.closed" title="永久链接至目标">¶</a></dt>
<dd><p>Returns true if the stream has been closed.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.BaseIOStream.reading">
<code class="descclassname">BaseIOStream.</code><code class="descname">reading</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.reading"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.reading" title="永久链接至目标">¶</a></dt>
<dd><p>Returns true if we are currently reading from the stream.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.BaseIOStream.writing">
<code class="descclassname">BaseIOStream.</code><code class="descname">writing</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.writing"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.writing" title="永久链接至目标">¶</a></dt>
<dd><p>Returns true if we are currently writing to the stream.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.BaseIOStream.set_nodelay">
<code class="descclassname">BaseIOStream.</code><code class="descname">set_nodelay</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.set_nodelay"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.set_nodelay" title="永久链接至目标">¶</a></dt>
<dd><p>Sets the no-delay flag for this stream.</p>
<p>By default, data written to TCP streams may be held for a time
to make the most efficient use of bandwidth (according to
Nagle&#8217;s algorithm).  The no-delay flag requests that data be
written as soon as possible, even if doing so would consume
additional bandwidth.</p>
<p>This flag is currently defined only for TCP-based <code class="docutils literal"><span class="pre">IOStreams</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="methods-for-subclasses">
<h6>Methods for subclasses<a class="headerlink" href="#methods-for-subclasses" title="永久链接至标题">¶</a></h6>
<dl class="method">
<dt id="tornado.iostream.BaseIOStream.fileno">
<code class="descclassname">BaseIOStream.</code><code class="descname">fileno</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.fileno"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.fileno" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the file descriptor for this stream.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.BaseIOStream.close_fd">
<code class="descclassname">BaseIOStream.</code><code class="descname">close_fd</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.close_fd"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.close_fd" title="永久链接至目标">¶</a></dt>
<dd><p>Closes the file underlying this stream.</p>
<p><code class="docutils literal"><span class="pre">close_fd</span></code> is called by <a class="reference internal" href="#tornado.iostream.BaseIOStream" title="tornado.iostream.BaseIOStream"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream</span></code></a> and should not be called
elsewhere; other users should call <a class="reference internal" href="#tornado.iostream.BaseIOStream.close" title="tornado.iostream.BaseIOStream.close"><code class="xref py py-obj docutils literal"><span class="pre">close</span></code></a> instead.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.BaseIOStream.write_to_fd">
<code class="descclassname">BaseIOStream.</code><code class="descname">write_to_fd</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.write_to_fd"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.write_to_fd" title="永久链接至目标">¶</a></dt>
<dd><p>Attempts to write <code class="docutils literal"><span class="pre">data</span></code> to the underlying file.</p>
<p>Returns the number of bytes written.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.BaseIOStream.read_from_fd">
<code class="descclassname">BaseIOStream.</code><code class="descname">read_from_fd</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.read_from_fd"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.read_from_fd" title="永久链接至目标">¶</a></dt>
<dd><p>Attempts to read from the underlying file.</p>
<p>Returns <code class="docutils literal"><span class="pre">None</span></code> if there was nothing to read (the socket
returned <a class="reference external" href="https://docs.python.org/3.4/library/errno.html#errno.EWOULDBLOCK" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">EWOULDBLOCK</span></code></a> or equivalent), otherwise
returns the data.  When possible, should return no more than
<code class="docutils literal"><span class="pre">self.read_chunk_size</span></code> bytes at a time.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.BaseIOStream.get_fd_error">
<code class="descclassname">BaseIOStream.</code><code class="descname">get_fd_error</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#BaseIOStream.get_fd_error"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.BaseIOStream.get_fd_error" title="永久链接至目标">¶</a></dt>
<dd><p>Returns information about any error on the underlying file.</p>
<p>This method is called after the <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> has signaled an error on the
file descriptor, and should return an Exception (such as <a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.error" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">socket.error</span></code></a>
with additional information, or None if no such information is
available.</p>
</dd></dl>

</div>
</div>
<div class="section" id="implementations">
<h5>Implementations<a class="headerlink" href="#implementations" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.iostream.IOStream">
<em class="property">class </em><code class="descclassname">tornado.iostream.</code><code class="descname">IOStream</code><span class="sig-paren">(</span><em>socket</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#IOStream"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.IOStream" title="永久链接至目标">¶</a></dt>
<dd><p>Socket-based <a class="reference internal" href="#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> implementation.</p>
<p>This class supports the read and write methods from <a class="reference internal" href="#tornado.iostream.BaseIOStream" title="tornado.iostream.BaseIOStream"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream</span></code></a>
plus a <a class="reference internal" href="#tornado.iostream.IOStream.connect" title="tornado.iostream.IOStream.connect"><code class="xref py py-obj docutils literal"><span class="pre">connect</span></code></a> method.</p>
<p>The <code class="docutils literal"><span class="pre">socket</span></code> parameter may either be connected or unconnected.
For server operations the socket is the result of calling
<a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.socket.accept" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">socket.accept</span></code></a>.  For client operations the
socket is created with <a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.socket" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">socket.socket</span></code></a>, and may either be
connected before passing it to the <a class="reference internal" href="#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> or connected with
<a class="reference internal" href="#tornado.iostream.IOStream.connect" title="tornado.iostream.IOStream.connect"><code class="xref py py-obj docutils literal"><span class="pre">IOStream.connect</span></code></a>.</p>
<p>A very simple (and broken) HTTP client using this class:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tornado.ioloop</span>
<span class="kn">import</span> <span class="nn">tornado.iostream</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="k">def</span> <span class="nf">send_request</span><span class="p">():</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;GET / HTTP/1.0</span><span class="se">\r\n</span><span class="s2">Host: friendfeed.com</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">on_headers</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">on_headers</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">):</span>
       <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
       <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
           <span class="n">headers</span><span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">]),</span> <span class="n">on_body</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">on_body</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">tornado</span><span class="o">.</span><span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">stream</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">iostream</span><span class="o">.</span><span class="n">IOStream</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s2">&quot;friendfeed.com&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="n">send_request</span><span class="p">)</span>
    <span class="n">tornado</span><span class="o">.</span><span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="tornado.iostream.IOStream.connect">
<code class="descname">connect</code><span class="sig-paren">(</span><em>address</em>, <em>callback=None</em>, <em>server_hostname=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#IOStream.connect"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.IOStream.connect" title="永久链接至目标">¶</a></dt>
<dd><p>Connects the socket to a remote address without blocking.</p>
<p>May only be called if the socket passed to the constructor was
not previously connected.  The address parameter is in the
same format as for <a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.socket.connect" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">socket.connect</span></code></a> for
the type of socket passed to the IOStream constructor,
e.g. an <code class="docutils literal"><span class="pre">(ip,</span> <span class="pre">port)</span></code> tuple.  Hostnames are accepted here,
but will be resolved synchronously and block the IOLoop.
If you have a hostname instead of an IP address, the <a class="reference internal" href="index.html#tornado.tcpclient.TCPClient" title="tornado.tcpclient.TCPClient"><code class="xref py py-obj docutils literal"><span class="pre">TCPClient</span></code></a>
class is recommended instead of calling this method directly.
<a class="reference internal" href="index.html#tornado.tcpclient.TCPClient" title="tornado.tcpclient.TCPClient"><code class="xref py py-obj docutils literal"><span class="pre">TCPClient</span></code></a> will do asynchronous DNS resolution and handle
both IPv4 and IPv6.</p>
<p>If <code class="docutils literal"><span class="pre">callback</span></code> is specified, it will be called with no
arguments when the connection is completed; if not this method
returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> (whose result after a successful
connection will be the stream itself).</p>
<p>In SSL mode, the <code class="docutils literal"><span class="pre">server_hostname</span></code> parameter will be used
for certificate validation (unless disabled in the
<code class="docutils literal"><span class="pre">ssl_options</span></code>) and SNI (if supported; requires Python
2.7.9+).</p>
<p>Note that it is safe to call <a class="reference internal" href="#tornado.iostream.BaseIOStream.write" title="tornado.iostream.BaseIOStream.write"><code class="xref py py-obj docutils literal"><span class="pre">IOStream.write</span></code></a> while the connection is pending, in
which case the data will be written as soon as the connection
is ready.  Calling <a class="reference internal" href="#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> read methods before the socket is
connected works on some platforms but is non-portable.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>If no callback is given, returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.2 版更改: </span>SSL certificates are validated by default; pass
<code class="docutils literal"><span class="pre">ssl_options=dict(cert_reqs=ssl.CERT_NONE)</span></code> or a
suitably-configured <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.SSLContext</span></code></a> to the
<a class="reference internal" href="#tornado.iostream.SSLIOStream" title="tornado.iostream.SSLIOStream"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream</span></code></a> constructor to disable.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.iostream.IOStream.start_tls">
<code class="descname">start_tls</code><span class="sig-paren">(</span><em>server_side</em>, <em>ssl_options=None</em>, <em>server_hostname=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#IOStream.start_tls"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.IOStream.start_tls" title="永久链接至目标">¶</a></dt>
<dd><p>Convert this <a class="reference internal" href="#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> to an <a class="reference internal" href="#tornado.iostream.SSLIOStream" title="tornado.iostream.SSLIOStream"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream</span></code></a>.</p>
<p>This enables protocols that begin in clear-text mode and
switch to SSL after some initial negotiation (such as the
<code class="docutils literal"><span class="pre">STARTTLS</span></code> extension to SMTP and IMAP).</p>
<p>This method cannot be used if there are outstanding reads
or writes on the stream, or if there is any data in the
IOStream&#8217;s buffer (data in the operating system&#8217;s socket
buffer is allowed).  This means it must generally be used
immediately after reading or writing the last clear-text
data.  It can also be used immediately after connecting,
before any reads or writes.</p>
<p>The <code class="docutils literal"><span class="pre">ssl_options</span></code> argument may be either an <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.SSLContext</span></code></a>
object or a dictionary of keyword arguments for the
<a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.wrap_socket" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.wrap_socket</span></code></a> function.  The <code class="docutils literal"><span class="pre">server_hostname</span></code> argument
will be used for certificate validation unless disabled
in the <code class="docutils literal"><span class="pre">ssl_options</span></code>.</p>
<p>This method returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> whose result is the new
<a class="reference internal" href="#tornado.iostream.SSLIOStream" title="tornado.iostream.SSLIOStream"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream</span></code></a>.  After this method has been called,
any other operation on the original stream is undefined.</p>
<p>If a close callback is defined on this stream, it will be
transferred to the new stream.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.2 版更改: </span>SSL certificates are validated by default; pass
<code class="docutils literal"><span class="pre">ssl_options=dict(cert_reqs=ssl.CERT_NONE)</span></code> or a
suitably-configured <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.SSLContext</span></code></a> to disable.</p>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.iostream.SSLIOStream">
<em class="property">class </em><code class="descclassname">tornado.iostream.</code><code class="descname">SSLIOStream</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#SSLIOStream"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.SSLIOStream" title="永久链接至目标">¶</a></dt>
<dd><p>A utility class to write to and read from a non-blocking SSL socket.</p>
<p>If the socket passed to the constructor is already connected,
it should be wrapped with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ssl</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">do_handshake_on_connect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>before constructing the <a class="reference internal" href="#tornado.iostream.SSLIOStream" title="tornado.iostream.SSLIOStream"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream</span></code></a>.  Unconnected sockets will be
wrapped when <a class="reference internal" href="#tornado.iostream.IOStream.connect" title="tornado.iostream.IOStream.connect"><code class="xref py py-obj docutils literal"><span class="pre">IOStream.connect</span></code></a> is finished.</p>
<p>The <code class="docutils literal"><span class="pre">ssl_options</span></code> keyword argument may either be an
<a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.SSLContext</span></code></a> object or a dictionary of keywords arguments
for <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.wrap_socket" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.wrap_socket</span></code></a></p>
<dl class="method">
<dt id="tornado.iostream.SSLIOStream.wait_for_handshake">
<code class="descname">wait_for_handshake</code><span class="sig-paren">(</span><em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#SSLIOStream.wait_for_handshake"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.SSLIOStream.wait_for_handshake" title="永久链接至目标">¶</a></dt>
<dd><p>Wait for the initial SSL handshake to complete.</p>
<p>If a <code class="docutils literal"><span class="pre">callback</span></code> is given, it will be called with no
arguments once the handshake is complete; otherwise this
method returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> which will resolve to the
stream itself after the handshake is complete.</p>
<p>Once the handshake is complete, information such as
the peer&#8217;s certificate and NPN/ALPN selections may be
accessed on <code class="docutils literal"><span class="pre">self.socket</span></code>.</p>
<p>This method is intended for use on server-side streams
or after using <a class="reference internal" href="#tornado.iostream.IOStream.start_tls" title="tornado.iostream.IOStream.start_tls"><code class="xref py py-obj docutils literal"><span class="pre">IOStream.start_tls</span></code></a>; it should not be used
with <a class="reference internal" href="#tornado.iostream.IOStream.connect" title="tornado.iostream.IOStream.connect"><code class="xref py py-obj docutils literal"><span class="pre">IOStream.connect</span></code></a> (which already waits for the
handshake to complete). It may only be called once per stream.</p>
<div class="versionadded">
<p><span class="versionmodified">4.2 新版功能.</span></p>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.iostream.PipeIOStream">
<em class="property">class </em><code class="descclassname">tornado.iostream.</code><code class="descname">PipeIOStream</code><span class="sig-paren">(</span><em>fd</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#PipeIOStream"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.PipeIOStream" title="永久链接至目标">¶</a></dt>
<dd><p>Pipe-based <a class="reference internal" href="#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> implementation.</p>
<p>The constructor takes an integer file descriptor (such as one returned
by <a class="reference external" href="https://docs.python.org/3.4/library/os.html#os.pipe" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">os.pipe</span></code></a>) rather than an open file object.  Pipes are generally
one-way, so a <a class="reference internal" href="#tornado.iostream.PipeIOStream" title="tornado.iostream.PipeIOStream"><code class="xref py py-obj docutils literal"><span class="pre">PipeIOStream</span></code></a> can be used for reading or writing but not
both.</p>
</dd></dl>

</div>
<div class="section" id="exceptions">
<h5>Exceptions<a class="headerlink" href="#exceptions" title="永久链接至标题">¶</a></h5>
<dl class="exception">
<dt id="tornado.iostream.StreamBufferFullError">
<em class="property">exception </em><code class="descclassname">tornado.iostream.</code><code class="descname">StreamBufferFullError</code><a class="reference internal" href="_modules/tornado/iostream.html#StreamBufferFullError"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.StreamBufferFullError" title="永久链接至目标">¶</a></dt>
<dd><p>Exception raised by <a class="reference internal" href="#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> methods when the buffer is full.</p>
</dd></dl>

<dl class="exception">
<dt id="tornado.iostream.StreamClosedError">
<em class="property">exception </em><code class="descclassname">tornado.iostream.</code><code class="descname">StreamClosedError</code><span class="sig-paren">(</span><em>real_error=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/iostream.html#StreamClosedError"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.StreamClosedError" title="永久链接至目标">¶</a></dt>
<dd><p>Exception raised by <a class="reference internal" href="#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> methods when the stream is closed.</p>
<p>Note that the close callback is scheduled to run <em>after</em> other
callbacks on the stream (to allow for buffered data to be processed),
so you may see this error before you see the close callback.</p>
<p>The <code class="docutils literal"><span class="pre">real_error</span></code> attribute contains the underlying error that caused
the stream to close (if any).</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>Added the <code class="docutils literal"><span class="pre">real_error</span></code> attribute.</p>
</div>
</dd></dl>

<dl class="exception">
<dt id="tornado.iostream.UnsatisfiableReadError">
<em class="property">exception </em><code class="descclassname">tornado.iostream.</code><code class="descname">UnsatisfiableReadError</code><a class="reference internal" href="_modules/tornado/iostream.html#UnsatisfiableReadError"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.iostream.UnsatisfiableReadError" title="永久链接至目标">¶</a></dt>
<dd><p>Exception raised when a read cannot be satisfied.</p>
<p>Raised by <code class="docutils literal"><span class="pre">read_until</span></code> and <code class="docutils literal"><span class="pre">read_until_regex</span></code> with a <code class="docutils literal"><span class="pre">max_bytes</span></code>
argument.</p>
</dd></dl>

</div>
</div>
<span id="document-netutil"></span><div class="section" id="module-tornado.netutil">
<span id="tornado-netutil-miscellaneous-network-utilities"></span><h4><code class="docutils literal"><span class="pre">tornado.netutil</span></code> &#8212; Miscellaneous network utilities<a class="headerlink" href="#module-tornado.netutil" title="永久链接至标题">¶</a></h4>
<p>Miscellaneous network utility code.</p>
<dl class="function">
<dt id="tornado.netutil.bind_sockets">
<code class="descclassname">tornado.netutil.</code><code class="descname">bind_sockets</code><span class="sig-paren">(</span><em>port</em>, <em>address=None</em>, <em>family=&lt;AddressFamily.AF_UNSPEC: 0&gt;</em>, <em>backlog=128</em>, <em>flags=None</em>, <em>reuse_port=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/netutil.html#bind_sockets"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.netutil.bind_sockets" title="永久链接至目标">¶</a></dt>
<dd><p>Creates listening sockets bound to the given port and address.</p>
<p>Returns a list of socket objects (multiple sockets are returned if
the given address maps to multiple IP addresses, which is most common
for mixed IPv4 and IPv6 use).</p>
<p>Address may be either an IP address or hostname.  If it&#8217;s a hostname,
the server will listen on all IP addresses associated with the
name.  Address may be an empty string or None to listen on all
available interfaces.  Family may be set to either <a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.AF_INET" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">socket.AF_INET</span></code></a>
or <a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.AF_INET6" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">socket.AF_INET6</span></code></a> to restrict to IPv4 or IPv6 addresses, otherwise
both will be used if available.</p>
<p>The <code class="docutils literal"><span class="pre">backlog</span></code> argument has the same meaning as for
<a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.socket.listen" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">socket.listen()</span></code></a>.</p>
<p><code class="docutils literal"><span class="pre">flags</span></code> is a bitmask of AI_* flags to <a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.getaddrinfo" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">getaddrinfo</span></code></a>, like
<code class="docutils literal"><span class="pre">socket.AI_PASSIVE</span> <span class="pre">|</span> <span class="pre">socket.AI_NUMERICHOST</span></code>.</p>
<p><code class="docutils literal"><span class="pre">resuse_port</span></code> option sets <code class="docutils literal"><span class="pre">SO_REUSEPORT</span></code> option for every socket
in the list. If your platform doesn&#8217;t support this option ValueError will
be raised.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.netutil.bind_unix_socket">
<code class="descclassname">tornado.netutil.</code><code class="descname">bind_unix_socket</code><span class="sig-paren">(</span><em>file</em>, <em>mode=384</em>, <em>backlog=128</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/netutil.html#bind_unix_socket"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.netutil.bind_unix_socket" title="永久链接至目标">¶</a></dt>
<dd><p>Creates a listening unix socket.</p>
<p>If a socket with the given name already exists, it will be deleted.
If any other file with that name exists, an exception will be
raised.</p>
<p>Returns a socket object (not a list of socket objects like
<a class="reference internal" href="#tornado.netutil.bind_sockets" title="tornado.netutil.bind_sockets"><code class="xref py py-obj docutils literal"><span class="pre">bind_sockets</span></code></a>)</p>
</dd></dl>

<dl class="function">
<dt id="tornado.netutil.add_accept_handler">
<code class="descclassname">tornado.netutil.</code><code class="descname">add_accept_handler</code><span class="sig-paren">(</span><em>sock</em>, <em>callback</em>, <em>io_loop=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/netutil.html#add_accept_handler"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.netutil.add_accept_handler" title="永久链接至目标">¶</a></dt>
<dd><p>Adds an <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> event handler to accept new connections on <code class="docutils literal"><span class="pre">sock</span></code>.</p>
<p>When a connection is accepted, <code class="docutils literal"><span class="pre">callback(connection,</span> <span class="pre">address)</span></code> will
be run (<code class="docutils literal"><span class="pre">connection</span></code> is a socket object, and <code class="docutils literal"><span class="pre">address</span></code> is the
address of the other end of the connection).  Note that this signature
is different from the <code class="docutils literal"><span class="pre">callback(fd,</span> <span class="pre">events)</span></code> signature used for
<a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> handlers.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>The <code class="docutils literal"><span class="pre">io_loop</span></code> argument is deprecated.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.netutil.is_valid_ip">
<code class="descclassname">tornado.netutil.</code><code class="descname">is_valid_ip</code><span class="sig-paren">(</span><em>ip</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/netutil.html#is_valid_ip"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.netutil.is_valid_ip" title="永久链接至目标">¶</a></dt>
<dd><p>Returns true if the given string is a well-formed IP address.</p>
<p>Supports IPv4 and IPv6.</p>
</dd></dl>

<dl class="class">
<dt id="tornado.netutil.Resolver">
<em class="property">class </em><code class="descclassname">tornado.netutil.</code><code class="descname">Resolver</code><a class="reference internal" href="_modules/tornado/netutil.html#Resolver"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.netutil.Resolver" title="永久链接至目标">¶</a></dt>
<dd><p>Configurable asynchronous DNS resolver interface.</p>
<p>By default, a blocking implementation is used (which simply calls
<a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.getaddrinfo" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">socket.getaddrinfo</span></code></a>).  An alternative implementation can be
chosen with the <a class="reference internal" href="index.html#tornado.util.Configurable.configure" title="tornado.util.Configurable.configure"><code class="xref py py-obj docutils literal"><span class="pre">Resolver.configure</span></code></a>
class method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Resolver</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;tornado.netutil.ThreadedResolver&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The implementations of this interface included with Tornado are</p>
<ul class="simple">
<li><a class="reference internal" href="#tornado.netutil.BlockingResolver" title="tornado.netutil.BlockingResolver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil.BlockingResolver</span></code></a></li>
<li><a class="reference internal" href="#tornado.netutil.ThreadedResolver" title="tornado.netutil.ThreadedResolver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil.ThreadedResolver</span></code></a></li>
<li><a class="reference internal" href="#tornado.netutil.OverrideResolver" title="tornado.netutil.OverrideResolver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil.OverrideResolver</span></code></a></li>
<li><a class="reference internal" href="index.html#tornado.platform.twisted.TwistedResolver" title="tornado.platform.twisted.TwistedResolver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.twisted.TwistedResolver</span></code></a></li>
<li><a class="reference internal" href="index.html#tornado.platform.caresresolver.CaresResolver" title="tornado.platform.caresresolver.CaresResolver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.caresresolver.CaresResolver</span></code></a></li>
</ul>
<dl class="method">
<dt id="tornado.netutil.Resolver.resolve">
<code class="descname">resolve</code><span class="sig-paren">(</span><em>host</em>, <em>port</em>, <em>family=&lt;AddressFamily.AF_UNSPEC: 0&gt;</em>, <em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/netutil.html#Resolver.resolve"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.netutil.Resolver.resolve" title="永久链接至目标">¶</a></dt>
<dd><p>Resolves an address.</p>
<p>The <code class="docutils literal"><span class="pre">host</span></code> argument is a string which may be a hostname or a
literal IP address.</p>
<p>Returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> whose result is a list of (family,
address) pairs, where address is a tuple suitable to pass to
<a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.socket.connect" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">socket.connect</span></code></a> (i.e. a <code class="docutils literal"><span class="pre">(host,</span>
<span class="pre">port)</span></code> pair for IPv4; additional fields may be present for
IPv6). If a <code class="docutils literal"><span class="pre">callback</span></code> is passed, it will be run with the
result as an argument when it is complete.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.netutil.Resolver.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/netutil.html#Resolver.close"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.netutil.Resolver.close" title="永久链接至目标">¶</a></dt>
<dd><p>Closes the <a class="reference internal" href="#tornado.netutil.Resolver" title="tornado.netutil.Resolver"><code class="xref py py-obj docutils literal"><span class="pre">Resolver</span></code></a>, freeing any resources used.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.netutil.ExecutorResolver">
<em class="property">class </em><code class="descclassname">tornado.netutil.</code><code class="descname">ExecutorResolver</code><a class="reference internal" href="_modules/tornado/netutil.html#ExecutorResolver"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.netutil.ExecutorResolver" title="永久链接至目标">¶</a></dt>
<dd><p>Resolver implementation using a <a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#concurrent.futures.Executor" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures.Executor</span></code></a>.</p>
<p>Use this instead of <a class="reference internal" href="#tornado.netutil.ThreadedResolver" title="tornado.netutil.ThreadedResolver"><code class="xref py py-obj docutils literal"><span class="pre">ThreadedResolver</span></code></a> when you require additional
control over the executor being used.</p>
<p>The executor will be shut down when the resolver is closed unless
<code class="docutils literal"><span class="pre">close_resolver=False</span></code>; use this if you want to reuse the same
executor elsewhere.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>The <code class="docutils literal"><span class="pre">io_loop</span></code> argument is deprecated.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.netutil.BlockingResolver">
<em class="property">class </em><code class="descclassname">tornado.netutil.</code><code class="descname">BlockingResolver</code><a class="reference internal" href="_modules/tornado/netutil.html#BlockingResolver"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.netutil.BlockingResolver" title="永久链接至目标">¶</a></dt>
<dd><p>Default <a class="reference internal" href="#tornado.netutil.Resolver" title="tornado.netutil.Resolver"><code class="xref py py-obj docutils literal"><span class="pre">Resolver</span></code></a> implementation, using <a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.getaddrinfo" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">socket.getaddrinfo</span></code></a>.</p>
<p>The <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> will be blocked during the resolution, although the
callback will not be run until the next <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> iteration.</p>
</dd></dl>

<dl class="class">
<dt id="tornado.netutil.ThreadedResolver">
<em class="property">class </em><code class="descclassname">tornado.netutil.</code><code class="descname">ThreadedResolver</code><a class="reference internal" href="_modules/tornado/netutil.html#ThreadedResolver"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.netutil.ThreadedResolver" title="永久链接至目标">¶</a></dt>
<dd><p>Multithreaded non-blocking <a class="reference internal" href="#tornado.netutil.Resolver" title="tornado.netutil.Resolver"><code class="xref py py-obj docutils literal"><span class="pre">Resolver</span></code></a> implementation.</p>
<p>Requires the <a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#module-concurrent.futures" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures</span></code></a> package to be installed
(available in the standard library since Python 3.2,
installable with <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">futures</span></code> in older versions).</p>
<p>The thread pool size can be configured with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Resolver</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;tornado.netutil.ThreadedResolver&#39;</span><span class="p">,</span>
                   <span class="n">num_threads</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 3.1 版更改: </span>All <code class="docutils literal"><span class="pre">ThreadedResolvers</span></code> share a single thread pool, whose
size is set by the first one to be created.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.netutil.OverrideResolver">
<em class="property">class </em><code class="descclassname">tornado.netutil.</code><code class="descname">OverrideResolver</code><a class="reference internal" href="_modules/tornado/netutil.html#OverrideResolver"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.netutil.OverrideResolver" title="永久链接至目标">¶</a></dt>
<dd><p>Wraps a resolver with a mapping of overrides.</p>
<p>This can be used to make local DNS changes (e.g. for testing)
without modifying system-wide settings.</p>
<p>The mapping can contain either host strings or host-port pairs.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.netutil.ssl_options_to_context">
<code class="descclassname">tornado.netutil.</code><code class="descname">ssl_options_to_context</code><span class="sig-paren">(</span><em>ssl_options</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/netutil.html#ssl_options_to_context"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.netutil.ssl_options_to_context" title="永久链接至目标">¶</a></dt>
<dd><p>Try to convert an <code class="docutils literal"><span class="pre">ssl_options</span></code> dictionary to an
<a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">SSLContext</span></code></a> object.</p>
<p>The <code class="docutils literal"><span class="pre">ssl_options</span></code> dictionary contains keywords to be passed to
<a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.wrap_socket" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.wrap_socket</span></code></a>.  In Python 2.7.9+, <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.SSLContext</span></code></a> objects can
be used instead.  This function converts the dict form to its
<a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">SSLContext</span></code></a> equivalent, and may be used when a component which
accepts both forms needs to upgrade to the <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">SSLContext</span></code></a> version
to use features like SNI or NPN.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.netutil.ssl_wrap_socket">
<code class="descclassname">tornado.netutil.</code><code class="descname">ssl_wrap_socket</code><span class="sig-paren">(</span><em>socket</em>, <em>ssl_options</em>, <em>server_hostname=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/netutil.html#ssl_wrap_socket"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.netutil.ssl_wrap_socket" title="永久链接至目标">¶</a></dt>
<dd><p>Returns an <code class="docutils literal"><span class="pre">ssl.SSLSocket</span></code> wrapping the given socket.</p>
<p><code class="docutils literal"><span class="pre">ssl_options</span></code> may be either an <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.SSLContext</span></code></a> object or a
dictionary (as accepted by <a class="reference internal" href="#tornado.netutil.ssl_options_to_context" title="tornado.netutil.ssl_options_to_context"><code class="xref py py-obj docutils literal"><span class="pre">ssl_options_to_context</span></code></a>).  Additional
keyword arguments are passed to <code class="docutils literal"><span class="pre">wrap_socket</span></code> (either the
<a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">SSLContext</span></code></a> method or the <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#module-ssl" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl</span></code></a> module function as
appropriate).</p>
</dd></dl>

</div>
<span id="document-tcpclient"></span><div class="section" id="module-tornado.tcpclient">
<span id="tornado-tcpclient-iostream-connection-factory"></span><h4><code class="docutils literal"><span class="pre">tornado.tcpclient</span></code> &#8212; <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> connection factory<a class="headerlink" href="#module-tornado.tcpclient" title="永久链接至标题">¶</a></h4>
<p>A non-blocking TCP connection factory.</p>
<dl class="class">
<dt id="tornado.tcpclient.TCPClient">
<em class="property">class </em><code class="descclassname">tornado.tcpclient.</code><code class="descname">TCPClient</code><span class="sig-paren">(</span><em>resolver=None</em>, <em>io_loop=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/tcpclient.html#TCPClient"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.tcpclient.TCPClient" title="永久链接至目标">¶</a></dt>
<dd><p>A non-blocking TCP connection factory.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>The <code class="docutils literal"><span class="pre">io_loop</span></code> argument is deprecated.</p>
</div>
<dl class="method">
<dt id="tornado.tcpclient.TCPClient.connect">
<code class="descname">connect</code><span class="sig-paren">(</span><em>host</em>, <em>port</em>, <em>af=&lt;AddressFamily.AF_UNSPEC: 0&gt;</em>, <em>ssl_options=None</em>, <em>max_buffer_size=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/tcpclient.html#TCPClient.connect"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.tcpclient.TCPClient.connect" title="永久链接至目标">¶</a></dt>
<dd><p>Connect to the given host and port.</p>
<p>Asynchronously returns an <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> (or <a class="reference internal" href="index.html#tornado.iostream.SSLIOStream" title="tornado.iostream.SSLIOStream"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream</span></code></a> if
<code class="docutils literal"><span class="pre">ssl_options</span></code> is not None).</p>
</dd></dl>

</dd></dl>

</div>
<span id="document-tcpserver"></span><div class="section" id="module-tornado.tcpserver">
<span id="tornado-tcpserver-iostream-tcp"></span><h4><code class="docutils literal"><span class="pre">tornado.tcpserver</span></code> &#8212; 基于 <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> 的基础 TCP 服务<a class="headerlink" href="#module-tornado.tcpserver" title="永久链接至标题">¶</a></h4>
<p>一个非阻塞, 单线程 TCP 服务.</p>
<dl class="class">
<dt id="tornado.tcpserver.TCPServer">
<em class="property">class </em><code class="descclassname">tornado.tcpserver.</code><code class="descname">TCPServer</code><span class="sig-paren">(</span><em>io_loop=None</em>, <em>ssl_options=None</em>, <em>max_buffer_size=None</em>, <em>read_chunk_size=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/tcpserver.html#TCPServer"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.tcpserver.TCPServer" title="永久链接至目标">¶</a></dt>
<dd><p>一个非阻塞, 单线程的 TCP 服务.</p>
<p>想要使用 <a class="reference internal" href="#tornado.tcpserver.TCPServer" title="tornado.tcpserver.TCPServer"><code class="xref py py-obj docutils literal"><span class="pre">TCPServer</span></code></a>, 只需要定义一个子类, 复写 <a class="reference internal" href="#tornado.tcpserver.TCPServer.handle_stream" title="tornado.tcpserver.TCPServer.handle_stream"><code class="xref py py-obj docutils literal"><span class="pre">handle_stream</span></code></a>
方法即可. 例如, 一个简单的 echo server 可以做如下定义:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado.tcpserver</span> <span class="k">import</span> <span class="n">TCPServer</span>
<span class="kn">from</span> <span class="nn">tornado.iostream</span> <span class="k">import</span> <span class="n">StreamClosedError</span>
<span class="kn">from</span> <span class="nn">tornado</span> <span class="k">import</span> <span class="n">gen</span>

<span class="k">class</span> <span class="nc">EchoServer</span><span class="p">(</span><span class="n">TCPServer</span><span class="p">):</span>
    <span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">handle_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">stream</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">StreamClosedError</span><span class="p">:</span>
                <span class="k">break</span>
</pre></div>
</div>
<p>为了使该服务提供 SSL 传输, 通过一个名为``ssl_options`` 的关键字参数
传递进去 <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.SSLContext</span></code></a> 对象即可. 为了兼容旧版本的 Python,
<code class="docutils literal"><span class="pre">ssl_options</span></code> 也可以是一个字典, 作为`ssl.wrap_socket` 方法的关键字
参数.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ssl_ctx</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">Purpose</span><span class="o">.</span><span class="n">CLIENT_AUTH</span><span class="p">)</span>
<span class="n">ssl_ctx</span><span class="o">.</span><span class="n">load_cert_chain</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;mydomain.crt&quot;</span><span class="p">),</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;mydomain.key&quot;</span><span class="p">))</span>
<span class="n">TCPServer</span><span class="p">(</span><span class="n">ssl_options</span><span class="o">=</span><span class="n">ssl_ctx</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#tornado.tcpserver.TCPServer" title="tornado.tcpserver.TCPServer"><code class="xref py py-obj docutils literal"><span class="pre">TCPServer</span></code></a> 初始化可以是以下三种模式之一:</p>
<ol class="arabic">
<li><p class="first"><a class="reference internal" href="#tornado.tcpserver.TCPServer.listen" title="tornado.tcpserver.TCPServer.listen"><code class="xref py py-obj docutils literal"><span class="pre">listen</span></code></a>: 简单的单进程模式:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">server</span> <span class="o">=</span> <span class="n">TCPServer</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
<span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first"><a class="reference internal" href="#tornado.tcpserver.TCPServer.bind" title="tornado.tcpserver.TCPServer.bind"><code class="xref py py-obj docutils literal"><span class="pre">bind</span></code></a>/<a class="reference internal" href="#tornado.tcpserver.TCPServer.start" title="tornado.tcpserver.TCPServer.start"><code class="xref py py-obj docutils literal"><span class="pre">start</span></code></a>: 简单的多进程模式:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">server</span> <span class="o">=</span> <span class="n">TCPServer</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Forks multiple sub-processes</span>
<span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>当使用这个接口, <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> 一定 <em>不能</em> 被传递给
<a class="reference internal" href="#tornado.tcpserver.TCPServer" title="tornado.tcpserver.TCPServer"><code class="xref py py-obj docutils literal"><span class="pre">TCPServer</span></code></a> 构造器.  <a class="reference internal" href="#tornado.tcpserver.TCPServer.start" title="tornado.tcpserver.TCPServer.start"><code class="xref py py-obj docutils literal"><span class="pre">start</span></code></a> 总是会在默认单一的 <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>
上启动服务.</p>
</li>
<li><p class="first"><a class="reference internal" href="#tornado.tcpserver.TCPServer.add_sockets" title="tornado.tcpserver.TCPServer.add_sockets"><code class="xref py py-obj docutils literal"><span class="pre">add_sockets</span></code></a>: 高级多进程模式:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sockets</span> <span class="o">=</span> <span class="n">bind_sockets</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
<span class="n">tornado</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">fork_processes</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">TCPServer</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">add_sockets</span><span class="p">(</span><span class="n">sockets</span><span class="p">)</span>
<span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p><a class="reference internal" href="#tornado.tcpserver.TCPServer.add_sockets" title="tornado.tcpserver.TCPServer.add_sockets"><code class="xref py py-obj docutils literal"><span class="pre">add_sockets</span></code></a> 接口更加复杂, 但是它可以和 <a class="reference internal" href="index.html#tornado.process.fork_processes" title="tornado.process.fork_processes"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process.fork_processes</span></code></a>
一起被使用, 当 fork 发生的时候给你更多灵活性.  <a class="reference internal" href="#tornado.tcpserver.TCPServer.add_sockets" title="tornado.tcpserver.TCPServer.add_sockets"><code class="xref py py-obj docutils literal"><span class="pre">add_sockets</span></code></a> 也可以被用于
单进程服务中, 如果你想要使用 <a class="reference internal" href="index.html#tornado.netutil.bind_sockets" title="tornado.netutil.bind_sockets"><code class="xref py py-obj docutils literal"><span class="pre">bind_sockets</span></code></a> 以外的方式
创建你监听的 socket.</p>
</li>
</ol>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能: </span><code class="docutils literal"><span class="pre">max_buffer_size</span></code> 参数.</p>
</div>
<dl class="method">
<dt id="tornado.tcpserver.TCPServer.listen">
<code class="descname">listen</code><span class="sig-paren">(</span><em>port</em>, <em>address=''</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/tcpserver.html#TCPServer.listen"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.tcpserver.TCPServer.listen" title="永久链接至目标">¶</a></dt>
<dd><p>开始在给定的端口接收连接.</p>
<p>这个方法可能不只被调用一次, 可能会在多个端口上被调用多次.
<a class="reference internal" href="#tornado.tcpserver.TCPServer.listen" title="tornado.tcpserver.TCPServer.listen"><code class="xref py py-obj docutils literal"><span class="pre">listen</span></code></a> 方法将立即生效, 所以它没必要在 <a class="reference internal" href="#tornado.tcpserver.TCPServer.start" title="tornado.tcpserver.TCPServer.start"><code class="xref py py-obj docutils literal"><span class="pre">TCPServer.start</span></code></a> 之后调用.
然而, 必须要启动 <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> 才可以.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.tcpserver.TCPServer.add_sockets">
<code class="descname">add_sockets</code><span class="sig-paren">(</span><em>sockets</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/tcpserver.html#TCPServer.add_sockets"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.tcpserver.TCPServer.add_sockets" title="永久链接至目标">¶</a></dt>
<dd><p>使服务开始接收给定端口的连接.</p>
<p><code class="docutils literal"><span class="pre">sockets</span></code> 参数是一个 socket 对象的列表, 例如那些被
<a class="reference internal" href="index.html#tornado.netutil.bind_sockets" title="tornado.netutil.bind_sockets"><code class="xref py py-obj docutils literal"><span class="pre">bind_sockets</span></code></a> 所返回的对象.
<a class="reference internal" href="#tornado.tcpserver.TCPServer.add_sockets" title="tornado.tcpserver.TCPServer.add_sockets"><code class="xref py py-obj docutils literal"><span class="pre">add_sockets</span></code></a> 通常和 <a class="reference internal" href="index.html#tornado.process.fork_processes" title="tornado.process.fork_processes"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process.fork_processes</span></code></a> 相结合使用,
以便于在一个多进程服务初始化时提供更多控制.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.tcpserver.TCPServer.add_socket">
<code class="descname">add_socket</code><span class="sig-paren">(</span><em>socket</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/tcpserver.html#TCPServer.add_socket"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.tcpserver.TCPServer.add_socket" title="永久链接至目标">¶</a></dt>
<dd><p>单数版本的 <a class="reference internal" href="#tornado.tcpserver.TCPServer.add_sockets" title="tornado.tcpserver.TCPServer.add_sockets"><code class="xref py py-obj docutils literal"><span class="pre">add_sockets</span></code></a>.  接受一个单一的 socket 对象.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.tcpserver.TCPServer.bind">
<code class="descname">bind</code><span class="sig-paren">(</span><em>port</em>, <em>address=None</em>, <em>family=&lt;AddressFamily.AF_UNSPEC: 0&gt;</em>, <em>backlog=128</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/tcpserver.html#TCPServer.bind"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.tcpserver.TCPServer.bind" title="永久链接至目标">¶</a></dt>
<dd><p>绑定该服务到指定的地址的指定端口上.</p>
<p>要启动该服务, 调用 <a class="reference internal" href="#tornado.tcpserver.TCPServer.start" title="tornado.tcpserver.TCPServer.start"><code class="xref py py-obj docutils literal"><span class="pre">start</span></code></a>. 如果你想要在一个单进程上运行该服务,
你可以调用 <a class="reference internal" href="#tornado.tcpserver.TCPServer.listen" title="tornado.tcpserver.TCPServer.listen"><code class="xref py py-obj docutils literal"><span class="pre">listen</span></code></a> 作为顺序调用 <a class="reference internal" href="#tornado.tcpserver.TCPServer.bind" title="tornado.tcpserver.TCPServer.bind"><code class="xref py py-obj docutils literal"><span class="pre">bind</span></code></a> 和 <a class="reference internal" href="#tornado.tcpserver.TCPServer.start" title="tornado.tcpserver.TCPServer.start"><code class="xref py py-obj docutils literal"><span class="pre">start</span></code></a> 的一个快捷方式.</p>
<p>address 参数可以是 IP 地址或者主机名.  如果它是主机名,
该服务将监听在和该名称有关的所有 IP 地址上.  地址也可以是空字符串或者
None, 服务将监听所有可用的接口. family 可以被设置为 <a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.AF_INET" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">socket.AF_INET</span></code></a> 或
<a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.AF_INET6" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">socket.AF_INET6</span></code></a> 用来限定是 IPv4 或 IPv6 地址, 否则如果可用的话, 两者
都将被使用.</p>
<p><code class="docutils literal"><span class="pre">backlog</span></code> 参数和 <a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.socket.listen" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">socket.listen</span></code></a> 是相同含义.</p>
<p>这个方法可能在 <a class="reference internal" href="#tornado.tcpserver.TCPServer.start" title="tornado.tcpserver.TCPServer.start"><code class="xref py py-obj docutils literal"><span class="pre">start</span></code></a> 之前被调用多次来监听在多个端口或接口上.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.tcpserver.TCPServer.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>num_processes=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/tcpserver.html#TCPServer.start"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.tcpserver.TCPServer.start" title="永久链接至目标">¶</a></dt>
<dd><p>在 <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> 中启动该服务.</p>
<p>默认情况下, 我们在该进程中运行服务, 并且不会 fork 出任何额外
的子进程.</p>
<p>如果 num_processes 为 <code class="docutils literal"><span class="pre">None</span></code> 或 &lt;= 0, 我们检测这台机器上可用的
核心数并 fork 相同数量的子进程. 如果给定了 num_processes 并且 &gt; 1,
我们 fork 指定数量的子进程.</p>
<p>因为我们使用进程而不是线程, 在任何服务代码之间没有共享内存.</p>
<p>注意多进程模式和 autoreload 模块不兼容(或者是当 <code class="docutils literal"><span class="pre">debug=True</span></code> 时
<a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Application</span></code></a> 的 <code class="docutils literal"><span class="pre">autoreload=True</span></code> 选项默认为 True).
当使用多进程模式时, 直到 <code class="docutils literal"><span class="pre">TCPServer.start(n)</span></code> 调用后, 才能创建或者
引用 IOLoops .</p>
</dd></dl>

<dl class="method">
<dt id="tornado.tcpserver.TCPServer.stop">
<code class="descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/tcpserver.html#TCPServer.stop"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.tcpserver.TCPServer.stop" title="永久链接至目标">¶</a></dt>
<dd><p>停止对新连接的监听.</p>
<p>正在进行的请求可能仍然会继续在服务停止之后.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.tcpserver.TCPServer.handle_stream">
<code class="descname">handle_stream</code><span class="sig-paren">(</span><em>stream</em>, <em>address</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/tcpserver.html#TCPServer.handle_stream"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.tcpserver.TCPServer.handle_stream" title="永久链接至目标">¶</a></dt>
<dd><p>通过复写这个方法以处理一个来自传入连接的新 <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> .</p>
<p>这个方法可能是一个协程; 如果是这样, 异步引发的任何异常都将被记录.
接受传入连接不会被该协程阻塞.</p>
<p>如果这个 <a class="reference internal" href="#tornado.tcpserver.TCPServer" title="tornado.tcpserver.TCPServer"><code class="xref py py-obj docutils literal"><span class="pre">TCPServer</span></code></a> 被配置为 SSL, <code class="docutils literal"><span class="pre">handle_stream</span></code>
将在 SSL 握手完成前被调用. 如果你需要验证客户端的证书或使用 NPN/ALPN
请使用 <a class="reference internal" href="index.html#tornado.iostream.SSLIOStream.wait_for_handshake" title="tornado.iostream.SSLIOStream.wait_for_handshake"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream.wait_for_handshake</span></code></a> .</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.2 版更改: </span>给这个方法添加了选项, 可以为协程.</p>
</div>
</dd></dl>

</dd></dl>

</div>
</div>
</div>
<span id="document-coroutine"></span><div class="section" id="id1">
<h3>协程和并发<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-gen"></span><div class="section" id="tornado-gen-simplify-asynchronous-code">
<h4><code class="docutils literal"><span class="pre">tornado.gen</span></code> &#8212; Simplify asynchronous code<a class="headerlink" href="#tornado-gen-simplify-asynchronous-code" title="永久链接至标题">¶</a></h4>
<span class="target" id="module-tornado.gen"></span><p><code class="docutils literal"><span class="pre">tornado.gen</span></code> is a generator-based interface to make it easier to
work in an asynchronous environment.  Code using the <code class="docutils literal"><span class="pre">gen</span></code> module
is technically asynchronous, but it is written as a single generator
instead of a collection of separate functions.</p>
<p>For example, the following asynchronous handler:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AsyncHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="nd">@asynchronous</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">http_client</span> <span class="o">=</span> <span class="n">AsyncHTTPClient</span><span class="p">()</span>
        <span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;http://example.com&quot;</span><span class="p">,</span>
                          <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_fetch</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">do_something_with_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;template.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>could be written with <code class="docutils literal"><span class="pre">gen</span></code> as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GenAsyncHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">http_client</span> <span class="o">=</span> <span class="n">AsyncHTTPClient</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;http://example.com&quot;</span><span class="p">)</span>
        <span class="n">do_something_with_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;template.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Most asynchronous functions in Tornado return a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>;
yielding this object returns its <a class="reference internal" href="index.html#tornado.concurrent.Future.result" title="tornado.concurrent.Future.result"><code class="xref py py-obj docutils literal"><span class="pre">result</span></code></a>.</p>
<p>You can also yield a list or dict of <code class="docutils literal"><span class="pre">Futures</span></code>, which will be
started at the same time and run in parallel; a list or dict of results will
be returned when they are all finished:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">http_client</span> <span class="o">=</span> <span class="n">AsyncHTTPClient</span><span class="p">()</span>
    <span class="n">response1</span><span class="p">,</span> <span class="n">response2</span> <span class="o">=</span> <span class="k">yield</span> <span class="p">[</span><span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url1</span><span class="p">),</span>
                                  <span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url2</span><span class="p">)]</span>
    <span class="n">response_dict</span> <span class="o">=</span> <span class="k">yield</span> <span class="nb">dict</span><span class="p">(</span><span class="n">response3</span><span class="o">=</span><span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url3</span><span class="p">),</span>
                               <span class="n">response4</span><span class="o">=</span><span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url4</span><span class="p">))</span>
    <span class="n">response3</span> <span class="o">=</span> <span class="n">response_dict</span><span class="p">[</span><span class="s1">&#39;response3&#39;</span><span class="p">]</span>
    <span class="n">response4</span> <span class="o">=</span> <span class="n">response_dict</span><span class="p">[</span><span class="s1">&#39;response4&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>If the <a class="reference external" href="https://docs.python.org/3.4/library/functools.html#functools.singledispatch" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">singledispatch</span></code></a> library is available (standard in
Python 3.4, available via the <a class="reference external" href="https://pypi.python.org/pypi/singledispatch">singledispatch</a> package on older
versions), additional types of objects may be yielded. Tornado includes
support for <code class="docutils literal"><span class="pre">asyncio.Future</span></code> and Twisted&#8217;s <code class="docutils literal"><span class="pre">Deferred</span></code> class when
<code class="docutils literal"><span class="pre">tornado.platform.asyncio</span></code> and <code class="docutils literal"><span class="pre">tornado.platform.twisted</span></code> are imported.
See the <a class="reference internal" href="#tornado.gen.convert_yielded" title="tornado.gen.convert_yielded"><code class="xref py py-obj docutils literal"><span class="pre">convert_yielded</span></code></a> function to extend this mechanism.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.2 版更改: </span>Dict support added.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>Support added for yielding <code class="docutils literal"><span class="pre">asyncio</span></code> Futures and Twisted Deferreds
via <code class="docutils literal"><span class="pre">singledispatch</span></code>.</p>
</div>
<div class="section" id="decorators">
<h5>Decorators<a class="headerlink" href="#decorators" title="永久链接至标题">¶</a></h5>
<dl class="function">
<dt id="tornado.gen.coroutine">
<code class="descclassname">tornado.gen.</code><code class="descname">coroutine</code><span class="sig-paren">(</span><em>func</em>, <em>replace_callback=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#coroutine"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.coroutine" title="永久链接至目标">¶</a></dt>
<dd><p>Decorator for asynchronous generators.</p>
<p>Any generator that yields objects from this module must be wrapped
in either this decorator or <a class="reference internal" href="#tornado.gen.engine" title="tornado.gen.engine"><code class="xref py py-obj docutils literal"><span class="pre">engine</span></code></a>.</p>
<p>Coroutines may &#8220;return&#8221; by raising the special exception
<a class="reference internal" href="#tornado.gen.Return" title="tornado.gen.Return"><code class="xref py py-obj docutils literal"><span class="pre">Return(value)</span></code></a>.  In Python 3.3+, it is also possible for
the function to simply use the <code class="docutils literal"><span class="pre">return</span> <span class="pre">value</span></code> statement (prior to
Python 3.3 generators were not allowed to also return values).
In all versions of Python a coroutine that simply wishes to exit
early may use the <code class="docutils literal"><span class="pre">return</span></code> statement without a value.</p>
<p>Functions with this decorator return a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.  Additionally,
they may be called with a <code class="docutils literal"><span class="pre">callback</span></code> keyword argument, which
will be invoked with the future&#8217;s result when it resolves.  If the
coroutine fails, the callback will not be run and an exception
will be raised into the surrounding <a class="reference internal" href="index.html#tornado.stack_context.StackContext" title="tornado.stack_context.StackContext"><code class="xref py py-obj docutils literal"><span class="pre">StackContext</span></code></a>.  The
<code class="docutils literal"><span class="pre">callback</span></code> argument is not visible inside the decorated
function; it is handled by the decorator itself.</p>
<p>From the caller&#8217;s perspective, <code class="docutils literal"><span class="pre">&#64;gen.coroutine</span></code> is similar to
the combination of <code class="docutils literal"><span class="pre">&#64;return_future</span></code> and <code class="docutils literal"><span class="pre">&#64;gen.engine</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">When exceptions occur inside a coroutine, the exception
information will be stored in the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> object. You must
examine the result of the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> object, or the exception
may go unnoticed by your code. This means yielding the function
if called from another coroutine, using something like
<a class="reference internal" href="index.html#tornado.ioloop.IOLoop.run_sync" title="tornado.ioloop.IOLoop.run_sync"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.run_sync</span></code></a> for top-level calls, or passing the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>
to <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_future" title="tornado.ioloop.IOLoop.add_future"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_future</span></code></a>.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.gen.engine">
<code class="descclassname">tornado.gen.</code><code class="descname">engine</code><span class="sig-paren">(</span><em>func</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#engine"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.engine" title="永久链接至目标">¶</a></dt>
<dd><p>Callback-oriented decorator for asynchronous generators.</p>
<p>This is an older interface; for new code that does not need to be
compatible with versions of Tornado older than 3.0 the
<a class="reference internal" href="#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">coroutine</span></code></a> decorator is recommended instead.</p>
<p>This decorator is similar to <a class="reference internal" href="#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">coroutine</span></code></a>, except it does not
return a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> and the <code class="docutils literal"><span class="pre">callback</span></code> argument is not treated
specially.</p>
<p>In most cases, functions decorated with <a class="reference internal" href="#tornado.gen.engine" title="tornado.gen.engine"><code class="xref py py-obj docutils literal"><span class="pre">engine</span></code></a> should take
a <code class="docutils literal"><span class="pre">callback</span></code> argument and invoke it with their result when
they are finished.  One notable exception is the
<a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> <a class="reference internal" href="index.html#verbs"><span class="std std-ref">HTTP verb methods</span></a>,
which use <code class="docutils literal"><span class="pre">self.finish()</span></code> in place of a callback argument.</p>
</dd></dl>

</div>
<div class="section" id="utility-functions">
<h5>Utility functions<a class="headerlink" href="#utility-functions" title="永久链接至标题">¶</a></h5>
<dl class="exception">
<dt id="tornado.gen.Return">
<em class="property">exception </em><code class="descclassname">tornado.gen.</code><code class="descname">Return</code><span class="sig-paren">(</span><em>value=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#Return"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.Return" title="永久链接至目标">¶</a></dt>
<dd><p>Special exception to return a value from a <a class="reference internal" href="#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">coroutine</span></code></a>.</p>
<p>If this exception is raised, its value argument is used as the
result of the coroutine:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">fetch_json</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">AsyncHTTPClient</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">gen</span><span class="o">.</span><span class="n">Return</span><span class="p">(</span><span class="n">json_decode</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">))</span>
</pre></div>
</div>
<p>In Python 3.3, this exception is no longer necessary: the <code class="docutils literal"><span class="pre">return</span></code>
statement can be used directly to return a value (previously
<code class="docutils literal"><span class="pre">yield</span></code> and <code class="docutils literal"><span class="pre">return</span></code> with a value could not be combined in the
same function).</p>
<p>By analogy with the return statement, the value argument is optional,
but it is never necessary to <code class="docutils literal"><span class="pre">raise</span> <span class="pre">gen.Return()</span></code>.  The <code class="docutils literal"><span class="pre">return</span></code>
statement can be used with no arguments instead.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.gen.with_timeout">
<code class="descclassname">tornado.gen.</code><code class="descname">with_timeout</code><span class="sig-paren">(</span><em>timeout</em>, <em>future</em>, <em>io_loop=None</em>, <em>quiet_exceptions=()</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#with_timeout"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.with_timeout" title="永久链接至目标">¶</a></dt>
<dd><p>Wraps a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> in a timeout.</p>
<p>Raises <a class="reference internal" href="#tornado.gen.TimeoutError" title="tornado.gen.TimeoutError"><code class="xref py py-obj docutils literal"><span class="pre">TimeoutError</span></code></a> if the input future does not complete before
<code class="docutils literal"><span class="pre">timeout</span></code>, which may be specified in any form allowed by
<a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_timeout" title="tornado.ioloop.IOLoop.add_timeout"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_timeout</span></code></a> (i.e. a <a class="reference external" href="https://docs.python.org/3.4/library/datetime.html#datetime.timedelta" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">datetime.timedelta</span></code></a> or an absolute time
relative to <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.time" title="tornado.ioloop.IOLoop.time"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.time</span></code></a>)</p>
<p>If the wrapped <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> fails after it has timed out, the exception
will be logged unless it is of a type contained in <code class="docutils literal"><span class="pre">quiet_exceptions</span></code>
(which may be an exception type or a sequence of types).</p>
<p>Currently only supports Futures, not other <a class="reference internal" href="#tornado.gen.YieldPoint" title="tornado.gen.YieldPoint"><code class="xref py py-obj docutils literal"><span class="pre">YieldPoint</span></code></a> classes.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>Added the <code class="docutils literal"><span class="pre">quiet_exceptions</span></code> argument and the logging of unhandled
exceptions.</p>
</div>
</dd></dl>

<dl class="exception">
<dt id="tornado.gen.TimeoutError">
<em class="property">exception </em><code class="descclassname">tornado.gen.</code><code class="descname">TimeoutError</code><a class="reference internal" href="_modules/tornado/gen.html#TimeoutError"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.TimeoutError" title="永久链接至目标">¶</a></dt>
<dd><p>Exception raised by <code class="docutils literal"><span class="pre">with_timeout</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.gen.sleep">
<code class="descclassname">tornado.gen.</code><code class="descname">sleep</code><span class="sig-paren">(</span><em>duration</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#sleep"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.sleep" title="永久链接至目标">¶</a></dt>
<dd><p>Return a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> that resolves after the given number of seconds.</p>
<p>When used with <code class="docutils literal"><span class="pre">yield</span></code> in a coroutine, this is a non-blocking
analogue to <a class="reference external" href="https://docs.python.org/3.4/library/time.html#time.sleep" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">time.sleep</span></code></a> (which should not be used in coroutines
because it is blocking):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">yield</span> <span class="n">gen</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that calling this function on its own does nothing; you must
wait on the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> it returns (usually by yielding it).</p>
<div class="versionadded">
<p><span class="versionmodified">4.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="data">
<dt id="tornado.gen.moment">
<code class="descclassname">tornado.gen.</code><code class="descname">moment</code><a class="headerlink" href="#tornado.gen.moment" title="永久链接至目标">¶</a></dt>
<dd><p>A special object which may be yielded to allow the IOLoop to run for
one iteration.</p>
<p>This is not needed in normal use but it can be helpful in long-running
coroutines that are likely to yield Futures that are ready instantly.</p>
<p>Usage: <code class="docutils literal"><span class="pre">yield</span> <span class="pre">gen.moment</span></code></p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.gen.WaitIterator">
<em class="property">class </em><code class="descclassname">tornado.gen.</code><code class="descname">WaitIterator</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#WaitIterator"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.WaitIterator" title="永久链接至目标">¶</a></dt>
<dd><p>Provides an iterator to yield the results of futures as they finish.</p>
<p>Yielding a set of futures like this:</p>
<p><code class="docutils literal"><span class="pre">results</span> <span class="pre">=</span> <span class="pre">yield</span> <span class="pre">[future1,</span> <span class="pre">future2]</span></code></p>
<p>pauses the coroutine until both <code class="docutils literal"><span class="pre">future1</span></code> and <code class="docutils literal"><span class="pre">future2</span></code>
return, and then restarts the coroutine with the results of both
futures. If either future is an exception, the expression will
raise that exception and all the results will be lost.</p>
<p>If you need to get the result of each future as soon as possible,
or if you need the result of some futures even if others produce
errors, you can use <code class="docutils literal"><span class="pre">WaitIterator</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">wait_iterator</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="n">WaitIterator</span><span class="p">(</span><span class="n">future1</span><span class="p">,</span> <span class="n">future2</span><span class="p">)</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">wait_iterator</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">wait_iterator</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error </span><span class="si">{}</span><span class="s2"> from </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">wait_iterator</span><span class="o">.</span><span class="n">current_future</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Result </span><span class="si">{}</span><span class="s2"> received from </span><span class="si">{}</span><span class="s2"> at </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">wait_iterator</span><span class="o">.</span><span class="n">current_future</span><span class="p">,</span>
            <span class="n">wait_iterator</span><span class="o">.</span><span class="n">current_index</span><span class="p">))</span>
</pre></div>
</div>
<p>Because results are returned as soon as they are available the
output from the iterator <em>will not be in the same order as the
input arguments</em>. If you need to know which future produced the
current result, you can use the attributes
<code class="docutils literal"><span class="pre">WaitIterator.current_future</span></code>, or <code class="docutils literal"><span class="pre">WaitIterator.current_index</span></code>
to get the index of the future from the input list. (if keyword
arguments were used in the construction of the <a class="reference internal" href="#tornado.gen.WaitIterator" title="tornado.gen.WaitIterator"><code class="xref py py-obj docutils literal"><span class="pre">WaitIterator</span></code></a>,
<code class="docutils literal"><span class="pre">current_index</span></code> will use the corresponding keyword).</p>
<p>On Python 3.5, <a class="reference internal" href="#tornado.gen.WaitIterator" title="tornado.gen.WaitIterator"><code class="xref py py-obj docutils literal"><span class="pre">WaitIterator</span></code></a> implements the async iterator
protocol, so it can be used with the <code class="docutils literal"><span class="pre">async</span> <span class="pre">for</span></code> statement (note
that in this version the entire iteration is aborted if any value
raises an exception, while the previous example can continue past
individual errors):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">gen</span><span class="o">.</span><span class="n">WaitIterator</span><span class="p">(</span><span class="n">future1</span><span class="p">,</span> <span class="n">future2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Result </span><span class="si">{}</span><span class="s2"> received from </span><span class="si">{}</span><span class="s2"> at </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">wait_iterator</span><span class="o">.</span><span class="n">current_future</span><span class="p">,</span>
        <span class="n">wait_iterator</span><span class="o">.</span><span class="n">current_index</span><span class="p">))</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">4.1 新版功能.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>Added <code class="docutils literal"><span class="pre">async</span> <span class="pre">for</span></code> support in Python 3.5.</p>
</div>
<dl class="method">
<dt id="tornado.gen.WaitIterator.done">
<code class="descname">done</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#WaitIterator.done"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.WaitIterator.done" title="永久链接至目标">¶</a></dt>
<dd><p>Returns True if this iterator has no more results.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.gen.WaitIterator.next">
<code class="descname">next</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#WaitIterator.next"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.WaitIterator.next" title="永久链接至目标">¶</a></dt>
<dd><p>Returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> that will yield the next available result.</p>
<p>Note that this <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> will not be the same object as any of
the inputs.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tornado.gen.multi">
<code class="descclassname">tornado.gen.</code><code class="descname">multi</code><span class="sig-paren">(</span><em>children</em>, <em>quiet_exceptions=()</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#multi"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.multi" title="永久链接至目标">¶</a></dt>
<dd><p>Runs multiple asynchronous operations in parallel.</p>
<p><code class="docutils literal"><span class="pre">children</span></code> may either be a list or a dict whose values are
yieldable objects. <code class="docutils literal"><span class="pre">multi()</span></code> returns a new yieldable
object that resolves to a parallel structure containing their
results. If <code class="docutils literal"><span class="pre">children</span></code> is a list, the result is a list of
results in the same order; if it is a dict, the result is a dict
with the same keys.</p>
<p>That is, <code class="docutils literal"><span class="pre">results</span> <span class="pre">=</span> <span class="pre">yield</span> <span class="pre">multi(list_of_futures)</span></code> is equivalent
to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">list_of_futures</span><span class="p">:</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">yield</span> <span class="n">future</span><span class="p">)</span>
</pre></div>
</div>
<p>If any children raise exceptions, <code class="docutils literal"><span class="pre">multi()</span></code> will raise the first
one. All others will be logged, unless they are of types
contained in the <code class="docutils literal"><span class="pre">quiet_exceptions</span></code> argument.</p>
<p>If any of the inputs are <a class="reference internal" href="#tornado.gen.YieldPoint" title="tornado.gen.YieldPoint"><code class="xref py py-obj docutils literal"><span class="pre">YieldPoints</span></code></a>, the returned
yieldable object is a <a class="reference internal" href="#tornado.gen.YieldPoint" title="tornado.gen.YieldPoint"><code class="xref py py-obj docutils literal"><span class="pre">YieldPoint</span></code></a>. Otherwise, returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.
This means that the result of <a class="reference internal" href="#tornado.gen.multi" title="tornado.gen.multi"><code class="xref py py-obj docutils literal"><span class="pre">multi</span></code></a> can be used in a native
coroutine if and only if all of its children can be.</p>
<p>In a <code class="docutils literal"><span class="pre">yield</span></code>-based coroutine, it is not normally necessary to
call this function directly, since the coroutine runner will
do it automatically when a list or dict is yielded. However,
it is necessary in <code class="docutils literal"><span class="pre">await</span></code>-based coroutines, or to pass
the <code class="docutils literal"><span class="pre">quiet_exceptions</span></code> argument.</p>
<p>This function is available under the names <code class="docutils literal"><span class="pre">multi()</span></code> and <code class="docutils literal"><span class="pre">Multi()</span></code>
for historical reasons.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.2 版更改: </span>If multiple yieldables fail, any exceptions after the first
(which is raised) will be logged. Added the <code class="docutils literal"><span class="pre">quiet_exceptions</span></code>
argument to suppress this logging for selected exception types.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>Replaced the class <code class="docutils literal"><span class="pre">Multi</span></code> and the function <code class="docutils literal"><span class="pre">multi_future</span></code>
with a unified function <code class="docutils literal"><span class="pre">multi</span></code>. Added support for yieldables
other than <a class="reference internal" href="#tornado.gen.YieldPoint" title="tornado.gen.YieldPoint"><code class="xref py py-obj docutils literal"><span class="pre">YieldPoint</span></code></a> and <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.gen.multi_future">
<code class="descclassname">tornado.gen.</code><code class="descname">multi_future</code><span class="sig-paren">(</span><em>children</em>, <em>quiet_exceptions=()</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#multi_future"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.multi_future" title="永久链接至目标">¶</a></dt>
<dd><p>Wait for multiple asynchronous futures in parallel.</p>
<p>This function is similar to <a class="reference internal" href="#tornado.gen.multi" title="tornado.gen.multi"><code class="xref py py-obj docutils literal"><span class="pre">multi</span></code></a>, but does not support
<a class="reference internal" href="#tornado.gen.YieldPoint" title="tornado.gen.YieldPoint"><code class="xref py py-obj docutils literal"><span class="pre">YieldPoints</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.2 版更改: </span>If multiple <code class="docutils literal"><span class="pre">Futures</span></code> fail, any exceptions after the first (which is
raised) will be logged. Added the <code class="docutils literal"><span class="pre">quiet_exceptions</span></code>
argument to suppress this logging for selected exception types.</p>
</div>
<div class="deprecated">
<p><span class="versionmodified">4.3 版后已移除: </span>Use <a class="reference internal" href="#tornado.gen.multi" title="tornado.gen.multi"><code class="xref py py-obj docutils literal"><span class="pre">multi</span></code></a> instead.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.gen.Task">
<code class="descclassname">tornado.gen.</code><code class="descname">Task</code><span class="sig-paren">(</span><em>func</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#Task"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.Task" title="永久链接至目标">¶</a></dt>
<dd><p>Adapts a callback-based asynchronous function for use in coroutines.</p>
<p>Takes a function (and optional additional arguments) and runs it with
those arguments plus a <code class="docutils literal"><span class="pre">callback</span></code> keyword argument.  The argument passed
to the callback is returned as the result of the yield expression.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span><code class="docutils literal"><span class="pre">gen.Task</span></code> is now a function that returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>, instead of
a subclass of <a class="reference internal" href="#tornado.gen.YieldPoint" title="tornado.gen.YieldPoint"><code class="xref py py-obj docutils literal"><span class="pre">YieldPoint</span></code></a>.  It still behaves the same way when
yielded.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.gen.Arguments">
<em class="property">class </em><code class="descclassname">tornado.gen.</code><code class="descname">Arguments</code><a class="headerlink" href="#tornado.gen.Arguments" title="永久链接至目标">¶</a></dt>
<dd><p>The result of a <a class="reference internal" href="#tornado.gen.Task" title="tornado.gen.Task"><code class="xref py py-obj docutils literal"><span class="pre">Task</span></code></a> or <a class="reference internal" href="#tornado.gen.Wait" title="tornado.gen.Wait"><code class="xref py py-obj docutils literal"><span class="pre">Wait</span></code></a> whose callback had more than one
argument (or keyword arguments).</p>
<p>The <a class="reference internal" href="#tornado.gen.Arguments" title="tornado.gen.Arguments"><code class="xref py py-obj docutils literal"><span class="pre">Arguments</span></code></a> object is a <a class="reference external" href="https://docs.python.org/3.4/library/collections.html#collections.namedtuple" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">collections.namedtuple</span></code></a> and can be
used either as a tuple <code class="docutils literal"><span class="pre">(args,</span> <span class="pre">kwargs)</span></code> or an object with attributes
<code class="docutils literal"><span class="pre">args</span></code> and <code class="docutils literal"><span class="pre">kwargs</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.gen.convert_yielded">
<code class="descclassname">tornado.gen.</code><code class="descname">convert_yielded</code><span class="sig-paren">(</span><em>yielded</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#convert_yielded"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.convert_yielded" title="永久链接至目标">¶</a></dt>
<dd><p>Convert a yielded object into a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.</p>
<p>The default implementation accepts lists, dictionaries, and Futures.</p>
<p>If the <a class="reference external" href="https://docs.python.org/3.4/library/functools.html#functools.singledispatch" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">singledispatch</span></code></a> library is available, this function
may be extended to support additional types. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@convert_yielded</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">asyncio_future</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tornado</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">asyncio</span><span class="o">.</span><span class="n">to_tornado_future</span><span class="p">(</span><span class="n">asyncio_future</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">4.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.gen.maybe_future">
<code class="descclassname">tornado.gen.</code><code class="descname">maybe_future</code><span class="sig-paren">(</span><em>x</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#maybe_future"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.maybe_future" title="永久链接至目标">¶</a></dt>
<dd><p>Converts <code class="docutils literal"><span class="pre">x</span></code> into a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.</p>
<p>If <code class="docutils literal"><span class="pre">x</span></code> is already a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>, it is simply returned; otherwise
it is wrapped in a new <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.  This is suitable for use as
<code class="docutils literal"><span class="pre">result</span> <span class="pre">=</span> <span class="pre">yield</span> <span class="pre">gen.maybe_future(f())</span></code> when you don&#8217;t know whether
<code class="docutils literal"><span class="pre">f()</span></code> returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> or not.</p>
<div class="deprecated">
<p><span class="versionmodified">4.3 版后已移除: </span>This function only handles <code class="docutils literal"><span class="pre">Futures</span></code>, not other yieldable objects.
Instead of <a class="reference internal" href="#tornado.gen.maybe_future" title="tornado.gen.maybe_future"><code class="xref py py-obj docutils literal"><span class="pre">maybe_future</span></code></a>, check for the non-future result types
you expect (often just <code class="docutils literal"><span class="pre">None</span></code>), and <code class="docutils literal"><span class="pre">yield</span></code> anything unknown.</p>
</div>
</dd></dl>

</div>
<div class="section" id="legacy-interface">
<h5>Legacy interface<a class="headerlink" href="#legacy-interface" title="永久链接至标题">¶</a></h5>
<p>Before support for <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Futures</span></code></a> was introduced in Tornado 3.0,
coroutines used subclasses of <a class="reference internal" href="#tornado.gen.YieldPoint" title="tornado.gen.YieldPoint"><code class="xref py py-obj docutils literal"><span class="pre">YieldPoint</span></code></a> in their <code class="docutils literal"><span class="pre">yield</span></code> expressions.
These classes are still supported but should generally not be used
except for compatibility with older interfaces. None of these classes
are compatible with native (<code class="docutils literal"><span class="pre">await</span></code>-based) coroutines.</p>
<dl class="class">
<dt id="tornado.gen.YieldPoint">
<em class="property">class </em><code class="descclassname">tornado.gen.</code><code class="descname">YieldPoint</code><a class="reference internal" href="_modules/tornado/gen.html#YieldPoint"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.YieldPoint" title="永久链接至目标">¶</a></dt>
<dd><p>Base class for objects that may be yielded from the generator.</p>
<div class="deprecated">
<p><span class="versionmodified">4.0 版后已移除: </span>Use <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Futures</span></code></a> instead.</p>
</div>
<dl class="method">
<dt id="tornado.gen.YieldPoint.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>runner</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#YieldPoint.start"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.YieldPoint.start" title="永久链接至目标">¶</a></dt>
<dd><p>Called by the runner after the generator has yielded.</p>
<p>No other methods will be called on this object before <code class="docutils literal"><span class="pre">start</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.gen.YieldPoint.is_ready">
<code class="descname">is_ready</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#YieldPoint.is_ready"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.YieldPoint.is_ready" title="永久链接至目标">¶</a></dt>
<dd><p>Called by the runner to determine whether to resume the generator.</p>
<p>Returns a boolean; may be called more than once.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.gen.YieldPoint.get_result">
<code class="descname">get_result</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#YieldPoint.get_result"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.YieldPoint.get_result" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the value to use as the result of the yield expression.</p>
<p>This method will only be called once, and only after <a class="reference internal" href="#tornado.gen.YieldPoint.is_ready" title="tornado.gen.YieldPoint.is_ready"><code class="xref py py-obj docutils literal"><span class="pre">is_ready</span></code></a>
has returned true.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.gen.Callback">
<em class="property">class </em><code class="descclassname">tornado.gen.</code><code class="descname">Callback</code><span class="sig-paren">(</span><em>key</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#Callback"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.Callback" title="永久链接至目标">¶</a></dt>
<dd><p>Returns a callable object that will allow a matching <a class="reference internal" href="#tornado.gen.Wait" title="tornado.gen.Wait"><code class="xref py py-obj docutils literal"><span class="pre">Wait</span></code></a> to proceed.</p>
<p>The key may be any value suitable for use as a dictionary key, and is
used to match <code class="docutils literal"><span class="pre">Callbacks</span></code> to their corresponding <code class="docutils literal"><span class="pre">Waits</span></code>.  The key
must be unique among outstanding callbacks within a single run of the
generator function, but may be reused across different runs of the same
function (so constants generally work fine).</p>
<p>The callback may be called with zero or one arguments; if an argument
is given it will be returned by <a class="reference internal" href="#tornado.gen.Wait" title="tornado.gen.Wait"><code class="xref py py-obj docutils literal"><span class="pre">Wait</span></code></a>.</p>
<div class="deprecated">
<p><span class="versionmodified">4.0 版后已移除: </span>Use <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Futures</span></code></a> instead.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.gen.Wait">
<em class="property">class </em><code class="descclassname">tornado.gen.</code><code class="descname">Wait</code><span class="sig-paren">(</span><em>key</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#Wait"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.Wait" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the argument passed to the result of a previous <a class="reference internal" href="#tornado.gen.Callback" title="tornado.gen.Callback"><code class="xref py py-obj docutils literal"><span class="pre">Callback</span></code></a>.</p>
<div class="deprecated">
<p><span class="versionmodified">4.0 版后已移除: </span>Use <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Futures</span></code></a> instead.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.gen.WaitAll">
<em class="property">class </em><code class="descclassname">tornado.gen.</code><code class="descname">WaitAll</code><span class="sig-paren">(</span><em>keys</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#WaitAll"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.WaitAll" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the results of multiple previous <a class="reference internal" href="#tornado.gen.Callback" title="tornado.gen.Callback"><code class="xref py py-obj docutils literal"><span class="pre">Callbacks</span></code></a>.</p>
<p>The argument is a sequence of <a class="reference internal" href="#tornado.gen.Callback" title="tornado.gen.Callback"><code class="xref py py-obj docutils literal"><span class="pre">Callback</span></code></a> keys, and the result is
a list of results in the same order.</p>
<p><a class="reference internal" href="#tornado.gen.WaitAll" title="tornado.gen.WaitAll"><code class="xref py py-obj docutils literal"><span class="pre">WaitAll</span></code></a> is equivalent to yielding a list of <a class="reference internal" href="#tornado.gen.Wait" title="tornado.gen.Wait"><code class="xref py py-obj docutils literal"><span class="pre">Wait</span></code></a> objects.</p>
<div class="deprecated">
<p><span class="versionmodified">4.0 版后已移除: </span>Use <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Futures</span></code></a> instead.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.gen.MultiYieldPoint">
<em class="property">class </em><code class="descclassname">tornado.gen.</code><code class="descname">MultiYieldPoint</code><span class="sig-paren">(</span><em>children</em>, <em>quiet_exceptions=()</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/gen.html#MultiYieldPoint"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.gen.MultiYieldPoint" title="永久链接至目标">¶</a></dt>
<dd><p>Runs multiple asynchronous operations in parallel.</p>
<p>This class is similar to <a class="reference internal" href="#tornado.gen.multi" title="tornado.gen.multi"><code class="xref py py-obj docutils literal"><span class="pre">multi</span></code></a>, but it always creates a stack
context even when no children require it. It is not compatible with
native coroutines.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.2 版更改: </span>If multiple <code class="docutils literal"><span class="pre">YieldPoints</span></code> fail, any exceptions after the first
(which is raised) will be logged. Added the <code class="docutils literal"><span class="pre">quiet_exceptions</span></code>
argument to suppress this logging for selected exception types.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>Renamed from <code class="docutils literal"><span class="pre">Multi</span></code> to <code class="docutils literal"><span class="pre">MultiYieldPoint</span></code>. The name <code class="docutils literal"><span class="pre">Multi</span></code>
remains as an alias for the equivalent <a class="reference internal" href="#tornado.gen.multi" title="tornado.gen.multi"><code class="xref py py-obj docutils literal"><span class="pre">multi</span></code></a> function.</p>
</div>
<div class="deprecated">
<p><span class="versionmodified">4.3 版后已移除: </span>Use <a class="reference internal" href="#tornado.gen.multi" title="tornado.gen.multi"><code class="xref py py-obj docutils literal"><span class="pre">multi</span></code></a> instead.</p>
</div>
</dd></dl>

</div>
</div>
<span id="document-concurrent"></span><div class="section" id="tornado-concurrent-work-with-threads-and-futures">
<h4><code class="docutils literal"><span class="pre">tornado.concurrent</span></code> &#8212; Work with threads and futures<a class="headerlink" href="#tornado-concurrent-work-with-threads-and-futures" title="永久链接至标题">¶</a></h4>
<span class="target" id="module-tornado.concurrent"></span><p>Utilities for working with threads and <code class="docutils literal"><span class="pre">Futures</span></code>.</p>
<p><code class="docutils literal"><span class="pre">Futures</span></code> are a pattern for concurrent programming introduced in
Python 3.2 in the <a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#module-concurrent.futures" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures</span></code></a> package. This package defines
a mostly-compatible <a class="reference internal" href="#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> class designed for use from coroutines,
as well as some utility functions for interacting with the
<a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#module-concurrent.futures" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures</span></code></a> package.</p>
<dl class="class">
<dt id="tornado.concurrent.Future">
<em class="property">class </em><code class="descclassname">tornado.concurrent.</code><code class="descname">Future</code><a class="reference internal" href="_modules/tornado/concurrent.html#Future"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.Future" title="永久链接至目标">¶</a></dt>
<dd><p>Placeholder for an asynchronous result.</p>
<p>A <code class="docutils literal"><span class="pre">Future</span></code> encapsulates the result of an asynchronous
operation.  In synchronous applications <code class="docutils literal"><span class="pre">Futures</span></code> are used
to wait for the result from a thread or process pool; in
Tornado they are normally used with <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_future" title="tornado.ioloop.IOLoop.add_future"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_future</span></code></a> or by
yielding them in a <a class="reference internal" href="index.html#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">gen.coroutine</span></code></a>.</p>
<p><a class="reference internal" href="#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">tornado.concurrent.Future</span></code></a> is similar to
<a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#concurrent.futures.Future" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures.Future</span></code></a>, but not thread-safe (and therefore
faster for use with single-threaded event loops).</p>
<p>In addition to <code class="docutils literal"><span class="pre">exception</span></code> and <code class="docutils literal"><span class="pre">set_exception</span></code>, methods <code class="docutils literal"><span class="pre">exc_info</span></code>
and <code class="docutils literal"><span class="pre">set_exc_info</span></code> are supported to capture tracebacks in Python 2.
The traceback is automatically available in Python 3, but in the
Python 2 futures backport this information is discarded.
This functionality was previously available in a separate class
<code class="docutils literal"><span class="pre">TracebackFuture</span></code>, which is now a deprecated alias for this class.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span><a class="reference internal" href="#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">tornado.concurrent.Future</span></code></a> is always a thread-unsafe <code class="docutils literal"><span class="pre">Future</span></code>
with support for the <code class="docutils literal"><span class="pre">exc_info</span></code> methods.  Previously it would
be an alias for the thread-safe <a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#concurrent.futures.Future" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures.Future</span></code></a>
if that package was available and fall back to the thread-unsafe
implementation if it was not.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>If a <a class="reference internal" href="#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> contains an error but that error is never observed
(by calling <code class="docutils literal"><span class="pre">result()</span></code>, <code class="docutils literal"><span class="pre">exception()</span></code>, or <code class="docutils literal"><span class="pre">exc_info()</span></code>),
a stack trace will be logged when the <a class="reference internal" href="#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> is garbage collected.
This normally indicates an error in the application, but in cases
where it results in undesired logging it may be necessary to
suppress the logging by ensuring that the exception is observed:
<code class="docutils literal"><span class="pre">f.add_done_callback(lambda</span> <span class="pre">f:</span> <span class="pre">f.exception())</span></code>.</p>
</div>
</dd></dl>

<div class="section" id="consumer-methods">
<h5>Consumer methods<a class="headerlink" href="#consumer-methods" title="永久链接至标题">¶</a></h5>
<dl class="method">
<dt id="tornado.concurrent.Future.result">
<code class="descclassname">Future.</code><code class="descname">result</code><span class="sig-paren">(</span><em>timeout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/concurrent.html#Future.result"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.Future.result" title="永久链接至目标">¶</a></dt>
<dd><p>If the operation succeeded, return its result.  If it failed,
re-raise its exception.</p>
<p>This method takes a <code class="docutils literal"><span class="pre">timeout</span></code> argument for compatibility with
<a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#concurrent.futures.Future" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures.Future</span></code></a> but it is an error to call it
before the <a class="reference internal" href="#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> is done, so the <code class="docutils literal"><span class="pre">timeout</span></code> is never used.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.concurrent.Future.exception">
<code class="descclassname">Future.</code><code class="descname">exception</code><span class="sig-paren">(</span><em>timeout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/concurrent.html#Future.exception"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.Future.exception" title="永久链接至目标">¶</a></dt>
<dd><p>If the operation raised an exception, return the <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#Exception" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">Exception</span></code></a>
object.  Otherwise returns None.</p>
<p>This method takes a <code class="docutils literal"><span class="pre">timeout</span></code> argument for compatibility with
<a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#concurrent.futures.Future" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures.Future</span></code></a> but it is an error to call it
before the <a class="reference internal" href="#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> is done, so the <code class="docutils literal"><span class="pre">timeout</span></code> is never used.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.concurrent.Future.exc_info">
<code class="descclassname">Future.</code><code class="descname">exc_info</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/concurrent.html#Future.exc_info"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.Future.exc_info" title="永久链接至目标">¶</a></dt>
<dd><p>Returns a tuple in the same format as <a class="reference external" href="https://docs.python.org/3.4/library/sys.html#sys.exc_info" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">sys.exc_info</span></code></a> or None.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.concurrent.Future.add_done_callback">
<code class="descclassname">Future.</code><code class="descname">add_done_callback</code><span class="sig-paren">(</span><em>fn</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/concurrent.html#Future.add_done_callback"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.Future.add_done_callback" title="永久链接至目标">¶</a></dt>
<dd><p>Attaches the given callback to the <a class="reference internal" href="#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.</p>
<p>It will be invoked with the <a class="reference internal" href="#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> as its argument when the Future
has finished running and its result is available.  In Tornado
consider using <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_future" title="tornado.ioloop.IOLoop.add_future"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_future</span></code></a> instead of calling
<a class="reference internal" href="#tornado.concurrent.Future.add_done_callback" title="tornado.concurrent.Future.add_done_callback"><code class="xref py py-obj docutils literal"><span class="pre">add_done_callback</span></code></a> directly.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.concurrent.Future.done">
<code class="descclassname">Future.</code><code class="descname">done</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/concurrent.html#Future.done"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.Future.done" title="永久链接至目标">¶</a></dt>
<dd><p>Returns True if the future has finished running.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.concurrent.Future.running">
<code class="descclassname">Future.</code><code class="descname">running</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/concurrent.html#Future.running"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.Future.running" title="永久链接至目标">¶</a></dt>
<dd><p>Returns True if this operation is currently running.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.concurrent.Future.cancel">
<code class="descclassname">Future.</code><code class="descname">cancel</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/concurrent.html#Future.cancel"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.Future.cancel" title="永久链接至目标">¶</a></dt>
<dd><p>Cancel the operation, if possible.</p>
<p>Tornado <code class="docutils literal"><span class="pre">Futures</span></code> do not support cancellation, so this method always
returns False.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.concurrent.Future.cancelled">
<code class="descclassname">Future.</code><code class="descname">cancelled</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/concurrent.html#Future.cancelled"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.Future.cancelled" title="永久链接至目标">¶</a></dt>
<dd><p>Returns True if the operation has been cancelled.</p>
<p>Tornado <code class="docutils literal"><span class="pre">Futures</span></code> do not support cancellation, so this method
always returns False.</p>
</dd></dl>

</div>
<div class="section" id="producer-methods">
<h5>Producer methods<a class="headerlink" href="#producer-methods" title="永久链接至标题">¶</a></h5>
<dl class="method">
<dt id="tornado.concurrent.Future.set_result">
<code class="descclassname">Future.</code><code class="descname">set_result</code><span class="sig-paren">(</span><em>result</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/concurrent.html#Future.set_result"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.Future.set_result" title="永久链接至目标">¶</a></dt>
<dd><p>Sets the result of a <code class="docutils literal"><span class="pre">Future</span></code>.</p>
<p>It is undefined to call any of the <code class="docutils literal"><span class="pre">set</span></code> methods more than once
on the same object.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.concurrent.Future.set_exception">
<code class="descclassname">Future.</code><code class="descname">set_exception</code><span class="sig-paren">(</span><em>exception</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/concurrent.html#Future.set_exception"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.Future.set_exception" title="永久链接至目标">¶</a></dt>
<dd><p>Sets the exception of a <code class="docutils literal"><span class="pre">Future.</span></code></p>
</dd></dl>

<dl class="method">
<dt id="tornado.concurrent.Future.set_exc_info">
<code class="descclassname">Future.</code><code class="descname">set_exc_info</code><span class="sig-paren">(</span><em>exc_info</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/concurrent.html#Future.set_exc_info"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.Future.set_exc_info" title="永久链接至目标">¶</a></dt>
<dd><p>Sets the exception information of a <code class="docutils literal"><span class="pre">Future.</span></code></p>
<p>Preserves tracebacks on Python 2.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.concurrent.run_on_executor">
<code class="descclassname">tornado.concurrent.</code><code class="descname">run_on_executor</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/concurrent.html#run_on_executor"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.run_on_executor" title="永久链接至目标">¶</a></dt>
<dd><p>Decorator to run a synchronous method asynchronously on an executor.</p>
<p>The decorated method may be called with a <code class="docutils literal"><span class="pre">callback</span></code> keyword
argument and returns a future.</p>
<p>The <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> and executor to be used are determined by the <code class="docutils literal"><span class="pre">io_loop</span></code>
and <code class="docutils literal"><span class="pre">executor</span></code> attributes of <code class="docutils literal"><span class="pre">self</span></code>. To use different attributes,
pass keyword arguments to the decorator:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@run_on_executor</span><span class="p">(</span><span class="n">executor</span><span class="o">=</span><span class="s1">&#39;_thread_pool&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.2 版更改: </span>Added keyword arguments to use alternative attributes.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.concurrent.return_future">
<code class="descclassname">tornado.concurrent.</code><code class="descname">return_future</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/concurrent.html#return_future"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.return_future" title="永久链接至目标">¶</a></dt>
<dd><p>Decorator to make a function that returns via callback return a
<a class="reference internal" href="#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.</p>
<p>The wrapped function should take a <code class="docutils literal"><span class="pre">callback</span></code> keyword argument
and invoke it with one argument when it has finished.  To signal failure,
the function can simply raise an exception (which will be
captured by the <a class="reference internal" href="index.html#tornado.stack_context.StackContext" title="tornado.stack_context.StackContext"><code class="xref py py-obj docutils literal"><span class="pre">StackContext</span></code></a> and passed along to the <code class="docutils literal"><span class="pre">Future</span></code>).</p>
<p>From the caller&#8217;s perspective, the callback argument is optional.
If one is given, it will be invoked when the function is complete
with <a class="reference internal" href="#tornado.concurrent.Future.result" title="tornado.concurrent.Future.result"><code class="xref py py-obj docutils literal"><span class="pre">Future.result()</span></code></a> as an argument.  If the function fails, the
callback will not be run and an exception will be raised into the
surrounding <a class="reference internal" href="index.html#tornado.stack_context.StackContext" title="tornado.stack_context.StackContext"><code class="xref py py-obj docutils literal"><span class="pre">StackContext</span></code></a>.</p>
<p>If no callback is given, the caller should use the <code class="docutils literal"><span class="pre">Future</span></code> to
wait for the function to complete (perhaps by yielding it in a
<a class="reference internal" href="index.html#tornado.gen.engine" title="tornado.gen.engine"><code class="xref py py-obj docutils literal"><span class="pre">gen.engine</span></code></a> function, or passing it to <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_future" title="tornado.ioloop.IOLoop.add_future"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_future</span></code></a>).</p>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@return_future</span>
<span class="k">def</span> <span class="nf">future_func</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
    <span class="c1"># Do stuff (possibly asynchronous)</span>
    <span class="n">callback</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">engine</span>
<span class="k">def</span> <span class="nf">caller</span><span class="p">(</span><span class="n">callback</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">future_func</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
    <span class="n">callback</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">&#64;return_future</span></code> and <code class="docutils literal"><span class="pre">&#64;gen.engine</span></code> can be applied to the
same function, provided <code class="docutils literal"><span class="pre">&#64;return_future</span></code> appears first.  However,
consider using <code class="docutils literal"><span class="pre">&#64;gen.coroutine</span></code> instead of this combination.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.concurrent.chain_future">
<code class="descclassname">tornado.concurrent.</code><code class="descname">chain_future</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/concurrent.html#chain_future"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.concurrent.chain_future" title="永久链接至目标">¶</a></dt>
<dd><p>Chain two futures together so that when one completes, so does the other.</p>
<p>The result (success or failure) of <code class="docutils literal"><span class="pre">a</span></code> will be copied to <code class="docutils literal"><span class="pre">b</span></code>, unless
<code class="docutils literal"><span class="pre">b</span></code> has already been completed or cancelled by the time <code class="docutils literal"><span class="pre">a</span></code> finishes.</p>
</dd></dl>

</div>
</div>
<span id="document-locks"></span><div class="section" id="tornado-locks">
<h4><code class="docutils literal"><span class="pre">tornado.locks</span></code> &#8211; 同步原语<a class="headerlink" href="#tornado-locks" title="永久链接至标题">¶</a></h4>
<div class="versionadded">
<p><span class="versionmodified">4.2 新版功能.</span></p>
</div>
<p>使用和标准库提供给线程相似的同步原语协调协程.</p>
<p><em>(请注意, 这些原语不是线程安全的, 不能被用来代替标准库中的&#8211;它
们是为了协调在单线程app中的Tornado协程, 而不是为了在一个多线程
app中保护共享对象.)</em></p>
<span class="target" id="module-tornado.locks"></span><div class="section" id="condition">
<h5>Condition<a class="headerlink" href="#condition" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.locks.Condition">
<em class="property">class </em><code class="descclassname">tornado.locks.</code><code class="descname">Condition</code><a class="reference internal" href="_modules/tornado/locks.html#Condition"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Condition" title="永久链接至目标">¶</a></dt>
<dd><p>允许一个或多个协程等待直到被通知的条件.</p>
<p>就像标准的 <a class="reference external" href="https://docs.python.org/3.4/library/threading.html#threading.Condition" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">threading.Condition</span></code></a>, 但是不需要一个被获取和释放的底层锁.</p>
<p>通过 <a class="reference internal" href="#tornado.locks.Condition" title="tornado.locks.Condition"><code class="xref py py-obj docutils literal"><span class="pre">Condition</span></code></a>, 协程可以等待着被其他协程通知:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado</span> <span class="k">import</span> <span class="n">gen</span>
<span class="kn">from</span> <span class="nn">tornado.ioloop</span> <span class="k">import</span> <span class="n">IOLoop</span>
<span class="kn">from</span> <span class="nn">tornado.locks</span> <span class="k">import</span> <span class="n">Condition</span>

<span class="n">condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">()</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">waiter</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I&#39;ll wait right here&quot;</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">condition</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>  <span class="c1"># Yield a Future.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I&#39;m done waiting&quot;</span><span class="p">)</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">notifier</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;About to notify&quot;</span><span class="p">)</span>
    <span class="n">condition</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done notifying&quot;</span><span class="p">)</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">runner</span><span class="p">():</span>
    <span class="c1"># Yield two Futures; wait for waiter() and notifier() to finish.</span>
    <span class="k">yield</span> <span class="p">[</span><span class="n">waiter</span><span class="p">(),</span> <span class="n">notifier</span><span class="p">()]</span>

<span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">runner</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>I&#39;ll wait right here
About to notify
Done notifying
I&#39;m done waiting
</pre></div>
</div>
<p><a class="reference internal" href="#tornado.locks.Condition.wait" title="tornado.locks.Condition.wait"><code class="xref py py-obj docutils literal"><span class="pre">wait</span></code></a> 有一个可选参数 <code class="docutils literal"><span class="pre">timeout</span></code> , 要不然是一个绝对的时间戳:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">io_loop</span> <span class="o">=</span> <span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span>

<span class="c1"># Wait up to 1 second for a notification.</span>
<span class="k">yield</span> <span class="n">condition</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">io_loop</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>...或一个 <a class="reference external" href="https://docs.python.org/3.4/library/datetime.html#datetime.timedelta" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">datetime.timedelta</span></code></a> 相对于当前时间的一个延时:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Wait up to 1 second.</span>
<span class="k">yield</span> <span class="n">condition</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>这个方法将抛出一个 <a class="reference internal" href="index.html#tornado.gen.TimeoutError" title="tornado.gen.TimeoutError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.TimeoutError</span></code></a> 如果在最后时间之前都
没有通知.</p>
<dl class="method">
<dt id="tornado.locks.Condition.wait">
<code class="descname">wait</code><span class="sig-paren">(</span><em>timeout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locks.html#Condition.wait"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Condition.wait" title="永久链接至目标">¶</a></dt>
<dd><p>等待 <a class="reference internal" href="#tornado.locks.Condition.notify" title="tornado.locks.Condition.notify"><code class="xref py py-obj docutils literal"><span class="pre">notify</span></code></a>.</p>
<p>返回一个 <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> 对象, 如果条件被通知则为 <code class="docutils literal"><span class="pre">True</span></code> ,
或者在超时之后为 <code class="docutils literal"><span class="pre">False</span></code> .</p>
</dd></dl>

<dl class="method">
<dt id="tornado.locks.Condition.notify">
<code class="descname">notify</code><span class="sig-paren">(</span><em>n=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locks.html#Condition.notify"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Condition.notify" title="永久链接至目标">¶</a></dt>
<dd><p>唤醒 <code class="docutils literal"><span class="pre">n</span></code> 个等待者(waiters) .</p>
</dd></dl>

<dl class="method">
<dt id="tornado.locks.Condition.notify_all">
<code class="descname">notify_all</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locks.html#Condition.notify_all"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Condition.notify_all" title="永久链接至目标">¶</a></dt>
<dd><p>唤醒全部的等待者(waiters) .</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="event">
<h5>Event<a class="headerlink" href="#event" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.locks.Event">
<em class="property">class </em><code class="descclassname">tornado.locks.</code><code class="descname">Event</code><a class="reference internal" href="_modules/tornado/locks.html#Event"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Event" title="永久链接至目标">¶</a></dt>
<dd><p>一个阻塞协程的事件直到它的内部标识设置为True.</p>
<p>类似于 <a class="reference external" href="https://docs.python.org/3.4/library/threading.html#threading.Event" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">threading.Event</span></code></a>.</p>
<p>协程可以等待一个事件被设置. 一旦它被设置, 调用
<code class="docutils literal"><span class="pre">yield</span> <span class="pre">event.wait()</span></code> 将不会被阻塞除非该事件已经被清除:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado</span> <span class="k">import</span> <span class="n">gen</span>
<span class="kn">from</span> <span class="nn">tornado.ioloop</span> <span class="k">import</span> <span class="n">IOLoop</span>
<span class="kn">from</span> <span class="nn">tornado.locks</span> <span class="k">import</span> <span class="n">Event</span>

<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">waiter</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Waiting for event&quot;</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">event</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not waiting this time&quot;</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">event</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">)</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">setter</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;About to set the event&quot;</span><span class="p">)</span>
    <span class="n">event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">runner</span><span class="p">():</span>
    <span class="k">yield</span> <span class="p">[</span><span class="n">waiter</span><span class="p">(),</span> <span class="n">setter</span><span class="p">()]</span>

<span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">runner</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>Waiting for event
About to set the event
Not waiting this time
Done
</pre></div>
</div>
<dl class="method">
<dt id="tornado.locks.Event.is_set">
<code class="descname">is_set</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locks.html#Event.is_set"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Event.is_set" title="永久链接至目标">¶</a></dt>
<dd><p>如果内部标识是true将返回 <code class="docutils literal"><span class="pre">True</span></code> .</p>
</dd></dl>

<dl class="method">
<dt id="tornado.locks.Event.set">
<code class="descname">set</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locks.html#Event.set"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Event.set" title="永久链接至目标">¶</a></dt>
<dd><p>设置内部标识为 <code class="docutils literal"><span class="pre">True</span></code>. 所有的等待者(waiters)都被唤醒.</p>
<p>一旦该标识被设置调用 <a class="reference internal" href="#tornado.locks.Event.wait" title="tornado.locks.Event.wait"><code class="xref py py-obj docutils literal"><span class="pre">wait</span></code></a> 将不会阻塞.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.locks.Event.clear">
<code class="descname">clear</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locks.html#Event.clear"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Event.clear" title="永久链接至目标">¶</a></dt>
<dd><p>重置内部标识为 <code class="docutils literal"><span class="pre">False</span></code>.</p>
<p>调用 <a class="reference internal" href="#tornado.locks.Event.wait" title="tornado.locks.Event.wait"><code class="xref py py-obj docutils literal"><span class="pre">wait</span></code></a> 将阻塞直到 <a class="reference internal" href="#tornado.locks.Event.set" title="tornado.locks.Event.set"><code class="xref py py-obj docutils literal"><span class="pre">set</span></code></a> 被调用.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.locks.Event.wait">
<code class="descname">wait</code><span class="sig-paren">(</span><em>timeout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locks.html#Event.wait"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Event.wait" title="永久链接至目标">¶</a></dt>
<dd><p>阻塞直到内部标识为true.</p>
<p>返回一个Future对象, 在超时之后会抛出一个 <a class="reference internal" href="index.html#tornado.gen.TimeoutError" title="tornado.gen.TimeoutError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.TimeoutError</span></code></a>
异常.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="semaphore">
<h5>Semaphore<a class="headerlink" href="#semaphore" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.locks.Semaphore">
<em class="property">class </em><code class="descclassname">tornado.locks.</code><code class="descname">Semaphore</code><span class="sig-paren">(</span><em>value=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locks.html#Semaphore"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Semaphore" title="永久链接至目标">¶</a></dt>
<dd><p>可以在阻塞之前获得固定次数的锁.</p>
<p>一个信号量管理着代表 <a class="reference internal" href="#tornado.locks.Semaphore.release" title="tornado.locks.Semaphore.release"><code class="xref py py-obj docutils literal"><span class="pre">release</span></code></a> 调用次数减去 <a class="reference internal" href="#tornado.locks.Semaphore.acquire" title="tornado.locks.Semaphore.acquire"><code class="xref py py-obj docutils literal"><span class="pre">acquire</span></code></a> 的
调用次数的计数器, 加一个初始值. 如果必要的话,`.acquire` 方
法将会阻塞, 直到它可以返回, 而不使该计数器成为负值.</p>
<p>信号量限制访问共享资源. 为了允许两个worker同时获得权限:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado</span> <span class="k">import</span> <span class="n">gen</span>
<span class="kn">from</span> <span class="nn">tornado.ioloop</span> <span class="k">import</span> <span class="n">IOLoop</span>
<span class="kn">from</span> <span class="nn">tornado.locks</span> <span class="k">import</span> <span class="n">Semaphore</span>

<span class="n">sem</span> <span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="n">worker_id</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">sem</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Worker </span><span class="si">%d</span><span class="s2"> is working&quot;</span> <span class="o">%</span> <span class="n">worker_id</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">use_some_resource</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Worker </span><span class="si">%d</span><span class="s2"> is done&quot;</span> <span class="o">%</span> <span class="n">worker_id</span><span class="p">)</span>
        <span class="n">sem</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">runner</span><span class="p">():</span>
    <span class="c1"># Join all workers.</span>
    <span class="k">yield</span> <span class="p">[</span><span class="n">worker</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>

<span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">runner</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>Worker 0 is working
Worker 1 is working
Worker 0 is done
Worker 2 is working
Worker 1 is done
Worker 2 is done
</pre></div>
</div>
<p>Workers 0 和 1 允许并行运行, 但是worker 2将等待直到
信号量被worker 0释放.</p>
<p><a class="reference internal" href="#tornado.locks.Semaphore.acquire" title="tornado.locks.Semaphore.acquire"><code class="xref py py-obj docutils literal"><span class="pre">acquire</span></code></a> 是一个上下文管理器, 所以 <code class="docutils literal"><span class="pre">worker</span></code> 可以被写为:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="n">worker_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="p">(</span><span class="k">yield</span> <span class="n">sem</span><span class="o">.</span><span class="n">acquire</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Worker </span><span class="si">%d</span><span class="s2"> is working&quot;</span> <span class="o">%</span> <span class="n">worker_id</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">use_some_resource</span><span class="p">()</span>

    <span class="c1"># Now the semaphore has been released.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Worker </span><span class="si">%d</span><span class="s2"> is done&quot;</span> <span class="o">%</span> <span class="n">worker_id</span><span class="p">)</span>
</pre></div>
</div>
<p>在 Python 3.5 中, 信号量自身可以作为一个异步上下文管理器:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="n">worker_id</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">sem</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Worker </span><span class="si">%d</span><span class="s2"> is working&quot;</span> <span class="o">%</span> <span class="n">worker_id</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">use_some_resource</span><span class="p">()</span>

    <span class="c1"># Now the semaphore has been released.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Worker </span><span class="si">%d</span><span class="s2"> is done&quot;</span> <span class="o">%</span> <span class="n">worker_id</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>添加对 Python 3.5 <code class="docutils literal"><span class="pre">async</span> <span class="pre">with</span></code> 的支持.</p>
</div>
<dl class="method">
<dt id="tornado.locks.Semaphore.release">
<code class="descname">release</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locks.html#Semaphore.release"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Semaphore.release" title="永久链接至目标">¶</a></dt>
<dd><p>增加counter 并且唤醒一个waiter.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.locks.Semaphore.acquire">
<code class="descname">acquire</code><span class="sig-paren">(</span><em>timeout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locks.html#Semaphore.acquire"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Semaphore.acquire" title="永久链接至目标">¶</a></dt>
<dd><p>递减计数器. 返回一个 Future 对象.</p>
<p>如果计数器(counter)为0将会阻塞, 等待 <a class="reference internal" href="#tornado.locks.Semaphore.release" title="tornado.locks.Semaphore.release"><code class="xref py py-obj docutils literal"><span class="pre">release</span></code></a>. 在超时之后
Future 对象将会抛出 <a class="reference internal" href="index.html#tornado.gen.TimeoutError" title="tornado.gen.TimeoutError"><code class="xref py py-obj docutils literal"><span class="pre">TimeoutError</span></code></a> .</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="boundedsemaphore">
<h5>BoundedSemaphore<a class="headerlink" href="#boundedsemaphore" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.locks.BoundedSemaphore">
<em class="property">class </em><code class="descclassname">tornado.locks.</code><code class="descname">BoundedSemaphore</code><span class="sig-paren">(</span><em>value=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locks.html#BoundedSemaphore"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.BoundedSemaphore" title="永久链接至目标">¶</a></dt>
<dd><p>一个防止release() 被调用太多次的信号量.</p>
<p>如果 <a class="reference internal" href="#tornado.locks.BoundedSemaphore.release" title="tornado.locks.BoundedSemaphore.release"><code class="xref py py-obj docutils literal"><span class="pre">release</span></code></a> 增加信号量的值超过初始值, 它将抛出 <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#ValueError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ValueError</span></code></a>.
信号量通常是通过限制容量来保护资源, 所以一个信号量释放太多次是
一个错误的标志.</p>
<dl class="method">
<dt id="tornado.locks.BoundedSemaphore.release">
<code class="descname">release</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locks.html#BoundedSemaphore.release"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.BoundedSemaphore.release" title="永久链接至目标">¶</a></dt>
<dd><p>增加counter 并且唤醒一个waiter.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.locks.BoundedSemaphore.acquire">
<code class="descname">acquire</code><span class="sig-paren">(</span><em>timeout=None</em><span class="sig-paren">)</span><a class="headerlink" href="#tornado.locks.BoundedSemaphore.acquire" title="永久链接至目标">¶</a></dt>
<dd><p>递减计数器. 返回一个 Future 对象.</p>
<p>如果计数器(counter)为0将会阻塞, 等待 <a class="reference internal" href="#tornado.locks.BoundedSemaphore.release" title="tornado.locks.BoundedSemaphore.release"><code class="xref py py-obj docutils literal"><span class="pre">release</span></code></a>. 在超时之后
Future 对象将会抛出 <a class="reference internal" href="index.html#tornado.gen.TimeoutError" title="tornado.gen.TimeoutError"><code class="xref py py-obj docutils literal"><span class="pre">TimeoutError</span></code></a> .</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="lock">
<h5>Lock<a class="headerlink" href="#lock" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.locks.Lock">
<em class="property">class </em><code class="descclassname">tornado.locks.</code><code class="descname">Lock</code><a class="reference internal" href="_modules/tornado/locks.html#Lock"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Lock" title="永久链接至目标">¶</a></dt>
<dd><p>协程的锁.</p>
<p>一个Lock开始解锁, 然后它立即 <a class="reference internal" href="#tornado.locks.Lock.acquire" title="tornado.locks.Lock.acquire"><code class="xref py py-obj docutils literal"><span class="pre">acquire</span></code></a> 锁. 虽然它是锁着的,
一个协程yield <a class="reference internal" href="#tornado.locks.Lock.acquire" title="tornado.locks.Lock.acquire"><code class="xref py py-obj docutils literal"><span class="pre">acquire</span></code></a> 并等待, 直到另一个协程调用 <a class="reference internal" href="#tornado.locks.Lock.release" title="tornado.locks.Lock.release"><code class="xref py py-obj docutils literal"><span class="pre">release</span></code></a>.</p>
<p>释放一个没锁住的锁将抛出 <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#RuntimeError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">RuntimeError</span></code></a>.</p>
<p>在所有Python 版本中 <a class="reference internal" href="#tornado.locks.Lock.acquire" title="tornado.locks.Lock.acquire"><code class="xref py py-obj docutils literal"><span class="pre">acquire</span></code></a> 支持上下文管理协议:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tornado</span> <span class="k">import</span> <span class="n">gen</span><span class="p">,</span> <span class="n">locks</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lock</span> <span class="o">=</span> <span class="n">locks</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
<span class="gp">... </span>   <span class="k">with</span> <span class="p">(</span><span class="k">yield</span> <span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()):</span>
<span class="gp">... </span>       <span class="c1"># Do something holding the lock.</span>
<span class="gp">... </span>       <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">... </span>   <span class="c1"># Now the lock is released.</span>
</pre></div>
</div>
<p>在Python 3.5, <a class="reference internal" href="#tornado.locks.Lock" title="tornado.locks.Lock"><code class="xref py py-obj docutils literal"><span class="pre">Lock</span></code></a> 也支持异步上下文管理协议(async context manager
protocol). 注意在这种情况下没有 <a class="reference internal" href="#tornado.locks.Lock.acquire" title="tornado.locks.Lock.acquire"><code class="xref py py-obj docutils literal"><span class="pre">acquire</span></code></a>, 因为
<code class="docutils literal"><span class="pre">async</span> <span class="pre">with</span></code> 同时包含 <code class="docutils literal"><span class="pre">yield</span></code> 和 <code class="docutils literal"><span class="pre">acquire</span></code>
(就像 <a class="reference external" href="https://docs.python.org/3.4/library/threading.html#threading.Lock" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">threading.Lock</span></code></a>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">async</span> <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>  
<span class="gp">... </span>   <span class="k">async</span> <span class="k">with</span> <span class="n">lock</span><span class="p">:</span>
<span class="gp">... </span>       <span class="c1"># Do something holding the lock.</span>
<span class="gp">... </span>       <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">... </span>   <span class="c1"># Now the lock is released.</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 3.5 版更改: </span>添加Python 3.5 的 <code class="docutils literal"><span class="pre">async</span> <span class="pre">with</span></code> 支持.</p>
</div>
<dl class="method">
<dt id="tornado.locks.Lock.acquire">
<code class="descname">acquire</code><span class="sig-paren">(</span><em>timeout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locks.html#Lock.acquire"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Lock.acquire" title="永久链接至目标">¶</a></dt>
<dd><p>尝试锁. 返回一个Future 对象.</p>
<p>返回一个Future 对象, 在超时之后将抛出
<a class="reference internal" href="index.html#tornado.gen.TimeoutError" title="tornado.gen.TimeoutError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.TimeoutError</span></code></a> .</p>
</dd></dl>

<dl class="method">
<dt id="tornado.locks.Lock.release">
<code class="descname">release</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/locks.html#Lock.release"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.locks.Lock.release" title="永久链接至目标">¶</a></dt>
<dd><p>Unlock.</p>
<p>在队列中等待 <a class="reference internal" href="#tornado.locks.Lock.acquire" title="tornado.locks.Lock.acquire"><code class="xref py py-obj docutils literal"><span class="pre">acquire</span></code></a> 的第一个 coroutine 获得锁.</p>
<p>如果没有锁, 将抛出 <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#RuntimeError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">RuntimeError</span></code></a>.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<span id="document-queues"></span><div class="section" id="tornado-queues">
<h4><code class="docutils literal"><span class="pre">tornado.queues</span></code> &#8211; 协程的队列<a class="headerlink" href="#tornado-queues" title="永久链接至标题">¶</a></h4>
<div class="versionadded">
<p><span class="versionmodified">4.2 新版功能.</span></p>
</div>
<span class="target" id="module-tornado.queues"></span><div class="section" id="classes">
<h5>Classes<a class="headerlink" href="#classes" title="永久链接至标题">¶</a></h5>
<div class="section" id="queue">
<h6>Queue<a class="headerlink" href="#queue" title="永久链接至标题">¶</a></h6>
<dl class="class">
<dt id="tornado.queues.Queue">
<em class="property">class </em><code class="descclassname">tornado.queues.</code><code class="descname">Queue</code><span class="sig-paren">(</span><em>maxsize=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/queues.html#Queue"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.queues.Queue" title="永久链接至目标">¶</a></dt>
<dd><p>协调生产者消费者协程.</p>
<p>如果maxsize 是0(默认配置)意味着队列的大小是无限的.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado</span> <span class="k">import</span> <span class="n">gen</span>
<span class="kn">from</span> <span class="nn">tornado.ioloop</span> <span class="k">import</span> <span class="n">IOLoop</span>
<span class="kn">from</span> <span class="nn">tornado.queues</span> <span class="k">import</span> <span class="n">Queue</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">consumer</span><span class="p">():</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">item</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Doing work on </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">item</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">gen</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">q</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">producer</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Put </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">item</span><span class="p">)</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Start consumer without waiting (since it never finishes).</span>
    <span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">spawn_callback</span><span class="p">(</span><span class="n">consumer</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">producer</span><span class="p">()</span>     <span class="c1"># Wait for producer to put all tasks.</span>
    <span class="k">yield</span> <span class="n">q</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>       <span class="c1"># Wait for consumer to finish all tasks.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span>

<span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>Put 0
Put 1
Doing work on 0
Put 2
Doing work on 1
Put 3
Doing work on 2
Put 4
Doing work on 3
Doing work on 4
Done
</pre></div>
</div>
<p>在Python 3.5, <a class="reference internal" href="#tornado.queues.Queue" title="tornado.queues.Queue"><code class="xref py py-obj docutils literal"><span class="pre">Queue</span></code></a> 实现了异步迭代器协议, 所以
<code class="docutils literal"><span class="pre">consumer()</span></code> 可以被重写为:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">consumer</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">q</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Doing work on </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">item</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">gen</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">q</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>为Python 3.5添加 <code class="docutils literal"><span class="pre">async</span> <span class="pre">for</span></code> 支持 in Python 3.5.</p>
</div>
<dl class="attribute">
<dt id="tornado.queues.Queue.maxsize">
<code class="descname">maxsize</code><a class="headerlink" href="#tornado.queues.Queue.maxsize" title="永久链接至目标">¶</a></dt>
<dd><p>队列中允许的最大项目数.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.queues.Queue.qsize">
<code class="descname">qsize</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/queues.html#Queue.qsize"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.queues.Queue.qsize" title="永久链接至目标">¶</a></dt>
<dd><p>当前队列中的项目数.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.queues.Queue.put">
<code class="descname">put</code><span class="sig-paren">(</span><em>item</em>, <em>timeout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/queues.html#Queue.put"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.queues.Queue.put" title="永久链接至目标">¶</a></dt>
<dd><p>将一个项目放入队列中, 可能需要等待直到队列中有空间.</p>
<p>返回一个Future对象, 如果超时会抛出 <a class="reference internal" href="index.html#tornado.gen.TimeoutError" title="tornado.gen.TimeoutError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.TimeoutError</span></code></a> .</p>
</dd></dl>

<dl class="method">
<dt id="tornado.queues.Queue.put_nowait">
<code class="descname">put_nowait</code><span class="sig-paren">(</span><em>item</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/queues.html#Queue.put_nowait"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.queues.Queue.put_nowait" title="永久链接至目标">¶</a></dt>
<dd><p>非阻塞的将一个项目放入队列中.</p>
<p>如果没有立即可用的空闲插槽, 则抛出 <a class="reference internal" href="#tornado.queues.QueueFull" title="tornado.queues.QueueFull"><code class="xref py py-obj docutils literal"><span class="pre">QueueFull</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.queues.Queue.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>timeout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/queues.html#Queue.get"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.queues.Queue.get" title="永久链接至目标">¶</a></dt>
<dd><p>从队列中删除并返回一个项目.</p>
<p>返回一个Future对象, 当项目可用时resolve, 或者在超时后抛出
<a class="reference internal" href="index.html#tornado.gen.TimeoutError" title="tornado.gen.TimeoutError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.TimeoutError</span></code></a> .</p>
</dd></dl>

<dl class="method">
<dt id="tornado.queues.Queue.get_nowait">
<code class="descname">get_nowait</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/queues.html#Queue.get_nowait"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.queues.Queue.get_nowait" title="永久链接至目标">¶</a></dt>
<dd><p>非阻塞的从队列中删除并返回一个项目.</p>
<p>如果有项目是立即可用的则返回该项目, 否则抛出 <a class="reference internal" href="#tornado.queues.QueueEmpty" title="tornado.queues.QueueEmpty"><code class="xref py py-obj docutils literal"><span class="pre">QueueEmpty</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.queues.Queue.task_done">
<code class="descname">task_done</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/queues.html#Queue.task_done"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.queues.Queue.task_done" title="永久链接至目标">¶</a></dt>
<dd><p>表明前面排队的任务已经完成.</p>
<p>被消费者队列使用. 每个 <a class="reference internal" href="#tornado.queues.Queue.get" title="tornado.queues.Queue.get"><code class="xref py py-obj docutils literal"><span class="pre">get</span></code></a> 用来获取一个任务, 随后(subsequent)
调用 <a class="reference internal" href="#tornado.queues.Queue.task_done" title="tornado.queues.Queue.task_done"><code class="xref py py-obj docutils literal"><span class="pre">task_done</span></code></a> 告诉队列正在处理的任务已经完成.</p>
<p>如果 <a class="reference internal" href="#tornado.queues.Queue.join" title="tornado.queues.Queue.join"><code class="xref py py-obj docutils literal"><span class="pre">join</span></code></a> 正在阻塞, 它会在所有项目都被处理完后调起;
即当每个 <a class="reference internal" href="#tornado.queues.Queue.put" title="tornado.queues.Queue.put"><code class="xref py py-obj docutils literal"><span class="pre">put</span></code></a> 都被一个 <a class="reference internal" href="#tornado.queues.Queue.task_done" title="tornado.queues.Queue.task_done"><code class="xref py py-obj docutils literal"><span class="pre">task_done</span></code></a> 匹配.</p>
<p>如果调用次数超过 <a class="reference internal" href="#tornado.queues.Queue.put" title="tornado.queues.Queue.put"><code class="xref py py-obj docutils literal"><span class="pre">put</span></code></a> 将会抛出 <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#ValueError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ValueError</span></code></a> .</p>
</dd></dl>

<dl class="method">
<dt id="tornado.queues.Queue.join">
<code class="descname">join</code><span class="sig-paren">(</span><em>timeout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/queues.html#Queue.join"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.queues.Queue.join" title="永久链接至目标">¶</a></dt>
<dd><p>阻塞(block)直到队列中的所有项目都处理完.</p>
<p>返回一个Future对象, 超时后会抛出 <a class="reference internal" href="index.html#tornado.gen.TimeoutError" title="tornado.gen.TimeoutError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.TimeoutError</span></code></a> 异常.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="priorityqueue">
<h6>PriorityQueue<a class="headerlink" href="#priorityqueue" title="永久链接至标题">¶</a></h6>
<dl class="class">
<dt id="tornado.queues.PriorityQueue">
<em class="property">class </em><code class="descclassname">tornado.queues.</code><code class="descname">PriorityQueue</code><span class="sig-paren">(</span><em>maxsize=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/queues.html#PriorityQueue"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.queues.PriorityQueue" title="永久链接至目标">¶</a></dt>
<dd><p>一个有优先级的 <a class="reference internal" href="#tornado.queues.Queue" title="tornado.queues.Queue"><code class="xref py py-obj docutils literal"><span class="pre">Queue</span></code></a> 最小的最优先.</p>
<p>写入的条目通常是元组, 类似 <code class="docutils literal"><span class="pre">(priority</span> <span class="pre">number,</span> <span class="pre">data)</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado.queues</span> <span class="k">import</span> <span class="n">PriorityQueue</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">PriorityQueue</span><span class="p">()</span>
<span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;medium-priority item&#39;</span><span class="p">))</span>
<span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;high-priority item&#39;</span><span class="p">))</span>
<span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;low-priority item&#39;</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(0, &#39;high-priority item&#39;)
(1, &#39;medium-priority item&#39;)
(10, &#39;low-priority item&#39;)
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="lifoqueue">
<h6>LifoQueue<a class="headerlink" href="#lifoqueue" title="永久链接至标题">¶</a></h6>
<dl class="class">
<dt id="tornado.queues.LifoQueue">
<em class="property">class </em><code class="descclassname">tornado.queues.</code><code class="descname">LifoQueue</code><span class="sig-paren">(</span><em>maxsize=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/queues.html#LifoQueue"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.queues.LifoQueue" title="永久链接至目标">¶</a></dt>
<dd><p>一个后进先出(Lifo)的 <a class="reference internal" href="#tornado.queues.Queue" title="tornado.queues.Queue"><code class="xref py py-obj docutils literal"><span class="pre">Queue</span></code></a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado.queues</span> <span class="k">import</span> <span class="n">LifoQueue</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">LifoQueue</span><span class="p">()</span>
<span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>1
2
3
</pre></div>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="exceptions">
<h5>Exceptions<a class="headerlink" href="#exceptions" title="永久链接至标题">¶</a></h5>
<div class="section" id="queueempty">
<h6>QueueEmpty<a class="headerlink" href="#queueempty" title="永久链接至标题">¶</a></h6>
<dl class="exception">
<dt id="tornado.queues.QueueEmpty">
<em class="property">exception </em><code class="descclassname">tornado.queues.</code><code class="descname">QueueEmpty</code><a class="reference internal" href="_modules/tornado/queues.html#QueueEmpty"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.queues.QueueEmpty" title="永久链接至目标">¶</a></dt>
<dd><p>当队列中没有项目时, 由 <a class="reference internal" href="#tornado.queues.Queue.get_nowait" title="tornado.queues.Queue.get_nowait"><code class="xref py py-obj docutils literal"><span class="pre">Queue.get_nowait</span></code></a> 抛出.</p>
</dd></dl>

</div>
<div class="section" id="queuefull">
<h6>QueueFull<a class="headerlink" href="#queuefull" title="永久链接至标题">¶</a></h6>
<dl class="exception">
<dt id="tornado.queues.QueueFull">
<em class="property">exception </em><code class="descclassname">tornado.queues.</code><code class="descname">QueueFull</code><a class="reference internal" href="_modules/tornado/queues.html#QueueFull"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.queues.QueueFull" title="永久链接至目标">¶</a></dt>
<dd><p>当队列为最大size时, 由 <a class="reference internal" href="#tornado.queues.Queue.put_nowait" title="tornado.queues.Queue.put_nowait"><code class="xref py py-obj docutils literal"><span class="pre">Queue.put_nowait</span></code></a> 抛出.</p>
</dd></dl>

</div>
</div>
</div>
<span id="document-process"></span><div class="section" id="module-tornado.process">
<span id="tornado-process-utilities-for-multiple-processes"></span><h4><code class="docutils literal"><span class="pre">tornado.process</span></code> &#8212; Utilities for multiple processes<a class="headerlink" href="#module-tornado.process" title="永久链接至标题">¶</a></h4>
<p>Utilities for working with multiple processes, including both forking
the server into multiple processes and managing subprocesses.</p>
<dl class="exception">
<dt id="tornado.process.CalledProcessError">
<em class="property">exception </em><code class="descclassname">tornado.process.</code><code class="descname">CalledProcessError</code><a class="reference internal" href="_modules/subprocess.html#CalledProcessError"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.process.CalledProcessError" title="永久链接至目标">¶</a></dt>
<dd><p>An alias for <a class="reference external" href="https://docs.python.org/3.4/library/subprocess.html#subprocess.CalledProcessError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">subprocess.CalledProcessError</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.process.cpu_count">
<code class="descclassname">tornado.process.</code><code class="descname">cpu_count</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/process.html#cpu_count"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.process.cpu_count" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the number of processors on this machine.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.process.fork_processes">
<code class="descclassname">tornado.process.</code><code class="descname">fork_processes</code><span class="sig-paren">(</span><em>num_processes</em>, <em>max_restarts=100</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/process.html#fork_processes"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.process.fork_processes" title="永久链接至目标">¶</a></dt>
<dd><p>Starts multiple worker processes.</p>
<p>If <code class="docutils literal"><span class="pre">num_processes</span></code> is None or &lt;= 0, we detect the number of cores
available on this machine and fork that number of child
processes. If <code class="docutils literal"><span class="pre">num_processes</span></code> is given and &gt; 0, we fork that
specific number of sub-processes.</p>
<p>Since we use processes and not threads, there is no shared memory
between any server code.</p>
<p>Note that multiple processes are not compatible with the autoreload
module (or the <code class="docutils literal"><span class="pre">autoreload=True</span></code> option to <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Application</span></code></a>
which defaults to True when <code class="docutils literal"><span class="pre">debug=True</span></code>).
When using multiple processes, no IOLoops can be created or
referenced until after the call to <code class="docutils literal"><span class="pre">fork_processes</span></code>.</p>
<p>In each child process, <code class="docutils literal"><span class="pre">fork_processes</span></code> returns its <em>task id</em>, a
number between 0 and <code class="docutils literal"><span class="pre">num_processes</span></code>.  Processes that exit
abnormally (due to a signal or non-zero exit status) are restarted
with the same id (up to <code class="docutils literal"><span class="pre">max_restarts</span></code> times).  In the parent
process, <code class="docutils literal"><span class="pre">fork_processes</span></code> returns None if all child processes
have exited normally, but will otherwise only exit by throwing an
exception.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.process.task_id">
<code class="descclassname">tornado.process.</code><code class="descname">task_id</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/process.html#task_id"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.process.task_id" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the current task id, if any.</p>
<p>Returns None if this process was not created by <a class="reference internal" href="#tornado.process.fork_processes" title="tornado.process.fork_processes"><code class="xref py py-obj docutils literal"><span class="pre">fork_processes</span></code></a>.</p>
</dd></dl>

<dl class="class">
<dt id="tornado.process.Subprocess">
<em class="property">class </em><code class="descclassname">tornado.process.</code><code class="descname">Subprocess</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/process.html#Subprocess"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.process.Subprocess" title="永久链接至目标">¶</a></dt>
<dd><p>Wraps <code class="docutils literal"><span class="pre">subprocess.Popen</span></code> with IOStream support.</p>
<p>The constructor is the same as <code class="docutils literal"><span class="pre">subprocess.Popen</span></code> with the following
additions:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">stdin</span></code>, <code class="docutils literal"><span class="pre">stdout</span></code>, and <code class="docutils literal"><span class="pre">stderr</span></code> may have the value
<code class="docutils literal"><span class="pre">tornado.process.Subprocess.STREAM</span></code>, which will make the corresponding
attribute of the resulting Subprocess a <a class="reference internal" href="index.html#tornado.iostream.PipeIOStream" title="tornado.iostream.PipeIOStream"><code class="xref py py-obj docutils literal"><span class="pre">PipeIOStream</span></code></a>.</li>
<li>A new keyword argument <code class="docutils literal"><span class="pre">io_loop</span></code> may be used to pass in an IOLoop.</li>
</ul>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>The <code class="docutils literal"><span class="pre">io_loop</span></code> argument is deprecated.</p>
</div>
<dl class="method">
<dt id="tornado.process.Subprocess.set_exit_callback">
<code class="descname">set_exit_callback</code><span class="sig-paren">(</span><em>callback</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/process.html#Subprocess.set_exit_callback"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.process.Subprocess.set_exit_callback" title="永久链接至目标">¶</a></dt>
<dd><p>Runs <code class="docutils literal"><span class="pre">callback</span></code> when this process exits.</p>
<p>The callback takes one argument, the return code of the process.</p>
<p>This method uses a <code class="docutils literal"><span class="pre">SIGCHLD</span></code> handler, which is a global setting
and may conflict if you have other libraries trying to handle the
same signal.  If you are using more than one <code class="docutils literal"><span class="pre">IOLoop</span></code> it may
be necessary to call <a class="reference internal" href="#tornado.process.Subprocess.initialize" title="tornado.process.Subprocess.initialize"><code class="xref py py-obj docutils literal"><span class="pre">Subprocess.initialize</span></code></a> first to designate
one <code class="docutils literal"><span class="pre">IOLoop</span></code> to run the signal handlers.</p>
<p>In many cases a close callback on the stdout or stderr streams
can be used as an alternative to an exit callback if the
signal handler is causing a problem.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.process.Subprocess.wait_for_exit">
<code class="descname">wait_for_exit</code><span class="sig-paren">(</span><em>raise_error=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/process.html#Subprocess.wait_for_exit"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.process.Subprocess.wait_for_exit" title="永久链接至目标">¶</a></dt>
<dd><p>Returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> which resolves when the process exits.</p>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ret</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">proc</span><span class="o">.</span><span class="n">wait_for_exit</span><span class="p">()</span>
</pre></div>
</div>
<p>This is a coroutine-friendly alternative to <a class="reference internal" href="#tornado.process.Subprocess.set_exit_callback" title="tornado.process.Subprocess.set_exit_callback"><code class="xref py py-obj docutils literal"><span class="pre">set_exit_callback</span></code></a>
(and a replacement for the blocking <a class="reference external" href="https://docs.python.org/3.4/library/subprocess.html#subprocess.Popen.wait" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">subprocess.Popen.wait</span></code></a>).</p>
<p>By default, raises <a class="reference external" href="https://docs.python.org/3.4/library/subprocess.html#subprocess.CalledProcessError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">subprocess.CalledProcessError</span></code></a> if the process
has a non-zero exit status. Use <code class="docutils literal"><span class="pre">wait_for_exit(raise_error=False)</span></code>
to suppress this behavior and return the exit status without raising.</p>
<div class="versionadded">
<p><span class="versionmodified">4.2 新版功能.</span></p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="tornado.process.Subprocess.initialize">
<em class="property">classmethod </em><code class="descname">initialize</code><span class="sig-paren">(</span><em>io_loop=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/process.html#Subprocess.initialize"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.process.Subprocess.initialize" title="永久链接至目标">¶</a></dt>
<dd><p>Initializes the <code class="docutils literal"><span class="pre">SIGCHLD</span></code> handler.</p>
<p>The signal handler is run on an <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> to avoid locking issues.
Note that the <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> used for signal handling need not be the
same one used by individual Subprocess objects (as long as the
<code class="docutils literal"><span class="pre">IOLoops</span></code> are each running in separate threads).</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>The <code class="docutils literal"><span class="pre">io_loop</span></code> argument is deprecated.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="tornado.process.Subprocess.uninitialize">
<em class="property">classmethod </em><code class="descname">uninitialize</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/process.html#Subprocess.uninitialize"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.process.Subprocess.uninitialize" title="永久链接至目标">¶</a></dt>
<dd><p>Removes the <code class="docutils literal"><span class="pre">SIGCHLD</span></code> handler.</p>
</dd></dl>

</dd></dl>

</div>
</div>
</div>
<span id="document-integration"></span><div class="section" id="id1">
<h3>与其他服务集成<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-auth"></span><div class="section" id="tornado-auth-third-party-login-with-openid-and-oauth">
<h4><code class="docutils literal"><span class="pre">tornado.auth</span></code> &#8212; Third-party login with OpenID and OAuth<a class="headerlink" href="#tornado-auth-third-party-login-with-openid-and-oauth" title="永久链接至标题">¶</a></h4>
<span class="target" id="module-tornado.auth"></span><p>This module contains implementations of various third-party
authentication schemes.</p>
<p>All the classes in this file are class mixins designed to be used with
the <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.RequestHandler</span></code></a> class.  They are used in two ways:</p>
<ul class="simple">
<li>On a login handler, use methods such as <code class="docutils literal"><span class="pre">authenticate_redirect()</span></code>,
<code class="docutils literal"><span class="pre">authorize_redirect()</span></code>, and <code class="docutils literal"><span class="pre">get_authenticated_user()</span></code> to
establish the user&#8217;s identity and store authentication tokens to your
database and/or cookies.</li>
<li>In non-login handlers, use methods such as <code class="docutils literal"><span class="pre">facebook_request()</span></code>
or <code class="docutils literal"><span class="pre">twitter_request()</span></code> to use the authentication tokens to make
requests to the respective services.</li>
</ul>
<p>They all take slightly different arguments due to the fact all these
services implement authentication and authorization slightly differently.
See the individual service classes below for complete documentation.</p>
<p>Example usage for Google OAuth:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GoogleOAuth2LoginHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">,</span>
                               <span class="n">tornado</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">GoogleOAuth2Mixin</span><span class="p">):</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">user</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_authenticated_user</span><span class="p">(</span>
                <span class="n">redirect_uri</span><span class="o">=</span><span class="s1">&#39;http://your.site.com/auth/google&#39;</span><span class="p">,</span>
                <span class="n">code</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">))</span>
            <span class="c1"># Save the user with e.g. set_secure_cookie</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorize_redirect</span><span class="p">(</span>
                <span class="n">redirect_uri</span><span class="o">=</span><span class="s1">&#39;http://your.site.com/auth/google&#39;</span><span class="p">,</span>
                <span class="n">client_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;google_oauth&#39;</span><span class="p">][</span><span class="s1">&#39;key&#39;</span><span class="p">],</span>
                <span class="n">scope</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">],</span>
                <span class="n">response_type</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">,</span>
                <span class="n">extra_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;approval_prompt&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">})</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>All of the callback interfaces in this module are now guaranteed
to run their callback with an argument of <code class="docutils literal"><span class="pre">None</span></code> on error.
Previously some functions would do this while others would simply
terminate the request on their own.  This change also ensures that
errors are more consistently reported through the <code class="docutils literal"><span class="pre">Future</span></code> interfaces.</p>
</div>
<div class="section" id="common-protocols">
<h5>Common protocols<a class="headerlink" href="#common-protocols" title="永久链接至标题">¶</a></h5>
<p>These classes implement the OpenID and OAuth standards.  They will
generally need to be subclassed to use them with any particular site.
The degree of customization required will vary, but in most cases
overridding the class attributes (which are named beginning with
underscores for historical reasons) should be sufficient.</p>
<dl class="class">
<dt id="tornado.auth.OpenIdMixin">
<em class="property">class </em><code class="descclassname">tornado.auth.</code><code class="descname">OpenIdMixin</code><a class="reference internal" href="_modules/tornado/auth.html#OpenIdMixin"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.OpenIdMixin" title="永久链接至目标">¶</a></dt>
<dd><p>Abstract implementation of OpenID and Attribute Exchange.</p>
<p>Class attributes:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">_OPENID_ENDPOINT</span></code>: the identity provider&#8217;s URI.</li>
</ul>
<dl class="method">
<dt id="tornado.auth.OpenIdMixin.authenticate_redirect">
<code class="descname">authenticate_redirect</code><span class="sig-paren">(</span><em>callback_uri=None, ax_attrs=['name', 'email', 'language', 'username'], callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#OpenIdMixin.authenticate_redirect"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.OpenIdMixin.authenticate_redirect" title="永久链接至目标">¶</a></dt>
<dd><p>Redirects to the authentication URL for this service.</p>
<p>After authentication, the service will redirect back to the given
callback URI with additional parameters including <code class="docutils literal"><span class="pre">openid.mode</span></code>.</p>
<p>We request the given attributes for the authenticated user by
default (name, email, language, and username). If you don&#8217;t need
all those attributes for your app, you can request fewer with
the ax_attrs keyword argument.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.1 版更改: </span>Returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> and takes an optional callback.  These are
not strictly necessary as this method is synchronous,
but they are supplied for consistency with
<a class="reference internal" href="#tornado.auth.OAuthMixin.authorize_redirect" title="tornado.auth.OAuthMixin.authorize_redirect"><code class="xref py py-obj docutils literal"><span class="pre">OAuthMixin.authorize_redirect</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.auth.OpenIdMixin.get_authenticated_user">
<code class="descname">get_authenticated_user</code><span class="sig-paren">(</span><em>callback</em>, <em>http_client=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#OpenIdMixin.get_authenticated_user"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.OpenIdMixin.get_authenticated_user" title="永久链接至目标">¶</a></dt>
<dd><p>Fetches the authenticated user data upon redirect.</p>
<p>This method should be called by the handler that receives the
redirect from the <a class="reference internal" href="#tornado.auth.OpenIdMixin.authenticate_redirect" title="tornado.auth.OpenIdMixin.authenticate_redirect"><code class="xref py py-obj docutils literal"><span class="pre">authenticate_redirect()</span></code></a> method (which is
often the same as the one that calls it; in that case you would
call <a class="reference internal" href="#tornado.auth.OpenIdMixin.get_authenticated_user" title="tornado.auth.OpenIdMixin.get_authenticated_user"><code class="xref py py-obj docutils literal"><span class="pre">get_authenticated_user</span></code></a> if the <code class="docutils literal"><span class="pre">openid.mode</span></code> parameter
is present and <a class="reference internal" href="#tornado.auth.OpenIdMixin.authenticate_redirect" title="tornado.auth.OpenIdMixin.authenticate_redirect"><code class="xref py py-obj docutils literal"><span class="pre">authenticate_redirect</span></code></a> if it is not).</p>
<p>The result of this method will generally be used to set a cookie.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.auth.OpenIdMixin.get_auth_http_client">
<code class="descname">get_auth_http_client</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#OpenIdMixin.get_auth_http_client"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.OpenIdMixin.get_auth_http_client" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> instance to be used for auth requests.</p>
<p>May be overridden by subclasses to use an HTTP client other than
the default.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.auth.OAuthMixin">
<em class="property">class </em><code class="descclassname">tornado.auth.</code><code class="descname">OAuthMixin</code><a class="reference internal" href="_modules/tornado/auth.html#OAuthMixin"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.OAuthMixin" title="永久链接至目标">¶</a></dt>
<dd><p>Abstract implementation of OAuth 1.0 and 1.0a.</p>
<p>See <a class="reference internal" href="#tornado.auth.TwitterMixin" title="tornado.auth.TwitterMixin"><code class="xref py py-obj docutils literal"><span class="pre">TwitterMixin</span></code></a> below for an example implementation.</p>
<p>Class attributes:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">_OAUTH_AUTHORIZE_URL</span></code>: The service&#8217;s OAuth authorization url.</li>
<li><code class="docutils literal"><span class="pre">_OAUTH_ACCESS_TOKEN_URL</span></code>: The service&#8217;s OAuth access token url.</li>
<li><code class="docutils literal"><span class="pre">_OAUTH_VERSION</span></code>: May be either &#8220;1.0&#8221; or &#8220;1.0a&#8221;.</li>
<li><code class="docutils literal"><span class="pre">_OAUTH_NO_CALLBACKS</span></code>: Set this to True if the service requires
advance registration of callbacks.</li>
</ul>
<p>Subclasses must also override the <a class="reference internal" href="#tornado.auth.OAuthMixin._oauth_get_user_future" title="tornado.auth.OAuthMixin._oauth_get_user_future"><code class="xref py py-obj docutils literal"><span class="pre">_oauth_get_user_future</span></code></a> and
<a class="reference internal" href="#tornado.auth.OAuthMixin._oauth_consumer_token" title="tornado.auth.OAuthMixin._oauth_consumer_token"><code class="xref py py-obj docutils literal"><span class="pre">_oauth_consumer_token</span></code></a> methods.</p>
<dl class="method">
<dt id="tornado.auth.OAuthMixin.authorize_redirect">
<code class="descname">authorize_redirect</code><span class="sig-paren">(</span><em>callback_uri=None</em>, <em>extra_params=None</em>, <em>http_client=None</em>, <em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#OAuthMixin.authorize_redirect"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.OAuthMixin.authorize_redirect" title="永久链接至目标">¶</a></dt>
<dd><p>Redirects the user to obtain OAuth authorization for this service.</p>
<p>The <code class="docutils literal"><span class="pre">callback_uri</span></code> may be omitted if you have previously
registered a callback URI with the third-party service.  For
some services (including Friendfeed), you must use a
previously-registered callback URI and cannot specify a
callback via this method.</p>
<p>This method sets a cookie called <code class="docutils literal"><span class="pre">_oauth_request_token</span></code> which is
subsequently used (and cleared) in <a class="reference internal" href="#tornado.auth.OAuthMixin.get_authenticated_user" title="tornado.auth.OAuthMixin.get_authenticated_user"><code class="xref py py-obj docutils literal"><span class="pre">get_authenticated_user</span></code></a> for
security purposes.</p>
<p>Note that this method is asynchronous, although it calls
<a class="reference internal" href="index.html#tornado.web.RequestHandler.finish" title="tornado.web.RequestHandler.finish"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.finish</span></code></a> for you so it may not be necessary
to pass a callback or use the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> it returns.  However,
if this method is called from a function decorated with
<a class="reference internal" href="index.html#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">gen.coroutine</span></code></a>, you must call it with <code class="docutils literal"><span class="pre">yield</span></code> to keep the
response from being closed prematurely.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.1 版更改: </span>Now returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> and takes an optional callback, for
compatibility with <a class="reference internal" href="index.html#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">gen.coroutine</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.auth.OAuthMixin.get_authenticated_user">
<code class="descname">get_authenticated_user</code><span class="sig-paren">(</span><em>callback</em>, <em>http_client=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#OAuthMixin.get_authenticated_user"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.OAuthMixin.get_authenticated_user" title="永久链接至目标">¶</a></dt>
<dd><p>Gets the OAuth authorized user and access token.</p>
<p>This method should be called from the handler for your
OAuth callback URL to complete the registration process. We run the
callback with the authenticated user dictionary.  This dictionary
will contain an <code class="docutils literal"><span class="pre">access_key</span></code> which can be used to make authorized
requests to this service on behalf of the user.  The dictionary will
also contain other fields such as <code class="docutils literal"><span class="pre">name</span></code>, depending on the service
used.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.auth.OAuthMixin._oauth_consumer_token">
<code class="descname">_oauth_consumer_token</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#OAuthMixin._oauth_consumer_token"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.OAuthMixin._oauth_consumer_token" title="永久链接至目标">¶</a></dt>
<dd><p>Subclasses must override this to return their OAuth consumer keys.</p>
<p>The return value should be a <a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#dict" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">dict</span></code></a> with keys <code class="docutils literal"><span class="pre">key</span></code> and <code class="docutils literal"><span class="pre">secret</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.auth.OAuthMixin._oauth_get_user_future">
<code class="descname">_oauth_get_user_future</code><span class="sig-paren">(</span><em>access_token</em>, <em>callback</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#OAuthMixin._oauth_get_user_future"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.OAuthMixin._oauth_get_user_future" title="永久链接至目标">¶</a></dt>
<dd><p>Subclasses must override this to get basic information about the
user.</p>
<p>Should return a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> whose result is a dictionary
containing information about the user, which may have been
retrieved by using <code class="docutils literal"><span class="pre">access_token</span></code> to make a request to the
service.</p>
<p>The access token will be added to the returned dictionary to make
the result of <a class="reference internal" href="#tornado.auth.OAuthMixin.get_authenticated_user" title="tornado.auth.OAuthMixin.get_authenticated_user"><code class="xref py py-obj docutils literal"><span class="pre">get_authenticated_user</span></code></a>.</p>
<p>For backwards compatibility, the callback-based <code class="docutils literal"><span class="pre">_oauth_get_user</span></code>
method is also supported.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.auth.OAuthMixin.get_auth_http_client">
<code class="descname">get_auth_http_client</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#OAuthMixin.get_auth_http_client"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.OAuthMixin.get_auth_http_client" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> instance to be used for auth requests.</p>
<p>May be overridden by subclasses to use an HTTP client other than
the default.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.auth.OAuth2Mixin">
<em class="property">class </em><code class="descclassname">tornado.auth.</code><code class="descname">OAuth2Mixin</code><a class="reference internal" href="_modules/tornado/auth.html#OAuth2Mixin"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.OAuth2Mixin" title="永久链接至目标">¶</a></dt>
<dd><p>Abstract implementation of OAuth 2.0.</p>
<p>See <a class="reference internal" href="#tornado.auth.FacebookGraphMixin" title="tornado.auth.FacebookGraphMixin"><code class="xref py py-obj docutils literal"><span class="pre">FacebookGraphMixin</span></code></a> or <a class="reference internal" href="#tornado.auth.GoogleOAuth2Mixin" title="tornado.auth.GoogleOAuth2Mixin"><code class="xref py py-obj docutils literal"><span class="pre">GoogleOAuth2Mixin</span></code></a> below for example
implementations.</p>
<p>Class attributes:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">_OAUTH_AUTHORIZE_URL</span></code>: The service&#8217;s authorization url.</li>
<li><code class="docutils literal"><span class="pre">_OAUTH_ACCESS_TOKEN_URL</span></code>:  The service&#8217;s access token url.</li>
</ul>
<dl class="method">
<dt id="tornado.auth.OAuth2Mixin.authorize_redirect">
<code class="descname">authorize_redirect</code><span class="sig-paren">(</span><em>redirect_uri=None</em>, <em>client_id=None</em>, <em>client_secret=None</em>, <em>extra_params=None</em>, <em>callback=None</em>, <em>scope=None</em>, <em>response_type='code'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#OAuth2Mixin.authorize_redirect"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.OAuth2Mixin.authorize_redirect" title="永久链接至目标">¶</a></dt>
<dd><p>Redirects the user to obtain OAuth authorization for this service.</p>
<p>Some providers require that you register a redirect URL with
your application instead of passing one via this method. You
should call this method to log the user in, and then call
<code class="docutils literal"><span class="pre">get_authenticated_user</span></code> in the handler for your
redirect URL to complete the authorization process.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.1 版更改: </span>Returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> and takes an optional callback.  These are
not strictly necessary as this method is synchronous,
but they are supplied for consistency with
<a class="reference internal" href="#tornado.auth.OAuthMixin.authorize_redirect" title="tornado.auth.OAuthMixin.authorize_redirect"><code class="xref py py-obj docutils literal"><span class="pre">OAuthMixin.authorize_redirect</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.auth.OAuth2Mixin.oauth2_request">
<code class="descname">oauth2_request</code><span class="sig-paren">(</span><em>url</em>, <em>callback</em>, <em>access_token=None</em>, <em>post_args=None</em>, <em>**args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#OAuth2Mixin.oauth2_request"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.OAuth2Mixin.oauth2_request" title="永久链接至目标">¶</a></dt>
<dd><p>Fetches the given URL auth an OAuth2 access token.</p>
<p>If the request is a POST, <code class="docutils literal"><span class="pre">post_args</span></code> should be provided. Query
string arguments should be given as keyword arguments.</p>
<p>Example usage:</p>
<p>..testcode:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">,</span>
                  <span class="n">tornado</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">FacebookGraphMixin</span><span class="p">):</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">authenticated</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_entry</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth2_request</span><span class="p">(</span>
            <span class="s2">&quot;https://graph.facebook.com/me/feed&quot;</span><span class="p">,</span>
            <span class="n">post_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;I am posting from my Tornado application!&quot;</span><span class="p">},</span>
            <span class="n">access_token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_user</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_entry</span><span class="p">:</span>
            <span class="c1"># Call failed; perhaps missing permission?</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorize_redirect</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">(</span><span class="s2">&quot;Posted a message!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">4.3 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.auth.OAuth2Mixin.get_auth_http_client">
<code class="descname">get_auth_http_client</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#OAuth2Mixin.get_auth_http_client"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.OAuth2Mixin.get_auth_http_client" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> instance to be used for auth requests.</p>
<p>May be overridden by subclasses to use an HTTP client other than
the default.</p>
<div class="versionadded">
<p><span class="versionmodified">4.3 新版功能.</span></p>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="google">
<h5>Google<a class="headerlink" href="#google" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.auth.GoogleOAuth2Mixin">
<em class="property">class </em><code class="descclassname">tornado.auth.</code><code class="descname">GoogleOAuth2Mixin</code><a class="reference internal" href="_modules/tornado/auth.html#GoogleOAuth2Mixin"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.GoogleOAuth2Mixin" title="永久链接至目标">¶</a></dt>
<dd><p>Google authentication using OAuth2.</p>
<p>In order to use, register your application with Google and copy the
relevant parameters to your application settings.</p>
<ul class="simple">
<li>Go to the Google Dev Console at <a class="reference external" href="http://console.developers.google.com">http://console.developers.google.com</a></li>
<li>Select a project, or create a new one.</li>
<li>In the sidebar on the left, select APIs &amp; Auth.</li>
<li>In the list of APIs, find the Google+ API service and set it to ON.</li>
<li>In the sidebar on the left, select Credentials.</li>
<li>In the OAuth section of the page, select Create New Client ID.</li>
<li>Set the Redirect URI to point to your auth handler</li>
<li>Copy the &#8220;Client secret&#8221; and &#8220;Client ID&#8221; to the application settings as
{&#8220;google_oauth&#8221;: {&#8220;key&#8221;: CLIENT_ID, &#8220;secret&#8221;: CLIENT_SECRET}}</li>
</ul>
<div class="versionadded">
<p><span class="versionmodified">3.2 新版功能.</span></p>
</div>
<dl class="method">
<dt id="tornado.auth.GoogleOAuth2Mixin.get_authenticated_user">
<code class="descname">get_authenticated_user</code><span class="sig-paren">(</span><em>redirect_uri</em>, <em>code</em>, <em>callback</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#GoogleOAuth2Mixin.get_authenticated_user"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.GoogleOAuth2Mixin.get_authenticated_user" title="永久链接至目标">¶</a></dt>
<dd><p>Handles the login for the Google user, returning an access token.</p>
<p>The result is a dictionary containing an <code class="docutils literal"><span class="pre">access_token</span></code> field
([among others](<a class="reference external" href="https://developers.google.com/identity/protocols/OAuth2WebServer#handlingtheresponse">https://developers.google.com/identity/protocols/OAuth2WebServer#handlingtheresponse</a>)).
Unlike other <code class="docutils literal"><span class="pre">get_authenticated_user</span></code> methods in this package,
this method does not return any additional information about the user.
The returned access token can be used with <a class="reference internal" href="#tornado.auth.OAuth2Mixin.oauth2_request" title="tornado.auth.OAuth2Mixin.oauth2_request"><code class="xref py py-obj docutils literal"><span class="pre">OAuth2Mixin.oauth2_request</span></code></a>
to request additional information (perhaps from
<code class="docutils literal"><span class="pre">https://www.googleapis.com/oauth2/v2/userinfo</span></code>)</p>
<p>Example usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GoogleOAuth2LoginHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">,</span>
                               <span class="n">tornado</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">GoogleOAuth2Mixin</span><span class="p">):</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">access</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_authenticated_user</span><span class="p">(</span>
                <span class="n">redirect_uri</span><span class="o">=</span><span class="s1">&#39;http://your.site.com/auth/google&#39;</span><span class="p">,</span>
                <span class="n">code</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">))</span>
            <span class="n">user</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth2_request</span><span class="p">(</span>
                <span class="s2">&quot;https://www.googleapis.com/oauth2/v1/userinfo&quot;</span><span class="p">,</span>
                <span class="n">access_token</span><span class="o">=</span><span class="n">access</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">])</span>
            <span class="c1"># Save the user and access token with</span>
            <span class="c1"># e.g. set_secure_cookie.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorize_redirect</span><span class="p">(</span>
                <span class="n">redirect_uri</span><span class="o">=</span><span class="s1">&#39;http://your.site.com/auth/google&#39;</span><span class="p">,</span>
                <span class="n">client_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;google_oauth&#39;</span><span class="p">][</span><span class="s1">&#39;key&#39;</span><span class="p">],</span>
                <span class="n">scope</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">],</span>
                <span class="n">response_type</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">,</span>
                <span class="n">extra_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;approval_prompt&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="facebook">
<h5>Facebook<a class="headerlink" href="#facebook" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.auth.FacebookGraphMixin">
<em class="property">class </em><code class="descclassname">tornado.auth.</code><code class="descname">FacebookGraphMixin</code><a class="reference internal" href="_modules/tornado/auth.html#FacebookGraphMixin"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.FacebookGraphMixin" title="永久链接至目标">¶</a></dt>
<dd><p>Facebook authentication using the new Graph API and OAuth2.</p>
<dl class="method">
<dt id="tornado.auth.FacebookGraphMixin.get_authenticated_user">
<code class="descname">get_authenticated_user</code><span class="sig-paren">(</span><em>redirect_uri</em>, <em>client_id</em>, <em>client_secret</em>, <em>code</em>, <em>callback</em>, <em>extra_fields=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#FacebookGraphMixin.get_authenticated_user"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.FacebookGraphMixin.get_authenticated_user" title="永久链接至目标">¶</a></dt>
<dd><p>Handles the login for the Facebook user, returning a user object.</p>
<p>Example usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FacebookGraphLoginHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">,</span>
                                <span class="n">tornado</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">FacebookGraphMixin</span><span class="p">):</span>
  <span class="nd">@tornado</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">coroutine</span>
  <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
          <span class="n">user</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_authenticated_user</span><span class="p">(</span>
              <span class="n">redirect_uri</span><span class="o">=</span><span class="s1">&#39;/auth/facebookgraph/&#39;</span><span class="p">,</span>
              <span class="n">client_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;facebook_api_key&quot;</span><span class="p">],</span>
              <span class="n">client_secret</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;facebook_secret&quot;</span><span class="p">],</span>
              <span class="n">code</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">))</span>
          <span class="c1"># Save the user with e.g. set_secure_cookie</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorize_redirect</span><span class="p">(</span>
              <span class="n">redirect_uri</span><span class="o">=</span><span class="s1">&#39;/auth/facebookgraph/&#39;</span><span class="p">,</span>
              <span class="n">client_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;facebook_api_key&quot;</span><span class="p">],</span>
              <span class="n">extra_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot;read_stream,offline_access&quot;</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.auth.FacebookGraphMixin.facebook_request">
<code class="descname">facebook_request</code><span class="sig-paren">(</span><em>path</em>, <em>callback</em>, <em>access_token=None</em>, <em>post_args=None</em>, <em>**args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#FacebookGraphMixin.facebook_request"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.FacebookGraphMixin.facebook_request" title="永久链接至目标">¶</a></dt>
<dd><p>Fetches the given relative API path, e.g., &#8220;/btaylor/picture&#8221;</p>
<p>If the request is a POST, <code class="docutils literal"><span class="pre">post_args</span></code> should be provided. Query
string arguments should be given as keyword arguments.</p>
<p>An introduction to the Facebook Graph API can be found at
<a class="reference external" href="http://developers.facebook.com/docs/api">http://developers.facebook.com/docs/api</a></p>
<p>Many methods require an OAuth access token which you can
obtain through <a class="reference internal" href="#tornado.auth.OAuth2Mixin.authorize_redirect" title="tornado.auth.OAuth2Mixin.authorize_redirect"><code class="xref py py-obj docutils literal"><span class="pre">authorize_redirect</span></code></a> and
<a class="reference internal" href="#tornado.auth.FacebookGraphMixin.get_authenticated_user" title="tornado.auth.FacebookGraphMixin.get_authenticated_user"><code class="xref py py-obj docutils literal"><span class="pre">get_authenticated_user</span></code></a>. The user returned through that
process includes an <code class="docutils literal"><span class="pre">access_token</span></code> attribute that can be
used to make authenticated requests via this method.</p>
<p>Example usage:</p>
<p>..testcode:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">,</span>
                  <span class="n">tornado</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">FacebookGraphMixin</span><span class="p">):</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">authenticated</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_entry</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">facebook_request</span><span class="p">(</span>
            <span class="s2">&quot;/me/feed&quot;</span><span class="p">,</span>
            <span class="n">post_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;I am posting from my Tornado application!&quot;</span><span class="p">},</span>
            <span class="n">access_token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_user</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_entry</span><span class="p">:</span>
            <span class="c1"># Call failed; perhaps missing permission?</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorize_redirect</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">(</span><span class="s2">&quot;Posted a message!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The given path is relative to <code class="docutils literal"><span class="pre">self._FACEBOOK_BASE_URL</span></code>,
by default &#8220;<a class="reference external" href="https://graph.facebook.com">https://graph.facebook.com</a>&#8221;.</p>
<p>This method is a wrapper around <a class="reference internal" href="#tornado.auth.OAuth2Mixin.oauth2_request" title="tornado.auth.OAuth2Mixin.oauth2_request"><code class="xref py py-obj docutils literal"><span class="pre">OAuth2Mixin.oauth2_request</span></code></a>;
the only difference is that this method takes a relative path,
while <code class="docutils literal"><span class="pre">oauth2_request</span></code> takes a complete url.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.1 版更改: </span>Added the ability to override <code class="docutils literal"><span class="pre">self._FACEBOOK_BASE_URL</span></code>.</p>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="twitter">
<h5>Twitter<a class="headerlink" href="#twitter" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.auth.TwitterMixin">
<em class="property">class </em><code class="descclassname">tornado.auth.</code><code class="descname">TwitterMixin</code><a class="reference internal" href="_modules/tornado/auth.html#TwitterMixin"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.TwitterMixin" title="永久链接至目标">¶</a></dt>
<dd><p>Twitter OAuth authentication.</p>
<p>To authenticate with Twitter, register your application with
Twitter at <a class="reference external" href="http://twitter.com/apps">http://twitter.com/apps</a>. Then copy your Consumer Key
and Consumer Secret to the application
<a class="reference internal" href="index.html#tornado.web.Application.settings" title="tornado.web.Application.settings"><code class="xref py py-obj docutils literal"><span class="pre">settings</span></code></a> <code class="docutils literal"><span class="pre">twitter_consumer_key</span></code> and
<code class="docutils literal"><span class="pre">twitter_consumer_secret</span></code>. Use this mixin on the handler for the
URL you registered as your application&#8217;s callback URL.</p>
<p>When your application is set up, you can use this mixin like this
to authenticate the user with Twitter and get access to their stream:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TwitterLoginHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">,</span>
                          <span class="n">tornado</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">TwitterMixin</span><span class="p">):</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_argument</span><span class="p">(</span><span class="s2">&quot;oauth_token&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">user</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_authenticated_user</span><span class="p">()</span>
            <span class="c1"># Save the user using e.g. set_secure_cookie()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorize_redirect</span><span class="p">()</span>
</pre></div>
</div>
<p>The user object returned by <a class="reference internal" href="#tornado.auth.OAuthMixin.get_authenticated_user" title="tornado.auth.OAuthMixin.get_authenticated_user"><code class="xref py py-obj docutils literal"><span class="pre">get_authenticated_user</span></code></a>
includes the attributes <code class="docutils literal"><span class="pre">username</span></code>, <code class="docutils literal"><span class="pre">name</span></code>, <code class="docutils literal"><span class="pre">access_token</span></code>,
and all of the custom Twitter user attributes described at
<a class="reference external" href="https://dev.twitter.com/docs/api/1.1/get/users/show">https://dev.twitter.com/docs/api/1.1/get/users/show</a></p>
<dl class="method">
<dt id="tornado.auth.TwitterMixin.authenticate_redirect">
<code class="descname">authenticate_redirect</code><span class="sig-paren">(</span><em>callback_uri=None</em>, <em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#TwitterMixin.authenticate_redirect"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.TwitterMixin.authenticate_redirect" title="永久链接至目标">¶</a></dt>
<dd><p>Just like <a class="reference internal" href="#tornado.auth.OAuthMixin.authorize_redirect" title="tornado.auth.OAuthMixin.authorize_redirect"><code class="xref py py-obj docutils literal"><span class="pre">authorize_redirect</span></code></a>, but
auto-redirects if authorized.</p>
<p>This is generally the right interface to use if you are using
Twitter for single-sign on.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.1 版更改: </span>Now returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> and takes an optional callback, for
compatibility with <a class="reference internal" href="index.html#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">gen.coroutine</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.auth.TwitterMixin.twitter_request">
<code class="descname">twitter_request</code><span class="sig-paren">(</span><em>path</em>, <em>callback=None</em>, <em>access_token=None</em>, <em>post_args=None</em>, <em>**args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/auth.html#TwitterMixin.twitter_request"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.auth.TwitterMixin.twitter_request" title="永久链接至目标">¶</a></dt>
<dd><p>Fetches the given API path, e.g., <code class="docutils literal"><span class="pre">statuses/user_timeline/btaylor</span></code></p>
<p>The path should not include the format or API version number.
(we automatically use JSON format and API version 1).</p>
<p>If the request is a POST, <code class="docutils literal"><span class="pre">post_args</span></code> should be provided. Query
string arguments should be given as keyword arguments.</p>
<p>All the Twitter methods are documented at <a class="reference external" href="http://dev.twitter.com/">http://dev.twitter.com/</a></p>
<p>Many methods require an OAuth access token which you can
obtain through <a class="reference internal" href="#tornado.auth.OAuthMixin.authorize_redirect" title="tornado.auth.OAuthMixin.authorize_redirect"><code class="xref py py-obj docutils literal"><span class="pre">authorize_redirect</span></code></a> and
<a class="reference internal" href="#tornado.auth.OAuthMixin.get_authenticated_user" title="tornado.auth.OAuthMixin.get_authenticated_user"><code class="xref py py-obj docutils literal"><span class="pre">get_authenticated_user</span></code></a>. The user returned through that
process includes an &#8216;access_token&#8217; attribute that can be used
to make authenticated requests via this method. Example
usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">,</span>
                  <span class="n">tornado</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">TwitterMixin</span><span class="p">):</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">authenticated</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_entry</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">twitter_request</span><span class="p">(</span>
            <span class="s2">&quot;/statuses/update&quot;</span><span class="p">,</span>
            <span class="n">post_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Testing Tornado Web Server&quot;</span><span class="p">},</span>
            <span class="n">access_token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_user</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_entry</span><span class="p">:</span>
            <span class="c1"># Call failed; perhaps missing permission?</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorize_redirect</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">(</span><span class="s2">&quot;Posted a message!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
</div>
<span id="document-wsgi"></span><div class="section" id="module-tornado.wsgi">
<span id="tornado-wsgi-interoperability-with-other-python-frameworks-and-servers"></span><h4><code class="docutils literal"><span class="pre">tornado.wsgi</span></code> &#8212; Interoperability with other Python frameworks and servers<a class="headerlink" href="#module-tornado.wsgi" title="永久链接至标题">¶</a></h4>
<p>WSGI support for the Tornado web framework.</p>
<p>WSGI is the Python standard for web servers, and allows for interoperability
between Tornado and other Python web frameworks and servers.  This module
provides WSGI support in two ways:</p>
<ul class="simple">
<li><a class="reference internal" href="#tornado.wsgi.WSGIAdapter" title="tornado.wsgi.WSGIAdapter"><code class="xref py py-obj docutils literal"><span class="pre">WSGIAdapter</span></code></a> converts a <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Application</span></code></a> to the WSGI application
interface.  This is useful for running a Tornado app on another
HTTP server, such as Google App Engine.  See the <a class="reference internal" href="#tornado.wsgi.WSGIAdapter" title="tornado.wsgi.WSGIAdapter"><code class="xref py py-obj docutils literal"><span class="pre">WSGIAdapter</span></code></a> class
documentation for limitations that apply.</li>
<li><a class="reference internal" href="#tornado.wsgi.WSGIContainer" title="tornado.wsgi.WSGIContainer"><code class="xref py py-obj docutils literal"><span class="pre">WSGIContainer</span></code></a> lets you run other WSGI applications and frameworks on the
Tornado HTTP server.  For example, with this class you can mix Django
and Tornado handlers in a single server.</li>
</ul>
<div class="section" id="running-tornado-apps-on-wsgi-servers">
<h5>Running Tornado apps on WSGI servers<a class="headerlink" href="#running-tornado-apps-on-wsgi-servers" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.wsgi.WSGIAdapter">
<em class="property">class </em><code class="descclassname">tornado.wsgi.</code><code class="descname">WSGIAdapter</code><span class="sig-paren">(</span><em>application</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/wsgi.html#WSGIAdapter"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.wsgi.WSGIAdapter" title="永久链接至目标">¶</a></dt>
<dd><p>Converts a <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Application</span></code></a> instance into a WSGI application.</p>
<p>Example usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tornado.web</span>
<span class="kn">import</span> <span class="nn">tornado.wsgi</span>
<span class="kn">import</span> <span class="nn">wsgiref.simple_server</span>

<span class="k">class</span> <span class="nc">MainHandler</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">MainHandler</span><span class="p">),</span>
    <span class="p">])</span>
    <span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">wsgi</span><span class="o">.</span><span class="n">WSGIAdapter</span><span class="p">(</span><span class="n">application</span><span class="p">)</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">wsgiref</span><span class="o">.</span><span class="n">simple_server</span><span class="o">.</span><span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">8888</span><span class="p">,</span> <span class="n">wsgi_app</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</div>
<p>See the <a class="reference external" href="https://github.com/tornadoweb/tornado/tree/stable/demos/appengine">appengine demo</a>
for an example of using this module to run a Tornado app on Google
App Engine.</p>
<p>In WSGI mode asynchronous methods are not supported.  This means
that it is not possible to use <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a>, or the
<a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a> or <a class="reference internal" href="index.html#module-tornado.websocket" title="tornado.websocket"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket</span></code></a> modules.</p>
<div class="versionadded">
<p><span class="versionmodified">4.0 新版功能.</span></p>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.wsgi.WSGIApplication">
<em class="property">class </em><code class="descclassname">tornado.wsgi.</code><code class="descname">WSGIApplication</code><span class="sig-paren">(</span><em>handlers=None</em>, <em>default_host=''</em>, <em>transforms=None</em>, <em>**settings</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/wsgi.html#WSGIApplication"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.wsgi.WSGIApplication" title="永久链接至目标">¶</a></dt>
<dd><p>A WSGI equivalent of <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Application</span></code></a>.</p>
<div class="deprecated">
<p><span class="versionmodified">4.0 版后已移除: </span>Use a regular <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> and wrap it in <a class="reference internal" href="#tornado.wsgi.WSGIAdapter" title="tornado.wsgi.WSGIAdapter"><code class="xref py py-obj docutils literal"><span class="pre">WSGIAdapter</span></code></a> instead.</p>
</div>
</dd></dl>

</div>
<div class="section" id="running-wsgi-apps-on-tornado-servers">
<h5>Running WSGI apps on Tornado servers<a class="headerlink" href="#running-wsgi-apps-on-tornado-servers" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.wsgi.WSGIContainer">
<em class="property">class </em><code class="descclassname">tornado.wsgi.</code><code class="descname">WSGIContainer</code><span class="sig-paren">(</span><em>wsgi_application</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/wsgi.html#WSGIContainer"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.wsgi.WSGIContainer" title="永久链接至目标">¶</a></dt>
<dd><p>Makes a WSGI-compatible function runnable on Tornado&#8217;s HTTP server.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">WSGI is a <em>synchronous</em> interface, while Tornado&#8217;s concurrency model
is based on single-threaded asynchronous execution.  This means that
running a WSGI app with Tornado&#8217;s <a class="reference internal" href="#tornado.wsgi.WSGIContainer" title="tornado.wsgi.WSGIContainer"><code class="xref py py-obj docutils literal"><span class="pre">WSGIContainer</span></code></a> is <em>less scalable</em>
than running the same app in a multi-threaded WSGI server like
<code class="docutils literal"><span class="pre">gunicorn</span></code> or <code class="docutils literal"><span class="pre">uwsgi</span></code>.  Use <a class="reference internal" href="#tornado.wsgi.WSGIContainer" title="tornado.wsgi.WSGIContainer"><code class="xref py py-obj docutils literal"><span class="pre">WSGIContainer</span></code></a> only when there are
benefits to combining Tornado and WSGI in the same process that
outweigh the reduced scalability.</p>
</div>
<p>Wrap a WSGI function in a <a class="reference internal" href="#tornado.wsgi.WSGIContainer" title="tornado.wsgi.WSGIContainer"><code class="xref py py-obj docutils literal"><span class="pre">WSGIContainer</span></code></a> and pass it to <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> to
run it. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">simple_app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;200 OK&quot;</span>
    <span class="n">response_headers</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;Content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">)]</span>
    <span class="n">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;Hello world!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>

<span class="n">container</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">wsgi</span><span class="o">.</span><span class="n">WSGIContainer</span><span class="p">(</span><span class="n">simple_app</span><span class="p">)</span>
<span class="n">http_server</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">httpserver</span><span class="o">.</span><span class="n">HTTPServer</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
<span class="n">http_server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8888</span><span class="p">)</span>
<span class="n">tornado</span><span class="o">.</span><span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>This class is intended to let other frameworks (Django, web.py, etc)
run on the Tornado HTTP server and I/O loop.</p>
<p>The <a class="reference internal" href="index.html#tornado.web.FallbackHandler" title="tornado.web.FallbackHandler"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.FallbackHandler</span></code></a> class is often useful for mixing
Tornado and WSGI apps in the same server.  See
<a class="reference external" href="https://github.com/bdarnell/django-tornado-demo">https://github.com/bdarnell/django-tornado-demo</a> for a complete example.</p>
<dl class="staticmethod">
<dt id="tornado.wsgi.WSGIContainer.environ">
<em class="property">static </em><code class="descname">environ</code><span class="sig-paren">(</span><em>request</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/wsgi.html#WSGIContainer.environ"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.wsgi.WSGIContainer.environ" title="永久链接至目标">¶</a></dt>
<dd><p>Converts a <a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest" title="tornado.httputil.HTTPServerRequest"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httputil.HTTPServerRequest</span></code></a> to a WSGI environment.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<span id="document-asyncio"></span><div class="section" id="module-tornado.platform.asyncio">
<span id="tornado-platform-asyncio-bridge-between-asyncio-and-tornado"></span><h4><code class="docutils literal"><span class="pre">tornado.platform.asyncio</span></code> &#8212; Bridge between <code class="docutils literal"><span class="pre">asyncio</span></code> and Tornado<a class="headerlink" href="#module-tornado.platform.asyncio" title="永久链接至标题">¶</a></h4>
<p>Bridges between the <a class="reference external" href="https://docs.python.org/3.4/library/asyncio.html#module-asyncio" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">asyncio</span></code></a> module and Tornado IOLoop.</p>
<div class="versionadded">
<p><span class="versionmodified">3.2 新版功能.</span></p>
</div>
<p>This module integrates Tornado with the <code class="docutils literal"><span class="pre">asyncio</span></code> module introduced
in Python 3.4 (and available <a class="reference external" href="https://pypi.python.org/pypi/asyncio">as a separate download</a> for Python 3.3).  This makes
it possible to combine the two libraries on the same event loop.</p>
<p>Most applications should use <a class="reference internal" href="#tornado.platform.asyncio.AsyncIOMainLoop" title="tornado.platform.asyncio.AsyncIOMainLoop"><code class="xref py py-obj docutils literal"><span class="pre">AsyncIOMainLoop</span></code></a> to run Tornado on the
default <code class="docutils literal"><span class="pre">asyncio</span></code> event loop.  Applications that need to run event
loops on multiple threads may use <a class="reference internal" href="#tornado.platform.asyncio.AsyncIOLoop" title="tornado.platform.asyncio.AsyncIOLoop"><code class="xref py py-obj docutils literal"><span class="pre">AsyncIOLoop</span></code></a> to create multiple
loops.</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">Tornado requires the <a class="reference external" href="https://docs.python.org/3.4/library/asyncio-eventloop.html#asyncio.BaseEventLoop.add_reader" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">add_reader</span></code></a> family of methods,
so it is not compatible with the <a class="reference external" href="https://docs.python.org/3.4/library/asyncio-eventloops.html#asyncio.ProactorEventLoop" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ProactorEventLoop</span></code></a> on Windows.
Use the <a class="reference external" href="https://docs.python.org/3.4/library/asyncio-eventloops.html#asyncio.SelectorEventLoop" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">SelectorEventLoop</span></code></a> instead.</p>
</div>
<dl class="class">
<dt id="tornado.platform.asyncio.AsyncIOMainLoop">
<em class="property">class </em><code class="descclassname">tornado.platform.asyncio.</code><code class="descname">AsyncIOMainLoop</code><a class="reference internal" href="_modules/tornado/platform/asyncio.html#AsyncIOMainLoop"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.platform.asyncio.AsyncIOMainLoop" title="永久链接至目标">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">AsyncIOMainLoop</span></code> creates an <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> that corresponds to the
current <code class="docutils literal"><span class="pre">asyncio</span></code> event loop (i.e. the one returned by
<code class="docutils literal"><span class="pre">asyncio.get_event_loop()</span></code>).  Recommended usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado.platform.asyncio</span> <span class="k">import</span> <span class="n">AsyncIOMainLoop</span>
<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="n">AsyncIOMainLoop</span><span class="p">()</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>
<span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_forever</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="tornado.platform.asyncio.AsyncIOLoop">
<em class="property">class </em><code class="descclassname">tornado.platform.asyncio.</code><code class="descname">AsyncIOLoop</code><a class="reference internal" href="_modules/tornado/platform/asyncio.html#AsyncIOLoop"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.platform.asyncio.AsyncIOLoop" title="永久链接至目标">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">AsyncIOLoop</span></code> is an <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> that runs on an <code class="docutils literal"><span class="pre">asyncio</span></code> event loop.
This class follows the usual Tornado semantics for creating new
<code class="docutils literal"><span class="pre">IOLoops</span></code>; these loops are not necessarily related to the
<code class="docutils literal"><span class="pre">asyncio</span></code> default event loop.  Recommended usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado.ioloop</span> <span class="k">import</span> <span class="n">IOLoop</span>
<span class="n">IOLoop</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;tornado.platform.asyncio.AsyncIOLoop&#39;</span><span class="p">)</span>
<span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>Each <code class="docutils literal"><span class="pre">AsyncIOLoop</span></code> creates a new <code class="docutils literal"><span class="pre">asyncio.EventLoop</span></code>; this object
can be accessed with the <code class="docutils literal"><span class="pre">asyncio_loop</span></code> attribute.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.platform.asyncio.to_tornado_future">
<code class="descclassname">tornado.platform.asyncio.</code><code class="descname">to_tornado_future</code><span class="sig-paren">(</span><em>asyncio_future</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/platform/asyncio.html#to_tornado_future"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.platform.asyncio.to_tornado_future" title="永久链接至目标">¶</a></dt>
<dd><p>Convert an <a class="reference external" href="https://docs.python.org/3.4/library/asyncio-task.html#asyncio.Future" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">asyncio.Future</span></code></a> to a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">tornado.concurrent.Future</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified">4.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.platform.asyncio.to_asyncio_future">
<code class="descclassname">tornado.platform.asyncio.</code><code class="descname">to_asyncio_future</code><span class="sig-paren">(</span><em>tornado_future</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/platform/asyncio.html#to_asyncio_future"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.platform.asyncio.to_asyncio_future" title="永久链接至目标">¶</a></dt>
<dd><p>Convert a Tornado yieldable object to an <a class="reference external" href="https://docs.python.org/3.4/library/asyncio-task.html#asyncio.Future" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">asyncio.Future</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified">4.1 新版功能.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>Now accepts any yieldable object, not just
<a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">tornado.concurrent.Future</span></code></a>.</p>
</div>
</dd></dl>

</div>
<span id="document-caresresolver"></span><div class="section" id="module-tornado.platform.caresresolver">
<span id="tornado-platform-caresresolver-asynchronous-dns-resolver-using-c-ares"></span><h4><code class="docutils literal"><span class="pre">tornado.platform.caresresolver</span></code> &#8212; Asynchronous DNS Resolver using C-Ares<a class="headerlink" href="#module-tornado.platform.caresresolver" title="永久链接至标题">¶</a></h4>
<p>This module contains a DNS resolver using the c-ares library (and its
wrapper <code class="docutils literal"><span class="pre">pycares</span></code>).</p>
<dl class="class">
<dt id="tornado.platform.caresresolver.CaresResolver">
<em class="property">class </em><code class="descclassname">tornado.platform.caresresolver.</code><code class="descname">CaresResolver</code><a class="headerlink" href="#tornado.platform.caresresolver.CaresResolver" title="永久链接至目标">¶</a></dt>
<dd><p>Name resolver based on the c-ares library.</p>
<p>This is a non-blocking and non-threaded resolver.  It may not produce
the same results as the system resolver, but can be used for non-blocking
resolution when threads cannot be used.</p>
<p>c-ares fails to resolve some names when <code class="docutils literal"><span class="pre">family</span></code> is <code class="docutils literal"><span class="pre">AF_UNSPEC</span></code>,
so it is only recommended for use in <code class="docutils literal"><span class="pre">AF_INET</span></code> (i.e. IPv4).  This is
the default for <code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code>, but other libraries
may default to <code class="docutils literal"><span class="pre">AF_UNSPEC</span></code>.</p>
</dd></dl>

</div>
<span id="document-twisted"></span><div class="section" id="module-tornado.platform.twisted">
<span id="tornado-platform-twisted-bridges-between-twisted-and-tornado"></span><h4><code class="docutils literal"><span class="pre">tornado.platform.twisted</span></code> &#8212; Bridges between Twisted and Tornado<a class="headerlink" href="#module-tornado.platform.twisted" title="永久链接至标题">¶</a></h4>
<p>Bridges between the Twisted reactor and Tornado IOLoop.</p>
<p>This module lets you run applications and libraries written for
Twisted in a Tornado application.  It can be used in two modes,
depending on which library&#8217;s underlying event loop you want to use.</p>
<p>This module has been tested with Twisted versions 11.0.0 and newer.</p>
<div class="section" id="twisted-on-tornado">
<h5>Twisted on Tornado<a class="headerlink" href="#twisted-on-tornado" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.platform.twisted.TornadoReactor">
<em class="property">class </em><code class="descclassname">tornado.platform.twisted.</code><code class="descname">TornadoReactor</code><span class="sig-paren">(</span><em>io_loop=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/platform/twisted.html#TornadoReactor"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.platform.twisted.TornadoReactor" title="永久链接至目标">¶</a></dt>
<dd><p>Twisted reactor built on the Tornado IOLoop.</p>
<p><a class="reference internal" href="#tornado.platform.twisted.TornadoReactor" title="tornado.platform.twisted.TornadoReactor"><code class="xref py py-obj docutils literal"><span class="pre">TornadoReactor</span></code></a> implements the Twisted reactor interface on top of
the Tornado IOLoop.  To use it, simply call <a class="reference internal" href="#tornado.platform.twisted.install" title="tornado.platform.twisted.install"><code class="xref py py-obj docutils literal"><span class="pre">install</span></code></a> at the beginning
of the application:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tornado.platform.twisted</span>
<span class="n">tornado</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">twisted</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="k">import</span> <span class="n">reactor</span>
</pre></div>
</div>
<p>When the app is ready to start, call <code class="docutils literal"><span class="pre">IOLoop.current().start()</span></code>
instead of <code class="docutils literal"><span class="pre">reactor.run()</span></code>.</p>
<p>It is also possible to create a non-global reactor by calling
<code class="docutils literal"><span class="pre">tornado.platform.twisted.TornadoReactor(io_loop)</span></code>.  However, if
the <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> and reactor are to be short-lived (such as those used in
unit tests), additional cleanup may be required.  Specifically, it is
recommended to call:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">reactor</span><span class="o">.</span><span class="n">fireSystemEvent</span><span class="p">(</span><span class="s1">&#39;shutdown&#39;</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">disconnectAll</span><span class="p">()</span>
</pre></div>
</div>
<p>before closing the <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>The <code class="docutils literal"><span class="pre">io_loop</span></code> argument is deprecated.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.platform.twisted.install">
<code class="descclassname">tornado.platform.twisted.</code><code class="descname">install</code><span class="sig-paren">(</span><em>io_loop=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/platform/twisted.html#install"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.platform.twisted.install" title="永久链接至目标">¶</a></dt>
<dd><p>Install this package as the default Twisted reactor.</p>
<p><code class="docutils literal"><span class="pre">install()</span></code> must be called very early in the startup process,
before most other twisted-related imports. Conversely, because it
initializes the <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>, it cannot be called before
<a class="reference internal" href="index.html#tornado.process.fork_processes" title="tornado.process.fork_processes"><code class="xref py py-obj docutils literal"><span class="pre">fork_processes</span></code></a> or multi-process <a class="reference internal" href="index.html#tornado.tcpserver.TCPServer.start" title="tornado.tcpserver.TCPServer.start"><code class="xref py py-obj docutils literal"><span class="pre">start</span></code></a>. These
conflicting requirements make it difficult to use <a class="reference internal" href="#tornado.platform.twisted.TornadoReactor" title="tornado.platform.twisted.TornadoReactor"><code class="xref py py-obj docutils literal"><span class="pre">TornadoReactor</span></code></a>
in multi-process mode, and an external process manager such as
<code class="docutils literal"><span class="pre">supervisord</span></code> is recommended instead.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>The <code class="docutils literal"><span class="pre">io_loop</span></code> argument is deprecated.</p>
</div>
</dd></dl>

</div>
<div class="section" id="tornado-on-twisted">
<h5>Tornado on Twisted<a class="headerlink" href="#tornado-on-twisted" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.platform.twisted.TwistedIOLoop">
<em class="property">class </em><code class="descclassname">tornado.platform.twisted.</code><code class="descname">TwistedIOLoop</code><a class="reference internal" href="_modules/tornado/platform/twisted.html#TwistedIOLoop"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.platform.twisted.TwistedIOLoop" title="永久链接至目标">¶</a></dt>
<dd><p>IOLoop implementation that runs on Twisted.</p>
<p><a class="reference internal" href="#tornado.platform.twisted.TwistedIOLoop" title="tornado.platform.twisted.TwistedIOLoop"><code class="xref py py-obj docutils literal"><span class="pre">TwistedIOLoop</span></code></a> implements the Tornado IOLoop interface on top of
the Twisted reactor. Recommended usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado.platform.twisted</span> <span class="k">import</span> <span class="n">TwistedIOLoop</span>
<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="k">import</span> <span class="n">reactor</span>
<span class="n">TwistedIOLoop</span><span class="p">()</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>
<span class="c1"># Set up your tornado application as usual using `IOLoop.instance`</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Uses the global Twisted reactor by default.  To create multiple
<code class="docutils literal"><span class="pre">TwistedIOLoops</span></code> in the same process, you must pass a unique reactor
when constructing each one.</p>
<p>Not compatible with <a class="reference internal" href="index.html#tornado.process.Subprocess.set_exit_callback" title="tornado.process.Subprocess.set_exit_callback"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process.Subprocess.set_exit_callback</span></code></a>
because the <code class="docutils literal"><span class="pre">SIGCHLD</span></code> handlers used by Tornado and Twisted conflict
with each other.</p>
</dd></dl>

</div>
<div class="section" id="twisted-dns-resolver">
<h5>Twisted DNS resolver<a class="headerlink" href="#twisted-dns-resolver" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.platform.twisted.TwistedResolver">
<em class="property">class </em><code class="descclassname">tornado.platform.twisted.</code><code class="descname">TwistedResolver</code><a class="reference internal" href="_modules/tornado/platform/twisted.html#TwistedResolver"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.platform.twisted.TwistedResolver" title="永久链接至目标">¶</a></dt>
<dd><p>Twisted-based asynchronous resolver.</p>
<p>This is a non-blocking and non-threaded resolver.  It is
recommended only when threads cannot be used, since it has
limitations compared to the standard <code class="docutils literal"><span class="pre">getaddrinfo</span></code>-based
<a class="reference internal" href="index.html#tornado.netutil.Resolver" title="tornado.netutil.Resolver"><code class="xref py py-obj docutils literal"><span class="pre">Resolver</span></code></a> and
<a class="reference internal" href="index.html#tornado.netutil.ThreadedResolver" title="tornado.netutil.ThreadedResolver"><code class="xref py py-obj docutils literal"><span class="pre">ThreadedResolver</span></code></a>.  Specifically, it returns at
most one result, and arguments other than <code class="docutils literal"><span class="pre">host</span></code> and <code class="docutils literal"><span class="pre">family</span></code>
are ignored.  It may fail to resolve when <code class="docutils literal"><span class="pre">family</span></code> is not
<code class="docutils literal"><span class="pre">socket.AF_UNSPEC</span></code>.</p>
<p>Requires Twisted 12.1 or newer.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>The <code class="docutils literal"><span class="pre">io_loop</span></code> argument is deprecated.</p>
</div>
</dd></dl>

</div>
</div>
</div>
</div>
<span id="document-utilities"></span><div class="section" id="id1">
<h3>通用工具<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-autoreload"></span><div class="section" id="module-tornado.autoreload">
<span id="tornado-autoreload-automatically-detect-code-changes-in-development"></span><h4><code class="docutils literal"><span class="pre">tornado.autoreload</span></code> &#8212; Automatically detect code changes in development<a class="headerlink" href="#module-tornado.autoreload" title="永久链接至标题">¶</a></h4>
<p>Automatically restart the server when a source file is modified.</p>
<p>Most applications should not access this module directly.  Instead,
pass the keyword argument <code class="docutils literal"><span class="pre">autoreload=True</span></code> to the
<a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Application</span></code></a> constructor (or <code class="docutils literal"><span class="pre">debug=True</span></code>, which
enables this setting and several others).  This will enable autoreload
mode as well as checking for changes to templates and static
resources.  Note that restarting is a destructive operation and any
requests in progress will be aborted when the process restarts.  (If
you want to disable autoreload while using other debug-mode features,
pass both <code class="docutils literal"><span class="pre">debug=True</span></code> and <code class="docutils literal"><span class="pre">autoreload=False</span></code>).</p>
<p>This module can also be used as a command-line wrapper around scripts
such as unit test runners.  See the <a class="reference internal" href="#tornado.autoreload.main" title="tornado.autoreload.main"><code class="xref py py-obj docutils literal"><span class="pre">main</span></code></a> method for details.</p>
<p>The command-line wrapper and Application debug modes can be used together.
This combination is encouraged as the wrapper catches syntax errors and
other import-time failures, while debug mode catches changes once
the server has started.</p>
<p>This module depends on <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>, so it will not work in WSGI applications
and Google App Engine.  It also will not work correctly when <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a>&#8216;s
multi-process mode is used.</p>
<p>Reloading loses any Python interpreter command-line arguments (e.g. <code class="docutils literal"><span class="pre">-u</span></code>)
because it re-executes Python using <code class="docutils literal"><span class="pre">sys.executable</span></code> and <code class="docutils literal"><span class="pre">sys.argv</span></code>.
Additionally, modifying these variables will cause reloading to behave
incorrectly.</p>
<dl class="function">
<dt id="tornado.autoreload.start">
<code class="descclassname">tornado.autoreload.</code><code class="descname">start</code><span class="sig-paren">(</span><em>io_loop=None</em>, <em>check_time=500</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/autoreload.html#start"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.autoreload.start" title="永久链接至目标">¶</a></dt>
<dd><p>Begins watching source files for changes.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>The <code class="docutils literal"><span class="pre">io_loop</span></code> argument is deprecated.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.autoreload.wait">
<code class="descclassname">tornado.autoreload.</code><code class="descname">wait</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/autoreload.html#wait"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.autoreload.wait" title="永久链接至目标">¶</a></dt>
<dd><p>Wait for a watched file to change, then restart the process.</p>
<p>Intended to be used at the end of scripts like unit test runners,
to run the tests again after any source file changes (but see also
the command-line interface in <a class="reference internal" href="#tornado.autoreload.main" title="tornado.autoreload.main"><code class="xref py py-obj docutils literal"><span class="pre">main</span></code></a>)</p>
</dd></dl>

<dl class="function">
<dt id="tornado.autoreload.watch">
<code class="descclassname">tornado.autoreload.</code><code class="descname">watch</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/autoreload.html#watch"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.autoreload.watch" title="永久链接至目标">¶</a></dt>
<dd><p>Add a file to the watch list.</p>
<p>All imported modules are watched by default.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.autoreload.add_reload_hook">
<code class="descclassname">tornado.autoreload.</code><code class="descname">add_reload_hook</code><span class="sig-paren">(</span><em>fn</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/autoreload.html#add_reload_hook"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.autoreload.add_reload_hook" title="永久链接至目标">¶</a></dt>
<dd><p>Add a function to be called before reloading the process.</p>
<p>Note that for open file and socket handles it is generally
preferable to set the <code class="docutils literal"><span class="pre">FD_CLOEXEC</span></code> flag (using <a class="reference external" href="https://docs.python.org/3.4/library/fcntl.html#module-fcntl" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">fcntl</span></code></a> or
<code class="docutils literal"><span class="pre">tornado.platform.auto.set_close_exec</span></code>) instead
of using a reload hook to close them.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.autoreload.main">
<code class="descclassname">tornado.autoreload.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/autoreload.html#main"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.autoreload.main" title="永久链接至目标">¶</a></dt>
<dd><p>Command-line wrapper to re-run a script whenever its source changes.</p>
<p>Scripts may be specified by filename or module name:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">tornado</span><span class="o">.</span><span class="n">autoreload</span> <span class="o">-</span><span class="n">m</span> <span class="n">tornado</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">runtests</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">tornado</span><span class="o">.</span><span class="n">autoreload</span> <span class="n">tornado</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">runtests</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Running a script with this wrapper is similar to calling
<a class="reference internal" href="#tornado.autoreload.wait" title="tornado.autoreload.wait"><code class="xref py py-obj docutils literal"><span class="pre">tornado.autoreload.wait</span></code></a> at the end of the script, but this wrapper
can catch import-time problems like syntax errors that would otherwise
prevent the script from reaching its call to <a class="reference internal" href="#tornado.autoreload.wait" title="tornado.autoreload.wait"><code class="xref py py-obj docutils literal"><span class="pre">wait</span></code></a>.</p>
</dd></dl>

</div>
<span id="document-log"></span><div class="section" id="module-tornado.log">
<span id="tornado-log-logging-support"></span><h4><code class="docutils literal"><span class="pre">tornado.log</span></code> &#8212; Logging support<a class="headerlink" href="#module-tornado.log" title="永久链接至标题">¶</a></h4>
<p>Logging support for Tornado.</p>
<p>Tornado uses three logger streams:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">tornado.access</span></code>: Per-request logging for Tornado&#8217;s HTTP servers (and
potentially other servers in the future)</li>
<li><code class="docutils literal"><span class="pre">tornado.application</span></code>: Logging of errors from application code (i.e.
uncaught exceptions from callbacks)</li>
<li><code class="docutils literal"><span class="pre">tornado.general</span></code>: General-purpose logging, including any errors
or warnings from Tornado itself.</li>
</ul>
<p>These streams may be configured independently using the standard library&#8217;s
<a class="reference external" href="https://docs.python.org/3.4/library/logging.html#module-logging" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">logging</span></code></a> module.  For example, you may wish to send <code class="docutils literal"><span class="pre">tornado.access</span></code> logs
to a separate file for analysis.</p>
<dl class="class">
<dt id="tornado.log.LogFormatter">
<em class="property">class </em><code class="descclassname">tornado.log.</code><code class="descname">LogFormatter</code><span class="sig-paren">(</span><em>color=True</em>, <em>fmt='%(color)s[%(levelname)1.1s %(asctime)s %(module)s:%(lineno)d]%(end_color)s %(message)s'</em>, <em>datefmt='%y%m%d %H:%M:%S'</em>, <em>colors={40: 1</em>, <em>10: 4</em>, <em>20: 2</em>, <em>30: 3}</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/log.html#LogFormatter"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.log.LogFormatter" title="永久链接至目标">¶</a></dt>
<dd><p>Log formatter used in Tornado.</p>
<p>Key features of this formatter are:</p>
<ul class="simple">
<li>Color support when logging to a terminal that supports it.</li>
<li>Timestamps on every log line.</li>
<li>Robust against str/bytes encoding problems.</li>
</ul>
<p>This formatter is enabled automatically by
<a class="reference internal" href="index.html#tornado.options.parse_command_line" title="tornado.options.parse_command_line"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.parse_command_line</span></code></a> (unless <code class="docutils literal"><span class="pre">--logging=none</span></code> is
used).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>color</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/functions.html#bool" title="(在 Python v3.4)"><em>bool</em></a>) &#8211; Enables color support.</li>
<li><strong>fmt</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; Log message format.
It will be applied to the attributes dict of log records. The
text between <code class="docutils literal"><span class="pre">%(color)s</span></code> and <code class="docutils literal"><span class="pre">%(end_color)s</span></code> will be colored
depending on the level if color support is on.</li>
<li><strong>colors</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#dict" title="(在 Python v3.4)"><em>dict</em></a>) &#8211; color mappings from logging level to terminal color
code</li>
<li><strong>datefmt</strong> (<a class="reference external" href="https://docs.python.org/3.4/library/string.html#module-string" title="(在 Python v3.4)"><em>string</em></a>) &#8211; Datetime format.
Used for formatting <code class="docutils literal"><span class="pre">(asctime)</span></code> placeholder in <code class="docutils literal"><span class="pre">prefix_fmt</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="versionchanged">
<p><span class="versionmodified">在 3.2 版更改: </span>Added <code class="docutils literal"><span class="pre">fmt</span></code> and <code class="docutils literal"><span class="pre">datefmt</span></code> arguments.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.log.enable_pretty_logging">
<code class="descclassname">tornado.log.</code><code class="descname">enable_pretty_logging</code><span class="sig-paren">(</span><em>options=None</em>, <em>logger=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/log.html#enable_pretty_logging"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.log.enable_pretty_logging" title="永久链接至目标">¶</a></dt>
<dd><p>Turns on formatted logging output as configured.</p>
<p>This is called automatically by <a class="reference internal" href="index.html#tornado.options.parse_command_line" title="tornado.options.parse_command_line"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.parse_command_line</span></code></a>
and <a class="reference internal" href="index.html#tornado.options.parse_config_file" title="tornado.options.parse_config_file"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.parse_config_file</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.log.define_logging_options">
<code class="descclassname">tornado.log.</code><code class="descname">define_logging_options</code><span class="sig-paren">(</span><em>options=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/log.html#define_logging_options"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.log.define_logging_options" title="永久链接至目标">¶</a></dt>
<dd><p>Add logging-related flags to <code class="docutils literal"><span class="pre">options</span></code>.</p>
<p>These options are present automatically on the default options instance;
this method is only necessary if you have created your own <a class="reference internal" href="index.html#tornado.options.OptionParser" title="tornado.options.OptionParser"><code class="xref py py-obj docutils literal"><span class="pre">OptionParser</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified">4.2 新版功能: </span>This function existed in prior versions but was broken and undocumented until 4.2.</p>
</div>
</dd></dl>

</div>
<span id="document-options"></span><div class="section" id="module-tornado.options">
<span id="tornado-options-command-line-parsing"></span><h4><code class="docutils literal"><span class="pre">tornado.options</span></code> &#8212; Command-line parsing<a class="headerlink" href="#module-tornado.options" title="永久链接至标题">¶</a></h4>
<p>A command line parsing module that lets modules define their own options.</p>
<p>Each module defines its own options which are added to the global
option namespace, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado.options</span> <span class="k">import</span> <span class="n">define</span><span class="p">,</span> <span class="n">options</span>

<span class="n">define</span><span class="p">(</span><span class="s2">&quot;mysql_host&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:3306&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Main user DB&quot;</span><span class="p">)</span>
<span class="n">define</span><span class="p">(</span><span class="s2">&quot;memcache_hosts&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:11011&quot;</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
       <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Main user memcache servers&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">connect</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">mysql_host</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">main()</span></code> method of your application does not need to be aware of all of
the options used throughout your program; they are all automatically loaded
when the modules are loaded.  However, all modules that define options
must have been imported before the command line is parsed.</p>
<p>Your <code class="docutils literal"><span class="pre">main()</span></code> method can parse the command line or parse a config file with
either:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tornado</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">parse_command_line</span><span class="p">()</span>
<span class="c1"># or</span>
<span class="n">tornado</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">parse_config_file</span><span class="p">(</span><span class="s2">&quot;/etc/server.conf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Command line formats are what you would expect (<code class="docutils literal"><span class="pre">--myoption=myvalue</span></code>).
Config files are just Python files. Global names become options, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myoption</span> <span class="o">=</span> <span class="s2">&quot;myvalue&quot;</span>
<span class="n">myotheroption</span> <span class="o">=</span> <span class="s2">&quot;myothervalue&quot;</span>
</pre></div>
</div>
<p>We support <a class="reference external" href="https://docs.python.org/3.4/library/datetime.html#datetime.datetime" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">datetimes</span></code></a>, <a class="reference external" href="https://docs.python.org/3.4/library/datetime.html#datetime.timedelta" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">timedeltas</span></code></a>, ints, and floats (just pass a <code class="docutils literal"><span class="pre">type</span></code> kwarg to
<a class="reference internal" href="#tornado.options.define" title="tornado.options.define"><code class="xref py py-obj docutils literal"><span class="pre">define</span></code></a>). We also accept multi-value options. See the documentation for
<a class="reference internal" href="#tornado.options.define" title="tornado.options.define"><code class="xref py py-obj docutils literal"><span class="pre">define()</span></code></a> below.</p>
<p><a class="reference internal" href="#tornado.options.options" title="tornado.options.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.options</span></code></a> is a singleton instance of <a class="reference internal" href="#tornado.options.OptionParser" title="tornado.options.OptionParser"><code class="xref py py-obj docutils literal"><span class="pre">OptionParser</span></code></a>, and
the top-level functions in this module (<a class="reference internal" href="#tornado.options.define" title="tornado.options.define"><code class="xref py py-obj docutils literal"><span class="pre">define</span></code></a>, <a class="reference internal" href="#tornado.options.parse_command_line" title="tornado.options.parse_command_line"><code class="xref py py-obj docutils literal"><span class="pre">parse_command_line</span></code></a>, etc)
simply call methods on it.  You may create additional <a class="reference internal" href="#tornado.options.OptionParser" title="tornado.options.OptionParser"><code class="xref py py-obj docutils literal"><span class="pre">OptionParser</span></code></a>
instances to define isolated sets of options, such as for subcommands.</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p>By default, several options are defined that will configure the
standard <a class="reference external" href="https://docs.python.org/3.4/library/logging.html#module-logging" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">logging</span></code></a> module when <a class="reference internal" href="#tornado.options.parse_command_line" title="tornado.options.parse_command_line"><code class="xref py py-obj docutils literal"><span class="pre">parse_command_line</span></code></a> or <a class="reference internal" href="#tornado.options.parse_config_file" title="tornado.options.parse_config_file"><code class="xref py py-obj docutils literal"><span class="pre">parse_config_file</span></code></a>
are called.  If you want Tornado to leave the logging configuration
alone so you can manage it yourself, either pass <code class="docutils literal"><span class="pre">--logging=none</span></code>
on the command line or do the following to disable it in code:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado.options</span> <span class="k">import</span> <span class="n">options</span><span class="p">,</span> <span class="n">parse_command_line</span>
<span class="n">options</span><span class="o">.</span><span class="n">logging</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">parse_command_line</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>Dashes and underscores are fully interchangeable in option names;
options can be defined, set, and read with any mix of the two.
Dashes are typical for command-line usage while config files require
underscores.</p>
</div>
<div class="section" id="global-functions">
<h5>Global functions<a class="headerlink" href="#global-functions" title="永久链接至标题">¶</a></h5>
<dl class="function">
<dt id="tornado.options.define">
<code class="descclassname">tornado.options.</code><code class="descname">define</code><span class="sig-paren">(</span><em>name</em>, <em>default=None</em>, <em>type=None</em>, <em>help=None</em>, <em>metavar=None</em>, <em>multiple=False</em>, <em>group=None</em>, <em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#define"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.define" title="永久链接至目标">¶</a></dt>
<dd><p>Defines an option in the global namespace.</p>
<p>See <a class="reference internal" href="#tornado.options.OptionParser.define" title="tornado.options.OptionParser.define"><code class="xref py py-obj docutils literal"><span class="pre">OptionParser.define</span></code></a>.</p>
</dd></dl>

<dl class="data">
<dt id="tornado.options.options">
<code class="descclassname">tornado.options.</code><code class="descname">options</code><a class="headerlink" href="#tornado.options.options" title="永久链接至目标">¶</a></dt>
<dd><p>Global options object.  All defined options are available as attributes
on this object.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.options.parse_command_line">
<code class="descclassname">tornado.options.</code><code class="descname">parse_command_line</code><span class="sig-paren">(</span><em>args=None</em>, <em>final=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#parse_command_line"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.parse_command_line" title="永久链接至目标">¶</a></dt>
<dd><p>Parses global options from the command line.</p>
<p>See <a class="reference internal" href="#tornado.options.OptionParser.parse_command_line" title="tornado.options.OptionParser.parse_command_line"><code class="xref py py-obj docutils literal"><span class="pre">OptionParser.parse_command_line</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.options.parse_config_file">
<code class="descclassname">tornado.options.</code><code class="descname">parse_config_file</code><span class="sig-paren">(</span><em>path</em>, <em>final=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#parse_config_file"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.parse_config_file" title="永久链接至目标">¶</a></dt>
<dd><p>Parses global options from a config file.</p>
<p>See <a class="reference internal" href="#tornado.options.OptionParser.parse_config_file" title="tornado.options.OptionParser.parse_config_file"><code class="xref py py-obj docutils literal"><span class="pre">OptionParser.parse_config_file</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.options.print_help">
<code class="descclassname">tornado.options.</code><code class="descname">print_help</code><span class="sig-paren">(</span><em>file=sys.stderr</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#print_help"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.print_help" title="永久链接至目标">¶</a></dt>
<dd><p>Prints all the command line options to stderr (or another file).</p>
<p>See <a class="reference internal" href="#tornado.options.OptionParser.print_help" title="tornado.options.OptionParser.print_help"><code class="xref py py-obj docutils literal"><span class="pre">OptionParser.print_help</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.options.add_parse_callback">
<code class="descclassname">tornado.options.</code><code class="descname">add_parse_callback</code><span class="sig-paren">(</span><em>callback</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#add_parse_callback"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.add_parse_callback" title="永久链接至目标">¶</a></dt>
<dd><p>Adds a parse callback, to be invoked when option parsing is done.</p>
<p>See <a class="reference internal" href="#tornado.options.OptionParser.add_parse_callback" title="tornado.options.OptionParser.add_parse_callback"><code class="xref py py-obj docutils literal"><span class="pre">OptionParser.add_parse_callback</span></code></a></p>
</dd></dl>

<dl class="exception">
<dt id="tornado.options.Error">
<em class="property">exception </em><code class="descclassname">tornado.options.</code><code class="descname">Error</code><a class="reference internal" href="_modules/tornado/options.html#Error"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.Error" title="永久链接至目标">¶</a></dt>
<dd><p>Exception raised by errors in the options module.</p>
</dd></dl>

</div>
<div class="section" id="optionparser-class">
<h5>OptionParser class<a class="headerlink" href="#optionparser-class" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.options.OptionParser">
<em class="property">class </em><code class="descclassname">tornado.options.</code><code class="descname">OptionParser</code><a class="reference internal" href="_modules/tornado/options.html#OptionParser"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.OptionParser" title="永久链接至目标">¶</a></dt>
<dd><p>A collection of options, a dictionary with object-like access.</p>
<p>Normally accessed via static functions in the <a class="reference internal" href="#module-tornado.options" title="tornado.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options</span></code></a> module,
which reference a global instance.</p>
<dl class="method">
<dt id="tornado.options.OptionParser.items">
<code class="descname">items</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#OptionParser.items"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.OptionParser.items" title="永久链接至目标">¶</a></dt>
<dd><p>A sequence of (name, value) pairs.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.options.OptionParser.groups">
<code class="descname">groups</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#OptionParser.groups"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.OptionParser.groups" title="永久链接至目标">¶</a></dt>
<dd><p>The set of option-groups created by <code class="docutils literal"><span class="pre">define</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.options.OptionParser.group_dict">
<code class="descname">group_dict</code><span class="sig-paren">(</span><em>group</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#OptionParser.group_dict"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.OptionParser.group_dict" title="永久链接至目标">¶</a></dt>
<dd><p>The names and values of options in a group.</p>
<p>Useful for copying options into Application settings:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado.options</span> <span class="k">import</span> <span class="n">define</span><span class="p">,</span> <span class="n">parse_command_line</span><span class="p">,</span> <span class="n">options</span>

<span class="n">define</span><span class="p">(</span><span class="s1">&#39;template_path&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;application&#39;</span><span class="p">)</span>
<span class="n">define</span><span class="p">(</span><span class="s1">&#39;static_path&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;application&#39;</span><span class="p">)</span>

<span class="n">parse_command_line</span><span class="p">()</span>

<span class="n">application</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span>
    <span class="n">handlers</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="o">.</span><span class="n">group_dict</span><span class="p">(</span><span class="s1">&#39;application&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.options.OptionParser.as_dict">
<code class="descname">as_dict</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#OptionParser.as_dict"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.OptionParser.as_dict" title="永久链接至目标">¶</a></dt>
<dd><p>The names and values of all options.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.options.OptionParser.define">
<code class="descname">define</code><span class="sig-paren">(</span><em>name</em>, <em>default=None</em>, <em>type=None</em>, <em>help=None</em>, <em>metavar=None</em>, <em>multiple=False</em>, <em>group=None</em>, <em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#OptionParser.define"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.OptionParser.define" title="永久链接至目标">¶</a></dt>
<dd><p>Defines a new command line option.</p>
<p>If <code class="docutils literal"><span class="pre">type</span></code> is given (one of str, float, int, datetime, or timedelta)
or can be inferred from the <code class="docutils literal"><span class="pre">default</span></code>, we parse the command line
arguments based on the given type. If <code class="docutils literal"><span class="pre">multiple</span></code> is True, we accept
comma-separated values, and the option value is always a list.</p>
<p>For multi-value integers, we also accept the syntax <code class="docutils literal"><span class="pre">x:y</span></code>, which
turns into <code class="docutils literal"><span class="pre">range(x,</span> <span class="pre">y)</span></code> - very useful for long integer ranges.</p>
<p><code class="docutils literal"><span class="pre">help</span></code> and <code class="docutils literal"><span class="pre">metavar</span></code> are used to construct the
automatically generated command line help string. The help
message is formatted like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">METAVAR</span>      <span class="n">help</span> <span class="n">string</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">group</span></code> is used to group the defined options in logical
groups. By default, command line options are grouped by the
file in which they are defined.</p>
<p>Command line option names must be unique globally. They can be parsed
from the command line with <a class="reference internal" href="#tornado.options.parse_command_line" title="tornado.options.parse_command_line"><code class="xref py py-obj docutils literal"><span class="pre">parse_command_line</span></code></a> or parsed from a
config file with <a class="reference internal" href="#tornado.options.parse_config_file" title="tornado.options.parse_config_file"><code class="xref py py-obj docutils literal"><span class="pre">parse_config_file</span></code></a>.</p>
<p>If a <code class="docutils literal"><span class="pre">callback</span></code> is given, it will be run with the new value whenever
the option is changed.  This can be used to combine command-line
and file-based options:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;path to config file&quot;</span><span class="p">,</span>
       <span class="n">callback</span><span class="o">=</span><span class="k">lambda</span> <span class="n">path</span><span class="p">:</span> <span class="n">parse_config_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
<p>With this definition, options in the file specified by <code class="docutils literal"><span class="pre">--config</span></code> will
override options set earlier on the command line, but can be overridden
by later flags.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.options.OptionParser.parse_command_line">
<code class="descname">parse_command_line</code><span class="sig-paren">(</span><em>args=None</em>, <em>final=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#OptionParser.parse_command_line"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.OptionParser.parse_command_line" title="永久链接至目标">¶</a></dt>
<dd><p>Parses all options given on the command line (defaults to
<a class="reference external" href="https://docs.python.org/3.4/library/sys.html#sys.argv" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">sys.argv</span></code></a>).</p>
<p>Note that <code class="docutils literal"><span class="pre">args[0]</span></code> is ignored since it is the program name
in <a class="reference external" href="https://docs.python.org/3.4/library/sys.html#sys.argv" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">sys.argv</span></code></a>.</p>
<p>We return a list of all arguments that are not parsed as options.</p>
<p>If <code class="docutils literal"><span class="pre">final</span></code> is <code class="docutils literal"><span class="pre">False</span></code>, parse callbacks will not be run.
This is useful for applications that wish to combine configurations
from multiple sources.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.options.OptionParser.parse_config_file">
<code class="descname">parse_config_file</code><span class="sig-paren">(</span><em>path</em>, <em>final=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#OptionParser.parse_config_file"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.OptionParser.parse_config_file" title="永久链接至目标">¶</a></dt>
<dd><p>Parses and loads the Python config file at the given path.</p>
<p>If <code class="docutils literal"><span class="pre">final</span></code> is <code class="docutils literal"><span class="pre">False</span></code>, parse callbacks will not be run.
This is useful for applications that wish to combine configurations
from multiple sources.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.1 版更改: </span>Config files are now always interpreted as utf-8 instead of
the system default encoding.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="tornado.options.OptionParser.print_help">
<code class="descname">print_help</code><span class="sig-paren">(</span><em>file=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#OptionParser.print_help"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.OptionParser.print_help" title="永久链接至目标">¶</a></dt>
<dd><p>Prints all the command line options to stderr (or another file).</p>
</dd></dl>

<dl class="method">
<dt id="tornado.options.OptionParser.add_parse_callback">
<code class="descname">add_parse_callback</code><span class="sig-paren">(</span><em>callback</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#OptionParser.add_parse_callback"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.OptionParser.add_parse_callback" title="永久链接至目标">¶</a></dt>
<dd><p>Adds a parse callback, to be invoked when option parsing is done.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.options.OptionParser.mockable">
<code class="descname">mockable</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/options.html#OptionParser.mockable"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.options.OptionParser.mockable" title="永久链接至目标">¶</a></dt>
<dd><p>Returns a wrapper around self that is compatible with
<a class="reference external" href="https://docs.python.org/3.4/library/unittest.mock.html#unittest.mock.patch" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">mock.patch</span></code></a>.</p>
<p>The <a class="reference external" href="https://docs.python.org/3.4/library/unittest.mock.html#unittest.mock.patch" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">mock.patch</span></code></a> function (included in
the standard library <a class="reference external" href="https://docs.python.org/3.4/library/unittest.mock.html#module-unittest.mock" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">unittest.mock</span></code></a> package since Python 3.3,
or in the third-party <code class="docutils literal"><span class="pre">mock</span></code> package for older versions of
Python) is incompatible with objects like <code class="docutils literal"><span class="pre">options</span></code> that
override <code class="docutils literal"><span class="pre">__getattr__</span></code> and <code class="docutils literal"><span class="pre">__setattr__</span></code>.  This function
returns an object that can be used with <a class="reference external" href="https://docs.python.org/3.4/library/unittest.mock.html#unittest.mock.patch.object" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">mock.patch.object</span></code></a> to modify option values:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">mockable</span><span class="p">(),</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">value</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
</div>
<span id="document-stack_context"></span><div class="section" id="module-tornado.stack_context">
<span id="tornado-stack-context-exception-handling-across-asynchronous-callbacks"></span><h4><code class="docutils literal"><span class="pre">tornado.stack_context</span></code> &#8212; Exception handling across asynchronous callbacks<a class="headerlink" href="#module-tornado.stack_context" title="永久链接至标题">¶</a></h4>
<p><a class="reference internal" href="#tornado.stack_context.StackContext" title="tornado.stack_context.StackContext"><code class="xref py py-obj docutils literal"><span class="pre">StackContext</span></code></a> allows applications to maintain threadlocal-like state
that follows execution as it moves to other execution contexts.</p>
<p>The motivating examples are to eliminate the need for explicit
<code class="docutils literal"><span class="pre">async_callback</span></code> wrappers (as in <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.RequestHandler</span></code></a>), and to
allow some additional context to be kept for logging.</p>
<p>This is slightly magic, but it&#8217;s an extension of the idea that an
exception handler is a kind of stack-local state and when that stack
is suspended and resumed in a new context that state needs to be
preserved.  <a class="reference internal" href="#tornado.stack_context.StackContext" title="tornado.stack_context.StackContext"><code class="xref py py-obj docutils literal"><span class="pre">StackContext</span></code></a> shifts the burden of restoring that state
from each call site (e.g.  wrapping each <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> callback
in <code class="docutils literal"><span class="pre">async_callback</span></code>) to the mechanisms that transfer control from
one context to another (e.g. <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> itself, <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>,
thread pools, etc).</p>
<p>Example usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">die_on_error</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;exception in asynchronous operation&quot;</span><span class="p">,</span><span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">with</span> <span class="n">StackContext</span><span class="p">(</span><span class="n">die_on_error</span><span class="p">):</span>
    <span class="c1"># Any exception thrown here *or in callback and its descendants*</span>
    <span class="c1"># will cause the process to exit instead of spinning endlessly</span>
    <span class="c1"># in the ioloop.</span>
    <span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
<span class="n">ioloop</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>Most applications shouldn&#8217;t have to work with <a class="reference internal" href="#tornado.stack_context.StackContext" title="tornado.stack_context.StackContext"><code class="xref py py-obj docutils literal"><span class="pre">StackContext</span></code></a> directly.
Here are a few rules of thumb for when it&#8217;s necessary:</p>
<ul class="simple">
<li>If you&#8217;re writing an asynchronous library that doesn&#8217;t rely on a
stack_context-aware library like <a class="reference internal" href="index.html#module-tornado.ioloop" title="tornado.ioloop"><code class="xref py py-obj docutils literal"><span class="pre">tornado.ioloop</span></code></a> or <a class="reference internal" href="index.html#module-tornado.iostream" title="tornado.iostream"><code class="xref py py-obj docutils literal"><span class="pre">tornado.iostream</span></code></a>
(for example, if you&#8217;re writing a thread pool), use
<a class="reference internal" href="#tornado.stack_context.wrap" title="tornado.stack_context.wrap"><code class="xref py py-obj docutils literal"><span class="pre">stack_context.wrap()</span></code></a> before any asynchronous operations to capture the
stack context from where the operation was started.</li>
<li>If you&#8217;re writing an asynchronous library that has some shared
resources (such as a connection pool), create those shared resources
within a <code class="docutils literal"><span class="pre">with</span> <span class="pre">stack_context.NullContext():</span></code> block.  This will prevent
<code class="docutils literal"><span class="pre">StackContexts</span></code> from leaking from one request to another.</li>
<li>If you want to write something like an exception handler that will
persist across asynchronous calls, create a new <a class="reference internal" href="#tornado.stack_context.StackContext" title="tornado.stack_context.StackContext"><code class="xref py py-obj docutils literal"><span class="pre">StackContext</span></code></a> (or
<a class="reference internal" href="#tornado.stack_context.ExceptionStackContext" title="tornado.stack_context.ExceptionStackContext"><code class="xref py py-obj docutils literal"><span class="pre">ExceptionStackContext</span></code></a>), and make your asynchronous calls in a <code class="docutils literal"><span class="pre">with</span></code>
block that references your <a class="reference internal" href="#tornado.stack_context.StackContext" title="tornado.stack_context.StackContext"><code class="xref py py-obj docutils literal"><span class="pre">StackContext</span></code></a>.</li>
</ul>
<dl class="class">
<dt id="tornado.stack_context.StackContext">
<em class="property">class </em><code class="descclassname">tornado.stack_context.</code><code class="descname">StackContext</code><span class="sig-paren">(</span><em>context_factory</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/stack_context.html#StackContext"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.stack_context.StackContext" title="永久链接至目标">¶</a></dt>
<dd><p>Establishes the given context as a StackContext that will be transferred.</p>
<p>Note that the parameter is a callable that returns a context
manager, not the context itself.  That is, where for a
non-transferable context manager you would say:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">my_context</span><span class="p">():</span>
</pre></div>
</div>
<p>StackContext takes the function itself rather than its result:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">StackContext</span><span class="p">(</span><span class="n">my_context</span><span class="p">):</span>
</pre></div>
</div>
<p>The result of <code class="docutils literal"><span class="pre">with</span> <span class="pre">StackContext()</span> <span class="pre">as</span> <span class="pre">cb:</span></code> is a deactivation
callback.  Run this callback when the StackContext is no longer
needed to ensure that it is not propagated any further (note that
deactivating a context does not affect any instances of that
context that are currently pending).  This is an advanced feature
and not necessary in most applications.</p>
</dd></dl>

<dl class="class">
<dt id="tornado.stack_context.ExceptionStackContext">
<em class="property">class </em><code class="descclassname">tornado.stack_context.</code><code class="descname">ExceptionStackContext</code><span class="sig-paren">(</span><em>exception_handler</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/stack_context.html#ExceptionStackContext"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.stack_context.ExceptionStackContext" title="永久链接至目标">¶</a></dt>
<dd><p>Specialization of StackContext for exception handling.</p>
<p>The supplied <code class="docutils literal"><span class="pre">exception_handler</span></code> function will be called in the
event of an uncaught exception in this context.  The semantics are
similar to a try/finally clause, and intended use cases are to log
an error, close a socket, or similar cleanup actions.  The
<code class="docutils literal"><span class="pre">exc_info</span></code> triple <code class="docutils literal"><span class="pre">(type,</span> <span class="pre">value,</span> <span class="pre">traceback)</span></code> will be passed to the
exception_handler function.</p>
<p>If the exception handler returns true, the exception will be
consumed and will not be propagated to other exception handlers.</p>
</dd></dl>

<dl class="class">
<dt id="tornado.stack_context.NullContext">
<em class="property">class </em><code class="descclassname">tornado.stack_context.</code><code class="descname">NullContext</code><a class="reference internal" href="_modules/tornado/stack_context.html#NullContext"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.stack_context.NullContext" title="永久链接至目标">¶</a></dt>
<dd><p>Resets the <a class="reference internal" href="#tornado.stack_context.StackContext" title="tornado.stack_context.StackContext"><code class="xref py py-obj docutils literal"><span class="pre">StackContext</span></code></a>.</p>
<p>Useful when creating a shared resource on demand (e.g. an
<a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a>) where the stack that caused the creating is
not relevant to future operations.</p>
</dd></dl>

<dl class="function">
<dt id="tornado.stack_context.wrap">
<code class="descclassname">tornado.stack_context.</code><code class="descname">wrap</code><span class="sig-paren">(</span><em>fn</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/stack_context.html#wrap"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.stack_context.wrap" title="永久链接至目标">¶</a></dt>
<dd><p>Returns a callable object that will restore the current <a class="reference internal" href="#tornado.stack_context.StackContext" title="tornado.stack_context.StackContext"><code class="xref py py-obj docutils literal"><span class="pre">StackContext</span></code></a>
when executed.</p>
<p>Use this whenever saving a callback to be executed later in a
different execution context (either in a different thread or
asynchronously in the same thread).</p>
</dd></dl>

<dl class="function">
<dt id="tornado.stack_context.run_with_stack_context">
<code class="descclassname">tornado.stack_context.</code><code class="descname">run_with_stack_context</code><span class="sig-paren">(</span><em>context</em>, <em>func</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/stack_context.html#run_with_stack_context"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.stack_context.run_with_stack_context" title="永久链接至目标">¶</a></dt>
<dd><p>Run a coroutine <code class="docutils literal"><span class="pre">func</span></code> in the given <a class="reference internal" href="#tornado.stack_context.StackContext" title="tornado.stack_context.StackContext"><code class="xref py py-obj docutils literal"><span class="pre">StackContext</span></code></a>.</p>
<p>It is not safe to have a <code class="docutils literal"><span class="pre">yield</span></code> statement within a <code class="docutils literal"><span class="pre">with</span> <span class="pre">StackContext</span></code>
block, so it is difficult to use stack context with <a class="reference internal" href="index.html#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">gen.coroutine</span></code></a>.
This helper function runs the function in the correct context while
keeping the <code class="docutils literal"><span class="pre">yield</span></code> and <code class="docutils literal"><span class="pre">with</span></code> statements syntactically separate.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">incorrect</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">StackContext</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
        <span class="c1"># ERROR: this will raise StackContextInconsistentError</span>
        <span class="k">yield</span> <span class="n">other_coroutine</span><span class="p">()</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">correct</span><span class="p">():</span>
    <span class="k">yield</span> <span class="n">run_with_stack_context</span><span class="p">(</span><span class="n">StackContext</span><span class="p">(</span><span class="n">ctx</span><span class="p">),</span> <span class="n">other_coroutine</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

</div>
<span id="document-testing"></span><div class="section" id="module-tornado.testing">
<span id="tornado-testing-unit-testing-support-for-asynchronous-code"></span><h4><code class="docutils literal"><span class="pre">tornado.testing</span></code> &#8212; Unit testing support for asynchronous code<a class="headerlink" href="#module-tornado.testing" title="永久链接至标题">¶</a></h4>
<p>Support classes for automated testing.</p>
<ul class="simple">
<li><a class="reference internal" href="#tornado.testing.AsyncTestCase" title="tornado.testing.AsyncTestCase"><code class="xref py py-obj docutils literal"><span class="pre">AsyncTestCase</span></code></a> and <a class="reference internal" href="#tornado.testing.AsyncHTTPTestCase" title="tornado.testing.AsyncHTTPTestCase"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPTestCase</span></code></a>:  Subclasses of unittest.TestCase
with additional support for testing asynchronous (<a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> based) code.</li>
<li><a class="reference internal" href="#tornado.testing.ExpectLog" title="tornado.testing.ExpectLog"><code class="xref py py-obj docutils literal"><span class="pre">ExpectLog</span></code></a> and <a class="reference internal" href="#tornado.testing.LogTrapTestCase" title="tornado.testing.LogTrapTestCase"><code class="xref py py-obj docutils literal"><span class="pre">LogTrapTestCase</span></code></a>: Make test logs less spammy.</li>
<li><a class="reference internal" href="#tornado.testing.main" title="tornado.testing.main"><code class="xref py py-obj docutils literal"><span class="pre">main()</span></code></a>: A simple test runner (wrapper around unittest.main()) with support
for the tornado.autoreload module to rerun the tests when code changes.</li>
</ul>
<div class="section" id="asynchronous-test-cases">
<h5>Asynchronous test cases<a class="headerlink" href="#asynchronous-test-cases" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.testing.AsyncTestCase">
<em class="property">class </em><code class="descclassname">tornado.testing.</code><code class="descname">AsyncTestCase</code><span class="sig-paren">(</span><em>methodName='runTest'</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#AsyncTestCase"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.AsyncTestCase" title="永久链接至目标">¶</a></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3.4/library/unittest.html#unittest.TestCase" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">TestCase</span></code></a> subclass for testing <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>-based
asynchronous code.</p>
<p>The unittest framework is synchronous, so the test must be
complete by the time the test method returns.  This means that
asynchronous code cannot be used in quite the same way as usual.
To write test functions that use the same <code class="docutils literal"><span class="pre">yield</span></code>-based patterns
used with the <a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a> module, decorate your test methods
with <a class="reference internal" href="#tornado.testing.gen_test" title="tornado.testing.gen_test"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.gen_test</span></code></a> instead of
<a class="reference internal" href="index.html#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.coroutine</span></code></a>.  This class also provides the <a class="reference internal" href="#tornado.testing.AsyncTestCase.stop" title="tornado.testing.AsyncTestCase.stop"><code class="xref py py-obj docutils literal"><span class="pre">stop()</span></code></a>
and <a class="reference internal" href="#tornado.testing.AsyncTestCase.wait" title="tornado.testing.AsyncTestCase.wait"><code class="xref py py-obj docutils literal"><span class="pre">wait()</span></code></a> methods for a more manual style of testing.  The test
method itself must call <code class="docutils literal"><span class="pre">self.wait()</span></code>, and asynchronous
callbacks should call <code class="docutils literal"><span class="pre">self.stop()</span></code> to signal completion.</p>
<p>By default, a new <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> is constructed for each test and is available
as <code class="docutils literal"><span class="pre">self.io_loop</span></code>.  This <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> should be used in the construction of
HTTP clients/servers, etc.  If the code being tested requires a
global <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>, subclasses should override <a class="reference internal" href="#tornado.testing.AsyncTestCase.get_new_ioloop" title="tornado.testing.AsyncTestCase.get_new_ioloop"><code class="xref py py-obj docutils literal"><span class="pre">get_new_ioloop</span></code></a> to return it.</p>
<p>The <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>&#8216;s <code class="docutils literal"><span class="pre">start</span></code> and <code class="docutils literal"><span class="pre">stop</span></code> methods should not be
called directly.  Instead, use <a class="reference internal" href="#tornado.testing.AsyncTestCase.stop" title="tornado.testing.AsyncTestCase.stop"><code class="xref py py-obj docutils literal"><span class="pre">self.stop</span></code></a> and <a class="reference internal" href="#tornado.testing.AsyncTestCase.wait" title="tornado.testing.AsyncTestCase.wait"><code class="xref py py-obj docutils literal"><span class="pre">self.wait</span></code></a>.  Arguments passed to <code class="docutils literal"><span class="pre">self.stop</span></code> are returned from
<code class="docutils literal"><span class="pre">self.wait</span></code>.  It is possible to have multiple <code class="docutils literal"><span class="pre">wait</span></code>/<code class="docutils literal"><span class="pre">stop</span></code>
cycles in the same test.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># This test uses coroutine style.</span>
<span class="k">class</span> <span class="nc">MyTestCase</span><span class="p">(</span><span class="n">AsyncTestCase</span><span class="p">):</span>
    <span class="nd">@tornado</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">gen_test</span>
    <span class="k">def</span> <span class="nf">test_http_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">AsyncHTTPClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">io_loop</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;http://www.tornadoweb.org&quot;</span><span class="p">)</span>
        <span class="c1"># Test contents of response</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;FriendFeed&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

<span class="c1"># This test uses argument passing between self.stop and self.wait.</span>
<span class="k">class</span> <span class="nc">MyTestCase2</span><span class="p">(</span><span class="n">AsyncTestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_http_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">AsyncHTTPClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">io_loop</span><span class="p">)</span>
        <span class="n">client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;http://www.tornadoweb.org/&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="c1"># Test contents of response</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;FriendFeed&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

<span class="c1"># This test uses an explicit callback-based style.</span>
<span class="k">class</span> <span class="nc">MyTestCase3</span><span class="p">(</span><span class="n">AsyncTestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_http_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">AsyncHTTPClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">io_loop</span><span class="p">)</span>
        <span class="n">client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;http://www.tornadoweb.org/&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_fetch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">handle_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># Test contents of response (failures and exceptions here</span>
        <span class="c1"># will cause self.wait() to throw an exception and end the</span>
        <span class="c1"># test).</span>
        <span class="c1"># Exceptions thrown here are magically propagated to</span>
        <span class="c1"># self.wait() in test_http_fetch() via stack_context.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;FriendFeed&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="tornado.testing.AsyncTestCase.get_new_ioloop">
<code class="descname">get_new_ioloop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#AsyncTestCase.get_new_ioloop"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.AsyncTestCase.get_new_ioloop" title="永久链接至目标">¶</a></dt>
<dd><p>Creates a new <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> for this test.  May be overridden in
subclasses for tests that require a specific <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> (usually
the singleton <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.instance" title="tornado.ioloop.IOLoop.instance"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.instance()</span></code></a>).</p>
</dd></dl>

<dl class="method">
<dt id="tornado.testing.AsyncTestCase.stop">
<code class="descname">stop</code><span class="sig-paren">(</span><em>_arg=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#AsyncTestCase.stop"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.AsyncTestCase.stop" title="永久链接至目标">¶</a></dt>
<dd><p>Stops the <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>, causing one pending (or future) call to <a class="reference internal" href="#tornado.testing.AsyncTestCase.wait" title="tornado.testing.AsyncTestCase.wait"><code class="xref py py-obj docutils literal"><span class="pre">wait()</span></code></a>
to return.</p>
<p>Keyword arguments or a single positional argument passed to <a class="reference internal" href="#tornado.testing.AsyncTestCase.stop" title="tornado.testing.AsyncTestCase.stop"><code class="xref py py-obj docutils literal"><span class="pre">stop()</span></code></a> are
saved and will be returned by <a class="reference internal" href="#tornado.testing.AsyncTestCase.wait" title="tornado.testing.AsyncTestCase.wait"><code class="xref py py-obj docutils literal"><span class="pre">wait()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.testing.AsyncTestCase.wait">
<code class="descname">wait</code><span class="sig-paren">(</span><em>condition=None</em>, <em>timeout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#AsyncTestCase.wait"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.AsyncTestCase.wait" title="永久链接至目标">¶</a></dt>
<dd><p>Runs the <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> until stop is called or timeout has passed.</p>
<p>In the event of a timeout, an exception will be thrown. The
default timeout is 5 seconds; it may be overridden with a
<code class="docutils literal"><span class="pre">timeout</span></code> keyword argument or globally with the
<code class="docutils literal"><span class="pre">ASYNC_TEST_TIMEOUT</span></code> environment variable.</p>
<p>If <code class="docutils literal"><span class="pre">condition</span></code> is not None, the <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> will be restarted
after <a class="reference internal" href="#tornado.testing.AsyncTestCase.stop" title="tornado.testing.AsyncTestCase.stop"><code class="xref py py-obj docutils literal"><span class="pre">stop()</span></code></a> until <code class="docutils literal"><span class="pre">condition()</span></code> returns true.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 3.1 版更改: </span>Added the <code class="docutils literal"><span class="pre">ASYNC_TEST_TIMEOUT</span></code> environment variable.</p>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.testing.AsyncHTTPTestCase">
<em class="property">class </em><code class="descclassname">tornado.testing.</code><code class="descname">AsyncHTTPTestCase</code><span class="sig-paren">(</span><em>methodName='runTest'</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#AsyncHTTPTestCase"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.AsyncHTTPTestCase" title="永久链接至目标">¶</a></dt>
<dd><p>A test case that starts up an HTTP server.</p>
<p>Subclasses must override <a class="reference internal" href="#tornado.testing.AsyncHTTPTestCase.get_app" title="tornado.testing.AsyncHTTPTestCase.get_app"><code class="xref py py-obj docutils literal"><span class="pre">get_app()</span></code></a>, which returns the
<a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Application</span></code></a> (or other <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> callback) to be tested.
Tests will typically use the provided <code class="docutils literal"><span class="pre">self.http_client</span></code> to fetch
URLs from this server.</p>
<p>Example, assuming the &#8220;Hello, world&#8221; example from the user guide is in
<code class="docutils literal"><span class="pre">hello.py</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hello</span>

<span class="k">class</span> <span class="nc">TestHelloApp</span><span class="p">(</span><span class="n">AsyncHTTPTestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_app</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">hello</span><span class="o">.</span><span class="n">make_app</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_homepage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="s1">&#39;Hello, world&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>That call to <code class="docutils literal"><span class="pre">self.fetch()</span></code> is equivalent to</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">http_client</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
<p>which illustrates how AsyncTestCase can turn an asynchronous operation,
like <code class="docutils literal"><span class="pre">http_client.fetch()</span></code>, into a synchronous operation. If you need
to do other asynchronous operations in tests, you&#8217;ll probably need to use
<code class="docutils literal"><span class="pre">stop()</span></code> and <code class="docutils literal"><span class="pre">wait()</span></code> yourself.</p>
<dl class="method">
<dt id="tornado.testing.AsyncHTTPTestCase.get_app">
<code class="descname">get_app</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#AsyncHTTPTestCase.get_app"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.AsyncHTTPTestCase.get_app" title="永久链接至目标">¶</a></dt>
<dd><p>Should be overridden by subclasses to return a
<a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Application</span></code></a> or other <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> callback.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.testing.AsyncHTTPTestCase.fetch">
<code class="descname">fetch</code><span class="sig-paren">(</span><em>path</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#AsyncHTTPTestCase.fetch"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.AsyncHTTPTestCase.fetch" title="永久链接至目标">¶</a></dt>
<dd><p>Convenience method to synchronously fetch a url.</p>
<p>The given path will be appended to the local server&#8217;s host and
port.  Any additional kwargs will be passed directly to
<a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient.fetch" title="tornado.httpclient.AsyncHTTPClient.fetch"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient.fetch</span></code></a> (and so could be used to pass
<code class="docutils literal"><span class="pre">method=&quot;POST&quot;</span></code>, <code class="docutils literal"><span class="pre">body=&quot;...&quot;</span></code>, etc).</p>
</dd></dl>

<dl class="method">
<dt id="tornado.testing.AsyncHTTPTestCase.get_httpserver_options">
<code class="descname">get_httpserver_options</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#AsyncHTTPTestCase.get_httpserver_options"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.AsyncHTTPTestCase.get_httpserver_options" title="永久链接至目标">¶</a></dt>
<dd><p>May be overridden by subclasses to return additional
keyword arguments for the server.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.testing.AsyncHTTPTestCase.get_http_port">
<code class="descname">get_http_port</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#AsyncHTTPTestCase.get_http_port"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.AsyncHTTPTestCase.get_http_port" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the port used by the server.</p>
<p>A new port is chosen for each test.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.testing.AsyncHTTPTestCase.get_url">
<code class="descname">get_url</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#AsyncHTTPTestCase.get_url"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.AsyncHTTPTestCase.get_url" title="永久链接至目标">¶</a></dt>
<dd><p>Returns an absolute url for the given path on the test server.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.testing.AsyncHTTPSTestCase">
<em class="property">class </em><code class="descclassname">tornado.testing.</code><code class="descname">AsyncHTTPSTestCase</code><span class="sig-paren">(</span><em>methodName='runTest'</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#AsyncHTTPSTestCase"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.AsyncHTTPSTestCase" title="永久链接至目标">¶</a></dt>
<dd><p>A test case that starts an HTTPS server.</p>
<p>Interface is generally the same as <a class="reference internal" href="#tornado.testing.AsyncHTTPTestCase" title="tornado.testing.AsyncHTTPTestCase"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPTestCase</span></code></a>.</p>
<dl class="method">
<dt id="tornado.testing.AsyncHTTPSTestCase.get_ssl_options">
<code class="descname">get_ssl_options</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#AsyncHTTPSTestCase.get_ssl_options"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.AsyncHTTPSTestCase.get_ssl_options" title="永久链接至目标">¶</a></dt>
<dd><p>May be overridden by subclasses to select SSL options.</p>
<p>By default includes a self-signed testing certificate.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tornado.testing.gen_test">
<code class="descclassname">tornado.testing.</code><code class="descname">gen_test</code><span class="sig-paren">(</span><em>func=None</em>, <em>timeout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#gen_test"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.gen_test" title="永久链接至目标">¶</a></dt>
<dd><p>Testing equivalent of <code class="docutils literal"><span class="pre">&#64;gen.coroutine</span></code>, to be applied to test methods.</p>
<p><code class="docutils literal"><span class="pre">&#64;gen.coroutine</span></code> cannot be used on tests because the <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> is not
already running.  <code class="docutils literal"><span class="pre">&#64;gen_test</span></code> should be applied to test methods
on subclasses of <a class="reference internal" href="#tornado.testing.AsyncTestCase" title="tornado.testing.AsyncTestCase"><code class="xref py py-obj docutils literal"><span class="pre">AsyncTestCase</span></code></a>.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTest</span><span class="p">(</span><span class="n">AsyncHTTPTestCase</span><span class="p">):</span>
    <span class="nd">@gen_test</span>
    <span class="k">def</span> <span class="nf">test_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">gen</span><span class="o">.</span><span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>By default, <code class="docutils literal"><span class="pre">&#64;gen_test</span></code> times out after 5 seconds. The timeout may be
overridden globally with the <code class="docutils literal"><span class="pre">ASYNC_TEST_TIMEOUT</span></code> environment variable,
or for each test with the <code class="docutils literal"><span class="pre">timeout</span></code> keyword argument:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTest</span><span class="p">(</span><span class="n">AsyncHTTPTestCase</span><span class="p">):</span>
    <span class="nd">@gen_test</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_something_slow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">gen</span><span class="o">.</span><span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能: </span>The <code class="docutils literal"><span class="pre">timeout</span></code> argument and <code class="docutils literal"><span class="pre">ASYNC_TEST_TIMEOUT</span></code> environment
variable.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.0 版更改: </span>The wrapper now passes along <code class="docutils literal"><span class="pre">*args,</span> <span class="pre">**kwargs</span></code> so it can be used
on functions with arguments.</p>
</div>
</dd></dl>

</div>
<div class="section" id="controlling-log-output">
<h5>Controlling log output<a class="headerlink" href="#controlling-log-output" title="永久链接至标题">¶</a></h5>
<dl class="class">
<dt id="tornado.testing.ExpectLog">
<em class="property">class </em><code class="descclassname">tornado.testing.</code><code class="descname">ExpectLog</code><span class="sig-paren">(</span><em>logger</em>, <em>regex</em>, <em>required=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#ExpectLog"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.ExpectLog" title="永久链接至目标">¶</a></dt>
<dd><p>Context manager to capture and suppress expected log output.</p>
<p>Useful to make tests of error conditions less noisy, while still
leaving unexpected log entries visible.  <em>Not thread safe.</em></p>
<p>The attribute <code class="docutils literal"><span class="pre">logged_stack</span></code> is set to true if any exception
stack trace was logged.</p>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectLog</span><span class="p">(</span><span class="s1">&#39;tornado.application&#39;</span><span class="p">,</span> <span class="s2">&quot;Uncaught exception&quot;</span><span class="p">):</span>
    <span class="n">error_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;/some_page&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 4.3 版更改: </span>Added the <code class="docutils literal"><span class="pre">logged_stack</span></code> attribute.</p>
</div>
<p>Constructs an ExpectLog context manager.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">参数:</th><td class="field-body"><ul class="first last simple">
<li><strong>logger</strong> &#8211; Logger object (or name of logger) to watch.  Pass
an empty string to watch the root logger.</li>
<li><strong>regex</strong> &#8211; Regular expression to match.  Any log entries on
the specified logger that match this regex will be suppressed.</li>
<li><strong>required</strong> &#8211; If true, an exeption will be raised if the end of
the <code class="docutils literal"><span class="pre">with</span></code> statement is reached without matching any log entries.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="tornado.testing.LogTrapTestCase">
<em class="property">class </em><code class="descclassname">tornado.testing.</code><code class="descname">LogTrapTestCase</code><span class="sig-paren">(</span><em>methodName='runTest'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#LogTrapTestCase"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.LogTrapTestCase" title="永久链接至目标">¶</a></dt>
<dd><p>A test case that captures and discards all logging output
if the test passes.</p>
<p>Some libraries can produce a lot of logging output even when
the test succeeds, so this class can be useful to minimize the noise.
Simply use it as a base class for your test case.  It is safe to combine
with AsyncTestCase via multiple inheritance
(<code class="docutils literal"><span class="pre">class</span> <span class="pre">MyTestCase(AsyncHTTPTestCase,</span> <span class="pre">LogTrapTestCase):</span></code>)</p>
<p>This class assumes that only one log handler is configured and
that it is a <a class="reference external" href="https://docs.python.org/3.4/library/logging.handlers.html#logging.StreamHandler" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">StreamHandler</span></code></a>.  This is true for both
<a class="reference external" href="https://docs.python.org/3.4/library/logging.html#logging.basicConfig" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">logging.basicConfig</span></code></a> and the &#8220;pretty logging&#8221; configured by
<a class="reference internal" href="index.html#module-tornado.options" title="tornado.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options</span></code></a>.  It is not compatible with other log buffering
mechanisms, such as those provided by some test runners.</p>
<div class="deprecated">
<p><span class="versionmodified">4.1 版后已移除: </span>Use the unittest module&#8217;s <code class="docutils literal"><span class="pre">--buffer</span></code> option instead, or <a class="reference internal" href="#tornado.testing.ExpectLog" title="tornado.testing.ExpectLog"><code class="xref py py-obj docutils literal"><span class="pre">ExpectLog</span></code></a>.</p>
</div>
<p>Create an instance of the class that will use the named test
method when executed. Raises a ValueError if the instance does
not have a method with the specified name.</p>
</dd></dl>

</div>
<div class="section" id="test-runner">
<h5>Test runner<a class="headerlink" href="#test-runner" title="永久链接至标题">¶</a></h5>
<dl class="function">
<dt id="tornado.testing.main">
<code class="descclassname">tornado.testing.</code><code class="descname">main</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#main"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.main" title="永久链接至目标">¶</a></dt>
<dd><p>A simple test runner.</p>
<p>This test runner is essentially equivalent to <a class="reference external" href="https://docs.python.org/3.4/library/unittest.html#unittest.main" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">unittest.main</span></code></a> from
the standard library, but adds support for tornado-style option
parsing and log formatting.</p>
<p>The easiest way to run a test is via the command line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">tornado</span><span class="o">.</span><span class="n">testing</span> <span class="n">tornado</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">stack_context_test</span>
</pre></div>
</div>
<p>See the standard library unittest module for ways in which tests can
be specified.</p>
<p>Projects with many tests may wish to define a test script like
<code class="docutils literal"><span class="pre">tornado/test/runtests.py</span></code>.  This script should define a method
<code class="docutils literal"><span class="pre">all()</span></code> which returns a test suite and then call
<a class="reference internal" href="#tornado.testing.main" title="tornado.testing.main"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.main()</span></code></a>.  Note that even when a test script is
used, the <code class="docutils literal"><span class="pre">all()</span></code> test suite may be overridden by naming a
single test on the command line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Runs all tests</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">tornado</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">runtests</span>
<span class="c1"># Runs one test</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">tornado</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">runtests</span> <span class="n">tornado</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">stack_context_test</span>
</pre></div>
</div>
<p>Additional keyword arguments passed through to <code class="docutils literal"><span class="pre">unittest.main()</span></code>.
For example, use <code class="docutils literal"><span class="pre">tornado.testing.main(verbosity=2)</span></code>
to show many test details as they are run.
See <a class="reference external" href="http://docs.python.org/library/unittest.html#unittest.main">http://docs.python.org/library/unittest.html#unittest.main</a>
for full argument list.</p>
</dd></dl>

</div>
<div class="section" id="helper-functions">
<h5>Helper functions<a class="headerlink" href="#helper-functions" title="永久链接至标题">¶</a></h5>
<dl class="function">
<dt id="tornado.testing.bind_unused_port">
<code class="descclassname">tornado.testing.</code><code class="descname">bind_unused_port</code><span class="sig-paren">(</span><em>reuse_port=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#bind_unused_port"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.bind_unused_port" title="永久链接至目标">¶</a></dt>
<dd><p>Binds a server socket to an available port on localhost.</p>
<p>Returns a tuple (socket, port).</p>
</dd></dl>

<dl class="function">
<dt id="tornado.testing.get_unused_port">
<code class="descclassname">tornado.testing.</code><code class="descname">get_unused_port</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#get_unused_port"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.get_unused_port" title="永久链接至目标">¶</a></dt>
<dd><p>Returns a (hopefully) unused port number.</p>
<p>This function does not guarantee that the port it returns is available,
only that a series of get_unused_port calls in a single process return
distinct ports.</p>
<div class="deprecated">
<p><span class="versionmodified">Use 版后已移除: </span>bind_unused_port instead, which is guaranteed to find an unused port.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.testing.get_async_test_timeout">
<code class="descclassname">tornado.testing.</code><code class="descname">get_async_test_timeout</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/testing.html#get_async_test_timeout"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.testing.get_async_test_timeout" title="永久链接至目标">¶</a></dt>
<dd><p>Get the global timeout setting for async tests.</p>
<p>Returns a float, the timeout in seconds.</p>
<div class="versionadded">
<p><span class="versionmodified">3.1 新版功能.</span></p>
</div>
</dd></dl>

</div>
</div>
<span id="document-util"></span><div class="section" id="tornado-util-general-purpose-utilities">
<h4><code class="docutils literal"><span class="pre">tornado.util</span></code> &#8212; General-purpose utilities<a class="headerlink" href="#tornado-util-general-purpose-utilities" title="永久链接至标题">¶</a></h4>
<span class="target" id="module-tornado.util"></span><p>Miscellaneous utility functions and classes.</p>
<p>This module is used internally by Tornado.  It is not necessarily expected
that the functions and classes defined here will be useful to other
applications, but they are documented here in case they are.</p>
<p>The one public-facing part of this module is the <a class="reference internal" href="#tornado.util.Configurable" title="tornado.util.Configurable"><code class="xref py py-obj docutils literal"><span class="pre">Configurable</span></code></a> class
and its <a class="reference internal" href="#tornado.util.Configurable.configure" title="tornado.util.Configurable.configure"><code class="xref py py-obj docutils literal"><span class="pre">configure</span></code></a> method, which becomes a part of the
interface of its subclasses, including <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a>, <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>,
and <a class="reference internal" href="index.html#tornado.netutil.Resolver" title="tornado.netutil.Resolver"><code class="xref py py-obj docutils literal"><span class="pre">Resolver</span></code></a>.</p>
<dl class="class">
<dt id="tornado.util.ObjectDict">
<em class="property">class </em><code class="descclassname">tornado.util.</code><code class="descname">ObjectDict</code><a class="reference internal" href="_modules/tornado/util.html#ObjectDict"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.ObjectDict" title="永久链接至目标">¶</a></dt>
<dd><p>Makes a dictionary behave like an object, with attribute-style access.</p>
</dd></dl>

<dl class="class">
<dt id="tornado.util.GzipDecompressor">
<em class="property">class </em><code class="descclassname">tornado.util.</code><code class="descname">GzipDecompressor</code><a class="reference internal" href="_modules/tornado/util.html#GzipDecompressor"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.GzipDecompressor" title="永久链接至目标">¶</a></dt>
<dd><p>Streaming gzip decompressor.</p>
<p>The interface is like that of <a class="reference external" href="https://docs.python.org/3.4/library/zlib.html#zlib.decompressobj" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">zlib.decompressobj</span></code></a> (without some of the
optional arguments, but it understands gzip headers and checksums.</p>
<dl class="method">
<dt id="tornado.util.GzipDecompressor.decompress">
<code class="descname">decompress</code><span class="sig-paren">(</span><em>value</em>, <em>max_length=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/util.html#GzipDecompressor.decompress"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.GzipDecompressor.decompress" title="永久链接至目标">¶</a></dt>
<dd><p>Decompress a chunk, returning newly-available data.</p>
<p>Some data may be buffered for later processing; <a class="reference internal" href="#tornado.util.GzipDecompressor.flush" title="tornado.util.GzipDecompressor.flush"><code class="xref py py-obj docutils literal"><span class="pre">flush</span></code></a> must
be called when there is no more input data to ensure that
all data was processed.</p>
<p>If <code class="docutils literal"><span class="pre">max_length</span></code> is given, some input data may be left over
in <code class="docutils literal"><span class="pre">unconsumed_tail</span></code>; you must retrieve this value and pass
it back to a future call to <a class="reference internal" href="#tornado.util.GzipDecompressor.decompress" title="tornado.util.GzipDecompressor.decompress"><code class="xref py py-obj docutils literal"><span class="pre">decompress</span></code></a> if it is not empty.</p>
</dd></dl>

<dl class="attribute">
<dt id="tornado.util.GzipDecompressor.unconsumed_tail">
<code class="descname">unconsumed_tail</code><a class="headerlink" href="#tornado.util.GzipDecompressor.unconsumed_tail" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the unconsumed portion left over</p>
</dd></dl>

<dl class="method">
<dt id="tornado.util.GzipDecompressor.flush">
<code class="descname">flush</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/util.html#GzipDecompressor.flush"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.GzipDecompressor.flush" title="永久链接至目标">¶</a></dt>
<dd><p>Return any remaining buffered data not yet returned by decompress.</p>
<p>Also checks for errors such as truncated input.
No other methods may be called on this object after <a class="reference internal" href="#tornado.util.GzipDecompressor.flush" title="tornado.util.GzipDecompressor.flush"><code class="xref py py-obj docutils literal"><span class="pre">flush</span></code></a>.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tornado.util.import_object">
<code class="descclassname">tornado.util.</code><code class="descname">import_object</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/util.html#import_object"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.import_object" title="永久链接至目标">¶</a></dt>
<dd><p>Imports an object by name.</p>
<p>import_object(&#8216;x&#8217;) is equivalent to &#8216;import x&#8217;.
import_object(&#8216;x.y.z&#8217;) is equivalent to &#8216;from x.y import z&#8217;.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tornado.escape</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">import_object</span><span class="p">(</span><span class="s1">&#39;tornado.escape&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="n">tornado</span><span class="o">.</span><span class="n">escape</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">import_object</span><span class="p">(</span><span class="s1">&#39;tornado.escape.utf8&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="n">tornado</span><span class="o">.</span><span class="n">escape</span><span class="o">.</span><span class="n">utf8</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">import_object</span><span class="p">(</span><span class="s1">&#39;tornado&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="n">tornado</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">import_object</span><span class="p">(</span><span class="s1">&#39;tornado.missing_module&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
<span class="gr">ImportError</span>: <span class="n">No module named missing_module</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="tornado.util.errno_from_exception">
<code class="descclassname">tornado.util.</code><code class="descname">errno_from_exception</code><span class="sig-paren">(</span><em>e</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/util.html#errno_from_exception"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.errno_from_exception" title="永久链接至目标">¶</a></dt>
<dd><p>Provides the errno from an Exception object.</p>
<p>There are cases that the errno attribute was not set so we pull
the errno out of the args but if someone instantiates an Exception
without any args you will get a tuple error. So this function
abstracts all that behavior to give you a safe way to get the
errno.</p>
</dd></dl>

<dl class="class">
<dt id="tornado.util.Configurable">
<em class="property">class </em><code class="descclassname">tornado.util.</code><code class="descname">Configurable</code><a class="reference internal" href="_modules/tornado/util.html#Configurable"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.Configurable" title="永久链接至目标">¶</a></dt>
<dd><p>Base class for configurable interfaces.</p>
<p>A configurable interface is an (abstract) class whose constructor
acts as a factory function for one of its implementation subclasses.
The implementation subclass as well as optional keyword arguments to
its initializer can be set globally at runtime with <a class="reference internal" href="#tornado.util.Configurable.configure" title="tornado.util.Configurable.configure"><code class="xref py py-obj docutils literal"><span class="pre">configure</span></code></a>.</p>
<p>By using the constructor as the factory method, the interface
looks like a normal class, <a class="reference external" href="https://docs.python.org/3.4/library/functions.html#isinstance" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">isinstance</span></code></a> works as usual, etc.  This
pattern is most useful when the choice of implementation is likely
to be a global decision (e.g. when <a class="reference external" href="https://docs.python.org/3.4/library/select.html#select.epoll" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">epoll</span></code></a> is available,
always use it instead of <a class="reference external" href="https://docs.python.org/3.4/library/select.html#select.select" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">select</span></code></a>), or when a
previously-monolithic class has been split into specialized
subclasses.</p>
<p>Configurable subclasses must define the class methods
<a class="reference internal" href="#tornado.util.Configurable.configurable_base" title="tornado.util.Configurable.configurable_base"><code class="xref py py-obj docutils literal"><span class="pre">configurable_base</span></code></a> and <a class="reference internal" href="#tornado.util.Configurable.configurable_default" title="tornado.util.Configurable.configurable_default"><code class="xref py py-obj docutils literal"><span class="pre">configurable_default</span></code></a>, and use the instance
method <a class="reference internal" href="#tornado.util.Configurable.initialize" title="tornado.util.Configurable.initialize"><code class="xref py py-obj docutils literal"><span class="pre">initialize</span></code></a> instead of <code class="docutils literal"><span class="pre">__init__</span></code>.</p>
<dl class="classmethod">
<dt id="tornado.util.Configurable.configurable_base">
<em class="property">classmethod </em><code class="descname">configurable_base</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/util.html#Configurable.configurable_base"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.Configurable.configurable_base" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the base class of a configurable hierarchy.</p>
<p>This will normally return the class in which it is defined.
(which is <em>not</em> necessarily the same as the cls classmethod parameter).</p>
</dd></dl>

<dl class="classmethod">
<dt id="tornado.util.Configurable.configurable_default">
<em class="property">classmethod </em><code class="descname">configurable_default</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/util.html#Configurable.configurable_default"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.Configurable.configurable_default" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the implementation class to be used if none is configured.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.util.Configurable.initialize">
<code class="descname">initialize</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/util.html#Configurable.initialize"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.Configurable.initialize" title="永久链接至目标">¶</a></dt>
<dd><p>Initialize a <a class="reference internal" href="#tornado.util.Configurable" title="tornado.util.Configurable"><code class="xref py py-obj docutils literal"><span class="pre">Configurable</span></code></a> subclass instance.</p>
<p>Configurable classes should use <a class="reference internal" href="#tornado.util.Configurable.initialize" title="tornado.util.Configurable.initialize"><code class="xref py py-obj docutils literal"><span class="pre">initialize</span></code></a> instead of <code class="docutils literal"><span class="pre">__init__</span></code>.</p>
<div class="versionchanged">
<p><span class="versionmodified">在 4.2 版更改: </span>Now accepts positional arguments in addition to keyword arguments.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="tornado.util.Configurable.configure">
<em class="property">classmethod </em><code class="descname">configure</code><span class="sig-paren">(</span><em>impl</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/util.html#Configurable.configure"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.Configurable.configure" title="永久链接至目标">¶</a></dt>
<dd><p>Sets the class to use when the base class is instantiated.</p>
<p>Keyword arguments will be saved and added to the arguments passed
to the constructor.  This can be used to set global defaults for
some parameters.</p>
</dd></dl>

<dl class="classmethod">
<dt id="tornado.util.Configurable.configured_class">
<em class="property">classmethod </em><code class="descname">configured_class</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/util.html#Configurable.configured_class"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.Configurable.configured_class" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the currently configured class.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tornado.util.ArgReplacer">
<em class="property">class </em><code class="descclassname">tornado.util.</code><code class="descname">ArgReplacer</code><span class="sig-paren">(</span><em>func</em>, <em>name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/util.html#ArgReplacer"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.ArgReplacer" title="永久链接至目标">¶</a></dt>
<dd><p>Replaces one value in an <code class="docutils literal"><span class="pre">args,</span> <span class="pre">kwargs</span></code> pair.</p>
<p>Inspects the function signature to find an argument by name
whether it is passed by position or keyword.  For use in decorators
and similar wrappers.</p>
<dl class="method">
<dt id="tornado.util.ArgReplacer.get_old_value">
<code class="descname">get_old_value</code><span class="sig-paren">(</span><em>args</em>, <em>kwargs</em>, <em>default=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/util.html#ArgReplacer.get_old_value"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.ArgReplacer.get_old_value" title="永久链接至目标">¶</a></dt>
<dd><p>Returns the old value of the named argument without replacing it.</p>
<p>Returns <code class="docutils literal"><span class="pre">default</span></code> if the argument is not present.</p>
</dd></dl>

<dl class="method">
<dt id="tornado.util.ArgReplacer.replace">
<code class="descname">replace</code><span class="sig-paren">(</span><em>new_value</em>, <em>args</em>, <em>kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/util.html#ArgReplacer.replace"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.ArgReplacer.replace" title="永久链接至目标">¶</a></dt>
<dd><p>Replace the named argument in <code class="docutils literal"><span class="pre">args,</span> <span class="pre">kwargs</span></code> with <code class="docutils literal"><span class="pre">new_value</span></code>.</p>
<p>Returns <code class="docutils literal"><span class="pre">(old_value,</span> <span class="pre">args,</span> <span class="pre">kwargs)</span></code>.  The returned <code class="docutils literal"><span class="pre">args</span></code> and
<code class="docutils literal"><span class="pre">kwargs</span></code> objects may not be the same as the input objects, or
the input objects may be mutated.</p>
<p>If the named argument was not found, <code class="docutils literal"><span class="pre">new_value</span></code> will be added
to <code class="docutils literal"><span class="pre">kwargs</span></code> and None will be returned as <code class="docutils literal"><span class="pre">old_value</span></code>.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tornado.util.timedelta_to_seconds">
<code class="descclassname">tornado.util.</code><code class="descname">timedelta_to_seconds</code><span class="sig-paren">(</span><em>td</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tornado/util.html#timedelta_to_seconds"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#tornado.util.timedelta_to_seconds" title="永久链接至目标">¶</a></dt>
<dd><p>Equivalent to td.total_seconds() (introduced in python 2.7).</p>
</dd></dl>

</div>
</div>
</div>
<span id="document-faq"></span><div class="section" id="id1">
<h3>常见问题<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#why-isn-t-this-example-with-time-sleep-running-in-parallel" id="id3">Why isn&#8217;t this example with <code class="docutils literal"><span class="pre">time.sleep()</span></code> running in parallel?</a></li>
<li><a class="reference internal" href="#my-code-is-asynchronous-but-it-s-not-running-in-parallel-in-two-browser-tabs" id="id4">My code is asynchronous, but it&#8217;s not running in parallel in two browser tabs.</a></li>
</ul>
</div>
<div class="section" id="why-isn-t-this-example-with-time-sleep-running-in-parallel">
<h4><a class="toc-backref" href="#id3">Why isn&#8217;t this example with <code class="docutils literal"><span class="pre">time.sleep()</span></code> running in parallel?</a><a class="headerlink" href="#why-isn-t-this-example-with-time-sleep-running-in-parallel" title="永久链接至标题">¶</a></h4>
<p>Many people&#8217;s first foray into Tornado&#8217;s concurrency looks something like
this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BadExampleHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Fetch this handler twice at the same time and you&#8217;ll see that the second
five-second countdown doesn&#8217;t start until the first one has completely
finished. The reason for this is that <a class="reference external" href="https://docs.python.org/3.4/library/time.html#time.sleep" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">time.sleep</span></code></a> is a <strong>blocking</strong>
function: it doesn&#8217;t allow control to return to the <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> so that other
handlers can be run.</p>
<p>Of course, <a class="reference external" href="https://docs.python.org/3.4/library/time.html#time.sleep" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">time.sleep</span></code></a> is really just a placeholder in these examples,
the point is to show what happens when something in a handler gets slow.
No matter what the real code is doing, to achieve concurrency blocking
code must be replaced with non-blocking equivalents. This means one of three things:</p>
<ol class="arabic">
<li><p class="first"><em>Find a coroutine-friendly equivalent.</em> For <a class="reference external" href="https://docs.python.org/3.4/library/time.html#time.sleep" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">time.sleep</span></code></a>, use
<a class="reference internal" href="index.html#tornado.gen.sleep" title="tornado.gen.sleep"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.sleep</span></code></a> instead:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CoroutineSleepHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">gen</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>When this option is available, it is usually the best approach.
See the <a class="reference external" href="https://github.com/tornadoweb/tornado/wiki/Links">Tornado wiki</a>
for links to asynchronous libraries that may be useful.</p>
</li>
<li><p class="first"><em>Find a callback-based equivalent.</em> Similar to the first option,
callback-based libraries are available for many tasks, although they
are slightly more complicated to use than a library designed for
coroutines. These are typically used with <a class="reference internal" href="index.html#tornado.gen.Task" title="tornado.gen.Task"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.Task</span></code></a> as an
adapter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CoroutineTimeoutHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">io_loop</span> <span class="o">=</span> <span class="n">IOLoop</span><span class="o">.</span><span class="n">current</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">gen</span><span class="o">.</span><span class="n">Task</span><span class="p">(</span><span class="n">io_loop</span><span class="o">.</span><span class="n">add_timeout</span><span class="p">,</span> <span class="n">io_loop</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Again, the
<a class="reference external" href="https://github.com/tornadoweb/tornado/wiki/Links">Tornado wiki</a>
can be useful to find suitable libraries.</p>
</li>
<li><p class="first"><em>Run the blocking code on another thread.</em> When asynchronous libraries
are not available, <a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures.ThreadPoolExecutor</span></code></a> can be used
to run any blocking code on another thread. This is a universal solution
that can be used for any blocking function whether an asynchronous
counterpart exists or not:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">executor</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ThreadPoolHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>See the <a class="reference internal" href="index.html#document-guide/async"><span class="doc">Asynchronous I/O</span></a> chapter of the Tornado
user&#8217;s guide for more on blocking and asynchronous functions.</p>
</div>
<div class="section" id="my-code-is-asynchronous-but-it-s-not-running-in-parallel-in-two-browser-tabs">
<h4><a class="toc-backref" href="#id4">My code is asynchronous, but it&#8217;s not running in parallel in two browser tabs.</a><a class="headerlink" href="#my-code-is-asynchronous-but-it-s-not-running-in-parallel-in-two-browser-tabs" title="永久链接至标题">¶</a></h4>
<p>Even when a handler is asynchronous and non-blocking, it can be surprisingly
tricky to verify this. Browsers will recognize that you are trying to
load the same page in two different tabs and delay the second request
until the first has finished. To work around this and see that the server
is in fact working in parallel, do one of two things:</p>
<ul class="simple">
<li>Add something to your urls to make them unique. Instead of
<code class="docutils literal"><span class="pre">http://localhost:8888</span></code> in both tabs, load
<code class="docutils literal"><span class="pre">http://localhost:8888/?x=1</span></code> in one and
<code class="docutils literal"><span class="pre">http://localhost:8888/?x=2</span></code> in the other.</li>
<li>Use two different browsers. For example, Firefox will be able to load
a url even while that same url is being loaded in a Chrome tab.</li>
</ul>
</div>
</div>
<span id="document-releases"></span><div class="section" id="id1">
<h3>版本记录<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-releases/v4.3.0"></span><div class="section" id="what-s-new-in-tornado-4-3">
<h4>What&#8217;s new in Tornado 4.3<a class="headerlink" href="#what-s-new-in-tornado-4-3" title="永久链接至标题">¶</a></h4>
<div class="section" id="nov-6-2015">
<h5>Nov 6, 2015<a class="headerlink" href="#nov-6-2015" title="永久链接至标题">¶</a></h5>
<div class="section" id="highlights">
<h6>Highlights<a class="headerlink" href="#highlights" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The new async/await keywords in Python 3.5 are supported. In most cases,
<code class="docutils literal"><span class="pre">async</span> <span class="pre">def</span></code> can be used in place of the <code class="docutils literal"><span class="pre">&#64;gen.coroutine</span></code> decorator.
Inside a function defined with <code class="docutils literal"><span class="pre">async</span> <span class="pre">def</span></code>, use <code class="docutils literal"><span class="pre">await</span></code> instead of
<code class="docutils literal"><span class="pre">yield</span></code> to wait on an asynchronous operation. Coroutines defined with
async/await will be faster than those defined with <code class="docutils literal"><span class="pre">&#64;gen.coroutine</span></code> and
<code class="docutils literal"><span class="pre">yield</span></code>, but do not support some features including <a class="reference internal" href="index.html#tornado.gen.Callback" title="tornado.gen.Callback"><code class="xref py py-obj docutils literal"><span class="pre">Callback</span></code></a>/<a class="reference internal" href="index.html#tornado.gen.Wait" title="tornado.gen.Wait"><code class="xref py py-obj docutils literal"><span class="pre">Wait</span></code></a> or
the ability to yield a Twisted <code class="docutils literal"><span class="pre">Deferred</span></code>. See <a class="reference internal" href="index.html#native-coroutines"><span class="std std-ref">the users&#8217;
guide</span></a> for more.</li>
<li>The async/await keywords are also available when compiling with Cython in
older versions of Python.</li>
</ul>
</div>
<div class="section" id="deprecation-notice">
<h6>Deprecation notice<a class="headerlink" href="#deprecation-notice" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>This will be the last release of Tornado to support Python 2.6 or 3.2.
Note that PyPy3 will continue to be supported even though it implements
a mix of Python 3.2 and 3.3 features.</li>
</ul>
</div>
<div class="section" id="installation">
<h6>Installation<a class="headerlink" href="#installation" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Tornado has several new dependencies: <code class="docutils literal"><span class="pre">ordereddict</span></code> on Python 2.6,
<code class="docutils literal"><span class="pre">singledispatch</span></code> on all Python versions prior to 3.4 (This was an
optional dependency in prior versions of Tornado, and is now
mandatory), and <code class="docutils literal"><span class="pre">backports_abc&gt;=0.4</span></code> on all versions prior to
3.5. These dependencies will be installed automatically when installing
with <code class="docutils literal"><span class="pre">pip</span></code> or <code class="docutils literal"><span class="pre">setup.py</span> <span class="pre">install</span></code>. These dependencies will not
be required when running on Google App Engine.</li>
<li>Binary wheels are provided for Python 3.5 on Windows (32 and 64 bit).</li>
</ul>
</div>
<div class="section" id="tornado-auth">
<h6><a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a><a class="headerlink" href="#tornado-auth" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>New method <a class="reference internal" href="index.html#tornado.auth.OAuth2Mixin.oauth2_request" title="tornado.auth.OAuth2Mixin.oauth2_request"><code class="xref py py-obj docutils literal"><span class="pre">OAuth2Mixin.oauth2_request</span></code></a> can be used to make authenticated
requests with an access token.</li>
<li>Now compatible with callbacks that have been compiled with Cython.</li>
</ul>
</div>
<div class="section" id="tornado-autoreload">
<h6><a class="reference internal" href="index.html#module-tornado.autoreload" title="tornado.autoreload"><code class="xref py py-obj docutils literal"><span class="pre">tornado.autoreload</span></code></a><a class="headerlink" href="#tornado-autoreload" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Fixed an issue with the autoreload command-line wrapper in which
imports would be incorrectly interpreted as relative.</li>
</ul>
</div>
<div class="section" id="tornado-curl-httpclient">
<h6><a class="reference internal" href="index.html#module-tornado.curl_httpclient" title="tornado.curl_httpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.curl_httpclient</span></code></a><a class="headerlink" href="#tornado-curl-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Fixed parsing of multi-line headers.</li>
<li><code class="docutils literal"><span class="pre">allow_nonstandard_methods=True</span></code> now bypasses body sanity checks,
in the same way as in <code class="docutils literal"><span class="pre">simple_httpclient</span></code>.</li>
<li>The <code class="docutils literal"><span class="pre">PATCH</span></code> method now allows a body without
<code class="docutils literal"><span class="pre">allow_nonstandard_methods=True</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-gen">
<h6><a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a><a class="headerlink" href="#tornado-gen" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.gen.WaitIterator" title="tornado.gen.WaitIterator"><code class="xref py py-obj docutils literal"><span class="pre">WaitIterator</span></code></a> now supports the <code class="docutils literal"><span class="pre">async</span> <span class="pre">for</span></code> statement on Python 3.5.</li>
<li><code class="docutils literal"><span class="pre">&#64;gen.coroutine</span></code> can be applied to functions compiled with Cython.
On python versions prior to 3.5, the <code class="docutils literal"><span class="pre">backports_abc</span></code> package must
be installed for this functionality.</li>
<li><code class="docutils literal"><span class="pre">Multi</span></code> and <a class="reference internal" href="index.html#tornado.gen.multi_future" title="tornado.gen.multi_future"><code class="xref py py-obj docutils literal"><span class="pre">multi_future</span></code></a> are deprecated and replaced by
a unified function <a class="reference internal" href="index.html#tornado.gen.multi" title="tornado.gen.multi"><code class="xref py py-obj docutils literal"><span class="pre">multi</span></code></a>.</li>
</ul>
</div>
<div class="section" id="tornado-httpclient">
<h6><a class="reference internal" href="index.html#module-tornado.httpclient" title="tornado.httpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient</span></code></a><a class="headerlink" href="#tornado-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httpclient.HTTPError" title="tornado.httpclient.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient.HTTPError</span></code></a> is now copyable with the <a class="reference external" href="https://docs.python.org/3.4/library/copy.html#module-copy" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">copy</span></code></a> module.</li>
</ul>
</div>
<div class="section" id="tornado-httpserver">
<h6><a class="reference internal" href="index.html#module-tornado.httpserver" title="tornado.httpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpserver</span></code></a><a class="headerlink" href="#tornado-httpserver" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Requests containing both <code class="docutils literal"><span class="pre">Content-Length</span></code> and <code class="docutils literal"><span class="pre">Transfer-Encoding</span></code>
will be treated as an error.</li>
</ul>
</div>
<div class="section" id="tornado-httputil">
<h6><a class="reference internal" href="index.html#module-tornado.httputil" title="tornado.httputil"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httputil</span></code></a><a class="headerlink" href="#tornado-httputil" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httputil.HTTPHeaders" title="tornado.httputil.HTTPHeaders"><code class="xref py py-obj docutils literal"><span class="pre">HTTPHeaders</span></code></a> can now be pickled and unpickled.</li>
</ul>
</div>
<div class="section" id="tornado-ioloop">
<h6><a class="reference internal" href="index.html#module-tornado.ioloop" title="tornado.ioloop"><code class="xref py py-obj docutils literal"><span class="pre">tornado.ioloop</span></code></a><a class="headerlink" href="#tornado-ioloop" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">IOLoop(make_current=True)</span></code> now works as intended instead
of raising an exception.</li>
<li>The Twisted and asyncio IOLoop implementations now clear
<code class="docutils literal"><span class="pre">current()</span></code> when they exit, like the standard IOLoops.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_callback" title="tornado.ioloop.IOLoop.add_callback"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_callback</span></code></a> is faster in the single-threaded case.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_callback" title="tornado.ioloop.IOLoop.add_callback"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_callback</span></code></a> no longer raises an error when called on
a closed IOLoop, but the callback will not be invoked.</li>
</ul>
</div>
<div class="section" id="tornado-iostream">
<h6><a class="reference internal" href="index.html#module-tornado.iostream" title="tornado.iostream"><code class="xref py py-obj docutils literal"><span class="pre">tornado.iostream</span></code></a><a class="headerlink" href="#tornado-iostream" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Coroutine-style usage of <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> now converts most errors into
<a class="reference internal" href="index.html#tornado.iostream.StreamClosedError" title="tornado.iostream.StreamClosedError"><code class="xref py py-obj docutils literal"><span class="pre">StreamClosedError</span></code></a>, which has the effect of reducing log noise from
exceptions that are outside the application&#8217;s control (especially
SSL errors).</li>
<li><a class="reference internal" href="index.html#tornado.iostream.StreamClosedError" title="tornado.iostream.StreamClosedError"><code class="xref py py-obj docutils literal"><span class="pre">StreamClosedError</span></code></a> now has a <code class="docutils literal"><span class="pre">real_error</span></code> attribute which indicates
why the stream was closed. It is the same as the <code class="docutils literal"><span class="pre">error</span></code> attribute of
<a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> but may be more easily accessible than the <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> itself.</li>
<li>Improved error handling in <a class="reference internal" href="index.html#tornado.iostream.BaseIOStream.read_until_close" title="tornado.iostream.BaseIOStream.read_until_close"><code class="xref py py-obj docutils literal"><span class="pre">read_until_close</span></code></a>.</li>
<li>Logging is less noisy when an SSL server is port scanned.</li>
<li><code class="docutils literal"><span class="pre">EINTR</span></code> is now handled on all reads.</li>
</ul>
</div>
<div class="section" id="tornado-locale">
<h6><a class="reference internal" href="index.html#module-tornado.locale" title="tornado.locale"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locale</span></code></a><a class="headerlink" href="#tornado-locale" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.locale.load_translations" title="tornado.locale.load_translations"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locale.load_translations</span></code></a> now accepts encodings other than
UTF-8. UTF-16 and UTF-8 will be detected automatically if a BOM is
present; for other encodings <a class="reference internal" href="index.html#tornado.locale.load_translations" title="tornado.locale.load_translations"><code class="xref py py-obj docutils literal"><span class="pre">load_translations</span></code></a> has an <code class="docutils literal"><span class="pre">encoding</span></code>
parameter.</li>
</ul>
</div>
<div class="section" id="tornado-locks">
<h6><a class="reference internal" href="index.html#module-tornado.locks" title="tornado.locks"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locks</span></code></a><a class="headerlink" href="#tornado-locks" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.locks.Lock" title="tornado.locks.Lock"><code class="xref py py-obj docutils literal"><span class="pre">Lock</span></code></a> and <a class="reference internal" href="index.html#tornado.locks.Semaphore" title="tornado.locks.Semaphore"><code class="xref py py-obj docutils literal"><span class="pre">Semaphore</span></code></a> now support the <code class="docutils literal"><span class="pre">async</span> <span class="pre">with</span></code> statement on
Python 3.5.</li>
</ul>
</div>
<div class="section" id="tornado-log">
<h6><a class="reference internal" href="index.html#module-tornado.log" title="tornado.log"><code class="xref py py-obj docutils literal"><span class="pre">tornado.log</span></code></a><a class="headerlink" href="#tornado-log" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>A new time-based log rotation mode is available with
<code class="docutils literal"><span class="pre">--log_rotate_mode=time</span></code>, <code class="docutils literal"><span class="pre">--log-rotate-when</span></code>, and
<code class="docutils literal"><span class="pre">log-rotate-interval</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-netutil">
<h6><a class="reference internal" href="index.html#module-tornado.netutil" title="tornado.netutil"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil</span></code></a><a class="headerlink" href="#tornado-netutil" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.netutil.bind_sockets" title="tornado.netutil.bind_sockets"><code class="xref py py-obj docutils literal"><span class="pre">bind_sockets</span></code></a> now supports <code class="docutils literal"><span class="pre">SO_REUSEPORT</span></code> with the <code class="docutils literal"><span class="pre">reuse_port=True</span></code>
argument.</li>
</ul>
</div>
<div class="section" id="tornado-options">
<h6><a class="reference internal" href="index.html#module-tornado.options" title="tornado.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options</span></code></a><a class="headerlink" href="#tornado-options" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Dashes and underscores are now fully interchangeable in option names.</li>
</ul>
</div>
<div class="section" id="tornado-queues">
<h6><a class="reference internal" href="index.html#module-tornado.queues" title="tornado.queues"><code class="xref py py-obj docutils literal"><span class="pre">tornado.queues</span></code></a><a class="headerlink" href="#tornado-queues" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.queues.Queue" title="tornado.queues.Queue"><code class="xref py py-obj docutils literal"><span class="pre">Queue</span></code></a> now supports the <code class="docutils literal"><span class="pre">async</span> <span class="pre">for</span></code> statement on Python 3.5.</li>
</ul>
</div>
<div class="section" id="tornado-simple-httpclient">
<h6><a class="reference internal" href="index.html#module-tornado.simple_httpclient" title="tornado.simple_httpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.simple_httpclient</span></code></a><a class="headerlink" href="#tornado-simple-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>When following redirects, <code class="docutils literal"><span class="pre">streaming_callback</span></code> and
<code class="docutils literal"><span class="pre">header_callback</span></code> will no longer be run on the redirect responses
(only the final non-redirect).</li>
<li>Responses containing both <code class="docutils literal"><span class="pre">Content-Length</span></code> and <code class="docutils literal"><span class="pre">Transfer-Encoding</span></code>
will be treated as an error.</li>
</ul>
</div>
<div class="section" id="tornado-template">
<h6><a class="reference internal" href="index.html#module-tornado.template" title="tornado.template"><code class="xref py py-obj docutils literal"><span class="pre">tornado.template</span></code></a><a class="headerlink" href="#tornado-template" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.template.ParseError" title="tornado.template.ParseError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.template.ParseError</span></code></a> now includes the filename in addition to
line number.</li>
<li>Whitespace handling has become more configurable. The <a class="reference internal" href="index.html#tornado.template.Loader" title="tornado.template.Loader"><code class="xref py py-obj docutils literal"><span class="pre">Loader</span></code></a>
constructor now has a <code class="docutils literal"><span class="pre">whitespace</span></code> argument, there is a new
<code class="docutils literal"><span class="pre">template_whitespace</span></code> <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> setting, and there is a new
<code class="docutils literal"><span class="pre">{%</span> <span class="pre">whitespace</span> <span class="pre">%}</span></code> template directive. All of these options take
a mode name defined in the <a class="reference internal" href="index.html#tornado.template.filter_whitespace" title="tornado.template.filter_whitespace"><code class="xref py py-obj docutils literal"><span class="pre">tornado.template.filter_whitespace</span></code></a> function.
The default mode is <code class="docutils literal"><span class="pre">single</span></code>, which is the same behavior as prior
versions of Tornado.</li>
<li>Non-ASCII filenames are now supported.</li>
</ul>
</div>
<div class="section" id="tornado-testing">
<h6><a class="reference internal" href="index.html#module-tornado.testing" title="tornado.testing"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing</span></code></a><a class="headerlink" href="#tornado-testing" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.testing.ExpectLog" title="tornado.testing.ExpectLog"><code class="xref py py-obj docutils literal"><span class="pre">ExpectLog</span></code></a> objects now have a boolean <code class="docutils literal"><span class="pre">logged_stack</span></code> attribute to
make it easier to test whether an exception stack trace was logged.</li>
</ul>
</div>
<div class="section" id="tornado-web">
<h6><a class="reference internal" href="index.html#module-tornado.web" title="tornado.web"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web</span></code></a><a class="headerlink" href="#tornado-web" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The hard limit of 4000 bytes per outgoing header has been removed.</li>
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> returns the correct <code class="docutils literal"><span class="pre">Content-Type</span></code> for files
with <code class="docutils literal"><span class="pre">.gz</span></code>, <code class="docutils literal"><span class="pre">.bz2</span></code>, and <code class="docutils literal"><span class="pre">.xz</span></code> extensions.</li>
<li>Responses smaller than 1000 bytes will no longer be compressed.</li>
<li>The default gzip compression level is now 6 (was 9).</li>
<li>Fixed a regression in Tornado 4.2.1 that broke <a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a>
with a <code class="docutils literal"><span class="pre">path</span></code> of <code class="docutils literal"><span class="pre">/</span></code>.</li>
<li><a class="reference internal" href="index.html#tornado.web.HTTPError" title="tornado.web.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.HTTPError</span></code></a> is now copyable with the <a class="reference external" href="https://docs.python.org/3.4/library/copy.html#module-copy" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">copy</span></code></a> module.</li>
<li>The exception <a class="reference internal" href="index.html#tornado.web.Finish" title="tornado.web.Finish"><code class="xref py py-obj docutils literal"><span class="pre">Finish</span></code></a> now accepts an argument which will be passed to
the method <a class="reference internal" href="index.html#tornado.web.RequestHandler.finish" title="tornado.web.RequestHandler.finish"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.finish</span></code></a>.</li>
<li>New <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> setting <code class="docutils literal"><span class="pre">xsrf_cookie_kwargs</span></code> can be used to set
additional attributes such as <code class="docutils literal"><span class="pre">secure</span></code> or <code class="docutils literal"><span class="pre">httponly</span></code> on the
XSRF cookie.</li>
<li><a class="reference internal" href="index.html#tornado.web.Application.listen" title="tornado.web.Application.listen"><code class="xref py py-obj docutils literal"><span class="pre">Application.listen</span></code></a> now returns the <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> it created.</li>
</ul>
</div>
<div class="section" id="tornado-websocket">
<h6><a class="reference internal" href="index.html#module-tornado.websocket" title="tornado.websocket"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket</span></code></a><a class="headerlink" href="#tornado-websocket" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Fixed handling of continuation frames when compression is enabled.</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v4.2.1"></span><div class="section" id="what-s-new-in-tornado-4-2-1">
<h4>What&#8217;s new in Tornado 4.2.1<a class="headerlink" href="#what-s-new-in-tornado-4-2-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="jul-17-2015">
<h5>Jul 17, 2015<a class="headerlink" href="#jul-17-2015" title="永久链接至标题">¶</a></h5>
<div class="section" id="security-fix">
<h6>Security fix<a class="headerlink" href="#security-fix" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>This release fixes a path traversal vulnerability in <a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a>,
in which files whose names <em>started with</em> the <code class="docutils literal"><span class="pre">static_path</span></code> directory
but were not actually <em>in</em> that directory could be accessed.</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v4.2.0"></span><div class="section" id="what-s-new-in-tornado-4-2">
<h4>What&#8217;s new in Tornado 4.2<a class="headerlink" href="#what-s-new-in-tornado-4-2" title="永久链接至标题">¶</a></h4>
<div class="section" id="may-26-2015">
<h5>May 26, 2015<a class="headerlink" href="#may-26-2015" title="永久链接至标题">¶</a></h5>
<div class="section" id="backwards-compatibility-notes">
<h6>Backwards-compatibility notes<a class="headerlink" href="#backwards-compatibility-notes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">SSLIOStream.connect</span></code> and <a class="reference internal" href="index.html#tornado.iostream.IOStream.start_tls" title="tornado.iostream.IOStream.start_tls"><code class="xref py py-obj docutils literal"><span class="pre">IOStream.start_tls</span></code></a> now validate certificates
by default.</li>
<li>Certificate validation will now use the system CA root certificates instead
of <code class="docutils literal"><span class="pre">certifi</span></code> when possible (i.e. Python 2.7.9+ or 3.4+). This includes
<a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> and <code class="docutils literal"><span class="pre">simple_httpclient</span></code>, but not <code class="docutils literal"><span class="pre">curl_httpclient</span></code>.</li>
<li>The default SSL configuration has become stricter, using
<a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.create_default_context" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.create_default_context</span></code></a> where available on the client side.
(On the server side, applications are encouraged to migrate from the
<code class="docutils literal"><span class="pre">ssl_options</span></code> dict-based API to pass an <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.SSLContext</span></code></a> instead).</li>
<li>The deprecated classes in the <a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a> module, <code class="docutils literal"><span class="pre">GoogleMixin</span></code>,
<code class="docutils literal"><span class="pre">FacebookMixin</span></code>, and <code class="docutils literal"><span class="pre">FriendFeedMixin</span></code> have been removed.</li>
</ul>
</div>
<div class="section" id="new-modules-tornado-locks-and-tornado-queues">
<h6>New modules: <a class="reference internal" href="index.html#module-tornado.locks" title="tornado.locks"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locks</span></code></a> and <a class="reference internal" href="index.html#module-tornado.queues" title="tornado.queues"><code class="xref py py-obj docutils literal"><span class="pre">tornado.queues</span></code></a><a class="headerlink" href="#new-modules-tornado-locks-and-tornado-queues" title="永久链接至标题">¶</a></h6>
<p>These modules provide classes for coordinating coroutines, merged from
<a class="reference external" href="http://toro.readthedocs.org">Toro</a>.</p>
<p>To port your code from Toro&#8217;s queues to Tornado 4.2, import <a class="reference internal" href="index.html#tornado.queues.Queue" title="tornado.queues.Queue"><code class="xref py py-obj docutils literal"><span class="pre">Queue</span></code></a>,
<a class="reference internal" href="index.html#tornado.queues.PriorityQueue" title="tornado.queues.PriorityQueue"><code class="xref py py-obj docutils literal"><span class="pre">PriorityQueue</span></code></a>, or <a class="reference internal" href="index.html#tornado.queues.LifoQueue" title="tornado.queues.LifoQueue"><code class="xref py py-obj docutils literal"><span class="pre">LifoQueue</span></code></a> from <a class="reference internal" href="index.html#module-tornado.queues" title="tornado.queues"><code class="xref py py-obj docutils literal"><span class="pre">tornado.queues</span></code></a> instead of from
<code class="docutils literal"><span class="pre">toro</span></code>.</p>
<p>Use <a class="reference internal" href="index.html#tornado.queues.Queue" title="tornado.queues.Queue"><code class="xref py py-obj docutils literal"><span class="pre">Queue</span></code></a> instead of Toro&#8217;s <code class="docutils literal"><span class="pre">JoinableQueue</span></code>. In Tornado the methods
<a class="reference internal" href="index.html#tornado.queues.Queue.join" title="tornado.queues.Queue.join"><code class="xref py py-obj docutils literal"><span class="pre">join</span></code></a> and <a class="reference internal" href="index.html#tornado.queues.Queue.task_done" title="tornado.queues.Queue.task_done"><code class="xref py py-obj docutils literal"><span class="pre">task_done</span></code></a> are available on all queues, not on a
special <code class="docutils literal"><span class="pre">JoinableQueue</span></code>.</p>
<p>Tornado queues raise exceptions specific to Tornado instead of reusing
exceptions from the Python standard library.
Therefore instead of catching the standard <a class="reference external" href="https://docs.python.org/3.4/library/queue.html#queue.Empty" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">queue.Empty</span></code></a> exception from
<a class="reference internal" href="index.html#tornado.queues.Queue.get_nowait" title="tornado.queues.Queue.get_nowait"><code class="xref py py-obj docutils literal"><span class="pre">Queue.get_nowait</span></code></a>, catch the special <a class="reference internal" href="index.html#tornado.queues.QueueEmpty" title="tornado.queues.QueueEmpty"><code class="xref py py-obj docutils literal"><span class="pre">tornado.queues.QueueEmpty</span></code></a> exception,
and instead of catching the standard <a class="reference external" href="https://docs.python.org/3.4/library/queue.html#queue.Full" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">queue.Full</span></code></a> from <a class="reference internal" href="index.html#tornado.queues.Queue.get_nowait" title="tornado.queues.Queue.get_nowait"><code class="xref py py-obj docutils literal"><span class="pre">Queue.get_nowait</span></code></a>,
catch <a class="reference internal" href="index.html#tornado.queues.QueueFull" title="tornado.queues.QueueFull"><code class="xref py py-obj docutils literal"><span class="pre">tornado.queues.QueueFull</span></code></a>.</p>
<p>To port from Toro&#8217;s locks to Tornado 4.2, import <a class="reference internal" href="index.html#tornado.locks.Condition" title="tornado.locks.Condition"><code class="xref py py-obj docutils literal"><span class="pre">Condition</span></code></a>, <a class="reference internal" href="index.html#tornado.locks.Event" title="tornado.locks.Event"><code class="xref py py-obj docutils literal"><span class="pre">Event</span></code></a>,
<a class="reference internal" href="index.html#tornado.locks.Semaphore" title="tornado.locks.Semaphore"><code class="xref py py-obj docutils literal"><span class="pre">Semaphore</span></code></a>, <a class="reference internal" href="index.html#tornado.locks.BoundedSemaphore" title="tornado.locks.BoundedSemaphore"><code class="xref py py-obj docutils literal"><span class="pre">BoundedSemaphore</span></code></a>, or <a class="reference internal" href="index.html#tornado.locks.Lock" title="tornado.locks.Lock"><code class="xref py py-obj docutils literal"><span class="pre">Lock</span></code></a> from <a class="reference internal" href="index.html#module-tornado.locks" title="tornado.locks"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locks</span></code></a>
instead of from <code class="docutils literal"><span class="pre">toro</span></code>.</p>
<p>Toro&#8217;s <code class="docutils literal"><span class="pre">Semaphore.wait</span></code> allowed a coroutine to wait for the semaphore to
be unlocked <em>without</em> acquiring it. This encouraged unorthodox patterns; in
Tornado, just use <a class="reference internal" href="index.html#tornado.locks.Semaphore.acquire" title="tornado.locks.Semaphore.acquire"><code class="xref py py-obj docutils literal"><span class="pre">acquire</span></code></a>.</p>
<p>Toro&#8217;s <code class="docutils literal"><span class="pre">Event.wait</span></code> raised a <code class="docutils literal"><span class="pre">Timeout</span></code> exception after a timeout. In
Tornado, <a class="reference internal" href="index.html#tornado.locks.Event.wait" title="tornado.locks.Event.wait"><code class="xref py py-obj docutils literal"><span class="pre">Event.wait</span></code></a> raises <a class="reference internal" href="index.html#tornado.gen.TimeoutError" title="tornado.gen.TimeoutError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.TimeoutError</span></code></a>.</p>
<p>Toro&#8217;s <code class="docutils literal"><span class="pre">Condition.wait</span></code> also raised <code class="docutils literal"><span class="pre">Timeout</span></code>, but in Tornado, the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>
returned by <a class="reference internal" href="index.html#tornado.locks.Condition.wait" title="tornado.locks.Condition.wait"><code class="xref py py-obj docutils literal"><span class="pre">Condition.wait</span></code></a> resolves to False after a timeout:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">await_notification</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="k">yield</span> <span class="n">condition</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">))):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;timed out&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;condition is true&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In lock and queue methods, wherever Toro accepted <code class="docutils literal"><span class="pre">deadline</span></code> as a keyword
argument, Tornado names the argument <code class="docutils literal"><span class="pre">timeout</span></code> instead.</p>
<p>Toro&#8217;s <code class="docutils literal"><span class="pre">AsyncResult</span></code> is not merged into Tornado, nor its exceptions
<code class="docutils literal"><span class="pre">NotReady</span></code> and <code class="docutils literal"><span class="pre">AlreadySet</span></code>. Use a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> instead. If you wrote code like
this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado</span> <span class="k">import</span> <span class="n">gen</span>
<span class="kn">import</span> <span class="nn">toro</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">toro</span><span class="o">.</span><span class="n">AsyncResult</span><span class="p">()</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">setter</span><span class="p">():</span>
    <span class="n">result</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">getter</span><span class="p">():</span>
    <span class="n">value</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># Prints &quot;1&quot;.</span>
</pre></div>
</div>
<p>Then the Tornado equivalent is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tornado</span> <span class="k">import</span> <span class="n">gen</span>
<span class="kn">from</span> <span class="nn">tornado.concurrent</span> <span class="k">import</span> <span class="n">Future</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">Future</span><span class="p">()</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">setter</span><span class="p">():</span>
    <span class="n">result</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
<span class="k">def</span> <span class="nf">getter</span><span class="p">():</span>
    <span class="n">value</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">result</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># Prints &quot;1&quot;.</span>
</pre></div>
</div>
</div>
<div class="section" id="tornado-autoreload">
<h6><a class="reference internal" href="index.html#module-tornado.autoreload" title="tornado.autoreload"><code class="xref py py-obj docutils literal"><span class="pre">tornado.autoreload</span></code></a><a class="headerlink" href="#tornado-autoreload" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Improved compatibility with Windows.</li>
<li>Fixed a bug in Python 3 if a module was imported during a reload check.</li>
</ul>
</div>
<div class="section" id="tornado-concurrent">
<h6><a class="reference internal" href="index.html#module-tornado.concurrent" title="tornado.concurrent"><code class="xref py py-obj docutils literal"><span class="pre">tornado.concurrent</span></code></a><a class="headerlink" href="#tornado-concurrent" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.concurrent.run_on_executor" title="tornado.concurrent.run_on_executor"><code class="xref py py-obj docutils literal"><span class="pre">run_on_executor</span></code></a> now accepts arguments to control which attributes
it uses to find the <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> and executor.</li>
</ul>
</div>
<div class="section" id="tornado-curl-httpclient">
<h6><a class="reference internal" href="index.html#module-tornado.curl_httpclient" title="tornado.curl_httpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.curl_httpclient</span></code></a><a class="headerlink" href="#tornado-curl-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Fixed a bug that would cause the client to stop processing requests
if an exception occurred in certain places while there is a queue.</li>
</ul>
</div>
<div class="section" id="tornado-escape">
<h6><a class="reference internal" href="index.html#module-tornado.escape" title="tornado.escape"><code class="xref py py-obj docutils literal"><span class="pre">tornado.escape</span></code></a><a class="headerlink" href="#tornado-escape" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.escape.xhtml_escape" title="tornado.escape.xhtml_escape"><code class="xref py py-obj docutils literal"><span class="pre">xhtml_escape</span></code></a> now supports numeric character references in hex
format (<code class="docutils literal"><span class="pre">&amp;#x20;</span></code>)</li>
</ul>
</div>
<div class="section" id="tornado-gen">
<h6><a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a><a class="headerlink" href="#tornado-gen" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.gen.WaitIterator" title="tornado.gen.WaitIterator"><code class="xref py py-obj docutils literal"><span class="pre">WaitIterator</span></code></a> no longer uses weak references, which fixes several
garbage-collection-related bugs.</li>
<li><code class="docutils literal"><span class="pre">tornado.gen.Multi</span></code> and <a class="reference internal" href="index.html#tornado.gen.multi_future" title="tornado.gen.multi_future"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.multi_future</span></code></a> (which are used when
yielding a list or dict in a coroutine) now log any exceptions after the
first if more than one <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> fails (previously they would be logged
when the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> was garbage-collected, but this is more reliable).
Both have a new keyword argument <code class="docutils literal"><span class="pre">quiet_exceptions</span></code> to suppress
logging of certain exception types; to use this argument you must
call <code class="docutils literal"><span class="pre">Multi</span></code> or <code class="docutils literal"><span class="pre">multi_future</span></code> directly instead of simply yielding
a list.</li>
<li><a class="reference internal" href="index.html#tornado.gen.multi_future" title="tornado.gen.multi_future"><code class="xref py py-obj docutils literal"><span class="pre">multi_future</span></code></a> now works when given multiple copies of the same <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.</li>
<li>On Python 3, catching an exception in a coroutine no longer leads to
leaks via <code class="docutils literal"><span class="pre">Exception.__context__</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-httpclient">
<h6><a class="reference internal" href="index.html#module-tornado.httpclient" title="tornado.httpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient</span></code></a><a class="headerlink" href="#tornado-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">raise_error</span></code> argument now works correctly with the synchronous
<a class="reference internal" href="index.html#tornado.httpclient.HTTPClient" title="tornado.httpclient.HTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">HTTPClient</span></code></a>.</li>
<li>The synchronous <a class="reference internal" href="index.html#tornado.httpclient.HTTPClient" title="tornado.httpclient.HTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">HTTPClient</span></code></a> no longer interferes with <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.current" title="tornado.ioloop.IOLoop.current"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.current()</span></code></a>.</li>
</ul>
</div>
<div class="section" id="tornado-httpserver">
<h6><a class="reference internal" href="index.html#module-tornado.httpserver" title="tornado.httpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpserver</span></code></a><a class="headerlink" href="#tornado-httpserver" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> is now a subclass of <a class="reference internal" href="index.html#tornado.util.Configurable" title="tornado.util.Configurable"><code class="xref py py-obj docutils literal"><span class="pre">tornado.util.Configurable</span></code></a>.</li>
</ul>
</div>
<div class="section" id="tornado-httputil">
<h6><a class="reference internal" href="index.html#module-tornado.httputil" title="tornado.httputil"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httputil</span></code></a><a class="headerlink" href="#tornado-httputil" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httputil.HTTPHeaders" title="tornado.httputil.HTTPHeaders"><code class="xref py py-obj docutils literal"><span class="pre">HTTPHeaders</span></code></a> can now be copied with <a class="reference external" href="https://docs.python.org/3.4/library/copy.html#copy.copy" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">copy.copy</span></code></a> and <a class="reference external" href="https://docs.python.org/3.4/library/copy.html#copy.deepcopy" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">copy.deepcopy</span></code></a>.</li>
</ul>
</div>
<div class="section" id="tornado-ioloop">
<h6><a class="reference internal" href="index.html#module-tornado.ioloop" title="tornado.ioloop"><code class="xref py py-obj docutils literal"><span class="pre">tornado.ioloop</span></code></a><a class="headerlink" href="#tornado-ioloop" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> constructor now has a <code class="docutils literal"><span class="pre">make_current</span></code> keyword argument
to control whether the new <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> becomes <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.current" title="tornado.ioloop.IOLoop.current"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.current()</span></code></a>.</li>
<li>Third-party implementations of <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> should accept <code class="docutils literal"><span class="pre">**kwargs</span></code>
in their <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.initialize" title="tornado.ioloop.IOLoop.initialize"><code class="xref py py-obj docutils literal"><span class="pre">initialize</span></code></a> methods and pass them to the superclass
implementation.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.PeriodicCallback" title="tornado.ioloop.PeriodicCallback"><code class="xref py py-obj docutils literal"><span class="pre">PeriodicCallback</span></code></a> is now more efficient when the clock jumps forward
by a large amount.</li>
</ul>
</div>
<div class="section" id="tornado-iostream">
<h6><a class="reference internal" href="index.html#module-tornado.iostream" title="tornado.iostream"><code class="xref py py-obj docutils literal"><span class="pre">tornado.iostream</span></code></a><a class="headerlink" href="#tornado-iostream" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">SSLIOStream.connect</span></code> and <a class="reference internal" href="index.html#tornado.iostream.IOStream.start_tls" title="tornado.iostream.IOStream.start_tls"><code class="xref py py-obj docutils literal"><span class="pre">IOStream.start_tls</span></code></a> now validate certificates
by default.</li>
<li>New method <a class="reference internal" href="index.html#tornado.iostream.SSLIOStream.wait_for_handshake" title="tornado.iostream.SSLIOStream.wait_for_handshake"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream.wait_for_handshake</span></code></a> allows server-side applications
to wait for the handshake to complete in order to verify client certificates
or use NPN/ALPN.</li>
<li>The <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> returned by <code class="docutils literal"><span class="pre">SSLIOStream.connect</span></code> now resolves after the
handshake is complete instead of as soon as the TCP connection is
established.</li>
<li>Reduced logging of SSL errors.</li>
<li><a class="reference internal" href="index.html#tornado.iostream.BaseIOStream.read_until_close" title="tornado.iostream.BaseIOStream.read_until_close"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream.read_until_close</span></code></a> now works correctly when a
<code class="docutils literal"><span class="pre">streaming_callback</span></code> is given but <code class="docutils literal"><span class="pre">callback</span></code> is None (i.e. when
it returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>)</li>
</ul>
</div>
<div class="section" id="tornado-locale">
<h6><a class="reference internal" href="index.html#module-tornado.locale" title="tornado.locale"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locale</span></code></a><a class="headerlink" href="#tornado-locale" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>New method <a class="reference internal" href="index.html#tornado.locale.GettextLocale.pgettext" title="tornado.locale.GettextLocale.pgettext"><code class="xref py py-obj docutils literal"><span class="pre">GettextLocale.pgettext</span></code></a> allows additional context to be
supplied for gettext translations.</li>
</ul>
</div>
<div class="section" id="tornado-log">
<h6><a class="reference internal" href="index.html#module-tornado.log" title="tornado.log"><code class="xref py py-obj docutils literal"><span class="pre">tornado.log</span></code></a><a class="headerlink" href="#tornado-log" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.log.define_logging_options" title="tornado.log.define_logging_options"><code class="xref py py-obj docutils literal"><span class="pre">define_logging_options</span></code></a> now works correctly when given a non-default
<code class="docutils literal"><span class="pre">options</span></code> object.</li>
</ul>
</div>
<div class="section" id="tornado-process">
<h6><a class="reference internal" href="index.html#module-tornado.process" title="tornado.process"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process</span></code></a><a class="headerlink" href="#tornado-process" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>New method <a class="reference internal" href="index.html#tornado.process.Subprocess.wait_for_exit" title="tornado.process.Subprocess.wait_for_exit"><code class="xref py py-obj docutils literal"><span class="pre">Subprocess.wait_for_exit</span></code></a> is a coroutine-friendly
version of <a class="reference internal" href="index.html#tornado.process.Subprocess.set_exit_callback" title="tornado.process.Subprocess.set_exit_callback"><code class="xref py py-obj docutils literal"><span class="pre">Subprocess.set_exit_callback</span></code></a>.</li>
</ul>
</div>
<div class="section" id="tornado-simple-httpclient">
<h6><a class="reference internal" href="index.html#module-tornado.simple_httpclient" title="tornado.simple_httpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.simple_httpclient</span></code></a><a class="headerlink" href="#tornado-simple-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Improved performance on Python 3 by reusing a single <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.SSLContext</span></code></a>.</li>
<li>New constructor argument <code class="docutils literal"><span class="pre">max_body_size</span></code> controls the maximum response
size the client is willing to accept. It may be bigger than
<code class="docutils literal"><span class="pre">max_buffer_size</span></code> if <code class="docutils literal"><span class="pre">streaming_callback</span></code> is used.</li>
</ul>
</div>
<div class="section" id="tornado-tcpserver">
<h6><a class="reference internal" href="index.html#module-tornado.tcpserver" title="tornado.tcpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.tcpserver</span></code></a><a class="headerlink" href="#tornado-tcpserver" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.tcpserver.TCPServer.handle_stream" title="tornado.tcpserver.TCPServer.handle_stream"><code class="xref py py-obj docutils literal"><span class="pre">TCPServer.handle_stream</span></code></a> may be a coroutine (so that any exceptions
it raises will be logged).</li>
</ul>
</div>
<div class="section" id="tornado-util">
<h6><a class="reference internal" href="index.html#module-tornado.util" title="tornado.util"><code class="xref py py-obj docutils literal"><span class="pre">tornado.util</span></code></a><a class="headerlink" href="#tornado-util" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.util.import_object" title="tornado.util.import_object"><code class="xref py py-obj docutils literal"><span class="pre">import_object</span></code></a> now supports unicode strings on Python 2.</li>
<li><a class="reference internal" href="index.html#tornado.util.Configurable.initialize" title="tornado.util.Configurable.initialize"><code class="xref py py-obj docutils literal"><span class="pre">Configurable.initialize</span></code></a> now supports positional arguments.</li>
</ul>
</div>
<div class="section" id="tornado-web">
<h6><a class="reference internal" href="index.html#module-tornado.web" title="tornado.web"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web</span></code></a><a class="headerlink" href="#tornado-web" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Key versioning support for cookie signing. <code class="docutils literal"><span class="pre">cookie_secret</span></code> application
setting can now contain a dict of valid keys with version as key. The
current signing key then must be specified via <code class="docutils literal"><span class="pre">key_version</span></code> setting.</li>
<li>Parsing of the <code class="docutils literal"><span class="pre">If-None-Match</span></code> header now follows the RFC and supports
weak validators.</li>
<li>Passing <code class="docutils literal"><span class="pre">secure=False</span></code> or <code class="docutils literal"><span class="pre">httponly=False</span></code> to
<a class="reference internal" href="index.html#tornado.web.RequestHandler.set_cookie" title="tornado.web.RequestHandler.set_cookie"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.set_cookie</span></code></a> now works as expected (previously only the
presence of the argument was considered and its value was ignored).</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.get_arguments" title="tornado.web.RequestHandler.get_arguments"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_arguments</span></code></a> now requires that its <code class="docutils literal"><span class="pre">strip</span></code> argument
be of type bool. This helps prevent errors caused by the slightly dissimilar
interfaces between the singular and plural methods.</li>
<li>Errors raised in <code class="docutils literal"><span class="pre">_handle_request_exception</span></code> are now logged more reliably.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.redirect" title="tornado.web.RequestHandler.redirect"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.redirect</span></code></a> now works correctly when called from a handler
whose path begins with two slashes.</li>
<li>Passing messages containing <code class="docutils literal"><span class="pre">%</span></code> characters to <a class="reference internal" href="index.html#tornado.web.HTTPError" title="tornado.web.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.HTTPError</span></code></a>
no longer causes broken error messages.</li>
</ul>
</div>
<div class="section" id="tornado-websocket">
<h6><a class="reference internal" href="index.html#module-tornado.websocket" title="tornado.websocket"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket</span></code></a><a class="headerlink" href="#tornado-websocket" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">on_close</span></code> method will no longer be called more than once.</li>
<li>When the other side closes a connection, we now echo the received close
code back instead of sending an empty close frame.</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v4.1.0"></span><div class="section" id="what-s-new-in-tornado-4-1">
<h4>What&#8217;s new in Tornado 4.1<a class="headerlink" href="#what-s-new-in-tornado-4-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="feb-7-2015">
<h5>Feb 7, 2015<a class="headerlink" href="#feb-7-2015" title="永久链接至标题">¶</a></h5>
<div class="section" id="highlights">
<h6>Highlights<a class="headerlink" href="#highlights" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>If a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> contains an exception but that exception is never
examined or re-raised (e.g. by yielding the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>), a stack
trace will be logged when the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> is garbage-collected.</li>
<li>New class <a class="reference internal" href="index.html#tornado.gen.WaitIterator" title="tornado.gen.WaitIterator"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.WaitIterator</span></code></a> provides a way to iterate
over <code class="docutils literal"><span class="pre">Futures</span></code> in the order they resolve.</li>
<li>The <a class="reference internal" href="index.html#module-tornado.websocket" title="tornado.websocket"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket</span></code></a> module now supports compression via the
&#8220;permessage-deflate&#8221; extension.  Override
<a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler.get_compression_options" title="tornado.websocket.WebSocketHandler.get_compression_options"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler.get_compression_options</span></code></a> to enable on the server
side, and use the <code class="docutils literal"><span class="pre">compression_options</span></code> keyword argument to
<a class="reference internal" href="index.html#tornado.websocket.websocket_connect" title="tornado.websocket.websocket_connect"><code class="xref py py-obj docutils literal"><span class="pre">websocket_connect</span></code></a> on the client side.</li>
<li>When the appropriate packages are installed, it is possible to yield
<a class="reference external" href="https://docs.python.org/3.4/library/asyncio-task.html#asyncio.Future" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">asyncio.Future</span></code></a> or Twisted <code class="docutils literal"><span class="pre">Defered</span></code> objects in Tornado coroutines.</li>
</ul>
</div>
<div class="section" id="backwards-compatibility-notes">
<h6>Backwards-compatibility notes<a class="headerlink" href="#backwards-compatibility-notes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> now calls <code class="docutils literal"><span class="pre">start_request</span></code> with the correct
arguments.  This change is backwards-incompatible, afffecting any
application which implemented <a class="reference internal" href="index.html#tornado.httputil.HTTPServerConnectionDelegate" title="tornado.httputil.HTTPServerConnectionDelegate"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerConnectionDelegate</span></code></a> by
following the example of <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> instead of the documented
method signatures.</li>
</ul>
</div>
<div class="section" id="tornado-concurrent">
<h6><a class="reference internal" href="index.html#module-tornado.concurrent" title="tornado.concurrent"><code class="xref py py-obj docutils literal"><span class="pre">tornado.concurrent</span></code></a><a class="headerlink" href="#tornado-concurrent" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>If a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> contains an exception but that exception is never
examined or re-raised (e.g. by yielding the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>), a stack
trace will be logged when the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> is garbage-collected.</li>
<li><a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> now catches and logs exceptions in its callbacks.</li>
</ul>
</div>
<div class="section" id="tornado-curl-httpclient">
<h6><code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code><a class="headerlink" href="#tornado-curl-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code> now supports request bodies for <code class="docutils literal"><span class="pre">PATCH</span></code>
and custom methods.</li>
<li><code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code> now supports resubmitting bodies after
following redirects for methods other than <code class="docutils literal"><span class="pre">POST</span></code>.</li>
<li><code class="docutils literal"><span class="pre">curl_httpclient</span></code> now runs the streaming and header callbacks on
the IOLoop.</li>
<li><code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code> now uses its own logger for debug output
so it can be filtered more easily.</li>
</ul>
</div>
<div class="section" id="tornado-gen">
<h6><a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a><a class="headerlink" href="#tornado-gen" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>New class <a class="reference internal" href="index.html#tornado.gen.WaitIterator" title="tornado.gen.WaitIterator"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.WaitIterator</span></code></a> provides a way to iterate
over <code class="docutils literal"><span class="pre">Futures</span></code> in the order they resolve.</li>
<li>When the <a class="reference external" href="https://docs.python.org/3.4/library/functools.html#functools.singledispatch" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">singledispatch</span></code></a> library is available (standard on
Python 3.4, available via <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">singledispatch</span></code> on older versions),
the <a class="reference internal" href="index.html#tornado.gen.convert_yielded" title="tornado.gen.convert_yielded"><code class="xref py py-obj docutils literal"><span class="pre">convert_yielded</span></code></a> function can be used to make other kinds of objects
yieldable in coroutines.</li>
<li>New function <a class="reference internal" href="index.html#tornado.gen.sleep" title="tornado.gen.sleep"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen.sleep</span></code></a> is a coroutine-friendly
analogue to <a class="reference external" href="https://docs.python.org/3.4/library/time.html#time.sleep" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">time.sleep</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.gen.engine" title="tornado.gen.engine"><code class="xref py py-obj docutils literal"><span class="pre">gen.engine</span></code></a> now correctly captures the stack context for its callbacks.</li>
</ul>
</div>
<div class="section" id="tornado-httpclient">
<h6><a class="reference internal" href="index.html#module-tornado.httpclient" title="tornado.httpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient</span></code></a><a class="headerlink" href="#tornado-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient.HTTPRequest</span></code></a> accepts a new argument
<code class="docutils literal"><span class="pre">raise_error=False</span></code> to suppress the default behavior of raising an
error for non-200 response codes.</li>
</ul>
</div>
<div class="section" id="tornado-httpserver">
<h6><a class="reference internal" href="index.html#module-tornado.httpserver" title="tornado.httpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpserver</span></code></a><a class="headerlink" href="#tornado-httpserver" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> now calls <code class="docutils literal"><span class="pre">start_request</span></code> with the correct
arguments.  This change is backwards-incompatible, afffecting any
application which implemented <a class="reference internal" href="index.html#tornado.httputil.HTTPServerConnectionDelegate" title="tornado.httputil.HTTPServerConnectionDelegate"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerConnectionDelegate</span></code></a> by
following the example of <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> instead of the documented
method signatures.</li>
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> now tolerates extra newlines which are sometimes inserted
between requests on keep-alive connections.</li>
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> can now use keep-alive connections after a request
with a chunked body.</li>
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> now always reports <code class="docutils literal"><span class="pre">HTTP/1.1</span></code> instead of echoing
the request version.</li>
</ul>
</div>
<div class="section" id="tornado-httputil">
<h6><a class="reference internal" href="index.html#module-tornado.httputil" title="tornado.httputil"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httputil</span></code></a><a class="headerlink" href="#tornado-httputil" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>New function <a class="reference internal" href="index.html#tornado.httputil.split_host_and_port" title="tornado.httputil.split_host_and_port"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httputil.split_host_and_port</span></code></a> for parsing
the <code class="docutils literal"><span class="pre">netloc</span></code> portion of URLs.</li>
<li>The <code class="docutils literal"><span class="pre">context</span></code> argument to <a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest" title="tornado.httputil.HTTPServerRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerRequest</span></code></a> is now optional,
and if a context is supplied the <code class="docutils literal"><span class="pre">remote_ip</span></code> attribute is also optional.</li>
<li><a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest.body" title="tornado.httputil.HTTPServerRequest.body"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerRequest.body</span></code></a> is now always a byte string (previously the default
empty body would be a unicode string on python 3).</li>
<li>Header parsing now works correctly when newline-like unicode characters
are present.</li>
<li>Header parsing again supports both CRLF and bare LF line separators.</li>
<li>Malformed <code class="docutils literal"><span class="pre">multipart/form-data</span></code> bodies will always be logged
quietly instead of raising an unhandled exception; previously
the behavior was inconsistent depending on the exact error.</li>
</ul>
</div>
<div class="section" id="tornado-ioloop">
<h6><a class="reference internal" href="index.html#module-tornado.ioloop" title="tornado.ioloop"><code class="xref py py-obj docutils literal"><span class="pre">tornado.ioloop</span></code></a><a class="headerlink" href="#tornado-ioloop" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">kqueue</span></code> and <code class="docutils literal"><span class="pre">select</span></code> IOLoop implementations now report
writeability correctly, fixing flow control in IOStream.</li>
<li>When a new <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> is created, it automatically becomes &#8220;current&#8221;
for the thread if there is not already a current instance.</li>
<li>New method <a class="reference internal" href="index.html#tornado.ioloop.PeriodicCallback.is_running" title="tornado.ioloop.PeriodicCallback.is_running"><code class="xref py py-obj docutils literal"><span class="pre">PeriodicCallback.is_running</span></code></a> can be used to see
whether the <a class="reference internal" href="index.html#tornado.ioloop.PeriodicCallback" title="tornado.ioloop.PeriodicCallback"><code class="xref py py-obj docutils literal"><span class="pre">PeriodicCallback</span></code></a> has been started.</li>
</ul>
</div>
<div class="section" id="tornado-iostream">
<h6><a class="reference internal" href="index.html#module-tornado.iostream" title="tornado.iostream"><code class="xref py py-obj docutils literal"><span class="pre">tornado.iostream</span></code></a><a class="headerlink" href="#tornado-iostream" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.iostream.IOStream.start_tls" title="tornado.iostream.IOStream.start_tls"><code class="xref py py-obj docutils literal"><span class="pre">IOStream.start_tls</span></code></a> now uses the <code class="docutils literal"><span class="pre">server_hostname</span></code> parameter
for certificate validation.</li>
<li><a class="reference internal" href="index.html#tornado.iostream.SSLIOStream" title="tornado.iostream.SSLIOStream"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream</span></code></a> will no longer consume 100% CPU after certain error conditions.</li>
<li><a class="reference internal" href="index.html#tornado.iostream.SSLIOStream" title="tornado.iostream.SSLIOStream"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream</span></code></a> no longer logs <code class="docutils literal"><span class="pre">EBADF</span></code> errors during the handshake as they
can result from nmap scans in certain modes.</li>
</ul>
</div>
<div class="section" id="tornado-options">
<h6><a class="reference internal" href="index.html#module-tornado.options" title="tornado.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options</span></code></a><a class="headerlink" href="#tornado-options" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.options.parse_config_file" title="tornado.options.parse_config_file"><code class="xref py py-obj docutils literal"><span class="pre">parse_config_file</span></code></a> now always decodes the config
file as utf8 on Python 3.</li>
<li><a class="reference internal" href="index.html#tornado.options.define" title="tornado.options.define"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.define</span></code></a> more accurately finds the module defining the
option.</li>
</ul>
</div>
<div class="section" id="tornado-platform-asyncio">
<h6><code class="docutils literal"><span class="pre">tornado.platform.asyncio</span></code><a class="headerlink" href="#tornado-platform-asyncio" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>It is now possible to yield <code class="docutils literal"><span class="pre">asyncio.Future</span></code> objects in coroutines
when the <a class="reference external" href="https://docs.python.org/3.4/library/functools.html#functools.singledispatch" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">singledispatch</span></code></a> library is available and
<code class="docutils literal"><span class="pre">tornado.platform.asyncio</span></code> has been imported.</li>
<li>New methods <a class="reference internal" href="index.html#tornado.platform.asyncio.to_tornado_future" title="tornado.platform.asyncio.to_tornado_future"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.asyncio.to_tornado_future</span></code></a> and
<a class="reference internal" href="index.html#tornado.platform.asyncio.to_asyncio_future" title="tornado.platform.asyncio.to_asyncio_future"><code class="xref py py-obj docutils literal"><span class="pre">to_asyncio_future</span></code></a> convert between
the two libraries&#8217; <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> classes.</li>
</ul>
</div>
<div class="section" id="tornado-platform-twisted">
<h6><code class="docutils literal"><span class="pre">tornado.platform.twisted</span></code><a class="headerlink" href="#tornado-platform-twisted" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>It is now possible to yield <code class="docutils literal"><span class="pre">Deferred</span></code> objects in coroutines
when the <a class="reference external" href="https://docs.python.org/3.4/library/functools.html#functools.singledispatch" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">singledispatch</span></code></a> library is available and
<code class="docutils literal"><span class="pre">tornado.platform.twisted</span></code> has been imported.</li>
</ul>
</div>
<div class="section" id="tornado-tcpclient">
<h6><a class="reference internal" href="index.html#module-tornado.tcpclient" title="tornado.tcpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.tcpclient</span></code></a><a class="headerlink" href="#tornado-tcpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.tcpclient.TCPClient" title="tornado.tcpclient.TCPClient"><code class="xref py py-obj docutils literal"><span class="pre">TCPClient</span></code></a> will no longer raise an exception due to an ill-timed
timeout.</li>
</ul>
</div>
<div class="section" id="tornado-tcpserver">
<h6><a class="reference internal" href="index.html#module-tornado.tcpserver" title="tornado.tcpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.tcpserver</span></code></a><a class="headerlink" href="#tornado-tcpserver" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.tcpserver.TCPServer" title="tornado.tcpserver.TCPServer"><code class="xref py py-obj docutils literal"><span class="pre">TCPServer</span></code></a> no longer ignores its <code class="docutils literal"><span class="pre">read_chunk_size</span></code> argument.</li>
</ul>
</div>
<div class="section" id="tornado-testing">
<h6><a class="reference internal" href="index.html#module-tornado.testing" title="tornado.testing"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing</span></code></a><a class="headerlink" href="#tornado-testing" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.testing.AsyncTestCase" title="tornado.testing.AsyncTestCase"><code class="xref py py-obj docutils literal"><span class="pre">AsyncTestCase</span></code></a> has better support for multiple exceptions. Previously
it would silently swallow all but the last; now it raises the first
and logs all the rest.</li>
<li><a class="reference internal" href="index.html#tornado.testing.AsyncTestCase" title="tornado.testing.AsyncTestCase"><code class="xref py py-obj docutils literal"><span class="pre">AsyncTestCase</span></code></a> now cleans up <a class="reference internal" href="index.html#tornado.process.Subprocess" title="tornado.process.Subprocess"><code class="xref py py-obj docutils literal"><span class="pre">Subprocess</span></code></a> state on <code class="docutils literal"><span class="pre">tearDown</span></code> when
necessary.</li>
</ul>
</div>
<div class="section" id="tornado-web">
<h6><a class="reference internal" href="index.html#module-tornado.web" title="tornado.web"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web</span></code></a><a class="headerlink" href="#tornado-web" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The <a class="reference internal" href="index.html#tornado.web.asynchronous" title="tornado.web.asynchronous"><code class="xref py py-obj docutils literal"><span class="pre">asynchronous</span></code></a> decorator now understands <a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#concurrent.futures.Future" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures.Future</span></code></a>
in addition to <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">tornado.concurrent.Future</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> no longer logs a stack trace if the connection is
closed while sending the file.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.send_error" title="tornado.web.RequestHandler.send_error"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.send_error</span></code></a> now supports a <code class="docutils literal"><span class="pre">reason</span></code> keyword
argument, similar to <a class="reference internal" href="index.html#tornado.web.HTTPError" title="tornado.web.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.HTTPError</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.locale" title="tornado.web.RequestHandler.locale"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.locale</span></code></a> now has a property setter.</li>
<li><a class="reference internal" href="index.html#tornado.web.Application.add_handlers" title="tornado.web.Application.add_handlers"><code class="xref py py-obj docutils literal"><span class="pre">Application.add_handlers</span></code></a> hostname matching now works correctly with
IPv6 literals.</li>
<li>Redirects for the <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> <code class="docutils literal"><span class="pre">default_host</span></code> setting now match
the request protocol instead of redirecting HTTPS to HTTP.</li>
<li>Malformed <code class="docutils literal"><span class="pre">_xsrf</span></code> cookies are now ignored instead of causing
uncaught exceptions.</li>
<li><code class="docutils literal"><span class="pre">Application.start_request</span></code> now has the same signature as
<a class="reference internal" href="index.html#tornado.httputil.HTTPServerConnectionDelegate.start_request" title="tornado.httputil.HTTPServerConnectionDelegate.start_request"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerConnectionDelegate.start_request</span></code></a>.</li>
</ul>
</div>
<div class="section" id="tornado-websocket">
<h6><a class="reference internal" href="index.html#module-tornado.websocket" title="tornado.websocket"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket</span></code></a><a class="headerlink" href="#tornado-websocket" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The <a class="reference internal" href="index.html#module-tornado.websocket" title="tornado.websocket"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket</span></code></a> module now supports compression via the
&#8220;permessage-deflate&#8221; extension.  Override
<a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler.get_compression_options" title="tornado.websocket.WebSocketHandler.get_compression_options"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler.get_compression_options</span></code></a> to enable on the server
side, and use the <code class="docutils literal"><span class="pre">compression_options</span></code> keyword argument to
<a class="reference internal" href="index.html#tornado.websocket.websocket_connect" title="tornado.websocket.websocket_connect"><code class="xref py py-obj docutils literal"><span class="pre">websocket_connect</span></code></a> on the client side.</li>
<li><a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler" title="tornado.websocket.WebSocketHandler"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler</span></code></a> no longer logs stack traces when the connection
is closed.</li>
<li><a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler.open" title="tornado.websocket.WebSocketHandler.open"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler.open</span></code></a> now accepts <code class="docutils literal"><span class="pre">*args,</span> <span class="pre">**kw</span></code> for consistency
with <code class="docutils literal"><span class="pre">RequestHandler.get</span></code> and related methods.</li>
<li>The <code class="docutils literal"><span class="pre">Sec-WebSocket-Version</span></code> header now includes all supported versions.</li>
<li><a class="reference internal" href="index.html#tornado.websocket.websocket_connect" title="tornado.websocket.websocket_connect"><code class="xref py py-obj docutils literal"><span class="pre">websocket_connect</span></code></a> now has a <code class="docutils literal"><span class="pre">on_message_callback</span></code> keyword argument
for callback-style use without <code class="docutils literal"><span class="pre">read_message()</span></code>.</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v4.0.2"></span><div class="section" id="what-s-new-in-tornado-4-0-2">
<h4>What&#8217;s new in Tornado 4.0.2<a class="headerlink" href="#what-s-new-in-tornado-4-0-2" title="永久链接至标题">¶</a></h4>
<div class="section" id="sept-10-2014">
<h5>Sept 10, 2014<a class="headerlink" href="#sept-10-2014" title="永久链接至标题">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Fixed a bug that could sometimes cause a timeout to fire after being
cancelled.</li>
<li><a class="reference internal" href="index.html#tornado.testing.AsyncTestCase" title="tornado.testing.AsyncTestCase"><code class="xref py py-obj docutils literal"><span class="pre">AsyncTestCase</span></code></a> once again passes along arguments to test methods,
making it compatible with extensions such as Nose&#8217;s test generators.</li>
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> can again compress its responses when gzip is enabled.</li>
<li><code class="docutils literal"><span class="pre">simple_httpclient</span></code> passes its <code class="docutils literal"><span class="pre">max_buffer_size</span></code> argument to the
underlying stream.</li>
<li>Fixed a reference cycle that can lead to increased memory consumption.</li>
<li><a class="reference internal" href="index.html#tornado.netutil.add_accept_handler" title="tornado.netutil.add_accept_handler"><code class="xref py py-obj docutils literal"><span class="pre">add_accept_handler</span></code></a> will now limit the number of times it will call
<a class="reference external" href="https://docs.python.org/3.4/library/socket.html#socket.socket.accept" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">accept</span></code></a> per <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> iteration, addressing a potential
starvation issue.</li>
<li>Improved error handling in <a class="reference internal" href="index.html#tornado.iostream.IOStream.connect" title="tornado.iostream.IOStream.connect"><code class="xref py py-obj docutils literal"><span class="pre">IOStream.connect</span></code></a> (primarily for FreeBSD
systems)</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v4.0.1"></span><div class="section" id="what-s-new-in-tornado-4-0-1">
<h4>What&#8217;s new in Tornado 4.0.1<a class="headerlink" href="#what-s-new-in-tornado-4-0-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="aug-12-2014">
<h5>Aug 12, 2014<a class="headerlink" href="#aug-12-2014" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>The build will now fall back to pure-python mode if the C extension
fails to build for any reason (previously it would fall back for some
errors but not others).</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop.call_at" title="tornado.ioloop.IOLoop.call_at"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.call_at</span></code></a> and <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.call_later" title="tornado.ioloop.IOLoop.call_later"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.call_later</span></code></a> now always return
a timeout handle for use with <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.remove_timeout" title="tornado.ioloop.IOLoop.remove_timeout"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.remove_timeout</span></code></a>.</li>
<li>If any callback of a <a class="reference internal" href="index.html#tornado.ioloop.PeriodicCallback" title="tornado.ioloop.PeriodicCallback"><code class="xref py py-obj docutils literal"><span class="pre">PeriodicCallback</span></code></a> or <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> returns a
<a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>, any error raised in that future will now be logged
(similar to the behavior of <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_callback" title="tornado.ioloop.IOLoop.add_callback"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_callback</span></code></a>).</li>
<li>Fixed an exception in client-side websocket connections when the
connection is closed.</li>
<li><code class="docutils literal"><span class="pre">simple_httpclient</span></code> once again correctly handles 204 status
codes with no content-length header.</li>
<li>Fixed a regression in <code class="docutils literal"><span class="pre">simple_httpclient</span></code> that would result in
timeouts for certain kinds of errors.</li>
</ul>
</div>
</div>
<span id="document-releases/v4.0.0"></span><div class="section" id="what-s-new-in-tornado-4-0">
<h4>What&#8217;s new in Tornado 4.0<a class="headerlink" href="#what-s-new-in-tornado-4-0" title="永久链接至标题">¶</a></h4>
<div class="section" id="july-15-2014">
<h5>July 15, 2014<a class="headerlink" href="#july-15-2014" title="永久链接至标题">¶</a></h5>
<div class="section" id="highlights">
<h6>Highlights<a class="headerlink" href="#highlights" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The <a class="reference internal" href="index.html#tornado.web.stream_request_body" title="tornado.web.stream_request_body"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.stream_request_body</span></code></a> decorator allows large files to be
uploaded with limited memory usage.</li>
<li>Coroutines are now faster and are used extensively throughout Tornado itself.
More methods now return <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Futures</span></code></a>, including most <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a>
methods and <a class="reference internal" href="index.html#tornado.web.RequestHandler.flush" title="tornado.web.RequestHandler.flush"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.flush</span></code></a>.</li>
<li>Many user-overridden methods are now allowed to return a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>
for flow control.</li>
<li>HTTP-related code is now shared between the <a class="reference internal" href="index.html#module-tornado.httpserver" title="tornado.httpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpserver</span></code></a>,
<code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code> and <a class="reference internal" href="index.html#module-tornado.wsgi" title="tornado.wsgi"><code class="xref py py-obj docutils literal"><span class="pre">tornado.wsgi</span></code></a> modules, making support
for features such as chunked and gzip encoding more consistent.
<a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> now uses new delegate interfaces defined in <a class="reference internal" href="index.html#module-tornado.httputil" title="tornado.httputil"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httputil</span></code></a>
in addition to its old single-callback interface.</li>
<li>New module <a class="reference internal" href="index.html#module-tornado.tcpclient" title="tornado.tcpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.tcpclient</span></code></a> creates TCP connections with non-blocking
DNS, SSL handshaking, and support for IPv6.</li>
</ul>
</div>
<div class="section" id="backwards-compatibility-notes">
<h6>Backwards-compatibility notes<a class="headerlink" href="#backwards-compatibility-notes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">tornado.concurrent.Future</span></code></a> is no longer thread-safe; use
<a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#concurrent.futures.Future" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures.Future</span></code></a> when thread-safety is needed.</li>
<li>Tornado now depends on the <a class="reference external" href="https://pypi.python.org/pypi/certifi">certifi</a>
package instead of bundling its own copy of the Mozilla CA list. This will
be installed automatically when using <code class="docutils literal"><span class="pre">pip</span></code> or <code class="docutils literal"><span class="pre">easy_install</span></code>.</li>
<li>This version includes the changes to the secure cookie format first
introduced in version <a class="reference internal" href="index.html#document-releases/v3.2.1"><span class="doc">3.2.1</span></a>, and the xsrf token change
in version <a class="reference internal" href="index.html#document-releases/v3.2.2"><span class="doc">3.2.2</span></a>.  If you are upgrading from an earlier
version, see those versions&#8217; release notes.</li>
<li>WebSocket connections from other origin sites are now rejected by default.
To accept cross-origin websocket connections, override
the new method <a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler.check_origin" title="tornado.websocket.WebSocketHandler.check_origin"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler.check_origin</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler" title="tornado.websocket.WebSocketHandler"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler</span></code></a> no longer supports the old <code class="docutils literal"><span class="pre">draft</span> <span class="pre">76</span></code> protocol
(this mainly affects Safari 5.x browsers).  Applications should use
non-websocket workarounds for these browsers.</li>
<li>Authors of alternative <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> implementations should see the changes
to <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_handler" title="tornado.ioloop.IOLoop.add_handler"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_handler</span></code></a> in this release.</li>
<li>The <code class="docutils literal"><span class="pre">RequestHandler.async_callback</span></code> and <code class="docutils literal"><span class="pre">WebSocketHandler.async_callback</span></code>
wrapper functions have been removed; they have been obsolete for a long
time due to stack contexts (and more recently coroutines).</li>
<li><code class="docutils literal"><span class="pre">curl_httpclient</span></code> now requires a minimum of libcurl version 7.21.1 and
pycurl 7.18.2.</li>
<li>Support for <code class="docutils literal"><span class="pre">RequestHandler.get_error_html</span></code> has been removed;
override <a class="reference internal" href="index.html#tornado.web.RequestHandler.write_error" title="tornado.web.RequestHandler.write_error"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.write_error</span></code></a> instead.</li>
</ul>
</div>
<div class="section" id="other-notes">
<h6>Other notes<a class="headerlink" href="#other-notes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The git repository has moved to <a class="reference external" href="https://github.com/tornadoweb/tornado">https://github.com/tornadoweb/tornado</a>.
All old links should be redirected to the new location.</li>
<li>An <a class="reference external" href="http://groups.google.com/group/python-tornado-announce">announcement mailing list</a> is now available.</li>
<li>All Tornado modules are now importable on Google App Engine (although
the App Engine environment does not allow the system calls used
by <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> so many modules are still unusable).</li>
</ul>
</div>
<div class="section" id="tornado-auth">
<h6><a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a><a class="headerlink" href="#tornado-auth" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Fixed a bug in <code class="docutils literal"><span class="pre">.FacebookMixin</span></code> on Python 3.</li>
<li>When using the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> interface, exceptions are more reliably delivered
to the caller.</li>
</ul>
</div>
<div class="section" id="tornado-concurrent">
<h6><a class="reference internal" href="index.html#module-tornado.concurrent" title="tornado.concurrent"><code class="xref py py-obj docutils literal"><span class="pre">tornado.concurrent</span></code></a><a class="headerlink" href="#tornado-concurrent" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">tornado.concurrent.Future</span></code></a> is now always thread-unsafe (previously
it would be thread-safe if the <a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#module-concurrent.futures" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures</span></code></a> package was available).
This improves performance and provides more consistent semantics.
The parts of Tornado that accept Futures will accept both Tornado&#8217;s
thread-unsafe Futures and the thread-safe <a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#concurrent.futures.Future" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures.Future</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">tornado.concurrent.Future</span></code></a> now includes all the functionality
of the old <code class="docutils literal"><span class="pre">TracebackFuture</span></code> class.  <code class="docutils literal"><span class="pre">TracebackFuture</span></code> is now
simply an alias for <code class="docutils literal"><span class="pre">Future</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-curl-httpclient">
<h6><code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code><a class="headerlink" href="#tornado-curl-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">curl_httpclient</span></code> now passes along the HTTP &#8220;reason&#8221; string
in <code class="docutils literal"><span class="pre">response.reason</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-gen">
<h6><a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a><a class="headerlink" href="#tornado-gen" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Performance of coroutines has been improved.</li>
<li>Coroutines no longer generate <code class="docutils literal"><span class="pre">StackContexts</span></code> by default, but they
will be created on demand when needed.</li>
<li>The internals of the <a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a> module have been rewritten to
improve performance when using <code class="docutils literal"><span class="pre">Futures</span></code>, at the expense of some
performance degradation for the older <a class="reference internal" href="index.html#tornado.gen.YieldPoint" title="tornado.gen.YieldPoint"><code class="xref py py-obj docutils literal"><span class="pre">YieldPoint</span></code></a> interfaces.</li>
<li>New function <a class="reference internal" href="index.html#tornado.gen.with_timeout" title="tornado.gen.with_timeout"><code class="xref py py-obj docutils literal"><span class="pre">with_timeout</span></code></a> wraps a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> and raises an exception
if it doesn&#8217;t complete in a given amount of time.</li>
<li>New object <a class="reference internal" href="index.html#tornado.gen.moment" title="tornado.gen.moment"><code class="xref py py-obj docutils literal"><span class="pre">moment</span></code></a> can be yielded to allow the IOLoop to run for
one iteration before resuming.</li>
<li><a class="reference internal" href="index.html#tornado.gen.Task" title="tornado.gen.Task"><code class="xref py py-obj docutils literal"><span class="pre">Task</span></code></a> is now a function returning a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> instead of a <a class="reference internal" href="index.html#tornado.gen.YieldPoint" title="tornado.gen.YieldPoint"><code class="xref py py-obj docutils literal"><span class="pre">YieldPoint</span></code></a>
subclass.  This change should be transparent to application code, but
allows <a class="reference internal" href="index.html#tornado.gen.Task" title="tornado.gen.Task"><code class="xref py py-obj docutils literal"><span class="pre">Task</span></code></a> to take advantage of the newly-optimized <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>
handling.</li>
</ul>
</div>
<div class="section" id="tornado-http1connection">
<h6><a class="reference internal" href="index.html#module-tornado.http1connection" title="tornado.http1connection"><code class="xref py py-obj docutils literal"><span class="pre">tornado.http1connection</span></code></a><a class="headerlink" href="#tornado-http1connection" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>New module contains the HTTP implementation shared by <a class="reference internal" href="index.html#module-tornado.httpserver" title="tornado.httpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpserver</span></code></a>
and <code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-httpclient">
<h6><a class="reference internal" href="index.html#module-tornado.httpclient" title="tornado.httpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient</span></code></a><a class="headerlink" href="#tornado-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The command-line HTTP client (<code class="docutils literal"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">tornado.httpclient</span> <span class="pre">$URL</span></code>)
now works on Python 3.</li>
<li>Fixed a memory leak in <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> shutdown that affected
applications that created many HTTP clients and IOLoops.</li>
<li>New client request parameter <code class="docutils literal"><span class="pre">decompress_response</span></code> replaces
the existing <code class="docutils literal"><span class="pre">use_gzip</span></code> parameter; both names are accepted.</li>
</ul>
</div>
<div class="section" id="tornado-httpserver">
<h6><a class="reference internal" href="index.html#module-tornado.httpserver" title="tornado.httpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpserver</span></code></a><a class="headerlink" href="#tornado-httpserver" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">tornado.httpserver.HTTPRequest</span></code> has moved to
<a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest" title="tornado.httputil.HTTPServerRequest"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httputil.HTTPServerRequest</span></code></a>.</li>
<li>HTTP implementation has been unified with <code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code>
in <a class="reference internal" href="index.html#module-tornado.http1connection" title="tornado.http1connection"><code class="xref py py-obj docutils literal"><span class="pre">tornado.http1connection</span></code></a>.</li>
<li>Now supports <code class="docutils literal"><span class="pre">Transfer-Encoding:</span> <span class="pre">chunked</span></code> for request bodies.</li>
<li>Now supports <code class="docutils literal"><span class="pre">Content-Encoding:</span> <span class="pre">gzip</span></code> for request bodies if
<code class="docutils literal"><span class="pre">decompress_request=True</span></code> is passed to the <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> constructor.</li>
<li>The <code class="docutils literal"><span class="pre">connection</span></code> attribute of <a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest" title="tornado.httputil.HTTPServerRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerRequest</span></code></a> is now documented
for public use; applications are expected to write their responses
via the <a class="reference internal" href="index.html#tornado.httputil.HTTPConnection" title="tornado.httputil.HTTPConnection"><code class="xref py py-obj docutils literal"><span class="pre">HTTPConnection</span></code></a> interface.</li>
<li>The <a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest.write" title="tornado.httputil.HTTPServerRequest.write"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerRequest.write</span></code></a> and <a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest.finish" title="tornado.httputil.HTTPServerRequest.finish"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerRequest.finish</span></code></a> methods
are now deprecated.  (<a class="reference internal" href="index.html#tornado.web.RequestHandler.write" title="tornado.web.RequestHandler.write"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.write</span></code></a> and <a class="reference internal" href="index.html#tornado.web.RequestHandler.finish" title="tornado.web.RequestHandler.finish"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.finish</span></code></a>
are <em>not</em> deprecated; this only applies to the methods on
<a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest" title="tornado.httputil.HTTPServerRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerRequest</span></code></a>)</li>
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> now supports <a class="reference internal" href="index.html#tornado.httputil.HTTPServerConnectionDelegate" title="tornado.httputil.HTTPServerConnectionDelegate"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerConnectionDelegate</span></code></a> in addition to
the old <code class="docutils literal"><span class="pre">request_callback</span></code> interface.  The delegate interface supports
streaming of request bodies.</li>
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> now detects the error of an application sending a
<code class="docutils literal"><span class="pre">Content-Length</span></code> error that is inconsistent with the actual content.</li>
<li>New constructor arguments <code class="docutils literal"><span class="pre">max_header_size</span></code> and <code class="docutils literal"><span class="pre">max_body_size</span></code>
allow separate limits to be set for different parts of the request.
<code class="docutils literal"><span class="pre">max_body_size</span></code> is applied even in streaming mode.</li>
<li>New constructor argument <code class="docutils literal"><span class="pre">chunk_size</span></code> can be used to limit the amount
of data read into memory at one time per request.</li>
<li>New constructor arguments <code class="docutils literal"><span class="pre">idle_connection_timeout</span></code> and <code class="docutils literal"><span class="pre">body_timeout</span></code>
allow time limits to be placed on the reading of requests.</li>
<li>Form-encoded message bodies are now parsed for all HTTP methods, not just
<code class="docutils literal"><span class="pre">POST</span></code>, <code class="docutils literal"><span class="pre">PUT</span></code>, and <code class="docutils literal"><span class="pre">PATCH</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-httputil">
<h6><a class="reference internal" href="index.html#module-tornado.httputil" title="tornado.httputil"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httputil</span></code></a><a class="headerlink" href="#tornado-httputil" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httputil.HTTPServerRequest" title="tornado.httputil.HTTPServerRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerRequest</span></code></a> was moved to this module from <a class="reference internal" href="index.html#module-tornado.httpserver" title="tornado.httpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpserver</span></code></a>.</li>
<li>New base classes <a class="reference internal" href="index.html#tornado.httputil.HTTPConnection" title="tornado.httputil.HTTPConnection"><code class="xref py py-obj docutils literal"><span class="pre">HTTPConnection</span></code></a>, <a class="reference internal" href="index.html#tornado.httputil.HTTPServerConnectionDelegate" title="tornado.httputil.HTTPServerConnectionDelegate"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServerConnectionDelegate</span></code></a>,
and <a class="reference internal" href="index.html#tornado.httputil.HTTPMessageDelegate" title="tornado.httputil.HTTPMessageDelegate"><code class="xref py py-obj docutils literal"><span class="pre">HTTPMessageDelegate</span></code></a> define the interaction between applications
and the HTTP implementation.</li>
</ul>
</div>
<div class="section" id="tornado-ioloop">
<h6><a class="reference internal" href="index.html#module-tornado.ioloop" title="tornado.ioloop"><code class="xref py py-obj docutils literal"><span class="pre">tornado.ioloop</span></code></a><a class="headerlink" href="#tornado-ioloop" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_handler" title="tornado.ioloop.IOLoop.add_handler"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_handler</span></code></a> and related methods now accept file-like objects
in addition to raw file descriptors.  Passing the objects is recommended
(when possible) to avoid a garbage-collection-related problem in unit tests.</li>
<li>New method <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.clear_instance" title="tornado.ioloop.IOLoop.clear_instance"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.clear_instance</span></code></a> makes it possible to uninstall the
singleton instance.</li>
<li>Timeout scheduling is now more robust against slow callbacks.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_timeout" title="tornado.ioloop.IOLoop.add_timeout"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_timeout</span></code></a> is now a bit more efficient.</li>
<li>When a function run by the <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> and that <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>
has an exception, the <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> will log the exception.</li>
<li>New method <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.spawn_callback" title="tornado.ioloop.IOLoop.spawn_callback"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.spawn_callback</span></code></a> simplifies the process of launching
a fire-and-forget callback that is separated from the caller&#8217;s stack context.</li>
<li>New methods <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.call_later" title="tornado.ioloop.IOLoop.call_later"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.call_later</span></code></a> and <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.call_at" title="tornado.ioloop.IOLoop.call_at"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.call_at</span></code></a> simplify the
specification of relative or absolute timeouts (as opposed to
<a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_timeout" title="tornado.ioloop.IOLoop.add_timeout"><code class="xref py py-obj docutils literal"><span class="pre">add_timeout</span></code></a>, which used the type of its argument).</li>
</ul>
</div>
<div class="section" id="tornado-iostream">
<h6><a class="reference internal" href="index.html#module-tornado.iostream" title="tornado.iostream"><code class="xref py py-obj docutils literal"><span class="pre">tornado.iostream</span></code></a><a class="headerlink" href="#tornado-iostream" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">callback</span></code> argument to most <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> methods is now optional.
When called without a callback the method will return a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>
for use with coroutines.</li>
<li>New method <a class="reference internal" href="index.html#tornado.iostream.IOStream.start_tls" title="tornado.iostream.IOStream.start_tls"><code class="xref py py-obj docutils literal"><span class="pre">IOStream.start_tls</span></code></a> converts an <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> to an
<a class="reference internal" href="index.html#tornado.iostream.SSLIOStream" title="tornado.iostream.SSLIOStream"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream</span></code></a>.</li>
<li>No longer gets confused when an <code class="docutils literal"><span class="pre">IOError</span></code> or <code class="docutils literal"><span class="pre">OSError</span></code> without
an <code class="docutils literal"><span class="pre">errno</span></code> attribute is raised.</li>
<li><a class="reference internal" href="index.html#tornado.iostream.BaseIOStream.read_bytes" title="tornado.iostream.BaseIOStream.read_bytes"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream.read_bytes</span></code></a> now accepts a <code class="docutils literal"><span class="pre">partial</span></code> keyword argument,
which can be used to return before the full amount has been read.
This is a more coroutine-friendly alternative to <code class="docutils literal"><span class="pre">streaming_callback</span></code>.</li>
<li><a class="reference internal" href="index.html#tornado.iostream.BaseIOStream.read_until" title="tornado.iostream.BaseIOStream.read_until"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream.read_until</span></code></a> and <code class="docutils literal"><span class="pre">read_until_regex</span></code> now acept a
<code class="docutils literal"><span class="pre">max_bytes</span></code> keyword argument which will cause the request to fail if
it cannot be satisfied from the given number of bytes.</li>
<li><a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> no longer reads from the socket into memory if it does not
need data to satisfy a pending read.  As a side effect, the close callback
will not be run immediately if the other side closes the connection
while there is unconsumed data in the buffer.</li>
<li>The default <code class="docutils literal"><span class="pre">chunk_size</span></code> has been increased to 64KB (from 4KB)</li>
<li>The <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> constructor takes a new keyword argument
<code class="docutils literal"><span class="pre">max_write_buffer_size</span></code> (defaults to unlimited).  Calls to
<a class="reference internal" href="index.html#tornado.iostream.BaseIOStream.write" title="tornado.iostream.BaseIOStream.write"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream.write</span></code></a> will raise <a class="reference internal" href="index.html#tornado.iostream.StreamBufferFullError" title="tornado.iostream.StreamBufferFullError"><code class="xref py py-obj docutils literal"><span class="pre">StreamBufferFullError</span></code></a> if the amount
of unsent buffered data exceeds this limit.</li>
<li><code class="docutils literal"><span class="pre">ETIMEDOUT</span></code> errors are no longer logged.  If you need to distinguish
timeouts from other forms of closed connections, examine <code class="docutils literal"><span class="pre">stream.error</span></code>
from a close callback.</li>
</ul>
</div>
<div class="section" id="tornado-netutil">
<h6><a class="reference internal" href="index.html#module-tornado.netutil" title="tornado.netutil"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil</span></code></a><a class="headerlink" href="#tornado-netutil" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>When <a class="reference internal" href="index.html#tornado.netutil.bind_sockets" title="tornado.netutil.bind_sockets"><code class="xref py py-obj docutils literal"><span class="pre">bind_sockets</span></code></a> chooses a port automatically, it will now use
the same port for IPv4 and IPv6.</li>
<li>TLS compression is now disabled by default on Python 3.3 and higher
(it is not possible to change this option in older versions).</li>
</ul>
</div>
<div class="section" id="tornado-options">
<h6><a class="reference internal" href="index.html#module-tornado.options" title="tornado.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options</span></code></a><a class="headerlink" href="#tornado-options" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>It is now possible to disable the default logging configuration
by setting <code class="docutils literal"><span class="pre">options.logging</span></code> to <code class="docutils literal"><span class="pre">None</span></code> instead of the string <code class="docutils literal"><span class="pre">&quot;none&quot;</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-platform-asyncio">
<h6><a class="reference internal" href="index.html#module-tornado.platform.asyncio" title="tornado.platform.asyncio"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.asyncio</span></code></a><a class="headerlink" href="#tornado-platform-asyncio" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Now works on Python 2.6.</li>
<li>Now works with Trollius version 0.3.</li>
</ul>
</div>
<div class="section" id="tornado-platform-twisted">
<h6><a class="reference internal" href="index.html#module-tornado.platform.twisted" title="tornado.platform.twisted"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.twisted</span></code></a><a class="headerlink" href="#tornado-platform-twisted" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.platform.twisted.TwistedIOLoop" title="tornado.platform.twisted.TwistedIOLoop"><code class="xref py py-obj docutils literal"><span class="pre">TwistedIOLoop</span></code></a> now works on Python 3.3+ (with Twisted 14.0.0+).</li>
</ul>
</div>
<div class="section" id="tornado-simple-httpclient">
<h6><code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code><a class="headerlink" href="#tornado-simple-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">simple_httpclient</span></code> has better support for IPv6, which is now enabled
by default.</li>
<li>Improved default cipher suite selection (Python 2.7+).</li>
<li>HTTP implementation has been unified with <code class="docutils literal"><span class="pre">tornado.httpserver</span></code>
in <a class="reference internal" href="index.html#module-tornado.http1connection" title="tornado.http1connection"><code class="xref py py-obj docutils literal"><span class="pre">tornado.http1connection</span></code></a></li>
<li>Streaming request bodies are now supported via the <code class="docutils literal"><span class="pre">body_producer</span></code>
keyword argument to <a class="reference internal" href="index.html#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient.HTTPRequest</span></code></a>.</li>
<li>The <code class="docutils literal"><span class="pre">expect_100_continue</span></code> keyword argument to
<a class="reference internal" href="index.html#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient.HTTPRequest</span></code></a> allows the use of the HTTP <code class="docutils literal"><span class="pre">Expect:</span>
<span class="pre">100-continue</span></code> feature.</li>
<li><code class="docutils literal"><span class="pre">simple_httpclient</span></code> now raises the original exception (e.g. an <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#IOError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">IOError</span></code></a>)
in more cases, instead of converting everything to <code class="docutils literal"><span class="pre">HTTPError</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-stack-context">
<h6><a class="reference internal" href="index.html#module-tornado.stack_context" title="tornado.stack_context"><code class="xref py py-obj docutils literal"><span class="pre">tornado.stack_context</span></code></a><a class="headerlink" href="#tornado-stack-context" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The stack context system now has less performance overhead when no
stack contexts are active.</li>
</ul>
</div>
<div class="section" id="tornado-tcpclient">
<h6><a class="reference internal" href="index.html#module-tornado.tcpclient" title="tornado.tcpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.tcpclient</span></code></a><a class="headerlink" href="#tornado-tcpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>New module which creates TCP connections and IOStreams, including
name resolution, connecting, and SSL handshakes.</li>
</ul>
</div>
<div class="section" id="tornado-testing">
<h6><a class="reference internal" href="index.html#module-tornado.testing" title="tornado.testing"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing</span></code></a><a class="headerlink" href="#tornado-testing" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.testing.AsyncTestCase" title="tornado.testing.AsyncTestCase"><code class="xref py py-obj docutils literal"><span class="pre">AsyncTestCase</span></code></a> now attempts to detect test methods that are generators
but were not run with <code class="docutils literal"><span class="pre">&#64;gen_test</span></code> or any similar decorator (this would
previously result in the test silently being skipped).</li>
<li>Better stack traces are now displayed when a test times out.</li>
<li>The <code class="docutils literal"><span class="pre">&#64;gen_test</span></code> decorator now passes along <code class="docutils literal"><span class="pre">*args,</span> <span class="pre">**kwargs</span></code> so it
can be used on functions with arguments.</li>
<li>Fixed the test suite when <code class="docutils literal"><span class="pre">unittest2</span></code> is installed on Python 3.</li>
</ul>
</div>
<div class="section" id="tornado-web">
<h6><a class="reference internal" href="index.html#module-tornado.web" title="tornado.web"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web</span></code></a><a class="headerlink" href="#tornado-web" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>It is now possible to support streaming request bodies with the
<a class="reference internal" href="index.html#tornado.web.stream_request_body" title="tornado.web.stream_request_body"><code class="xref py py-obj docutils literal"><span class="pre">stream_request_body</span></code></a> decorator and the new <a class="reference internal" href="index.html#tornado.web.RequestHandler.data_received" title="tornado.web.RequestHandler.data_received"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.data_received</span></code></a>
method.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.flush" title="tornado.web.RequestHandler.flush"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.flush</span></code></a> now returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> if no callback is given.</li>
<li>New exception <a class="reference internal" href="index.html#tornado.web.Finish" title="tornado.web.Finish"><code class="xref py py-obj docutils literal"><span class="pre">Finish</span></code></a> may be raised to finish a request without
triggering error handling.</li>
<li>When gzip support is enabled, all <code class="docutils literal"><span class="pre">text/*</span></code> mime types will be compressed,
not just those on a whitelist.</li>
<li><a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> now implements the <a class="reference internal" href="index.html#tornado.httputil.HTTPMessageDelegate" title="tornado.httputil.HTTPMessageDelegate"><code class="xref py py-obj docutils literal"><span class="pre">HTTPMessageDelegate</span></code></a> interface.</li>
<li><code class="docutils literal"><span class="pre">HEAD</span></code> requests in <a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> no longer read the entire file.</li>
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> now streams response bodies to the client.</li>
<li>New setting <code class="docutils literal"><span class="pre">compress_response</span></code> replaces the existing <code class="docutils literal"><span class="pre">gzip</span></code>
setting; both names are accepted.</li>
<li>XSRF cookies that were not generated by this module (i.e. strings without
any particular formatting) are once again accepted (as long as the
cookie and body/header match).  This pattern was common for
testing and non-browser clients but was broken by the changes in
Tornado 3.2.2.</li>
</ul>
</div>
<div class="section" id="tornado-websocket">
<h6><a class="reference internal" href="index.html#module-tornado.websocket" title="tornado.websocket"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket</span></code></a><a class="headerlink" href="#tornado-websocket" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>WebSocket connections from other origin sites are now rejected by default.
Browsers do not use the same-origin policy for WebSocket connections as they
do for most other browser-initiated communications.  This can be surprising
and a security risk, so we disallow these connections on the server side
by default.  To accept cross-origin websocket connections, override
the new method <a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler.check_origin" title="tornado.websocket.WebSocketHandler.check_origin"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler.check_origin</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler.close" title="tornado.websocket.WebSocketHandler.close"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler.close</span></code></a> and <a class="reference internal" href="index.html#tornado.websocket.WebSocketClientConnection.close" title="tornado.websocket.WebSocketClientConnection.close"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketClientConnection.close</span></code></a> now
support <code class="docutils literal"><span class="pre">code</span></code> and <code class="docutils literal"><span class="pre">reason</span></code> arguments to send a status code and
message to the other side of the connection when closing.  Both classes
also have <code class="docutils literal"><span class="pre">close_code</span></code> and <code class="docutils literal"><span class="pre">close_reason</span></code> attributes to receive these
values when the other side closes.</li>
<li>The C speedup module now builds correctly with MSVC, and can support
messages larger than 2GB on 64-bit systems.</li>
<li>The fallback mechanism for detecting a missing C compiler now
works correctly on Mac OS X.</li>
<li>Arguments to <a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler.open" title="tornado.websocket.WebSocketHandler.open"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler.open</span></code></a> are now decoded in the same way
as arguments to <a class="reference internal" href="index.html#tornado.web.RequestHandler.get" title="tornado.web.RequestHandler.get"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get</span></code></a> and similar methods.</li>
<li>It is now allowed to override <code class="docutils literal"><span class="pre">prepare</span></code> in a <a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler" title="tornado.websocket.WebSocketHandler"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler</span></code></a>,
and this method may generate HTTP responses (error pages) in the usual
way.  The HTTP response methods are still not allowed once the
WebSocket handshake has completed.</li>
</ul>
</div>
<div class="section" id="tornado-wsgi">
<h6><a class="reference internal" href="index.html#module-tornado.wsgi" title="tornado.wsgi"><code class="xref py py-obj docutils literal"><span class="pre">tornado.wsgi</span></code></a><a class="headerlink" href="#tornado-wsgi" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>New class <a class="reference internal" href="index.html#tornado.wsgi.WSGIAdapter" title="tornado.wsgi.WSGIAdapter"><code class="xref py py-obj docutils literal"><span class="pre">WSGIAdapter</span></code></a> supports running a Tornado <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> on
a WSGI server in a way that is more compatible with Tornado&#8217;s non-WSGI
<a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a>.  <a class="reference internal" href="index.html#tornado.wsgi.WSGIApplication" title="tornado.wsgi.WSGIApplication"><code class="xref py py-obj docutils literal"><span class="pre">WSGIApplication</span></code></a> is deprecated in favor of using
<a class="reference internal" href="index.html#tornado.wsgi.WSGIAdapter" title="tornado.wsgi.WSGIAdapter"><code class="xref py py-obj docutils literal"><span class="pre">WSGIAdapter</span></code></a> with a regular <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.wsgi.WSGIAdapter" title="tornado.wsgi.WSGIAdapter"><code class="xref py py-obj docutils literal"><span class="pre">WSGIAdapter</span></code></a> now supports gzipped output.</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v3.2.2"></span><div class="section" id="what-s-new-in-tornado-3-2-2">
<h4>What&#8217;s new in Tornado 3.2.2<a class="headerlink" href="#what-s-new-in-tornado-3-2-2" title="永久链接至标题">¶</a></h4>
<div class="section" id="june-3-2014">
<h5>June 3, 2014<a class="headerlink" href="#june-3-2014" title="永久链接至标题">¶</a></h5>
<div class="section" id="security-fixes">
<h6>Security fixes<a class="headerlink" href="#security-fixes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The XSRF token is now encoded with a random mask on each request.
This makes it safe to include in compressed pages without being
vulnerable to the <a class="reference external" href="http://breachattack.com">BREACH attack</a>.
This applies to most applications that use both the <code class="docutils literal"><span class="pre">xsrf_cookies</span></code>
and <code class="docutils literal"><span class="pre">gzip</span></code> options (or have gzip applied by a proxy).</li>
</ul>
</div>
<div class="section" id="backwards-compatibility-notes">
<h6>Backwards-compatibility notes<a class="headerlink" href="#backwards-compatibility-notes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>If Tornado 3.2.2 is run at the same time as older versions on the same
domain, there is some potential for issues with the differing cookie
versions.  The <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> setting <code class="docutils literal"><span class="pre">xsrf_cookie_version=1</span></code> can
be used for a transitional period to generate the older cookie format
on newer servers.</li>
</ul>
</div>
<div class="section" id="other-changes">
<h6>Other changes<a class="headerlink" href="#other-changes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">tornado.platform.asyncio</span></code> is now compatible with <code class="docutils literal"><span class="pre">trollius</span></code> version 0.3.</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v3.2.1"></span><div class="section" id="what-s-new-in-tornado-3-2-1">
<h4>What&#8217;s new in Tornado 3.2.1<a class="headerlink" href="#what-s-new-in-tornado-3-2-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="may-5-2014">
<h5>May 5, 2014<a class="headerlink" href="#may-5-2014" title="永久链接至标题">¶</a></h5>
<div class="section" id="security-fixes">
<h6>Security fixes<a class="headerlink" href="#security-fixes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The signed-value format used by <a class="reference internal" href="index.html#tornado.web.RequestHandler.set_secure_cookie" title="tornado.web.RequestHandler.set_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.set_secure_cookie</span></code></a>
and <a class="reference internal" href="index.html#tornado.web.RequestHandler.get_secure_cookie" title="tornado.web.RequestHandler.get_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_secure_cookie</span></code></a> has changed to be more secure.
<strong>This is a disruptive change</strong>.  The <code class="docutils literal"><span class="pre">secure_cookie</span></code> functions
take new <code class="docutils literal"><span class="pre">version</span></code> parameters to support transitions between cookie
formats.</li>
<li>The new cookie format fixes a vulnerability that may be present in
applications that use multiple cookies where the name of one cookie
is a prefix of the name of another.</li>
<li>To minimize disruption, cookies in the older format will be accepted
by default until they expire.  Applications that may be vulnerable
can reject all cookies in the older format by passing <code class="docutils literal"><span class="pre">min_version=2</span></code>
to <a class="reference internal" href="index.html#tornado.web.RequestHandler.get_secure_cookie" title="tornado.web.RequestHandler.get_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_secure_cookie</span></code></a>.</li>
<li>Thanks to Joost Pol of <a class="reference external" href="https://www.certifiedsecure.com">Certified Secure</a>
for reporting this issue.</li>
</ul>
</div>
<div class="section" id="backwards-compatibility-notes">
<h6>Backwards-compatibility notes<a class="headerlink" href="#backwards-compatibility-notes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Signed cookies issued by <a class="reference internal" href="index.html#tornado.web.RequestHandler.set_secure_cookie" title="tornado.web.RequestHandler.set_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.set_secure_cookie</span></code></a> in Tornado
3.2.1 cannot be read by older releases.  If you need to run 3.2.1
in parallel with older releases, you can pass <code class="docutils literal"><span class="pre">version=1</span></code> to
<a class="reference internal" href="index.html#tornado.web.RequestHandler.set_secure_cookie" title="tornado.web.RequestHandler.set_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.set_secure_cookie</span></code></a> to issue cookies that are
backwards-compatible (but have a known weakness, so this option
should only be used for a transitional period).</li>
</ul>
</div>
<div class="section" id="other-changes">
<h6>Other changes<a class="headerlink" href="#other-changes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The C extension used to speed up the websocket module now compiles
correctly on Windows with MSVC and 64-bit mode.  The fallback to
the pure-Python alternative now works correctly on Mac OS X machines
with no C compiler installed.</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v3.2.0"></span><div class="section" id="what-s-new-in-tornado-3-2">
<h4>What&#8217;s new in Tornado 3.2<a class="headerlink" href="#what-s-new-in-tornado-3-2" title="永久链接至标题">¶</a></h4>
<div class="section" id="jan-14-2014">
<h5>Jan 14, 2014<a class="headerlink" href="#jan-14-2014" title="永久链接至标题">¶</a></h5>
<div class="section" id="installation">
<h6>Installation<a class="headerlink" href="#installation" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Tornado now depends on the <a class="reference external" href="https://pypi.python.org/pypi/backports.ssl_match_hostname">backports.ssl_match_hostname</a> when
running on Python 2.  This will be installed automatically when using <code class="docutils literal"><span class="pre">pip</span></code>
or <code class="docutils literal"><span class="pre">easy_install</span></code></li>
<li>Tornado now includes an optional C extension module, which greatly improves
performance of websockets.  This extension will be built automatically
if a C compiler is found at install time.</li>
</ul>
</div>
<div class="section" id="new-modules">
<h6>New modules<a class="headerlink" href="#new-modules" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The <a class="reference internal" href="index.html#module-tornado.platform.asyncio" title="tornado.platform.asyncio"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.asyncio</span></code></a> module provides integration with the
<code class="docutils literal"><span class="pre">asyncio</span></code> module introduced in Python 3.4 (also available for Python
3.3 with <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">asyncio</span></code>).</li>
</ul>
</div>
<div class="section" id="tornado-auth">
<h6><a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a><a class="headerlink" href="#tornado-auth" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Added <a class="reference internal" href="index.html#tornado.auth.GoogleOAuth2Mixin" title="tornado.auth.GoogleOAuth2Mixin"><code class="xref py py-obj docutils literal"><span class="pre">GoogleOAuth2Mixin</span></code></a> support authentication to Google services
with OAuth 2 instead of OpenID and OAuth 1.</li>
<li><a class="reference internal" href="index.html#tornado.auth.FacebookGraphMixin" title="tornado.auth.FacebookGraphMixin"><code class="xref py py-obj docutils literal"><span class="pre">FacebookGraphMixin</span></code></a> has been updated to use the current Facebook login
URL, which saves a redirect.</li>
</ul>
</div>
<div class="section" id="tornado-concurrent">
<h6><a class="reference internal" href="index.html#module-tornado.concurrent" title="tornado.concurrent"><code class="xref py py-obj docutils literal"><span class="pre">tornado.concurrent</span></code></a><a class="headerlink" href="#tornado-concurrent" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">TracebackFuture</span></code> now accepts a <code class="docutils literal"><span class="pre">timeout</span></code> keyword argument (although
it is still incorrect to use a non-zero timeout in non-blocking code).</li>
</ul>
</div>
<div class="section" id="tornado-curl-httpclient">
<h6><code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code><a class="headerlink" href="#tornado-curl-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code> now works on Python 3 with the
soon-to-be-released pycurl 7.19.3, which will officially support
Python 3 for the first time.  Note that there are some unofficial
Python 3 ports of pycurl (Ubuntu has included one for its past
several releases); these are not supported for use with Tornado.</li>
</ul>
</div>
<div class="section" id="tornado-escape">
<h6><a class="reference internal" href="index.html#module-tornado.escape" title="tornado.escape"><code class="xref py py-obj docutils literal"><span class="pre">tornado.escape</span></code></a><a class="headerlink" href="#tornado-escape" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.escape.xhtml_escape" title="tornado.escape.xhtml_escape"><code class="xref py py-obj docutils literal"><span class="pre">xhtml_escape</span></code></a> now escapes apostrophes as well.</li>
<li><a class="reference internal" href="index.html#tornado.escape.utf8" title="tornado.escape.utf8"><code class="xref py py-obj docutils literal"><span class="pre">tornado.escape.utf8</span></code></a>, <a class="reference internal" href="index.html#tornado.escape.to_unicode" title="tornado.escape.to_unicode"><code class="xref py py-obj docutils literal"><span class="pre">to_unicode</span></code></a>, and <a class="reference internal" href="index.html#tornado.escape.native_str" title="tornado.escape.native_str"><code class="xref py py-obj docutils literal"><span class="pre">native_str</span></code></a> now raise
<a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#TypeError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">TypeError</span></code></a> instead of <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#AssertionError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">AssertionError</span></code></a> when given an invalid value.</li>
</ul>
</div>
<div class="section" id="tornado-gen">
<h6><a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a><a class="headerlink" href="#tornado-gen" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Coroutines may now yield dicts in addition to lists to wait for
multiple tasks in parallel.</li>
<li>Improved performance of <a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a> when yielding a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> that is
already done.</li>
</ul>
</div>
<div class="section" id="tornado-httpclient">
<h6><a class="reference internal" href="index.html#module-tornado.httpclient" title="tornado.httpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient</span></code></a><a class="headerlink" href="#tornado-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient.HTTPRequest</span></code></a> now uses property setters so that
setting attributes after construction applies the same conversions
as <code class="docutils literal"><span class="pre">__init__</span></code> (e.g. converting the body attribute to bytes).</li>
</ul>
</div>
<div class="section" id="tornado-httpserver">
<h6><a class="reference internal" href="index.html#module-tornado.httpserver" title="tornado.httpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpserver</span></code></a><a class="headerlink" href="#tornado-httpserver" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Malformed <code class="docutils literal"><span class="pre">x-www-form-urlencoded</span></code> request bodies will now log a warning
and continue instead of causing the request to fail (similar to the existing
handling of malformed <code class="docutils literal"><span class="pre">multipart/form-data</span></code> bodies.  This is done mainly
because some libraries send this content type by default even when the data
is not form-encoded.</li>
<li>Fix some error messages for unix sockets (and other non-IP sockets)</li>
</ul>
</div>
<div class="section" id="tornado-ioloop">
<h6><a class="reference internal" href="index.html#module-tornado.ioloop" title="tornado.ioloop"><code class="xref py py-obj docutils literal"><span class="pre">tornado.ioloop</span></code></a><a class="headerlink" href="#tornado-ioloop" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> now uses <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.handle_callback_exception" title="tornado.ioloop.IOLoop.handle_callback_exception"><code class="xref py py-obj docutils literal"><span class="pre">handle_callback_exception</span></code></a> consistently for
error logging.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> now frees callback objects earlier, reducing memory usage
while idle.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> will no longer call <a class="reference external" href="https://docs.python.org/3.4/library/logging.html#logging.basicConfig" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">logging.basicConfig</span></code></a> if there is a handler
defined for the root logger or for the <code class="docutils literal"><span class="pre">tornado</span></code> or <code class="docutils literal"><span class="pre">tornado.application</span></code>
loggers (previously it only looked at the root logger).</li>
</ul>
</div>
<div class="section" id="tornado-iostream">
<h6><a class="reference internal" href="index.html#module-tornado.iostream" title="tornado.iostream"><code class="xref py py-obj docutils literal"><span class="pre">tornado.iostream</span></code></a><a class="headerlink" href="#tornado-iostream" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> now recognizes <code class="docutils literal"><span class="pre">ECONNABORTED</span></code> error codes in more places
(which was mainly an issue on Windows).</li>
<li><a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> now frees memory earlier if a connection is closed while
there is data in the write buffer.</li>
<li><a class="reference internal" href="index.html#tornado.iostream.PipeIOStream" title="tornado.iostream.PipeIOStream"><code class="xref py py-obj docutils literal"><span class="pre">PipeIOStream</span></code></a> now handles <code class="docutils literal"><span class="pre">EAGAIN</span></code> error codes correctly.</li>
<li><a class="reference internal" href="index.html#tornado.iostream.SSLIOStream" title="tornado.iostream.SSLIOStream"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream</span></code></a> now initiates the SSL handshake automatically without
waiting for the application to try and read or write to the connection.</li>
<li>Swallow a spurious exception from <code class="docutils literal"><span class="pre">set_nodelay</span></code> when a connection
has been reset.</li>
</ul>
</div>
<div class="section" id="tornado-locale">
<h6><a class="reference internal" href="index.html#module-tornado.locale" title="tornado.locale"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locale</span></code></a><a class="headerlink" href="#tornado-locale" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.locale.Locale.format_date" title="tornado.locale.Locale.format_date"><code class="xref py py-obj docutils literal"><span class="pre">Locale.format_date</span></code></a> no longer forces the use of absolute
dates in Russian.</li>
</ul>
</div>
<div class="section" id="tornado-log">
<h6><a class="reference internal" href="index.html#module-tornado.log" title="tornado.log"><code class="xref py py-obj docutils literal"><span class="pre">tornado.log</span></code></a><a class="headerlink" href="#tornado-log" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Fix an error from <a class="reference internal" href="index.html#tornado.log.enable_pretty_logging" title="tornado.log.enable_pretty_logging"><code class="xref py py-obj docutils literal"><span class="pre">tornado.log.enable_pretty_logging</span></code></a> when
<a class="reference external" href="https://docs.python.org/3.4/library/sys.html#sys.stderr" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">sys.stderr</span></code></a> does not have an <code class="docutils literal"><span class="pre">isatty</span></code> method.</li>
<li><a class="reference internal" href="index.html#tornado.log.LogFormatter" title="tornado.log.LogFormatter"><code class="xref py py-obj docutils literal"><span class="pre">tornado.log.LogFormatter</span></code></a> now accepts keyword arguments <code class="docutils literal"><span class="pre">fmt</span></code>
and <code class="docutils literal"><span class="pre">datefmt</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-netutil">
<h6><a class="reference internal" href="index.html#module-tornado.netutil" title="tornado.netutil"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil</span></code></a><a class="headerlink" href="#tornado-netutil" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.netutil.is_valid_ip" title="tornado.netutil.is_valid_ip"><code class="xref py py-obj docutils literal"><span class="pre">is_valid_ip</span></code></a> (and therefore <code class="docutils literal"><span class="pre">HTTPRequest.remote_ip</span></code>) now rejects
empty strings.</li>
<li>Synchronously using <a class="reference internal" href="index.html#tornado.netutil.ThreadedResolver" title="tornado.netutil.ThreadedResolver"><code class="xref py py-obj docutils literal"><span class="pre">ThreadedResolver</span></code></a> at import time to resolve
a unicode hostname no longer deadlocks.</li>
</ul>
</div>
<div class="section" id="tornado-platform-twisted">
<h6><a class="reference internal" href="index.html#module-tornado.platform.twisted" title="tornado.platform.twisted"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.twisted</span></code></a><a class="headerlink" href="#tornado-platform-twisted" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.platform.twisted.TwistedResolver" title="tornado.platform.twisted.TwistedResolver"><code class="xref py py-obj docutils literal"><span class="pre">TwistedResolver</span></code></a> now has better error handling.</li>
</ul>
</div>
<div class="section" id="tornado-process">
<h6><a class="reference internal" href="index.html#module-tornado.process" title="tornado.process"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process</span></code></a><a class="headerlink" href="#tornado-process" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.process.Subprocess" title="tornado.process.Subprocess"><code class="xref py py-obj docutils literal"><span class="pre">Subprocess</span></code></a> no longer leaks file descriptors if <a class="reference external" href="https://docs.python.org/3.4/library/subprocess.html#subprocess.Popen" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">subprocess.Popen</span></code></a> fails.</li>
</ul>
</div>
<div class="section" id="tornado-simple-httpclient">
<h6><code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code><a class="headerlink" href="#tornado-simple-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">simple_httpclient</span></code> now applies the <code class="docutils literal"><span class="pre">connect_timeout</span></code> to requests
that are queued and have not yet started.</li>
<li>On Python 2.6, <code class="docutils literal"><span class="pre">simple_httpclient</span></code> now uses TLSv1 instead of SSLv3.</li>
<li><code class="docutils literal"><span class="pre">simple_httpclient</span></code> now enforces the connect timeout during DNS resolution.</li>
<li>The embedded <code class="docutils literal"><span class="pre">ca-certificates.crt</span></code> file has been updated with the current
Mozilla CA list.</li>
</ul>
</div>
<div class="section" id="tornado-web">
<h6><a class="reference internal" href="index.html#module-tornado.web" title="tornado.web"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web</span></code></a><a class="headerlink" href="#tornado-web" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> no longer fails if the client requests a <code class="docutils literal"><span class="pre">Range</span></code> that
is larger than the entire file (Facebook has a crawler that does this).</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.on_connection_close" title="tornado.web.RequestHandler.on_connection_close"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.on_connection_close</span></code></a> now works correctly on subsequent
requests of a keep-alive connection.</li>
<li>New application setting <code class="docutils literal"><span class="pre">default_handler_class</span></code> can be used to easily
set up custom 404 pages.</li>
<li>New application settings <code class="docutils literal"><span class="pre">autoreload</span></code>, <code class="docutils literal"><span class="pre">compiled_template_cache</span></code>,
<code class="docutils literal"><span class="pre">static_hash_cache</span></code>, and <code class="docutils literal"><span class="pre">serve_traceback</span></code> can be used to control
individual aspects of debug mode.</li>
<li>New methods <a class="reference internal" href="index.html#tornado.web.RequestHandler.get_query_argument" title="tornado.web.RequestHandler.get_query_argument"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_query_argument</span></code></a> and
<a class="reference internal" href="index.html#tornado.web.RequestHandler.get_body_argument" title="tornado.web.RequestHandler.get_body_argument"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_body_argument</span></code></a> and new attributes
<code class="docutils literal"><span class="pre">HTTPRequest.query_arguments</span></code> and <code class="docutils literal"><span class="pre">HTTPRequest.body_arguments</span></code> allow access
to arguments without intermingling those from the query string with those
from the request body.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.decode_argument" title="tornado.web.RequestHandler.decode_argument"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.decode_argument</span></code></a> and related methods now raise
an <code class="docutils literal"><span class="pre">HTTPError(400)</span></code> instead of <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#UnicodeDecodeError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">UnicodeDecodeError</span></code></a> when the
argument could not be decoded.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.clear_all_cookies" title="tornado.web.RequestHandler.clear_all_cookies"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.clear_all_cookies</span></code></a> now accepts <code class="docutils literal"><span class="pre">domain</span></code> and <code class="docutils literal"><span class="pre">path</span></code>
arguments, just like <a class="reference internal" href="index.html#tornado.web.RequestHandler.clear_cookie" title="tornado.web.RequestHandler.clear_cookie"><code class="xref py py-obj docutils literal"><span class="pre">clear_cookie</span></code></a>.</li>
<li>It is now possible to specify handlers by name when using the <a class="reference internal" href="index.html#tornado.web.URLSpec" title="tornado.web.URLSpec"><code class="xref py py-obj docutils literal"><span class="pre">URLSpec</span></code></a>
class.</li>
<li><a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> now accepts 4-tuples to specify the <code class="docutils literal"><span class="pre">name</span></code> parameter
(which previously required constructing a <a class="reference internal" href="index.html#tornado.web.URLSpec" title="tornado.web.URLSpec"><code class="xref py py-obj docutils literal"><span class="pre">URLSpec</span></code></a> object instead of
a tuple).</li>
<li>Fixed an incorrect error message when handler methods return a value
other than None or a Future.</li>
<li>Exceptions will no longer be logged twice when using both <code class="docutils literal"><span class="pre">&#64;asynchronous</span></code>
and <code class="docutils literal"><span class="pre">&#64;gen.coroutine</span></code></li>
</ul>
</div>
<div class="section" id="tornado-websocket">
<h6><a class="reference internal" href="index.html#module-tornado.websocket" title="tornado.websocket"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket</span></code></a><a class="headerlink" href="#tornado-websocket" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler.write_message" title="tornado.websocket.WebSocketHandler.write_message"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler.write_message</span></code></a> now raises <a class="reference internal" href="index.html#tornado.websocket.WebSocketClosedError" title="tornado.websocket.WebSocketClosedError"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketClosedError</span></code></a> instead
of <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#AttributeError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">AttributeError</span></code></a> when the connection has been closed.</li>
<li><a class="reference internal" href="index.html#tornado.websocket.websocket_connect" title="tornado.websocket.websocket_connect"><code class="xref py py-obj docutils literal"><span class="pre">websocket_connect</span></code></a> now accepts preconstructed <code class="docutils literal"><span class="pre">HTTPRequest</span></code> objects.</li>
<li>Fix a bug with <a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler" title="tornado.websocket.WebSocketHandler"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler</span></code></a> when used with some proxies that
unconditionally modify the <code class="docutils literal"><span class="pre">Connection</span></code> header.</li>
<li><a class="reference internal" href="index.html#tornado.websocket.websocket_connect" title="tornado.websocket.websocket_connect"><code class="xref py py-obj docutils literal"><span class="pre">websocket_connect</span></code></a> now returns an error immediately for refused connections
instead of waiting for the timeout.</li>
<li><a class="reference internal" href="index.html#tornado.websocket.WebSocketClientConnection" title="tornado.websocket.WebSocketClientConnection"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketClientConnection</span></code></a> now has a <code class="docutils literal"><span class="pre">close</span></code> method.</li>
</ul>
</div>
<div class="section" id="tornado-wsgi">
<h6><a class="reference internal" href="index.html#module-tornado.wsgi" title="tornado.wsgi"><code class="xref py py-obj docutils literal"><span class="pre">tornado.wsgi</span></code></a><a class="headerlink" href="#tornado-wsgi" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.wsgi.WSGIContainer" title="tornado.wsgi.WSGIContainer"><code class="xref py py-obj docutils literal"><span class="pre">WSGIContainer</span></code></a> now calls the iterable&#8217;s <code class="docutils literal"><span class="pre">close()</span></code> method even if
an error is raised, in compliance with the spec.</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v3.1.1"></span><div class="section" id="what-s-new-in-tornado-3-1-1">
<h4>What&#8217;s new in Tornado 3.1.1<a class="headerlink" href="#what-s-new-in-tornado-3-1-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="sep-1-2013">
<h5>Sep 1, 2013<a class="headerlink" href="#sep-1-2013" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> no longer fails if the client requests a <code class="docutils literal"><span class="pre">Range</span></code> that
is larger than the entire file (Facebook has a crawler that does this).</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.on_connection_close" title="tornado.web.RequestHandler.on_connection_close"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.on_connection_close</span></code></a> now works correctly on subsequent
requests of a keep-alive connection.</li>
</ul>
</div>
</div>
<span id="document-releases/v3.1.0"></span><div class="section" id="what-s-new-in-tornado-3-1">
<h4>What&#8217;s new in Tornado 3.1<a class="headerlink" href="#what-s-new-in-tornado-3-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="jun-15-2013">
<h5>Jun 15, 2013<a class="headerlink" href="#jun-15-2013" title="永久链接至标题">¶</a></h5>
<div class="section" id="multiple-modules">
<h6>Multiple modules<a class="headerlink" href="#multiple-modules" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Many reference cycles have been broken up throughout the package,
allowing for more efficient garbage collection on CPython.</li>
<li>Silenced some log messages when connections are opened and immediately
closed (i.e. port scans), or other situations related to closed
connections.</li>
<li>Various small speedups: <a class="reference internal" href="index.html#tornado.httputil.HTTPHeaders" title="tornado.httputil.HTTPHeaders"><code class="xref py py-obj docutils literal"><span class="pre">HTTPHeaders</span></code></a> case normalization, <a class="reference internal" href="index.html#tornado.web.UIModule" title="tornado.web.UIModule"><code class="xref py py-obj docutils literal"><span class="pre">UIModule</span></code></a>
proxy objects, precompile some regexes.</li>
</ul>
</div>
<div class="section" id="tornado-auth">
<h6><a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a><a class="headerlink" href="#tornado-auth" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.auth.OAuthMixin" title="tornado.auth.OAuthMixin"><code class="xref py py-obj docutils literal"><span class="pre">OAuthMixin</span></code></a> always sends <code class="docutils literal"><span class="pre">oauth_version=1.0</span></code> in its
request as required by the spec.</li>
<li><a class="reference internal" href="index.html#tornado.auth.FacebookGraphMixin" title="tornado.auth.FacebookGraphMixin"><code class="xref py py-obj docutils literal"><span class="pre">FacebookGraphMixin</span></code></a> now uses <code class="docutils literal"><span class="pre">self._FACEBOOK_BASE_URL</span></code>
in <a class="reference internal" href="index.html#tornado.auth.FacebookGraphMixin.facebook_request" title="tornado.auth.FacebookGraphMixin.facebook_request"><code class="xref py py-obj docutils literal"><span class="pre">facebook_request</span></code></a> to allow the base url to be
overridden.</li>
<li>The <code class="docutils literal"><span class="pre">authenticate_redirect</span></code> and <code class="docutils literal"><span class="pre">authorize_redirect</span></code> methods in the
<a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a> mixin classes all now return Futures.  These methods
are asynchronous in <a class="reference internal" href="index.html#tornado.auth.OAuthMixin" title="tornado.auth.OAuthMixin"><code class="xref py py-obj docutils literal"><span class="pre">OAuthMixin</span></code></a> and derived classes, although they
do not take a callback.  The <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> these methods return must be
yielded if they are called from a function decorated with <a class="reference internal" href="index.html#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">gen.coroutine</span></code></a>
(but not <a class="reference internal" href="index.html#tornado.gen.engine" title="tornado.gen.engine"><code class="xref py py-obj docutils literal"><span class="pre">gen.engine</span></code></a>).</li>
<li><a class="reference internal" href="index.html#tornado.auth.TwitterMixin" title="tornado.auth.TwitterMixin"><code class="xref py py-obj docutils literal"><span class="pre">TwitterMixin</span></code></a> now uses <code class="docutils literal"><span class="pre">/account/verify_credentials</span></code> to get information
about the logged-in user, which is more robust against changing screen
names.</li>
<li>The <code class="docutils literal"><span class="pre">demos</span></code> directory (in the source distribution) has a new
<code class="docutils literal"><span class="pre">twitter</span></code> demo using <a class="reference internal" href="index.html#tornado.auth.TwitterMixin" title="tornado.auth.TwitterMixin"><code class="xref py py-obj docutils literal"><span class="pre">TwitterMixin</span></code></a>.</li>
</ul>
</div>
<div class="section" id="tornado-escape">
<h6><a class="reference internal" href="index.html#module-tornado.escape" title="tornado.escape"><code class="xref py py-obj docutils literal"><span class="pre">tornado.escape</span></code></a><a class="headerlink" href="#tornado-escape" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.escape.url_escape" title="tornado.escape.url_escape"><code class="xref py py-obj docutils literal"><span class="pre">url_escape</span></code></a> and <a class="reference internal" href="index.html#tornado.escape.url_unescape" title="tornado.escape.url_unescape"><code class="xref py py-obj docutils literal"><span class="pre">url_unescape</span></code></a> have a new <code class="docutils literal"><span class="pre">plus</span></code> argument (defaulting
to True for consistency with the previous behavior) which specifies
whether they work like <a class="reference external" href="https://docs.python.org/3.4/library/urllib.parse.html#urllib.parse.unquote" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">urllib.parse.unquote</span></code></a> or <a class="reference external" href="https://docs.python.org/3.4/library/urllib.parse.html#urllib.parse.unquote_plus" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">urllib.parse.unquote_plus</span></code></a>.</li>
</ul>
</div>
<div class="section" id="tornado-gen">
<h6><a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a><a class="headerlink" href="#tornado-gen" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Fixed a potential memory leak with long chains of <a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a> coroutines.</li>
</ul>
</div>
<div class="section" id="tornado-httpclient">
<h6><a class="reference internal" href="index.html#module-tornado.httpclient" title="tornado.httpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient</span></code></a><a class="headerlink" href="#tornado-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient.HTTPRequest</span></code></a> takes a new argument <code class="docutils literal"><span class="pre">auth_mode</span></code>,
which can be either <code class="docutils literal"><span class="pre">basic</span></code> or <code class="docutils literal"><span class="pre">digest</span></code>.  Digest authentication
is only supported with <code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code>.</li>
<li><code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code> no longer goes into an infinite loop when
pycurl returns a negative timeout.</li>
<li><code class="docutils literal"><span class="pre">curl_httpclient</span></code> now supports the <code class="docutils literal"><span class="pre">PATCH</span></code> and <code class="docutils literal"><span class="pre">OPTIONS</span></code> methods
without the use of <code class="docutils literal"><span class="pre">allow_nonstandard_methods=True</span></code>.</li>
<li>Worked around a class of bugs in libcurl that would result in
errors from <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.update_handler" title="tornado.ioloop.IOLoop.update_handler"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.update_handler</span></code></a> in various scenarios including
digest authentication and socks proxies.</li>
<li>The <code class="docutils literal"><span class="pre">TCP_NODELAY</span></code> flag is now set when appropriate in <code class="docutils literal"><span class="pre">simple_httpclient</span></code>.</li>
<li><code class="docutils literal"><span class="pre">simple_httpclient</span></code> no longer logs exceptions, since those exceptions
are made available to the caller as <code class="docutils literal"><span class="pre">HTTPResponse.error</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-httpserver">
<h6><a class="reference internal" href="index.html#module-tornado.httpserver" title="tornado.httpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpserver</span></code></a><a class="headerlink" href="#tornado-httpserver" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpserver.HTTPServer</span></code></a> handles malformed HTTP headers more
gracefully.</li>
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> now supports lists of IPs in <code class="docutils literal"><span class="pre">X-Forwarded-For</span></code>
(it chooses the last, i.e. nearest one).</li>
<li>Memory is now reclaimed promptly on CPython when an HTTP request
fails because it exceeded the maximum upload size.</li>
<li>The <code class="docutils literal"><span class="pre">TCP_NODELAY</span></code> flag is now set when appropriate in <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a>.</li>
<li>The <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> <code class="docutils literal"><span class="pre">no_keep_alive</span></code> option is now respected with
HTTP 1.0 connections that explicitly pass <code class="docutils literal"><span class="pre">Connection:</span> <span class="pre">keep-alive</span></code>.</li>
<li>The <code class="docutils literal"><span class="pre">Connection:</span> <span class="pre">keep-alive</span></code> check for HTTP 1.0 connections is now
case-insensitive.</li>
<li>The <a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#str" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">str</span></code></a> and <a class="reference external" href="https://docs.python.org/3.4/library/functions.html#repr" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">repr</span></code></a> of <code class="docutils literal"><span class="pre">tornado.httpserver.HTTPRequest</span></code> no longer
include the request body, reducing log spam on errors (and potential
exposure/retention of private data).</li>
</ul>
</div>
<div class="section" id="tornado-httputil">
<h6><a class="reference internal" href="index.html#module-tornado.httputil" title="tornado.httputil"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httputil</span></code></a><a class="headerlink" href="#tornado-httputil" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The cache used in <a class="reference internal" href="index.html#tornado.httputil.HTTPHeaders" title="tornado.httputil.HTTPHeaders"><code class="xref py py-obj docutils literal"><span class="pre">HTTPHeaders</span></code></a> will no longer grow without bound.</li>
</ul>
</div>
<div class="section" id="tornado-ioloop">
<h6><a class="reference internal" href="index.html#module-tornado.ioloop" title="tornado.ioloop"><code class="xref py py-obj docutils literal"><span class="pre">tornado.ioloop</span></code></a><a class="headerlink" href="#tornado-ioloop" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Some <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> implementations (such as <code class="docutils literal"><span class="pre">pyzmq</span></code>) accept objects
other than integer file descriptors; these objects will now have
their <code class="docutils literal"><span class="pre">.close()</span></code> method called when the <code class="docutils literal"><span class="pre">IOLoop`</span> <span class="pre">is</span> <span class="pre">closed</span> <span class="pre">with</span>
<span class="pre">``all_fds=True</span></code>.</li>
<li>The stub handles left behind by <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.remove_timeout" title="tornado.ioloop.IOLoop.remove_timeout"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.remove_timeout</span></code></a> will now get
cleaned up instead of waiting to expire.</li>
</ul>
</div>
<div class="section" id="tornado-iostream">
<h6><a class="reference internal" href="index.html#module-tornado.iostream" title="tornado.iostream"><code class="xref py py-obj docutils literal"><span class="pre">tornado.iostream</span></code></a><a class="headerlink" href="#tornado-iostream" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Fixed a bug in <a class="reference internal" href="index.html#tornado.iostream.BaseIOStream.read_until_close" title="tornado.iostream.BaseIOStream.read_until_close"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream.read_until_close</span></code></a> that would sometimes
cause data to be passed to the final callback instead of the streaming
callback.</li>
<li>The <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> close callback is now run more reliably if there is
an exception in <code class="docutils literal"><span class="pre">_try_inline_read</span></code>.</li>
<li>New method <a class="reference internal" href="index.html#tornado.iostream.BaseIOStream.set_nodelay" title="tornado.iostream.BaseIOStream.set_nodelay"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream.set_nodelay</span></code></a> can be used to set the
<code class="docutils literal"><span class="pre">TCP_NODELAY</span></code> flag.</li>
<li>Fixed a case where errors in <code class="docutils literal"><span class="pre">SSLIOStream.connect</span></code> (and
<code class="docutils literal"><span class="pre">SimpleAsyncHTTPClient</span></code>) were not being reported correctly.</li>
</ul>
</div>
<div class="section" id="tornado-locale">
<h6><a class="reference internal" href="index.html#module-tornado.locale" title="tornado.locale"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locale</span></code></a><a class="headerlink" href="#tornado-locale" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.locale.Locale.format_date" title="tornado.locale.Locale.format_date"><code class="xref py py-obj docutils literal"><span class="pre">Locale.format_date</span></code></a> now works on Python 3.</li>
</ul>
</div>
<div class="section" id="tornado-netutil">
<h6><a class="reference internal" href="index.html#module-tornado.netutil" title="tornado.netutil"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil</span></code></a><a class="headerlink" href="#tornado-netutil" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The default <a class="reference internal" href="index.html#tornado.netutil.Resolver" title="tornado.netutil.Resolver"><code class="xref py py-obj docutils literal"><span class="pre">Resolver</span></code></a> implementation now works on Solaris.</li>
<li><a class="reference internal" href="index.html#tornado.netutil.Resolver" title="tornado.netutil.Resolver"><code class="xref py py-obj docutils literal"><span class="pre">Resolver</span></code></a> now has a <a class="reference internal" href="index.html#tornado.netutil.Resolver.close" title="tornado.netutil.Resolver.close"><code class="xref py py-obj docutils literal"><span class="pre">close</span></code></a> method.</li>
<li>Fixed a potential CPU DoS when <code class="docutils literal"><span class="pre">tornado.netutil.ssl_match_hostname</span></code>
is used on certificates with an abusive wildcard pattern.</li>
<li>All instances of <a class="reference internal" href="index.html#tornado.netutil.ThreadedResolver" title="tornado.netutil.ThreadedResolver"><code class="xref py py-obj docutils literal"><span class="pre">ThreadedResolver</span></code></a> now share a single thread pool,
whose size is set by the first one to be created (or the static
<code class="docutils literal"><span class="pre">Resolver.configure</span></code> method).</li>
<li><a class="reference internal" href="index.html#tornado.netutil.ExecutorResolver" title="tornado.netutil.ExecutorResolver"><code class="xref py py-obj docutils literal"><span class="pre">ExecutorResolver</span></code></a> is now documented for public use.</li>
<li><a class="reference internal" href="index.html#tornado.netutil.bind_sockets" title="tornado.netutil.bind_sockets"><code class="xref py py-obj docutils literal"><span class="pre">bind_sockets</span></code></a> now works in configurations with incomplete IPv6 support.</li>
</ul>
</div>
<div class="section" id="tornado-options">
<h6><a class="reference internal" href="index.html#module-tornado.options" title="tornado.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options</span></code></a><a class="headerlink" href="#tornado-options" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.options.define" title="tornado.options.define"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.define</span></code></a> with <code class="docutils literal"><span class="pre">multiple=True</span></code> now works on Python 3.</li>
<li><a class="reference internal" href="index.html#tornado.options.options" title="tornado.options.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.options</span></code></a> and other <a class="reference internal" href="index.html#tornado.options.OptionParser" title="tornado.options.OptionParser"><code class="xref py py-obj docutils literal"><span class="pre">OptionParser</span></code></a> instances support some
new dict-like methods: <a class="reference internal" href="index.html#tornado.options.OptionParser.items" title="tornado.options.OptionParser.items"><code class="xref py py-obj docutils literal"><span class="pre">items()</span></code></a>, iteration over keys,
and (read-only) access to options with square braket syntax.
<a class="reference internal" href="index.html#tornado.options.OptionParser.group_dict" title="tornado.options.OptionParser.group_dict"><code class="xref py py-obj docutils literal"><span class="pre">OptionParser.group_dict</span></code></a> returns all options with a given group
name, and <a class="reference internal" href="index.html#tornado.options.OptionParser.as_dict" title="tornado.options.OptionParser.as_dict"><code class="xref py py-obj docutils literal"><span class="pre">OptionParser.as_dict</span></code></a> returns all options.</li>
</ul>
</div>
<div class="section" id="tornado-process">
<h6><a class="reference internal" href="index.html#module-tornado.process" title="tornado.process"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process</span></code></a><a class="headerlink" href="#tornado-process" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.process.Subprocess" title="tornado.process.Subprocess"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process.Subprocess</span></code></a> no longer leaks file descriptors into
the child process, which fixes a problem in which the child could not
detect that the parent process had closed its stdin pipe.</li>
<li><a class="reference internal" href="index.html#tornado.process.Subprocess.set_exit_callback" title="tornado.process.Subprocess.set_exit_callback"><code class="xref py py-obj docutils literal"><span class="pre">Subprocess.set_exit_callback</span></code></a> now works for subprocesses created
without an explicit <code class="docutils literal"><span class="pre">io_loop</span></code> parameter.</li>
</ul>
</div>
<div class="section" id="tornado-stack-context">
<h6><a class="reference internal" href="index.html#module-tornado.stack_context" title="tornado.stack_context"><code class="xref py py-obj docutils literal"><span class="pre">tornado.stack_context</span></code></a><a class="headerlink" href="#tornado-stack-context" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#module-tornado.stack_context" title="tornado.stack_context"><code class="xref py py-obj docutils literal"><span class="pre">tornado.stack_context</span></code></a> has been rewritten and is now much faster.</li>
<li>New function <a class="reference internal" href="index.html#tornado.stack_context.run_with_stack_context" title="tornado.stack_context.run_with_stack_context"><code class="xref py py-obj docutils literal"><span class="pre">run_with_stack_context</span></code></a> facilitates the use of stack
contexts with coroutines.</li>
</ul>
</div>
<div class="section" id="tornado-tcpserver">
<h6><a class="reference internal" href="index.html#module-tornado.tcpserver" title="tornado.tcpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.tcpserver</span></code></a><a class="headerlink" href="#tornado-tcpserver" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The constructors of <a class="reference internal" href="index.html#tornado.tcpserver.TCPServer" title="tornado.tcpserver.TCPServer"><code class="xref py py-obj docutils literal"><span class="pre">TCPServer</span></code></a> and <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> now take a
<code class="docutils literal"><span class="pre">max_buffer_size</span></code> keyword argument.</li>
</ul>
</div>
<div class="section" id="tornado-template">
<h6><a class="reference internal" href="index.html#module-tornado.template" title="tornado.template"><code class="xref py py-obj docutils literal"><span class="pre">tornado.template</span></code></a><a class="headerlink" href="#tornado-template" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Some internal names used by the template system have been changed;
now all &#8220;reserved&#8221; names in templates start with <code class="docutils literal"><span class="pre">_tt_</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-testing">
<h6><a class="reference internal" href="index.html#module-tornado.testing" title="tornado.testing"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing</span></code></a><a class="headerlink" href="#tornado-testing" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.testing.AsyncTestCase.wait" title="tornado.testing.AsyncTestCase.wait"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.AsyncTestCase.wait</span></code></a> now raises the correct exception
when it has been modified by <a class="reference internal" href="index.html#module-tornado.stack_context" title="tornado.stack_context"><code class="xref py py-obj docutils literal"><span class="pre">tornado.stack_context</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.testing.gen_test" title="tornado.testing.gen_test"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.gen_test</span></code></a> can now be called as <code class="docutils literal"><span class="pre">&#64;gen_test(timeout=60)</span></code>
to give some tests a longer timeout than others.</li>
<li>The environment variable <code class="docutils literal"><span class="pre">ASYNC_TEST_TIMEOUT</span></code> can now be set to
override the default timeout for <a class="reference internal" href="index.html#tornado.testing.AsyncTestCase.wait" title="tornado.testing.AsyncTestCase.wait"><code class="xref py py-obj docutils literal"><span class="pre">AsyncTestCase.wait</span></code></a> and <a class="reference internal" href="index.html#tornado.testing.gen_test" title="tornado.testing.gen_test"><code class="xref py py-obj docutils literal"><span class="pre">gen_test</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.testing.bind_unused_port" title="tornado.testing.bind_unused_port"><code class="xref py py-obj docutils literal"><span class="pre">bind_unused_port</span></code></a> now passes <code class="docutils literal"><span class="pre">None</span></code> instead of <code class="docutils literal"><span class="pre">0</span></code> as the port
to <code class="docutils literal"><span class="pre">getaddrinfo</span></code>, which works better with some unusual network
configurations.</li>
</ul>
</div>
<div class="section" id="tornado-util">
<h6><a class="reference internal" href="index.html#module-tornado.util" title="tornado.util"><code class="xref py py-obj docutils literal"><span class="pre">tornado.util</span></code></a><a class="headerlink" href="#tornado-util" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.util.import_object" title="tornado.util.import_object"><code class="xref py py-obj docutils literal"><span class="pre">tornado.util.import_object</span></code></a> now works with top-level module names that
do not contain a dot.</li>
<li><a class="reference internal" href="index.html#tornado.util.import_object" title="tornado.util.import_object"><code class="xref py py-obj docutils literal"><span class="pre">tornado.util.import_object</span></code></a> now consistently raises <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#ImportError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ImportError</span></code></a>
instead of <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#AttributeError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">AttributeError</span></code></a> when it fails.</li>
</ul>
</div>
<div class="section" id="tornado-web">
<h6><a class="reference internal" href="index.html#module-tornado.web" title="tornado.web"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web</span></code></a><a class="headerlink" href="#tornado-web" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">handlers</span></code> list passed to the <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Application</span></code></a> constructor
and <a class="reference internal" href="index.html#tornado.web.Application.add_handlers" title="tornado.web.Application.add_handlers"><code class="xref py py-obj docutils literal"><span class="pre">add_handlers</span></code></a> methods can now contain
lists in addition to tuples and <a class="reference internal" href="index.html#tornado.web.URLSpec" title="tornado.web.URLSpec"><code class="xref py py-obj docutils literal"><span class="pre">URLSpec</span></code></a> objects.</li>
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.StaticFileHandler</span></code></a> now works on Windows when the client
passes an <code class="docutils literal"><span class="pre">If-Modified-Since</span></code> timestamp before 1970.</li>
<li>New method <a class="reference internal" href="index.html#tornado.web.RequestHandler.log_exception" title="tornado.web.RequestHandler.log_exception"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.log_exception</span></code></a> can be overridden to
customize the logging behavior when an exception is uncaught.  Most
apps that currently override <code class="docutils literal"><span class="pre">_handle_request_exception</span></code> can now
use a combination of <a class="reference internal" href="index.html#tornado.web.RequestHandler.log_exception" title="tornado.web.RequestHandler.log_exception"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.log_exception</span></code></a> and
<a class="reference internal" href="index.html#tornado.web.RequestHandler.write_error" title="tornado.web.RequestHandler.write_error"><code class="xref py py-obj docutils literal"><span class="pre">write_error</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.get_argument" title="tornado.web.RequestHandler.get_argument"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_argument</span></code></a> now raises <a class="reference internal" href="index.html#tornado.web.MissingArgumentError" title="tornado.web.MissingArgumentError"><code class="xref py py-obj docutils literal"><span class="pre">MissingArgumentError</span></code></a>
(a subclass of <a class="reference internal" href="index.html#tornado.web.HTTPError" title="tornado.web.HTTPError"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.HTTPError</span></code></a>, which is what it raised previously)
if the argument cannot be found.</li>
<li><a class="reference internal" href="index.html#tornado.web.Application.reverse_url" title="tornado.web.Application.reverse_url"><code class="xref py py-obj docutils literal"><span class="pre">Application.reverse_url</span></code></a> now uses <a class="reference internal" href="index.html#tornado.escape.url_escape" title="tornado.escape.url_escape"><code class="xref py py-obj docutils literal"><span class="pre">url_escape</span></code></a> with <code class="docutils literal"><span class="pre">plus=False</span></code>,
i.e. spaces are encoded as <code class="docutils literal"><span class="pre">%20</span></code> instead of <code class="docutils literal"><span class="pre">+</span></code>.</li>
<li>Arguments extracted from the url path are now decoded with
<a class="reference internal" href="index.html#tornado.escape.url_unescape" title="tornado.escape.url_unescape"><code class="xref py py-obj docutils literal"><span class="pre">url_unescape</span></code></a> with <code class="docutils literal"><span class="pre">plus=False</span></code>, so plus signs are left as-is
instead of being turned into spaces.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.send_error" title="tornado.web.RequestHandler.send_error"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.send_error</span></code></a> will now only be called once per request,
even if multiple exceptions are caught by the stack context.</li>
<li>The <a class="reference internal" href="index.html#tornado.web.asynchronous" title="tornado.web.asynchronous"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.asynchronous</span></code></a> decorator is no longer necessary for
methods that return a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> (i.e. those that use the <a class="reference internal" href="index.html#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">gen.coroutine</span></code></a>
or <a class="reference internal" href="index.html#tornado.concurrent.return_future" title="tornado.concurrent.return_future"><code class="xref py py-obj docutils literal"><span class="pre">return_future</span></code></a> decorators)</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.prepare" title="tornado.web.RequestHandler.prepare"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.prepare</span></code></a> may now be asynchronous if it returns a
<a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.  The <a class="reference internal" href="index.html#tornado.web.asynchronous" title="tornado.web.asynchronous"><code class="xref py py-obj docutils literal"><span class="pre">asynchronous</span></code></a> decorator is not used with
<code class="docutils literal"><span class="pre">prepare</span></code>; one of the <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>-related decorators should be used instead.</li>
<li><code class="docutils literal"><span class="pre">RequestHandler.current_user</span></code> may now be assigned to normally.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.redirect" title="tornado.web.RequestHandler.redirect"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.redirect</span></code></a> no longer silently strips control characters
and whitespace.  It is now an error to pass control characters, newlines
or tabs.</li>
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> has been reorganized internally and now has additional
extension points that can be overridden in subclasses.</li>
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> now supports HTTP <code class="docutils literal"><span class="pre">Range</span></code> requests.
<a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> is still not suitable for files too large to
comfortably fit in memory, but <code class="docutils literal"><span class="pre">Range</span></code> support is necessary in some
browsers to enable seeking of HTML5 audio and video.</li>
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> now uses longer hashes by default, and uses the same
hashes for <code class="docutils literal"><span class="pre">Etag</span></code> as it does for versioned urls.</li>
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler.make_static_url" title="tornado.web.StaticFileHandler.make_static_url"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler.make_static_url</span></code></a> and <a class="reference internal" href="index.html#tornado.web.RequestHandler.static_url" title="tornado.web.RequestHandler.static_url"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.static_url</span></code></a>
now have an additional keyword argument <code class="docutils literal"><span class="pre">include_version</span></code> to suppress
the url versioning.</li>
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> now reads its file in chunks, which will reduce
memory fragmentation.</li>
<li>Fixed a problem with the <code class="docutils literal"><span class="pre">Date</span></code> header and cookie expiration dates
when the system locale is set to a non-english configuration.</li>
</ul>
</div>
<div class="section" id="tornado-websocket">
<h6><a class="reference internal" href="index.html#module-tornado.websocket" title="tornado.websocket"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket</span></code></a><a class="headerlink" href="#tornado-websocket" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler" title="tornado.websocket.WebSocketHandler"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler</span></code></a> now catches <a class="reference internal" href="index.html#tornado.iostream.StreamClosedError" title="tornado.iostream.StreamClosedError"><code class="xref py py-obj docutils literal"><span class="pre">StreamClosedError</span></code></a> and runs
<a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler.on_close" title="tornado.websocket.WebSocketHandler.on_close"><code class="xref py py-obj docutils literal"><span class="pre">on_close</span></code></a> immediately instead of logging a
stack trace.</li>
<li>New method <a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler.set_nodelay" title="tornado.websocket.WebSocketHandler.set_nodelay"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler.set_nodelay</span></code></a> can be used to set the
<code class="docutils literal"><span class="pre">TCP_NODELAY</span></code> flag.</li>
</ul>
</div>
<div class="section" id="tornado-wsgi">
<h6><a class="reference internal" href="index.html#module-tornado.wsgi" title="tornado.wsgi"><code class="xref py py-obj docutils literal"><span class="pre">tornado.wsgi</span></code></a><a class="headerlink" href="#tornado-wsgi" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Fixed an exception in <a class="reference internal" href="index.html#tornado.wsgi.WSGIContainer" title="tornado.wsgi.WSGIContainer"><code class="xref py py-obj docutils literal"><span class="pre">WSGIContainer</span></code></a> when the connection is closed
while output is being written.</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v3.0.2"></span><div class="section" id="what-s-new-in-tornado-3-0-2">
<h4>What&#8217;s new in Tornado 3.0.2<a class="headerlink" href="#what-s-new-in-tornado-3-0-2" title="永久链接至标题">¶</a></h4>
<div class="section" id="jun-2-2013">
<h5>Jun 2, 2013<a class="headerlink" href="#jun-2-2013" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.auth.TwitterMixin" title="tornado.auth.TwitterMixin"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth.TwitterMixin</span></code></a> now defaults to version 1.1 of the
Twitter API, instead of version 1.0 which is being <a class="reference external" href="https://dev.twitter.com/calendar">discontinued on
June 11</a>.  It also now uses HTTPS
when talking to Twitter.</li>
<li>Fixed a potential memory leak with a long chain of <a class="reference internal" href="index.html#tornado.gen.coroutine" title="tornado.gen.coroutine"><code class="xref py py-obj docutils literal"><span class="pre">gen.coroutine</span></code></a>
or <a class="reference internal" href="index.html#tornado.gen.engine" title="tornado.gen.engine"><code class="xref py py-obj docutils literal"><span class="pre">gen.engine</span></code></a> functions.</li>
</ul>
</div>
</div>
<span id="document-releases/v3.0.1"></span><div class="section" id="what-s-new-in-tornado-3-0-1">
<h4>What&#8217;s new in Tornado 3.0.1<a class="headerlink" href="#what-s-new-in-tornado-3-0-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="apr-8-2013">
<h5>Apr 8, 2013<a class="headerlink" href="#apr-8-2013" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>The interface of <a class="reference internal" href="index.html#tornado.auth.FacebookGraphMixin" title="tornado.auth.FacebookGraphMixin"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth.FacebookGraphMixin</span></code></a> is now consistent
with its documentation and the rest of the module.  The
<code class="docutils literal"><span class="pre">get_authenticated_user</span></code> and <code class="docutils literal"><span class="pre">facebook_request</span></code> methods return a
<code class="docutils literal"><span class="pre">Future</span></code> and the <code class="docutils literal"><span class="pre">callback</span></code> argument is optional.</li>
<li>The <a class="reference internal" href="index.html#tornado.testing.gen_test" title="tornado.testing.gen_test"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.gen_test</span></code></a> decorator will no longer be recognized
as a (broken) test by <code class="docutils literal"><span class="pre">nose</span></code>.</li>
<li>Work around a bug in Ubuntu 13.04 betas involving an incomplete backport
of the <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.match_hostname" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.match_hostname</span></code></a> function.</li>
<li><a class="reference internal" href="index.html#tornado.websocket.websocket_connect" title="tornado.websocket.websocket_connect"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket.websocket_connect</span></code></a> now fails cleanly when it attempts
to connect to a non-websocket url.</li>
<li><a class="reference internal" href="index.html#tornado.testing.LogTrapTestCase" title="tornado.testing.LogTrapTestCase"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.LogTrapTestCase</span></code></a> once again works with byte strings
on Python 2.</li>
<li>The <code class="docutils literal"><span class="pre">request</span></code> attribute of <a class="reference internal" href="index.html#tornado.httpclient.HTTPResponse" title="tornado.httpclient.HTTPResponse"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient.HTTPResponse</span></code></a> is
now always an <a class="reference internal" href="index.html#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPRequest</span></code></a>, never a <code class="docutils literal"><span class="pre">_RequestProxy</span></code>.</li>
<li>Exceptions raised by the <a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a> module now have better messages
when tuples are used as callback keys.</li>
</ul>
</div>
</div>
<span id="document-releases/v3.0.0"></span><div class="section" id="what-s-new-in-tornado-3-0">
<h4>What&#8217;s new in Tornado 3.0<a class="headerlink" href="#what-s-new-in-tornado-3-0" title="永久链接至标题">¶</a></h4>
<div class="section" id="mar-29-2013">
<h5>Mar 29, 2013<a class="headerlink" href="#mar-29-2013" title="永久链接至标题">¶</a></h5>
<div class="section" id="highlights">
<h6>Highlights<a class="headerlink" href="#highlights" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">callback</span></code> argument to many asynchronous methods is now
optional, and these methods return a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>.  The <a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a>
module now understands <code class="docutils literal"><span class="pre">Futures</span></code>, and these methods can be used
directly without a <a class="reference internal" href="index.html#tornado.gen.Task" title="tornado.gen.Task"><code class="xref py py-obj docutils literal"><span class="pre">gen.Task</span></code></a> wrapper.</li>
<li>New function <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.current" title="tornado.ioloop.IOLoop.current"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.current</span></code></a> returns the <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> that is running
on the current thread (as opposed to <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.instance" title="tornado.ioloop.IOLoop.instance"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.instance</span></code></a>, which
returns a specific thread&#8217;s (usually the main thread&#8217;s) IOLoop.</li>
<li>New class <a class="reference internal" href="index.html#tornado.netutil.Resolver" title="tornado.netutil.Resolver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil.Resolver</span></code></a> provides an asynchronous
interface to DNS resolution.  The default implementation is still
blocking, but non-blocking implementations are available using one
of three optional dependencies: <a class="reference internal" href="index.html#tornado.netutil.ThreadedResolver" title="tornado.netutil.ThreadedResolver"><code class="xref py py-obj docutils literal"><span class="pre">ThreadedResolver</span></code></a>
using the <a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#module-concurrent.futures" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures</span></code></a> thread pool,
<code class="docutils literal"><span class="pre">tornado.platform.caresresolver.CaresResolver</span></code> using the <code class="docutils literal"><span class="pre">pycares</span></code>
library, or <code class="docutils literal"><span class="pre">tornado.platform.twisted.TwistedResolver</span></code> using <code class="docutils literal"><span class="pre">twisted</span></code></li>
<li>Tornado&#8217;s logging is now less noisy, and it no longer goes directly
to the root logger, allowing for finer-grained configuration.</li>
<li>New class <a class="reference internal" href="index.html#tornado.process.Subprocess" title="tornado.process.Subprocess"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process.Subprocess</span></code></a> wraps <a class="reference external" href="https://docs.python.org/3.4/library/subprocess.html#subprocess.Popen" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">subprocess.Popen</span></code></a> with
<a class="reference internal" href="index.html#tornado.iostream.PipeIOStream" title="tornado.iostream.PipeIOStream"><code class="xref py py-obj docutils literal"><span class="pre">PipeIOStream</span></code></a> access to the child&#8217;s file descriptors.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> now has a static <a class="reference internal" href="index.html#tornado.util.Configurable.configure" title="tornado.util.Configurable.configure"><code class="xref py py-obj docutils literal"><span class="pre">configure</span></code></a>
method like the one on <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a>, which can be used to
select an <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> implementation other than the default.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> can now optionally use a monotonic clock if available
(see below for more details).</li>
</ul>
</div>
<div class="section" id="backwards-incompatible-changes">
<h6>Backwards-incompatible changes<a class="headerlink" href="#backwards-incompatible-changes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Python 2.5 is no longer supported.  Python 3 is now supported in a single
codebase instead of using <code class="docutils literal"><span class="pre">2to3</span></code></li>
<li>The <code class="docutils literal"><span class="pre">tornado.database</span></code> module has been removed.  It is now available
as a separate package, <a class="reference external" href="https://github.com/bdarnell/torndb">torndb</a></li>
<li>Functions that take an <code class="docutils literal"><span class="pre">io_loop</span></code> parameter now default to
<a class="reference internal" href="index.html#tornado.ioloop.IOLoop.current" title="tornado.ioloop.IOLoop.current"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.current()</span></code></a> instead of <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.instance" title="tornado.ioloop.IOLoop.instance"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.instance()</span></code></a>.</li>
<li>Empty HTTP request arguments are no longer ignored.  This applies to
<code class="docutils literal"><span class="pre">HTTPRequest.arguments</span></code> and <code class="docutils literal"><span class="pre">RequestHandler.get_argument[s]</span></code>
in WSGI and non-WSGI modes.</li>
<li>On Python 3, <a class="reference internal" href="index.html#tornado.escape.json_encode" title="tornado.escape.json_encode"><code class="xref py py-obj docutils literal"><span class="pre">tornado.escape.json_encode</span></code></a> no longer accepts byte strings.</li>
<li>On Python 3, the <code class="docutils literal"><span class="pre">get_authenticated_user</span></code> methods in <a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a>
now return character strings instead of byte strings.</li>
<li><code class="docutils literal"><span class="pre">tornado.netutil.TCPServer</span></code> has moved to its own module,
<a class="reference internal" href="index.html#module-tornado.tcpserver" title="tornado.tcpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.tcpserver</span></code></a>.</li>
<li>The Tornado test suite now requires <code class="docutils literal"><span class="pre">unittest2</span></code> when run on Python 2.6.</li>
<li><a class="reference internal" href="index.html#tornado.options.options" title="tornado.options.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.options</span></code></a> is no longer a subclass of <a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#dict" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">dict</span></code></a>; attribute-style
access is now required.</li>
</ul>
</div>
<div class="section" id="detailed-changes-by-module">
<h6>Detailed changes by module<a class="headerlink" href="#detailed-changes-by-module" title="永久链接至标题">¶</a></h6>
<div class="section" id="multiple-modules">
<h7>Multiple modules<a class="headerlink" href="#multiple-modules" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>Tornado no longer logs to the root logger.  Details on the new logging
scheme can be found under the <a class="reference internal" href="index.html#module-tornado.log" title="tornado.log"><code class="xref py py-obj docutils literal"><span class="pre">tornado.log</span></code></a> module.  Note that in some
cases this will require that you add an explicit logging configuration
in order to see any output (perhaps just calling <code class="docutils literal"><span class="pre">logging.basicConfig()</span></code>),
although both <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.start" title="tornado.ioloop.IOLoop.start"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.start()</span></code></a> and <a class="reference internal" href="index.html#tornado.options.parse_command_line" title="tornado.options.parse_command_line"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.parse_command_line</span></code></a>
will do this for you.</li>
<li>On python 3.2+, methods that take an <code class="docutils literal"><span class="pre">ssl_options</span></code> argument (on
<a class="reference internal" href="index.html#tornado.iostream.SSLIOStream" title="tornado.iostream.SSLIOStream"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream</span></code></a>, <a class="reference internal" href="index.html#tornado.tcpserver.TCPServer" title="tornado.tcpserver.TCPServer"><code class="xref py py-obj docutils literal"><span class="pre">TCPServer</span></code></a>, and <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a>) now accept either a
dictionary of options or an <a class="reference external" href="https://docs.python.org/3.4/library/ssl.html#ssl.SSLContext" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">ssl.SSLContext</span></code></a> object.</li>
<li>New optional dependency on <a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#module-concurrent.futures" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures</span></code></a> to provide better support
for working with threads.  <a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#module-concurrent.futures" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures</span></code></a> is in the standard library
for Python 3.2+, and can be installed on older versions with
<code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">futures</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-autoreload">
<h7><a class="reference internal" href="index.html#module-tornado.autoreload" title="tornado.autoreload"><code class="xref py py-obj docutils literal"><span class="pre">tornado.autoreload</span></code></a><a class="headerlink" href="#tornado-autoreload" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li><a class="reference internal" href="index.html#module-tornado.autoreload" title="tornado.autoreload"><code class="xref py py-obj docutils literal"><span class="pre">tornado.autoreload</span></code></a> is now more reliable when there are errors at import
time.</li>
<li>Calling <a class="reference internal" href="index.html#tornado.autoreload.start" title="tornado.autoreload.start"><code class="xref py py-obj docutils literal"><span class="pre">tornado.autoreload.start</span></code></a> (or creating an <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a> with
<code class="docutils literal"><span class="pre">debug=True</span></code>) twice on the same <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> now does nothing (instead of
creating multiple periodic callbacks).  Starting autoreload on
more than one <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> in the same process now logs a warning.</li>
<li>Scripts run by autoreload no longer inherit <code class="docutils literal"><span class="pre">__future__</span></code> imports
used by Tornado.</li>
</ul>
</div>
<div class="section" id="tornado-auth">
<h7><a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a><a class="headerlink" href="#tornado-auth" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>On Python 3, the <code class="docutils literal"><span class="pre">get_authenticated_user</span></code> method family now returns
character strings instead of byte strings.</li>
<li>Asynchronous methods defined in <a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a> now return a
<a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>, and their <code class="docutils literal"><span class="pre">callback</span></code> argument is optional.  The
<code class="docutils literal"><span class="pre">Future</span></code> interface is preferred as it offers better error handling
(the previous interface just logged a warning and returned None).</li>
<li>The <a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a> mixin classes now define a method
<code class="docutils literal"><span class="pre">get_auth_http_client</span></code>, which can be overridden to use a non-default
<a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> instance (e.g. to use a different <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>)</li>
<li>Subclasses of <a class="reference internal" href="index.html#tornado.auth.OAuthMixin" title="tornado.auth.OAuthMixin"><code class="xref py py-obj docutils literal"><span class="pre">OAuthMixin</span></code></a> are encouraged to override
<a class="reference internal" href="index.html#tornado.auth.OAuthMixin._oauth_get_user_future" title="tornado.auth.OAuthMixin._oauth_get_user_future"><code class="xref py py-obj docutils literal"><span class="pre">OAuthMixin._oauth_get_user_future</span></code></a> instead of <code class="docutils literal"><span class="pre">_oauth_get_user</span></code>,
although both methods are still supported.</li>
</ul>
</div>
<div class="section" id="tornado-concurrent">
<h7><a class="reference internal" href="index.html#module-tornado.concurrent" title="tornado.concurrent"><code class="xref py py-obj docutils literal"><span class="pre">tornado.concurrent</span></code></a><a class="headerlink" href="#tornado-concurrent" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>New module <a class="reference internal" href="index.html#module-tornado.concurrent" title="tornado.concurrent"><code class="xref py py-obj docutils literal"><span class="pre">tornado.concurrent</span></code></a> contains code to support working with
<a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#module-concurrent.futures" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures</span></code></a>, or to emulate future-based interface when that module
is not available.</li>
</ul>
</div>
<div class="section" id="tornado-curl-httpclient">
<h7><code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code><a class="headerlink" href="#tornado-curl-httpclient" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>Preliminary support for <code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code> on Python 3.  The latest
official release of pycurl only supports Python 2, but Ubuntu has a
port available in 12.10 (<code class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">python3-pycurl</span></code>).  This port
currently has bugs that prevent it from handling arbitrary binary data
but it should work for textual (utf8) resources.</li>
<li>Fix a crash with libcurl 7.29.0 if a curl object is created and closed
without being used.</li>
</ul>
</div>
<div class="section" id="tornado-escape">
<h7><a class="reference internal" href="index.html#module-tornado.escape" title="tornado.escape"><code class="xref py py-obj docutils literal"><span class="pre">tornado.escape</span></code></a><a class="headerlink" href="#tornado-escape" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>On Python 3, <a class="reference internal" href="index.html#tornado.escape.json_encode" title="tornado.escape.json_encode"><code class="xref py py-obj docutils literal"><span class="pre">json_encode</span></code></a> no longer accepts byte strings.
This mirrors the behavior of the underlying json module.  Python 2 behavior
is unchanged but should be faster.</li>
</ul>
</div>
<div class="section" id="tornado-gen">
<h7><a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a><a class="headerlink" href="#tornado-gen" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>New decorator <code class="docutils literal"><span class="pre">&#64;gen.coroutine</span></code> is available as an alternative to
<code class="docutils literal"><span class="pre">&#64;gen.engine</span></code>.  It automatically returns a
<a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a>, and within the function instead of
calling a callback you return a value with <code class="docutils literal"><span class="pre">raise</span>
<span class="pre">gen.Return(value)</span></code> (or simply <code class="docutils literal"><span class="pre">return</span> <span class="pre">value</span></code> in Python 3.3).</li>
<li>Generators may now yield <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> objects.</li>
<li>Callbacks produced by <a class="reference internal" href="index.html#tornado.gen.Callback" title="tornado.gen.Callback"><code class="xref py py-obj docutils literal"><span class="pre">gen.Callback</span></code></a> and <a class="reference internal" href="index.html#tornado.gen.Task" title="tornado.gen.Task"><code class="xref py py-obj docutils literal"><span class="pre">gen.Task</span></code></a> are now automatically
stack-context-wrapped, to minimize the risk of context leaks when used
with asynchronous functions that don&#8217;t do their own wrapping.</li>
<li>Fixed a memory leak involving generators, <a class="reference internal" href="index.html#tornado.web.RequestHandler.flush" title="tornado.web.RequestHandler.flush"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.flush</span></code></a>,
and clients closing connections while output is being written.</li>
<li>Yielding a large list no longer has quadratic performance.</li>
</ul>
</div>
<div class="section" id="tornado-httpclient">
<h7><a class="reference internal" href="index.html#module-tornado.httpclient" title="tornado.httpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient</span></code></a><a class="headerlink" href="#tornado-httpclient" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient.fetch" title="tornado.httpclient.AsyncHTTPClient.fetch"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient.fetch</span></code></a> now returns a <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> and its callback argument
is optional.  When the future interface is used, any error will be raised
automatically, as if <a class="reference internal" href="index.html#tornado.httpclient.HTTPResponse.rethrow" title="tornado.httpclient.HTTPResponse.rethrow"><code class="xref py py-obj docutils literal"><span class="pre">HTTPResponse.rethrow</span></code></a> was called.</li>
<li><a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient.configure" title="tornado.httpclient.AsyncHTTPClient.configure"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient.configure</span></code></a> and all <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> constructors
now take a <code class="docutils literal"><span class="pre">defaults</span></code> keyword argument.  This argument should be a
dictionary, and its values will be used in place of corresponding
attributes of <a class="reference internal" href="index.html#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPRequest</span></code></a> that are not set.</li>
<li>All unset attributes of <a class="reference internal" href="index.html#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient.HTTPRequest</span></code></a> are now
<code class="docutils literal"><span class="pre">None</span></code>.  The default values of some attributes
(<code class="docutils literal"><span class="pre">connect_timeout</span></code>, <code class="docutils literal"><span class="pre">request_timeout</span></code>, <code class="docutils literal"><span class="pre">follow_redirects</span></code>,
<code class="docutils literal"><span class="pre">max_redirects</span></code>, <code class="docutils literal"><span class="pre">use_gzip</span></code>, <code class="docutils literal"><span class="pre">proxy_password</span></code>,
<code class="docutils literal"><span class="pre">allow_nonstandard_methods</span></code>, and <code class="docutils literal"><span class="pre">validate_cert</span></code> have been moved
from <a class="reference internal" href="index.html#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">HTTPRequest</span></code></a> to the client
implementations.</li>
<li>The <code class="docutils literal"><span class="pre">max_clients</span></code> argument to <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> is now a keyword-only
argument.</li>
<li>Keyword arguments to <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient.configure" title="tornado.httpclient.AsyncHTTPClient.configure"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient.configure</span></code></a> are no longer used
when instantiating an implementation subclass directly.</li>
<li>Secondary <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a> callbacks (<code class="docutils literal"><span class="pre">streaming_callback</span></code>,
<code class="docutils literal"><span class="pre">header_callback</span></code>, and <code class="docutils literal"><span class="pre">prepare_curl_callback</span></code>) now respect
<a class="reference internal" href="index.html#tornado.stack_context.StackContext" title="tornado.stack_context.StackContext"><code class="xref py py-obj docutils literal"><span class="pre">StackContext</span></code></a>.</li>
</ul>
</div>
<div class="section" id="tornado-httpserver">
<h7><a class="reference internal" href="index.html#module-tornado.httpserver" title="tornado.httpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpserver</span></code></a><a class="headerlink" href="#tornado-httpserver" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> no longer logs an error when it is unable to read a second
request from an HTTP 1.1 keep-alive connection.</li>
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> now takes a <code class="docutils literal"><span class="pre">protocol</span></code> keyword argument which can be set
to <code class="docutils literal"><span class="pre">https</span></code> if the server is behind an SSL-decoding proxy that does not
set any supported X-headers.</li>
<li><code class="docutils literal"><span class="pre">tornado.httpserver.HTTPConnection</span></code> now has a <code class="docutils literal"><span class="pre">set_close_callback</span></code>
method that should be used instead of reaching into its <code class="docutils literal"><span class="pre">stream</span></code>
attribute.</li>
<li>Empty HTTP request arguments are no longer ignored.  This applies to
<code class="docutils literal"><span class="pre">HTTPRequest.arguments</span></code> and <code class="docutils literal"><span class="pre">RequestHandler.get_argument[s]</span></code>
in WSGI and non-WSGI modes.</li>
</ul>
</div>
<div class="section" id="tornado-ioloop">
<h7><a class="reference internal" href="index.html#module-tornado.ioloop" title="tornado.ioloop"><code class="xref py py-obj docutils literal"><span class="pre">tornado.ioloop</span></code></a><a class="headerlink" href="#tornado-ioloop" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>New function <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.current" title="tornado.ioloop.IOLoop.current"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.current</span></code></a> returns the <code class="docutils literal"><span class="pre">IOLoop</span></code> that is running
on the current thread (as opposed to <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.instance" title="tornado.ioloop.IOLoop.instance"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.instance</span></code></a>, which returns a
specific thread&#8217;s (usually the main thread&#8217;s) IOLoop).</li>
<li>New method <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_future" title="tornado.ioloop.IOLoop.add_future"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_future</span></code></a> to run a callback on the IOLoop when
an asynchronous <a class="reference internal" href="index.html#tornado.concurrent.Future" title="tornado.concurrent.Future"><code class="xref py py-obj docutils literal"><span class="pre">Future</span></code></a> finishes.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> now has a static <a class="reference internal" href="index.html#tornado.util.Configurable.configure" title="tornado.util.Configurable.configure"><code class="xref py py-obj docutils literal"><span class="pre">configure</span></code></a>
method like the one on <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a>, which can be used to
select an <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> implementation other than the default.</li>
<li>The <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> poller implementations (<code class="docutils literal"><span class="pre">select</span></code>, <code class="docutils literal"><span class="pre">epoll</span></code>, <code class="docutils literal"><span class="pre">kqueue</span></code>)
are now available as distinct subclasses of <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a>.  Instantiating
<a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> will continue to automatically choose the best available
implementation.</li>
<li>The <a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> constructor has a new keyword argument <code class="docutils literal"><span class="pre">time_func</span></code>,
which can be used to set the time function used when scheduling callbacks.
This is most useful with the <a class="reference external" href="https://docs.python.org/3.4/library/time.html#time.monotonic" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">time.monotonic</span></code></a> function, introduced
in Python 3.3 and backported to older versions via the <code class="docutils literal"><span class="pre">monotime</span></code>
module.  Using a monotonic clock here avoids problems when the system
clock is changed.</li>
<li>New function <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.time" title="tornado.ioloop.IOLoop.time"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.time</span></code></a> returns the current time according to the
IOLoop.  To use the new monotonic clock functionality, all calls to
<a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_timeout" title="tornado.ioloop.IOLoop.add_timeout"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_timeout</span></code></a> must be either pass a <a class="reference external" href="https://docs.python.org/3.4/library/datetime.html#datetime.timedelta" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">datetime.timedelta</span></code></a> or
a time relative to <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.time" title="tornado.ioloop.IOLoop.time"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.time</span></code></a>, not <a class="reference external" href="https://docs.python.org/3.4/library/time.html#time.time" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">time.time</span></code></a>.  (<a class="reference external" href="https://docs.python.org/3.4/library/time.html#time.time" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">time.time</span></code></a> will
continue to work only as long as the IOLoop&#8217;s <code class="docutils literal"><span class="pre">time_func</span></code> argument
is not used).</li>
<li>New convenience method <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.run_sync" title="tornado.ioloop.IOLoop.run_sync"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.run_sync</span></code></a> can be used to start an IOLoop
just long enough to run a single coroutine.</li>
<li>New method <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_callback_from_signal" title="tornado.ioloop.IOLoop.add_callback_from_signal"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_callback_from_signal</span></code></a> is safe to use in a signal
handler (the regular <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_callback" title="tornado.ioloop.IOLoop.add_callback"><code class="xref py py-obj docutils literal"><span class="pre">add_callback</span></code></a> method may deadlock).</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> now uses <a class="reference external" href="https://docs.python.org/3.4/library/signal.html#signal.set_wakeup_fd" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">signal.set_wakeup_fd</span></code></a> where available (Python 2.6+
on Unix) to avoid a race condition that could result in Python signal
handlers being delayed.</li>
<li>Method <code class="docutils literal"><span class="pre">IOLoop.running()</span></code> has been removed.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop</span></code></a> has been refactored to better support subclassing.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_callback" title="tornado.ioloop.IOLoop.add_callback"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_callback</span></code></a> and <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_callback_from_signal" title="tornado.ioloop.IOLoop.add_callback_from_signal"><code class="xref py py-obj docutils literal"><span class="pre">add_callback_from_signal</span></code></a> now take
<code class="docutils literal"><span class="pre">*args,</span> <span class="pre">**kwargs</span></code> to pass along to the callback.</li>
</ul>
</div>
<div class="section" id="tornado-iostream">
<h7><a class="reference internal" href="index.html#module-tornado.iostream" title="tornado.iostream"><code class="xref py py-obj docutils literal"><span class="pre">tornado.iostream</span></code></a><a class="headerlink" href="#tornado-iostream" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.iostream.IOStream.connect" title="tornado.iostream.IOStream.connect"><code class="xref py py-obj docutils literal"><span class="pre">IOStream.connect</span></code></a> now has an optional <code class="docutils literal"><span class="pre">server_hostname</span></code> argument
which will be used for SSL certificate validation when applicable.
Additionally, when supported (on Python 3.2+), this hostname
will be sent via SNI (and this is supported by <code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code>)</li>
<li>Much of <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> has been refactored into a separate class
<a class="reference internal" href="index.html#tornado.iostream.BaseIOStream" title="tornado.iostream.BaseIOStream"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream</span></code></a>.</li>
<li>New class <a class="reference internal" href="index.html#tornado.iostream.PipeIOStream" title="tornado.iostream.PipeIOStream"><code class="xref py py-obj docutils literal"><span class="pre">tornado.iostream.PipeIOStream</span></code></a> provides the IOStream
interface on pipe file descriptors.</li>
<li><a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> now raises a new exception
<code class="docutils literal"><span class="pre">tornado.iostream.StreamClosedError</span></code> when you attempt to read or
write after the stream has been closed (by either side).</li>
<li><a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> now simply closes the connection when it gets an
<code class="docutils literal"><span class="pre">ECONNRESET</span></code> error, rather than logging it as an error.</li>
<li><code class="docutils literal"><span class="pre">IOStream.error</span></code> no longer picks up unrelated exceptions.</li>
<li><a class="reference internal" href="index.html#tornado.iostream.BaseIOStream.close" title="tornado.iostream.BaseIOStream.close"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream.close</span></code></a> now has an <code class="docutils literal"><span class="pre">exc_info</span></code> argument (similar to the
one used in the <a class="reference external" href="https://docs.python.org/3.4/library/logging.html#module-logging" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">logging</span></code></a> module) that can be used to set the stream&#8217;s
<code class="docutils literal"><span class="pre">error</span></code> attribute when closing it.</li>
<li><a class="reference internal" href="index.html#tornado.iostream.BaseIOStream.read_until_close" title="tornado.iostream.BaseIOStream.read_until_close"><code class="xref py py-obj docutils literal"><span class="pre">BaseIOStream.read_until_close</span></code></a> now works correctly when it is called
while there is buffered data.</li>
<li>Fixed a major performance regression when run on PyPy (introduced in
Tornado 2.3).</li>
</ul>
</div>
<div class="section" id="tornado-log">
<h7><a class="reference internal" href="index.html#module-tornado.log" title="tornado.log"><code class="xref py py-obj docutils literal"><span class="pre">tornado.log</span></code></a><a class="headerlink" href="#tornado-log" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>New module containing <a class="reference internal" href="index.html#tornado.log.enable_pretty_logging" title="tornado.log.enable_pretty_logging"><code class="xref py py-obj docutils literal"><span class="pre">enable_pretty_logging</span></code></a> and <a class="reference internal" href="index.html#tornado.log.LogFormatter" title="tornado.log.LogFormatter"><code class="xref py py-obj docutils literal"><span class="pre">LogFormatter</span></code></a>,
moved from the options module.</li>
<li><a class="reference internal" href="index.html#tornado.log.LogFormatter" title="tornado.log.LogFormatter"><code class="xref py py-obj docutils literal"><span class="pre">LogFormatter</span></code></a> now handles non-ascii data in messages and tracebacks better.</li>
</ul>
</div>
<div class="section" id="tornado-netutil">
<h7><a class="reference internal" href="index.html#module-tornado.netutil" title="tornado.netutil"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil</span></code></a><a class="headerlink" href="#tornado-netutil" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>New class <a class="reference internal" href="index.html#tornado.netutil.Resolver" title="tornado.netutil.Resolver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil.Resolver</span></code></a> provides an asynchronous
interface to DNS resolution.  The default implementation is still
blocking, but non-blocking implementations are available using one
of three optional dependencies: <a class="reference internal" href="index.html#tornado.netutil.ThreadedResolver" title="tornado.netutil.ThreadedResolver"><code class="xref py py-obj docutils literal"><span class="pre">ThreadedResolver</span></code></a>
using the <a class="reference external" href="https://docs.python.org/3.4/library/concurrent.futures.html#module-concurrent.futures" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">concurrent.futures</span></code></a> thread pool,
<a class="reference internal" href="index.html#tornado.platform.caresresolver.CaresResolver" title="tornado.platform.caresresolver.CaresResolver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.caresresolver.CaresResolver</span></code></a> using the <code class="docutils literal"><span class="pre">pycares</span></code>
library, or <a class="reference internal" href="index.html#tornado.platform.twisted.TwistedResolver" title="tornado.platform.twisted.TwistedResolver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.twisted.TwistedResolver</span></code></a> using <code class="docutils literal"><span class="pre">twisted</span></code></li>
<li>New function <a class="reference internal" href="index.html#tornado.netutil.is_valid_ip" title="tornado.netutil.is_valid_ip"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil.is_valid_ip</span></code></a> returns true if a given string
is a valid IP (v4 or v6) address.</li>
<li><a class="reference internal" href="index.html#tornado.netutil.bind_sockets" title="tornado.netutil.bind_sockets"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil.bind_sockets</span></code></a> has a new <code class="docutils literal"><span class="pre">flags</span></code> argument that can
be used to pass additional flags to <code class="docutils literal"><span class="pre">getaddrinfo</span></code>.</li>
<li><a class="reference internal" href="index.html#tornado.netutil.bind_sockets" title="tornado.netutil.bind_sockets"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil.bind_sockets</span></code></a> no longer sets <code class="docutils literal"><span class="pre">AI_ADDRCONFIG</span></code>; this will
cause it to bind to both ipv4 and ipv6 more often than before.</li>
<li><a class="reference internal" href="index.html#tornado.netutil.bind_sockets" title="tornado.netutil.bind_sockets"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil.bind_sockets</span></code></a> now works when Python was compiled
with <code class="docutils literal"><span class="pre">--disable-ipv6</span></code> but IPv6 DNS resolution is available on the
system.</li>
<li><code class="docutils literal"><span class="pre">tornado.netutil.TCPServer</span></code> has moved to its own module, <a class="reference internal" href="index.html#module-tornado.tcpserver" title="tornado.tcpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.tcpserver</span></code></a>.</li>
</ul>
</div>
<div class="section" id="tornado-options">
<h7><a class="reference internal" href="index.html#module-tornado.options" title="tornado.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options</span></code></a><a class="headerlink" href="#tornado-options" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>The class underlying the functions in <a class="reference internal" href="index.html#module-tornado.options" title="tornado.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options</span></code></a> is now public
(<a class="reference internal" href="index.html#tornado.options.OptionParser" title="tornado.options.OptionParser"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.OptionParser</span></code></a>).  This can be used to create multiple
independent option sets, such as for subcommands.</li>
<li><a class="reference internal" href="index.html#tornado.options.parse_config_file" title="tornado.options.parse_config_file"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.parse_config_file</span></code></a> now configures logging automatically
by default, in the same way that <a class="reference internal" href="index.html#tornado.options.parse_command_line" title="tornado.options.parse_command_line"><code class="xref py py-obj docutils literal"><span class="pre">parse_command_line</span></code></a> does.</li>
<li>New function <a class="reference internal" href="index.html#tornado.options.add_parse_callback" title="tornado.options.add_parse_callback"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.add_parse_callback</span></code></a> schedules a callback
to be run after the command line or config file has been parsed.  The
keyword argument <code class="docutils literal"><span class="pre">final=False</span></code> can be used on either parsing function
to supress these callbacks.</li>
<li><a class="reference internal" href="index.html#tornado.options.define" title="tornado.options.define"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.define</span></code></a> now takes a <code class="docutils literal"><span class="pre">callback</span></code> argument.  This callback
will be run with the new value whenever the option is changed.  This is
especially useful for options that set other options, such as by reading
from a config file.</li>
<li><a class="reference internal" href="index.html#tornado.options.parse_command_line" title="tornado.options.parse_command_line"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.parse_command_line</span></code></a> <code class="docutils literal"><span class="pre">--help</span></code> output now goes to <code class="docutils literal"><span class="pre">stderr</span></code>
rather than <code class="docutils literal"><span class="pre">stdout</span></code>.</li>
<li><a class="reference internal" href="index.html#tornado.options.options" title="tornado.options.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.options</span></code></a> is no longer a subclass of <a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#dict" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">dict</span></code></a>; attribute-style
access is now required.</li>
<li><a class="reference internal" href="index.html#tornado.options.options" title="tornado.options.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.options</span></code></a> (and <a class="reference internal" href="index.html#tornado.options.OptionParser" title="tornado.options.OptionParser"><code class="xref py py-obj docutils literal"><span class="pre">OptionParser</span></code></a> instances generally) now
have a <a class="reference internal" href="index.html#tornado.options.OptionParser.mockable" title="tornado.options.OptionParser.mockable"><code class="xref py py-obj docutils literal"><span class="pre">mockable()</span></code></a> method that returns a wrapper object compatible with
<a class="reference external" href="https://docs.python.org/3.4/library/unittest.mock.html#unittest.mock.patch" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">mock.patch</span></code></a>.</li>
<li>Function <code class="docutils literal"><span class="pre">tornado.options.enable_pretty_logging</span></code> has been moved to the
<a class="reference internal" href="index.html#module-tornado.log" title="tornado.log"><code class="xref py py-obj docutils literal"><span class="pre">tornado.log</span></code></a> module.</li>
</ul>
</div>
<div class="section" id="tornado-platform-caresresolver">
<h7><a class="reference internal" href="index.html#module-tornado.platform.caresresolver" title="tornado.platform.caresresolver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.caresresolver</span></code></a><a class="headerlink" href="#tornado-platform-caresresolver" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>New module containing an asynchronous implementation of the <a class="reference internal" href="index.html#tornado.netutil.Resolver" title="tornado.netutil.Resolver"><code class="xref py py-obj docutils literal"><span class="pre">Resolver</span></code></a>
interface, using the <code class="docutils literal"><span class="pre">pycares</span></code> library.</li>
</ul>
</div>
<div class="section" id="tornado-platform-twisted">
<h7><a class="reference internal" href="index.html#module-tornado.platform.twisted" title="tornado.platform.twisted"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.twisted</span></code></a><a class="headerlink" href="#tornado-platform-twisted" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>New class <a class="reference internal" href="index.html#tornado.platform.twisted.TwistedIOLoop" title="tornado.platform.twisted.TwistedIOLoop"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.twisted.TwistedIOLoop</span></code></a> allows Tornado
code to be run on the Twisted reactor (as opposed to the existing
<a class="reference internal" href="index.html#tornado.platform.twisted.TornadoReactor" title="tornado.platform.twisted.TornadoReactor"><code class="xref py py-obj docutils literal"><span class="pre">TornadoReactor</span></code></a>, which bridges the gap in the other direction).</li>
<li>New class <a class="reference internal" href="index.html#tornado.platform.twisted.TwistedResolver" title="tornado.platform.twisted.TwistedResolver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.twisted.TwistedResolver</span></code></a> is an asynchronous
implementation of the <a class="reference internal" href="index.html#tornado.netutil.Resolver" title="tornado.netutil.Resolver"><code class="xref py py-obj docutils literal"><span class="pre">Resolver</span></code></a> interface.</li>
</ul>
</div>
<div class="section" id="tornado-process">
<h7><a class="reference internal" href="index.html#module-tornado.process" title="tornado.process"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process</span></code></a><a class="headerlink" href="#tornado-process" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>New class <a class="reference internal" href="index.html#tornado.process.Subprocess" title="tornado.process.Subprocess"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process.Subprocess</span></code></a> wraps <a class="reference external" href="https://docs.python.org/3.4/library/subprocess.html#subprocess.Popen" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">subprocess.Popen</span></code></a> with
<a class="reference internal" href="index.html#tornado.iostream.PipeIOStream" title="tornado.iostream.PipeIOStream"><code class="xref py py-obj docutils literal"><span class="pre">PipeIOStream</span></code></a> access to the child&#8217;s file descriptors.</li>
</ul>
</div>
<div class="section" id="tornado-simple-httpclient">
<h7><code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code><a class="headerlink" href="#tornado-simple-httpclient" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">SimpleAsyncHTTPClient</span></code> now takes a <code class="docutils literal"><span class="pre">resolver</span></code> keyword argument
(which may be passed to either the constructor or <a class="reference internal" href="index.html#tornado.util.Configurable.configure" title="tornado.util.Configurable.configure"><code class="xref py py-obj docutils literal"><span class="pre">configure</span></code></a>), to allow it to use the new non-blocking
<a class="reference internal" href="index.html#tornado.netutil.Resolver" title="tornado.netutil.Resolver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil.Resolver</span></code></a>.</li>
<li>When following redirects, <code class="docutils literal"><span class="pre">SimpleAsyncHTTPClient</span></code> now treats a 302
response code the same as a 303.  This is contrary to the HTTP spec
but consistent with all browsers and other major HTTP clients
(including <code class="docutils literal"><span class="pre">CurlAsyncHTTPClient</span></code>).</li>
<li>The behavior of <code class="docutils literal"><span class="pre">header_callback</span></code> with <code class="docutils literal"><span class="pre">SimpleAsyncHTTPClient</span></code> has
changed and is now the same as that of <code class="docutils literal"><span class="pre">CurlAsyncHTTPClient</span></code>.  The
header callback now receives the first line of the response (e.g.
<code class="docutils literal"><span class="pre">HTTP/1.0</span> <span class="pre">200</span> <span class="pre">OK</span></code>) and the final empty line.</li>
<li><code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code> now accepts responses with a 304
status code that include a <code class="docutils literal"><span class="pre">Content-Length</span></code> header.</li>
<li>Fixed a bug in which <code class="docutils literal"><span class="pre">SimpleAsyncHTTPClient</span></code> callbacks were being run in the
client&#8217;s <code class="docutils literal"><span class="pre">stack_context</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-stack-context">
<h7><a class="reference internal" href="index.html#module-tornado.stack_context" title="tornado.stack_context"><code class="xref py py-obj docutils literal"><span class="pre">tornado.stack_context</span></code></a><a class="headerlink" href="#tornado-stack-context" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.stack_context.wrap" title="tornado.stack_context.wrap"><code class="xref py py-obj docutils literal"><span class="pre">stack_context.wrap</span></code></a> now runs the wrapped callback in a more consistent
environment by recreating contexts even if they already exist on the
stack.</li>
<li>Fixed a bug in which stack contexts could leak from one callback
chain to another.</li>
<li>Yield statements inside a <code class="docutils literal"><span class="pre">with</span></code> statement can cause stack
contexts to become inconsistent; an exception will now be raised
when this case is detected.</li>
</ul>
</div>
<div class="section" id="tornado-template">
<h7><a class="reference internal" href="index.html#module-tornado.template" title="tornado.template"><code class="xref py py-obj docutils literal"><span class="pre">tornado.template</span></code></a><a class="headerlink" href="#tornado-template" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>Errors while rendering templates no longer log the generated code,
since the enhanced stack traces (from version 2.1) should make this
unnecessary.</li>
<li>The <code class="docutils literal"><span class="pre">{%</span> <span class="pre">apply</span> <span class="pre">%}</span></code> directive now works properly with functions that return
both unicode strings and byte strings (previously only byte strings were
supported).</li>
<li>Code in templates is no longer affected by Tornado&#8217;s <code class="docutils literal"><span class="pre">__future__</span></code> imports
(which previously included <code class="docutils literal"><span class="pre">absolute_import</span></code> and <code class="docutils literal"><span class="pre">division</span></code>).</li>
</ul>
</div>
<div class="section" id="tornado-testing">
<h7><a class="reference internal" href="index.html#module-tornado.testing" title="tornado.testing"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing</span></code></a><a class="headerlink" href="#tornado-testing" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>New function <a class="reference internal" href="index.html#tornado.testing.bind_unused_port" title="tornado.testing.bind_unused_port"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.bind_unused_port</span></code></a> both chooses a port
and binds a socket to it, so there is no risk of another process
using the same port.  <code class="docutils literal"><span class="pre">get_unused_port</span></code> is now deprecated.</li>
<li>New decorator <a class="reference internal" href="index.html#tornado.testing.gen_test" title="tornado.testing.gen_test"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.gen_test</span></code></a> can be used to allow for
yielding <a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a> objects in tests, as an alternative to the
<code class="docutils literal"><span class="pre">stop</span></code> and <code class="docutils literal"><span class="pre">wait</span></code> methods of <a class="reference internal" href="index.html#tornado.testing.AsyncTestCase" title="tornado.testing.AsyncTestCase"><code class="xref py py-obj docutils literal"><span class="pre">AsyncTestCase</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.testing.AsyncTestCase" title="tornado.testing.AsyncTestCase"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.AsyncTestCase</span></code></a> and friends now extend <code class="docutils literal"><span class="pre">unittest2.TestCase</span></code>
when it is available (and continue to use the standard <code class="docutils literal"><span class="pre">unittest</span></code> module
when <code class="docutils literal"><span class="pre">unittest2</span></code> is not available)</li>
<li><a class="reference internal" href="index.html#tornado.testing.ExpectLog" title="tornado.testing.ExpectLog"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.ExpectLog</span></code></a> can be used as a finer-grained alternative
to <a class="reference internal" href="index.html#tornado.testing.LogTrapTestCase" title="tornado.testing.LogTrapTestCase"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.LogTrapTestCase</span></code></a></li>
<li>The command-line interface to <a class="reference internal" href="index.html#tornado.testing.main" title="tornado.testing.main"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.main</span></code></a> now supports
additional arguments from the underlying <a class="reference external" href="https://docs.python.org/3.4/library/unittest.html#module-unittest" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">unittest</span></code></a> module:
<code class="docutils literal"><span class="pre">verbose</span></code>, <code class="docutils literal"><span class="pre">quiet</span></code>, <code class="docutils literal"><span class="pre">failfast</span></code>, <code class="docutils literal"><span class="pre">catch</span></code>, <code class="docutils literal"><span class="pre">buffer</span></code>.</li>
<li>The deprecated <code class="docutils literal"><span class="pre">--autoreload</span></code> option of <a class="reference internal" href="index.html#tornado.testing.main" title="tornado.testing.main"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.main</span></code></a> has
been removed.  Use <code class="docutils literal"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">tornado.autoreload</span></code> as a prefix command
instead.</li>
<li>The <code class="docutils literal"><span class="pre">--httpclient</span></code> option of <a class="reference internal" href="index.html#tornado.testing.main" title="tornado.testing.main"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.main</span></code></a> has been moved
to <code class="docutils literal"><span class="pre">tornado.test.runtests</span></code> so as not to pollute the application
option namespace.  The <a class="reference internal" href="index.html#module-tornado.options" title="tornado.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options</span></code></a> module&#8217;s new callback
support now makes it easy to add options from a wrapper script
instead of putting all possible options in <a class="reference internal" href="index.html#tornado.testing.main" title="tornado.testing.main"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.main</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.testing.AsyncHTTPTestCase" title="tornado.testing.AsyncHTTPTestCase"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPTestCase</span></code></a> no longer calls <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient.close" title="tornado.httpclient.AsyncHTTPClient.close"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient.close</span></code></a> for tests
that use the singleton <a class="reference internal" href="index.html#tornado.ioloop.IOLoop.instance" title="tornado.ioloop.IOLoop.instance"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.instance</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.testing.LogTrapTestCase" title="tornado.testing.LogTrapTestCase"><code class="xref py py-obj docutils literal"><span class="pre">LogTrapTestCase</span></code></a> no longer fails when run in unknown logging
configurations.  This allows tests to be run under nose, which does its
own log buffering (<a class="reference internal" href="index.html#tornado.testing.LogTrapTestCase" title="tornado.testing.LogTrapTestCase"><code class="xref py py-obj docutils literal"><span class="pre">LogTrapTestCase</span></code></a> doesn&#8217;t do anything useful in this
case, but at least it doesn&#8217;t break things any more).</li>
</ul>
</div>
<div class="section" id="tornado-util">
<h7><code class="docutils literal"><span class="pre">tornado.util</span></code><a class="headerlink" href="#tornado-util" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">tornado.util.b</span></code> (which was only intended for internal use) is gone.</li>
</ul>
</div>
<div class="section" id="tornado-web">
<h7><a class="reference internal" href="index.html#module-tornado.web" title="tornado.web"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web</span></code></a><a class="headerlink" href="#tornado-web" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.set_header" title="tornado.web.RequestHandler.set_header"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.set_header</span></code></a> now overwrites previous header values
case-insensitively.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.RequestHandler</span></code></a> has new attributes <code class="docutils literal"><span class="pre">path_args</span></code> and
<code class="docutils literal"><span class="pre">path_kwargs</span></code>, which contain the positional and keyword arguments
that are passed to the <code class="docutils literal"><span class="pre">get</span></code>/<code class="docutils literal"><span class="pre">post</span></code>/etc method.  These attributes
are set before those methods are called, so they are available during
<code class="docutils literal"><span class="pre">prepare()</span></code></li>
<li><a class="reference internal" href="index.html#tornado.web.ErrorHandler" title="tornado.web.ErrorHandler"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.ErrorHandler</span></code></a> no longer requires XSRF tokens on <code class="docutils literal"><span class="pre">POST</span></code>
requests, so posts to an unknown url will always return 404 instead of
complaining about XSRF tokens.</li>
<li>Several methods related to HTTP status codes now take a <code class="docutils literal"><span class="pre">reason</span></code> keyword
argument to specify an alternate &#8220;reason&#8221; string (i.e. the &#8220;Not Found&#8221; in
&#8220;HTTP/1.1 404 Not Found&#8221;).  It is now possible to set status codes other
than those defined in the spec, as long as a reason string is given.</li>
<li>The <code class="docutils literal"><span class="pre">Date</span></code> HTTP header is now set by default on all responses.</li>
<li><code class="docutils literal"><span class="pre">Etag</span></code>/<code class="docutils literal"><span class="pre">If-None-Match</span></code> requests now work with <a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> no longer sets <code class="docutils literal"><span class="pre">Cache-Control:</span> <span class="pre">public</span></code> unnecessarily.</li>
<li>When gzip is enabled in a <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Application</span></code></a>, appropriate
<code class="docutils literal"><span class="pre">Vary:</span> <span class="pre">Accept-Encoding</span></code> headers are now sent.</li>
<li>It is no longer necessary to pass all handlers for a host in a single
<a class="reference internal" href="index.html#tornado.web.Application.add_handlers" title="tornado.web.Application.add_handlers"><code class="xref py py-obj docutils literal"><span class="pre">Application.add_handlers</span></code></a> call.  Now the request will be matched
against the handlers for any <code class="docutils literal"><span class="pre">host_pattern</span></code> that includes the request&#8217;s
<code class="docutils literal"><span class="pre">Host</span></code> header.</li>
</ul>
</div>
<div class="section" id="tornado-websocket">
<h7><a class="reference internal" href="index.html#module-tornado.websocket" title="tornado.websocket"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket</span></code></a><a class="headerlink" href="#tornado-websocket" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>Client-side WebSocket support is now available:
<a class="reference internal" href="index.html#tornado.websocket.websocket_connect" title="tornado.websocket.websocket_connect"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket.websocket_connect</span></code></a></li>
<li><a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler" title="tornado.websocket.WebSocketHandler"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler</span></code></a> has new methods <a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler.ping" title="tornado.websocket.WebSocketHandler.ping"><code class="xref py py-obj docutils literal"><span class="pre">ping</span></code></a> and
<a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler.on_pong" title="tornado.websocket.WebSocketHandler.on_pong"><code class="xref py py-obj docutils literal"><span class="pre">on_pong</span></code></a> to send pings to the browser (not
supported on the <code class="docutils literal"><span class="pre">draft76</span></code> protocol)</li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-releases/v2.4.1"></span><div class="section" id="what-s-new-in-tornado-2-4-1">
<h4>What&#8217;s new in Tornado 2.4.1<a class="headerlink" href="#what-s-new-in-tornado-2-4-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="nov-24-2012">
<h5>Nov 24, 2012<a class="headerlink" href="#nov-24-2012" title="永久链接至标题">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Fixed a memory leak in <a class="reference internal" href="index.html#module-tornado.stack_context" title="tornado.stack_context"><code class="xref py py-obj docutils literal"><span class="pre">tornado.stack_context</span></code></a> that was especially likely
with long-running <code class="docutils literal"><span class="pre">&#64;gen.engine</span></code> functions.</li>
<li><a class="reference internal" href="index.html#tornado.auth.TwitterMixin" title="tornado.auth.TwitterMixin"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth.TwitterMixin</span></code></a> now works on Python 3.</li>
<li>Fixed a bug in which <code class="docutils literal"><span class="pre">IOStream.read_until_close</span></code> with a streaming callback
would sometimes pass the last chunk of data to the final callback instead
of the streaming callback.</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v2.4.0"></span><div class="section" id="what-s-new-in-tornado-2-4">
<h4>What&#8217;s new in Tornado 2.4<a class="headerlink" href="#what-s-new-in-tornado-2-4" title="永久链接至标题">¶</a></h4>
<div class="section" id="sep-4-2012">
<h5>Sep 4, 2012<a class="headerlink" href="#sep-4-2012" title="永久链接至标题">¶</a></h5>
<div class="section" id="general">
<h6>General<a class="headerlink" href="#general" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Fixed Python 3 bugs in <a class="reference internal" href="index.html#module-tornado.auth" title="tornado.auth"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth</span></code></a>, <a class="reference internal" href="index.html#module-tornado.locale" title="tornado.locale"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locale</span></code></a>, and <a class="reference internal" href="index.html#module-tornado.wsgi" title="tornado.wsgi"><code class="xref py py-obj docutils literal"><span class="pre">tornado.wsgi</span></code></a>.</li>
</ul>
</div>
<div class="section" id="http-clients">
<h6>HTTP clients<a class="headerlink" href="#http-clients" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Removed <code class="docutils literal"><span class="pre">max_simultaneous_connections</span></code> argument from <a class="reference internal" href="index.html#module-tornado.httpclient" title="tornado.httpclient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient</span></code></a>
(both implementations).  This argument hasn&#8217;t been useful for some time
(if you were using it you probably want <code class="docutils literal"><span class="pre">max_clients</span></code> instead)</li>
<li><code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code> now accepts and ignores HTTP 1xx status
responses.</li>
</ul>
</div>
<div class="section" id="tornado-ioloop-and-tornado-iostream">
<h6><a class="reference internal" href="index.html#module-tornado.ioloop" title="tornado.ioloop"><code class="xref py py-obj docutils literal"><span class="pre">tornado.ioloop</span></code></a> and <a class="reference internal" href="index.html#module-tornado.iostream" title="tornado.iostream"><code class="xref py py-obj docutils literal"><span class="pre">tornado.iostream</span></code></a><a class="headerlink" href="#tornado-ioloop-and-tornado-iostream" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Fixed a bug introduced in 2.3 that would cause <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> close callbacks
to not run if there were pending reads.</li>
<li>Improved error handling in <a class="reference internal" href="index.html#tornado.iostream.SSLIOStream" title="tornado.iostream.SSLIOStream"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream</span></code></a> and SSL-enabled <a class="reference internal" href="index.html#tornado.tcpserver.TCPServer" title="tornado.tcpserver.TCPServer"><code class="xref py py-obj docutils literal"><span class="pre">TCPServer</span></code></a>.</li>
<li><code class="docutils literal"><span class="pre">SSLIOStream.get_ssl_certificate</span></code> now has a <code class="docutils literal"><span class="pre">binary_form</span></code> argument
which is passed to <code class="docutils literal"><span class="pre">SSLSocket.getpeercert</span></code>.</li>
<li><code class="docutils literal"><span class="pre">SSLIOStream.write</span></code> can now be called while the connection is in progress,
same as non-SSL <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> (but be careful not to send sensitive data until
the connection has completed and the certificate has been verified).</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_handler" title="tornado.ioloop.IOLoop.add_handler"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_handler</span></code></a> cannot be called more than once with the same file
descriptor.  This was always true for <code class="docutils literal"><span class="pre">epoll</span></code>, but now the other
implementations enforce it too.</li>
<li>On Windows, <a class="reference internal" href="index.html#tornado.tcpserver.TCPServer" title="tornado.tcpserver.TCPServer"><code class="xref py py-obj docutils literal"><span class="pre">TCPServer</span></code></a> uses <code class="docutils literal"><span class="pre">SO_EXCLUSIVEADDRUSER</span></code> instead of <code class="docutils literal"><span class="pre">SO_REUSEADDR</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-template">
<h6><a class="reference internal" href="index.html#module-tornado.template" title="tornado.template"><code class="xref py py-obj docutils literal"><span class="pre">tornado.template</span></code></a><a class="headerlink" href="#tornado-template" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">{%</span> <span class="pre">break</span> <span class="pre">%}</span></code> and <code class="docutils literal"><span class="pre">{%</span> <span class="pre">continue</span> <span class="pre">%}</span></code> can now be used looping constructs
in templates.</li>
<li>It is no longer an error for an if/else/for/etc block in a template to
have an empty body.</li>
</ul>
</div>
<div class="section" id="tornado-testing">
<h6><a class="reference internal" href="index.html#module-tornado.testing" title="tornado.testing"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing</span></code></a><a class="headerlink" href="#tornado-testing" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>New class <a class="reference internal" href="index.html#tornado.testing.AsyncHTTPSTestCase" title="tornado.testing.AsyncHTTPSTestCase"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.AsyncHTTPSTestCase</span></code></a> is like <a class="reference internal" href="index.html#tornado.testing.AsyncHTTPTestCase" title="tornado.testing.AsyncHTTPTestCase"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPTestCase</span></code></a>.
but enables SSL for the testing server (by default using a self-signed
testing certificate).</li>
<li><a class="reference internal" href="index.html#tornado.testing.main" title="tornado.testing.main"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.main</span></code></a> now accepts additional keyword arguments and forwards
them to <a class="reference external" href="https://docs.python.org/3.4/library/unittest.html#unittest.main" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">unittest.main</span></code></a>.</li>
</ul>
</div>
<div class="section" id="tornado-web">
<h6><a class="reference internal" href="index.html#module-tornado.web" title="tornado.web"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web</span></code></a><a class="headerlink" href="#tornado-web" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>New method <a class="reference internal" href="index.html#tornado.web.RequestHandler.get_template_namespace" title="tornado.web.RequestHandler.get_template_namespace"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_template_namespace</span></code></a> can be overridden to
add additional variables without modifying keyword arguments to
<code class="docutils literal"><span class="pre">render_string</span></code>.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.add_header" title="tornado.web.RequestHandler.add_header"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.add_header</span></code></a> now works with <a class="reference internal" href="index.html#tornado.wsgi.WSGIApplication" title="tornado.wsgi.WSGIApplication"><code class="xref py py-obj docutils literal"><span class="pre">WSGIApplication</span></code></a>.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.get_secure_cookie" title="tornado.web.RequestHandler.get_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_secure_cookie</span></code></a> now handles a potential error case.</li>
<li><code class="docutils literal"><span class="pre">RequestHandler.__init__</span></code> now calls <code class="docutils literal"><span class="pre">super().__init__</span></code> to ensure that
all constructors are called when multiple inheritance is used.</li>
<li>Docs have been updated with a description of all available
<a class="reference internal" href="index.html#tornado.web.Application.settings" title="tornado.web.Application.settings"><code class="xref py py-attr docutils literal"><span class="pre">Application</span> <span class="pre">settings</span></code></a></li>
</ul>
</div>
<div class="section" id="other-modules">
<h6>Other modules<a class="headerlink" href="#other-modules" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.auth.OAuthMixin" title="tornado.auth.OAuthMixin"><code class="xref py py-obj docutils literal"><span class="pre">OAuthMixin</span></code></a> now accepts <code class="docutils literal"><span class="pre">&quot;oob&quot;</span></code> as a <code class="docutils literal"><span class="pre">callback_uri</span></code>.</li>
<li><a class="reference internal" href="index.html#tornado.auth.OpenIdMixin" title="tornado.auth.OpenIdMixin"><code class="xref py py-obj docutils literal"><span class="pre">OpenIdMixin</span></code></a> now also returns the <code class="docutils literal"><span class="pre">claimed_id</span></code> field for the user.</li>
<li><a class="reference internal" href="index.html#module-tornado.platform.twisted" title="tornado.platform.twisted"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.twisted</span></code></a> shutdown sequence is now more compatible.</li>
<li>The logging configuration used in <a class="reference internal" href="index.html#module-tornado.options" title="tornado.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options</span></code></a> is now more tolerant
of non-ascii byte strings.</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v2.3.0"></span><div class="section" id="what-s-new-in-tornado-2-3">
<h4>What&#8217;s new in Tornado 2.3<a class="headerlink" href="#what-s-new-in-tornado-2-3" title="永久链接至标题">¶</a></h4>
<div class="section" id="may-31-2012">
<h5>May 31, 2012<a class="headerlink" href="#may-31-2012" title="永久链接至标题">¶</a></h5>
<div class="section" id="http-clients">
<h6>HTTP clients<a class="headerlink" href="#http-clients" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httpclient.HTTPClient" title="tornado.httpclient.HTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient.HTTPClient</span></code></a> now supports the same constructor
keyword arguments as <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient" title="tornado.httpclient.AsyncHTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient</span></code></a>.</li>
<li>The <code class="docutils literal"><span class="pre">max_clients</span></code> keyword argument to <a class="reference internal" href="index.html#tornado.httpclient.AsyncHTTPClient.configure" title="tornado.httpclient.AsyncHTTPClient.configure"><code class="xref py py-obj docutils literal"><span class="pre">AsyncHTTPClient.configure</span></code></a> now works.</li>
<li><code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code> now supports the <code class="docutils literal"><span class="pre">OPTIONS</span></code> and <code class="docutils literal"><span class="pre">PATCH</span></code>
HTTP methods.</li>
<li><code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code> is better about closing its sockets
instead of leaving them for garbage collection.</li>
<li><code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code> correctly verifies SSL certificates for
URLs containing IPv6 literals (This bug affected Python 2.5 and 2.6).</li>
<li><code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code> no longer includes basic auth credentials
in the <code class="docutils literal"><span class="pre">Host</span></code> header when those credentials are extracted from the URL.</li>
<li><code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code> no longer modifies the caller-supplied header
dictionary, which caused problems when following redirects.</li>
<li><code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code> now supports client SSL certificates (using
the same <code class="docutils literal"><span class="pre">client_cert</span></code> and <code class="docutils literal"><span class="pre">client_key</span></code> arguments as
<code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code>)</li>
</ul>
</div>
<div class="section" id="http-server">
<h6>HTTP Server<a class="headerlink" href="#http-server" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> now works correctly with paths starting with <code class="docutils literal"><span class="pre">//</span></code></li>
<li><code class="docutils literal"><span class="pre">HTTPHeaders.copy</span></code> (inherited from <a class="reference external" href="https://docs.python.org/3.4/library/stdtypes.html#dict.copy" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">dict.copy</span></code></a>) now works correctly.</li>
<li><code class="docutils literal"><span class="pre">HTTPConnection.address</span></code> is now always the socket address, even for non-IP
sockets.  <code class="docutils literal"><span class="pre">HTTPRequest.remote_ip</span></code> is still always an IP-style address
(fake data is used for non-IP sockets)</li>
<li>Extra data at the end of multipart form bodies is now ignored, which fixes
a compatibility problem with an iOS HTTP client library.</li>
</ul>
</div>
<div class="section" id="ioloop-and-iostream">
<h6><code class="docutils literal"><span class="pre">IOLoop</span></code> and <code class="docutils literal"><span class="pre">IOStream</span></code><a class="headerlink" href="#ioloop-and-iostream" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> now has an <code class="docutils literal"><span class="pre">error</span></code> attribute that can be used to determine
why a socket was closed.</li>
<li><code class="docutils literal"><span class="pre">tornado.iostream.IOStream.read_until</span></code> and <code class="docutils literal"><span class="pre">read_until_regex</span></code> are much
faster with large input.</li>
<li><code class="docutils literal"><span class="pre">IOStream.write</span></code> performs better when given very large strings.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop.instance" title="tornado.ioloop.IOLoop.instance"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.instance()</span></code></a> is now thread-safe.</li>
</ul>
</div>
<div class="section" id="tornado-options">
<h6><code class="docutils literal"><span class="pre">tornado.options</span></code><a class="headerlink" href="#tornado-options" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#module-tornado.options" title="tornado.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options</span></code></a> options with <code class="docutils literal"><span class="pre">multiple=True</span></code> that are set more than
once now overwrite rather than append.  This makes it possible to override
values set in <code class="docutils literal"><span class="pre">parse_config_file</span></code> with <code class="docutils literal"><span class="pre">parse_command_line</span></code>.</li>
<li><a class="reference internal" href="index.html#module-tornado.options" title="tornado.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options</span></code></a> <code class="docutils literal"><span class="pre">--help</span></code> output is now prettier.</li>
<li><a class="reference internal" href="index.html#tornado.options.options" title="tornado.options.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.options</span></code></a> now supports attribute assignment.</li>
</ul>
</div>
<div class="section" id="tornado-template">
<h6><code class="docutils literal"><span class="pre">tornado.template</span></code><a class="headerlink" href="#tornado-template" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Template files containing non-ASCII (utf8) characters now work on Python 3
regardless of the locale environment variables.</li>
<li>Templates now support <code class="docutils literal"><span class="pre">else</span></code> clauses in
<code class="docutils literal"><span class="pre">try</span></code>/<code class="docutils literal"><span class="pre">except</span></code>/<code class="docutils literal"><span class="pre">finally</span></code>/<code class="docutils literal"><span class="pre">else</span></code> blocks.</li>
</ul>
</div>
<div class="section" id="tornado-web">
<h6><code class="docutils literal"><span class="pre">tornado.web</span></code><a class="headerlink" href="#tornado-web" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.RequestHandler</span></code></a> now supports the <code class="docutils literal"><span class="pre">PATCH</span></code> HTTP method.
Note that this means any existing methods named <code class="docutils literal"><span class="pre">patch</span></code> in
<code class="docutils literal"><span class="pre">RequestHandler</span></code> subclasses will need to be renamed.</li>
<li><a class="reference internal" href="index.html#tornado.web.addslash" title="tornado.web.addslash"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.addslash</span></code></a> and <code class="docutils literal"><span class="pre">removeslash</span></code> decorators now send permanent
redirects (301) instead of temporary (302).</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.flush" title="tornado.web.RequestHandler.flush"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.flush</span></code></a> now invokes its callback whether there was any data
to flush or not.</li>
<li>Repeated calls to <a class="reference internal" href="index.html#tornado.web.RequestHandler.set_cookie" title="tornado.web.RequestHandler.set_cookie"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.set_cookie</span></code></a> with the same name now
overwrite the previous cookie instead of producing additional copies.</li>
<li><code class="docutils literal"><span class="pre">tornado.web.OutputTransform.transform_first_chunk</span></code> now takes and returns
a status code in addition to the headers and chunk.  This is a
backwards-incompatible change to an interface that was never technically
private, but was not included in the documentation and does not appear
to have been used outside Tornado itself.</li>
<li>Fixed a bug on python versions before 2.6.5 when <a class="reference internal" href="index.html#tornado.web.URLSpec" title="tornado.web.URLSpec"><code class="xref py py-obj docutils literal"><span class="pre">URLSpec</span></code></a> regexes
are constructed from unicode strings and keyword arguments are extracted.</li>
<li>The <code class="docutils literal"><span class="pre">reverse_url</span></code> function in the template namespace now comes from
the <a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a> rather than the <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a>.  (Unless overridden,
<a class="reference internal" href="index.html#tornado.web.RequestHandler.reverse_url" title="tornado.web.RequestHandler.reverse_url"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.reverse_url</span></code></a> is just an alias for the <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">Application</span></code></a>
method).</li>
<li>The <code class="docutils literal"><span class="pre">Etag</span></code> header is now returned on 304 responses to an <code class="docutils literal"><span class="pre">If-None-Match</span></code>
request, improving compatibility with some caches.</li>
<li><a class="reference internal" href="index.html#module-tornado.web" title="tornado.web"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web</span></code></a> will no longer produce responses with status code 304
that also have entity headers such as <code class="docutils literal"><span class="pre">Content-Length</span></code>.</li>
</ul>
</div>
<div class="section" id="other-modules">
<h6>Other modules<a class="headerlink" href="#other-modules" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.auth.FacebookGraphMixin" title="tornado.auth.FacebookGraphMixin"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth.FacebookGraphMixin</span></code></a> no longer sends <code class="docutils literal"><span class="pre">post_args</span></code> redundantly
in the url.</li>
<li>The <code class="docutils literal"><span class="pre">extra_params</span></code> argument to <a class="reference internal" href="index.html#tornado.escape.linkify" title="tornado.escape.linkify"><code class="xref py py-obj docutils literal"><span class="pre">tornado.escape.linkify</span></code></a> may now be
a callable, to allow parameters to be chosen separately for each link.</li>
<li><a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a> no longer leaks <code class="docutils literal"><span class="pre">StackContexts</span></code> when a <code class="docutils literal"><span class="pre">&#64;gen.engine</span></code> wrapped
function is called repeatedly.</li>
<li><a class="reference internal" href="index.html#tornado.locale.get_supported_locales" title="tornado.locale.get_supported_locales"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locale.get_supported_locales</span></code></a> no longer takes a meaningless
<code class="docutils literal"><span class="pre">cls</span></code> argument.</li>
<li><a class="reference internal" href="index.html#tornado.stack_context.StackContext" title="tornado.stack_context.StackContext"><code class="xref py py-obj docutils literal"><span class="pre">StackContext</span></code></a> instances now have a deactivation callback that can be
used to prevent further propagation.</li>
<li><a class="reference internal" href="index.html#tornado.testing.AsyncTestCase.wait" title="tornado.testing.AsyncTestCase.wait"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.AsyncTestCase.wait</span></code></a> now resets its timeout on each call.</li>
<li><a class="reference internal" href="index.html#tornado.wsgi.WSGIApplication" title="tornado.wsgi.WSGIApplication"><code class="xref py py-obj docutils literal"><span class="pre">tornado.wsgi.WSGIApplication</span></code></a> now parses arguments correctly on Python 3.</li>
<li>Exception handling on Python 3 has been improved; previously some exceptions
such as <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#UnicodeDecodeError" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">UnicodeDecodeError</span></code></a> would generate <code class="docutils literal"><span class="pre">TypeErrors</span></code></li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v2.2.1"></span><div class="section" id="what-s-new-in-tornado-2-2-1">
<h4>What&#8217;s new in Tornado 2.2.1<a class="headerlink" href="#what-s-new-in-tornado-2-2-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="apr-23-2012">
<h5>Apr 23, 2012<a class="headerlink" href="#apr-23-2012" title="永久链接至标题">¶</a></h5>
<div class="section" id="security-fixes">
<h6>Security fixes<a class="headerlink" href="#security-fixes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.set_header" title="tornado.web.RequestHandler.set_header"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.RequestHandler.set_header</span></code></a> now properly sanitizes input
values to protect against header injection, response splitting, etc.
(it has always attempted to do this, but the check was incorrect).
Note that redirects, the most likely source of such bugs, are protected
by a separate check in <a class="reference internal" href="index.html#tornado.web.RequestHandler.redirect" title="tornado.web.RequestHandler.redirect"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.redirect</span></code></a>.</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Colored logging configuration in <a class="reference internal" href="index.html#module-tornado.options" title="tornado.options"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options</span></code></a> is compatible with
Python 3.2.3 (and 3.3).</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v2.2.0"></span><div class="section" id="what-s-new-in-tornado-2-2">
<h4>What&#8217;s new in Tornado 2.2<a class="headerlink" href="#what-s-new-in-tornado-2-2" title="永久链接至标题">¶</a></h4>
<div class="section" id="jan-30-2012">
<h5>Jan 30, 2012<a class="headerlink" href="#jan-30-2012" title="永久链接至标题">¶</a></h5>
<div class="section" id="highlights">
<h6>Highlights<a class="headerlink" href="#highlights" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Updated and expanded WebSocket support.</li>
<li>Improved compatibility in the Twisted/Tornado bridge.</li>
<li>Template errors now generate better stack traces.</li>
<li>Better exception handling in <a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a>.</li>
</ul>
</div>
<div class="section" id="security-fixes">
<h6>Security fixes<a class="headerlink" href="#security-fixes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code> now disables SSLv2 in all cases.  Previously
SSLv2 would be allowed if the Python interpreter was linked against a
pre-1.0 version of OpenSSL.</li>
</ul>
</div>
<div class="section" id="backwards-incompatible-changes">
<h6>Backwards-incompatible changes<a class="headerlink" href="#backwards-incompatible-changes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.process.fork_processes" title="tornado.process.fork_processes"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process.fork_processes</span></code></a> now raises <a class="reference external" href="https://docs.python.org/3.4/library/exceptions.html#SystemExit" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">SystemExit</span></code></a> if all child
processes exit cleanly rather than returning <code class="docutils literal"><span class="pre">None</span></code>.  The old behavior
was surprising and inconsistent with most of the documented examples
of this function (which did not check the return value).</li>
<li>On Python 2.6, <code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code> only supports SSLv3.  This
is because Python 2.6 does not expose a way to support both SSLv3 and TLSv1
without also supporting the insecure SSLv2.</li>
<li><a class="reference internal" href="index.html#module-tornado.websocket" title="tornado.websocket"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket</span></code></a> no longer supports the older &#8220;draft 76&#8221; version
of the websocket protocol by default, although this version can
be enabled by overriding <code class="docutils literal"><span class="pre">tornado.websocket.WebSocketHandler.allow_draft76</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-httpclient">
<h6><code class="docutils literal"><span class="pre">tornado.httpclient</span></code><a class="headerlink" href="#tornado-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">SimpleAsyncHTTPClient</span></code> no longer hangs on <code class="docutils literal"><span class="pre">HEAD</span></code> requests,
responses with no content, or empty <code class="docutils literal"><span class="pre">POST</span></code>/<code class="docutils literal"><span class="pre">PUT</span></code> response bodies.</li>
<li><code class="docutils literal"><span class="pre">SimpleAsyncHTTPClient</span></code> now supports 303 and 307 redirect codes.</li>
<li><code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code> now accepts non-integer timeouts.</li>
<li><code class="docutils literal"><span class="pre">tornado.curl_httpclient</span></code> now supports basic authentication with an
empty password.</li>
</ul>
</div>
<div class="section" id="tornado-httpserver">
<h6><code class="docutils literal"><span class="pre">tornado.httpserver</span></code><a class="headerlink" href="#tornado-httpserver" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> with <code class="docutils literal"><span class="pre">xheaders=True</span></code> will no longer accept
<code class="docutils literal"><span class="pre">X-Real-IP</span></code> headers that don&#8217;t look like valid IP addresses.</li>
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> now treats the <code class="docutils literal"><span class="pre">Connection</span></code> request header as
case-insensitive.</li>
</ul>
</div>
<div class="section" id="tornado-ioloop-and-tornado-iostream">
<h6><code class="docutils literal"><span class="pre">tornado.ioloop</span></code> and <code class="docutils literal"><span class="pre">tornado.iostream</span></code><a class="headerlink" href="#tornado-ioloop-and-tornado-iostream" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">IOStream.write</span></code> now works correctly when given an empty string.</li>
<li><code class="docutils literal"><span class="pre">IOStream.read_until</span></code> (and <code class="docutils literal"><span class="pre">read_until_regex</span></code>) now perform better
when there is a lot of buffered data, which improves peformance of
<code class="docutils literal"><span class="pre">SimpleAsyncHTTPClient</span></code> when downloading files with lots of
chunks.</li>
<li><a class="reference internal" href="index.html#tornado.iostream.SSLIOStream" title="tornado.iostream.SSLIOStream"><code class="xref py py-obj docutils literal"><span class="pre">SSLIOStream</span></code></a> now works correctly when <code class="docutils literal"><span class="pre">ssl_version</span></code> is set to
a value other than <code class="docutils literal"><span class="pre">SSLv23</span></code>.</li>
<li>Idle <code class="docutils literal"><span class="pre">IOLoops</span></code> no longer wake up several times a second.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.PeriodicCallback" title="tornado.ioloop.PeriodicCallback"><code class="xref py py-obj docutils literal"><span class="pre">tornado.ioloop.PeriodicCallback</span></code></a> no longer triggers duplicate callbacks
when stopped and started repeatedly.</li>
</ul>
</div>
<div class="section" id="tornado-template">
<h6><code class="docutils literal"><span class="pre">tornado.template</span></code><a class="headerlink" href="#tornado-template" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Exceptions in template code will now show better stack traces that
reference lines from the original template file.</li>
<li><code class="docutils literal"><span class="pre">{#</span></code> and <code class="docutils literal"><span class="pre">#}</span></code> can now be used for comments (and unlike the old
<code class="docutils literal"><span class="pre">{%</span> <span class="pre">comment</span> <span class="pre">%}</span></code> directive, these can wrap other template directives).</li>
<li>Template directives may now span multiple lines.</li>
</ul>
</div>
<div class="section" id="tornado-web">
<h6><code class="docutils literal"><span class="pre">tornado.web</span></code><a class="headerlink" href="#tornado-web" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Now behaves better when given malformed <code class="docutils literal"><span class="pre">Cookie</span></code> headers</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.redirect" title="tornado.web.RequestHandler.redirect"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.redirect</span></code></a> now has a <code class="docutils literal"><span class="pre">status</span></code> argument to send
status codes other than 301 and 302.</li>
<li>New method <a class="reference internal" href="index.html#tornado.web.RequestHandler.on_finish" title="tornado.web.RequestHandler.on_finish"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.on_finish</span></code></a> may be overridden for post-request
processing (as a counterpart to <a class="reference internal" href="index.html#tornado.web.RequestHandler.prepare" title="tornado.web.RequestHandler.prepare"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.prepare</span></code></a>)</li>
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> now outputs <code class="docutils literal"><span class="pre">Content-Length</span></code> and <code class="docutils literal"><span class="pre">Etag</span></code> headers
on <code class="docutils literal"><span class="pre">HEAD</span></code> requests.</li>
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> now has overridable <code class="docutils literal"><span class="pre">get_version</span></code> and
<code class="docutils literal"><span class="pre">parse_url_path</span></code> methods for use in subclasses.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.static_url" title="tornado.web.RequestHandler.static_url"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.static_url</span></code></a> now takes an <code class="docutils literal"><span class="pre">include_host</span></code> parameter
(in addition to the old support for the <code class="docutils literal"><span class="pre">RequestHandler.include_host</span></code>
attribute).</li>
</ul>
</div>
<div class="section" id="tornado-websocket">
<h6><code class="docutils literal"><span class="pre">tornado.websocket</span></code><a class="headerlink" href="#tornado-websocket" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Updated to support the latest version of the protocol, as finalized
in RFC 6455.</li>
<li>Many bugs were fixed in all supported protocol versions.</li>
<li><a class="reference internal" href="index.html#module-tornado.websocket" title="tornado.websocket"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket</span></code></a> no longer supports the older &#8220;draft 76&#8221; version
of the websocket protocol by default, although this version can
be enabled by overriding <code class="docutils literal"><span class="pre">tornado.websocket.WebSocketHandler.allow_draft76</span></code>.</li>
<li><a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler.write_message" title="tornado.websocket.WebSocketHandler.write_message"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler.write_message</span></code></a> now accepts a <code class="docutils literal"><span class="pre">binary</span></code> argument
to send binary messages.</li>
<li>Subprotocols (i.e. the <code class="docutils literal"><span class="pre">Sec-WebSocket-Protocol</span></code> header) are now supported;
see the <a class="reference internal" href="index.html#tornado.websocket.WebSocketHandler.select_subprotocol" title="tornado.websocket.WebSocketHandler.select_subprotocol"><code class="xref py py-obj docutils literal"><span class="pre">WebSocketHandler.select_subprotocol</span></code></a> method for details.</li>
<li><code class="docutils literal"><span class="pre">.WebSocketHandler.get_websocket_scheme</span></code> can be used to select the
appropriate url scheme (<code class="docutils literal"><span class="pre">ws://</span></code> or <code class="docutils literal"><span class="pre">wss://</span></code>) in cases where
<code class="docutils literal"><span class="pre">HTTPRequest.protocol</span></code> is not set correctly.</li>
</ul>
</div>
<div class="section" id="other-modules">
<h6>Other modules<a class="headerlink" href="#other-modules" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.auth.TwitterMixin.authenticate_redirect" title="tornado.auth.TwitterMixin.authenticate_redirect"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth.TwitterMixin.authenticate_redirect</span></code></a> now takes a
<code class="docutils literal"><span class="pre">callback_uri</span></code> parameter.</li>
<li><a class="reference internal" href="index.html#tornado.auth.TwitterMixin.twitter_request" title="tornado.auth.TwitterMixin.twitter_request"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth.TwitterMixin.twitter_request</span></code></a> now accepts both URLs and
partial paths (complete URLs are useful for the search API which follows
different patterns).</li>
<li>Exception handling in <a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a> has been improved.  It is now possible
to catch exceptions thrown by a <code class="docutils literal"><span class="pre">Task</span></code>.</li>
<li><a class="reference internal" href="index.html#tornado.netutil.bind_sockets" title="tornado.netutil.bind_sockets"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil.bind_sockets</span></code></a> now works when <code class="docutils literal"><span class="pre">getaddrinfo</span></code> returns
duplicate addresses.</li>
<li><a class="reference internal" href="index.html#module-tornado.platform.twisted" title="tornado.platform.twisted"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.twisted</span></code></a> compatibility has been significantly improved.
Twisted version 11.1.0 is now supported in addition to 11.0.0.</li>
<li><a class="reference internal" href="index.html#tornado.process.fork_processes" title="tornado.process.fork_processes"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process.fork_processes</span></code></a> correctly reseeds the <a class="reference external" href="https://docs.python.org/3.4/library/random.html#module-random" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">random</span></code></a> module
even when <a class="reference external" href="https://docs.python.org/3.4/library/os.html#os.urandom" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">os.urandom</span></code></a> is not implemented.</li>
<li><a class="reference internal" href="index.html#tornado.testing.main" title="tornado.testing.main"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.main</span></code></a> supports a new flag <code class="docutils literal"><span class="pre">--exception_on_interrupt</span></code>,
which can be set to false to make <code class="docutils literal"><span class="pre">Ctrl-C</span></code> kill the process more
reliably (at the expense of stack traces when it does so).</li>
<li><code class="docutils literal"><span class="pre">tornado.version_info</span></code> is now a four-tuple so official releases can be
distinguished from development branches.</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v2.1.1"></span><div class="section" id="what-s-new-in-tornado-2-1-1">
<h4>What&#8217;s new in Tornado 2.1.1<a class="headerlink" href="#what-s-new-in-tornado-2-1-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="oct-4-2011">
<h5>Oct 4, 2011<a class="headerlink" href="#oct-4-2011" title="永久链接至标题">¶</a></h5>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Fixed handling of closed connections with the <code class="docutils literal"><span class="pre">epoll</span></code> (i.e. Linux)
<code class="docutils literal"><span class="pre">IOLoop</span></code>.  Previously, closed connections could be shut down too early,
which most often manifested as &#8220;Stream is closed&#8221; exceptions in
<code class="docutils literal"><span class="pre">SimpleAsyncHTTPClient</span></code>.</li>
<li>Fixed a case in which chunked responses could be closed prematurely,
leading to truncated output.</li>
<li><code class="docutils literal"><span class="pre">IOStream.connect</span></code> now reports errors more consistently via logging
and the close callback (this affects e.g. connections to localhost
on FreeBSD).</li>
<li><code class="docutils literal"><span class="pre">IOStream.read_bytes</span></code> again accepts both <code class="docutils literal"><span class="pre">int</span></code> and <code class="docutils literal"><span class="pre">long</span></code> arguments.</li>
<li><code class="docutils literal"><span class="pre">PeriodicCallback</span></code> no longer runs repeatedly when <code class="docutils literal"><span class="pre">IOLoop</span></code> iterations
complete faster than the resolution of <code class="docutils literal"><span class="pre">time.time()</span></code> (mainly a problem
on Windows).</li>
</ul>
</div>
<div class="section" id="backwards-compatibility-note">
<h6>Backwards-compatibility note<a class="headerlink" href="#backwards-compatibility-note" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Listening for <code class="docutils literal"><span class="pre">IOLoop.ERROR</span></code> alone is no longer sufficient for detecting
closed connections on an otherwise unused socket.  <code class="docutils literal"><span class="pre">IOLoop.ERROR</span></code> must
always be used in combination with <code class="docutils literal"><span class="pre">READ</span></code> or <code class="docutils literal"><span class="pre">WRITE</span></code>.</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v2.1.0"></span><div class="section" id="what-s-new-in-tornado-2-1">
<h4>What&#8217;s new in Tornado 2.1<a class="headerlink" href="#what-s-new-in-tornado-2-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="sep-20-2011">
<h5>Sep 20, 2011<a class="headerlink" href="#sep-20-2011" title="永久链接至标题">¶</a></h5>
<div class="section" id="backwards-incompatible-changes">
<h6>Backwards-incompatible changes<a class="headerlink" href="#backwards-incompatible-changes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Support for secure cookies written by pre-1.0 releases of Tornado has
been removed.  The <a class="reference internal" href="index.html#tornado.web.RequestHandler.get_secure_cookie" title="tornado.web.RequestHandler.get_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.get_secure_cookie</span></code></a> method no longer
takes an <code class="docutils literal"><span class="pre">include_name</span></code> parameter.</li>
<li>The <code class="docutils literal"><span class="pre">debug</span></code> application setting now causes stack traces to be displayed
in the browser on uncaught exceptions.  Since this may leak sensitive
information, debug mode is not recommended for public-facing servers.</li>
</ul>
</div>
<div class="section" id="security-fixes">
<h6>Security fixes<a class="headerlink" href="#security-fixes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Diginotar has been removed from the default CA certificates file used
by <code class="docutils literal"><span class="pre">SimpleAsyncHTTPClient</span></code>.</li>
</ul>
</div>
<div class="section" id="new-modules">
<h6>New modules<a class="headerlink" href="#new-modules" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#module-tornado.gen" title="tornado.gen"><code class="xref py py-obj docutils literal"><span class="pre">tornado.gen</span></code></a>:  A generator-based interface to simplify writing
asynchronous functions.</li>
<li><a class="reference internal" href="index.html#module-tornado.netutil" title="tornado.netutil"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil</span></code></a>:  Parts of <a class="reference internal" href="index.html#module-tornado.httpserver" title="tornado.httpserver"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpserver</span></code></a> have been extracted into
a new module for use with non-HTTP protocols.</li>
<li><a class="reference internal" href="index.html#module-tornado.platform.twisted" title="tornado.platform.twisted"><code class="xref py py-obj docutils literal"><span class="pre">tornado.platform.twisted</span></code></a>:  A bridge between the Tornado IOLoop and the
Twisted Reactor, allowing code written for Twisted to be run on Tornado.</li>
<li><a class="reference internal" href="index.html#module-tornado.process" title="tornado.process"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process</span></code></a>:  Multi-process mode has been improved, and can now restart
crashed child processes.  A new entry point has been added at
<a class="reference internal" href="index.html#tornado.process.fork_processes" title="tornado.process.fork_processes"><code class="xref py py-obj docutils literal"><span class="pre">tornado.process.fork_processes</span></code></a>, although
<code class="docutils literal"><span class="pre">tornado.httpserver.HTTPServer.start</span></code> is still supported.</li>
</ul>
</div>
<div class="section" id="tornado-web">
<h6><code class="docutils literal"><span class="pre">tornado.web</span></code><a class="headerlink" href="#tornado-web" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.write_error" title="tornado.web.RequestHandler.write_error"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.RequestHandler.write_error</span></code></a> replaces <code class="docutils literal"><span class="pre">get_error_html</span></code> as the
preferred way to generate custom error pages (<code class="docutils literal"><span class="pre">get_error_html</span></code> is still
supported, but deprecated)</li>
<li>In <a class="reference internal" href="index.html#tornado.web.Application" title="tornado.web.Application"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.Application</span></code></a>, handlers may be specified by
(fully-qualified) name instead of importing and passing the class object
itself.</li>
<li>It is now possible to use a custom subclass of <code class="docutils literal"><span class="pre">StaticFileHandler</span></code>
with the <code class="docutils literal"><span class="pre">static_handler_class</span></code> application setting, and this subclass
can override the behavior of the <code class="docutils literal"><span class="pre">static_url</span></code> method.</li>
<li><a class="reference internal" href="index.html#tornado.web.StaticFileHandler" title="tornado.web.StaticFileHandler"><code class="xref py py-obj docutils literal"><span class="pre">StaticFileHandler</span></code></a> subclasses can now override
<code class="docutils literal"><span class="pre">get_cache_time</span></code> to customize cache control behavior.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.get_secure_cookie" title="tornado.web.RequestHandler.get_secure_cookie"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.RequestHandler.get_secure_cookie</span></code></a> now has a <code class="docutils literal"><span class="pre">max_age_days</span></code>
parameter to allow applications to override the default one-month expiration.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.set_cookie" title="tornado.web.RequestHandler.set_cookie"><code class="xref py py-obj docutils literal"><span class="pre">set_cookie</span></code></a> now accepts a <code class="docutils literal"><span class="pre">max_age</span></code> keyword
argument to set the <code class="docutils literal"><span class="pre">max-age</span></code> cookie attribute (note underscore vs dash)</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.set_default_headers" title="tornado.web.RequestHandler.set_default_headers"><code class="xref py py-obj docutils literal"><span class="pre">tornado.web.RequestHandler.set_default_headers</span></code></a> may be overridden to set
headers in a way that does not get reset during error handling.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.add_header" title="tornado.web.RequestHandler.add_header"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.add_header</span></code></a> can now be used to set a header that can
appear multiple times in the response.</li>
<li><a class="reference internal" href="index.html#tornado.web.RequestHandler.flush" title="tornado.web.RequestHandler.flush"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler.flush</span></code></a> can now take a callback for flow control.</li>
<li>The <code class="docutils literal"><span class="pre">application/json</span></code> content type can now be gzipped.</li>
<li>The cookie-signing functions are now accessible as static functions
<code class="docutils literal"><span class="pre">tornado.web.create_signed_value</span></code> and <code class="docutils literal"><span class="pre">tornado.web.decode_signed_value</span></code>.</li>
</ul>
</div>
<div class="section" id="tornado-httpserver">
<h6><code class="docutils literal"><span class="pre">tornado.httpserver</span></code><a class="headerlink" href="#tornado-httpserver" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>To facilitate some advanced multi-process scenarios, <code class="docutils literal"><span class="pre">HTTPServer</span></code>
has a new method <code class="docutils literal"><span class="pre">add_sockets</span></code>, and socket-opening code is
available separately as <a class="reference internal" href="index.html#tornado.netutil.bind_sockets" title="tornado.netutil.bind_sockets"><code class="xref py py-obj docutils literal"><span class="pre">tornado.netutil.bind_sockets</span></code></a>.</li>
<li>The <code class="docutils literal"><span class="pre">cookies</span></code> property is now available on <code class="docutils literal"><span class="pre">tornado.httpserver.HTTPRequest</span></code>
(it is also available in its old location as a property of
<a class="reference internal" href="index.html#tornado.web.RequestHandler" title="tornado.web.RequestHandler"><code class="xref py py-obj docutils literal"><span class="pre">RequestHandler</span></code></a>)</li>
<li><code class="docutils literal"><span class="pre">tornado.httpserver.HTTPServer.bind</span></code> now takes a backlog argument with the
same meaning as <code class="docutils literal"><span class="pre">socket.listen</span></code>.</li>
<li><a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a> can now be run on a unix socket as well
as TCP.</li>
<li>Fixed exception at startup when <code class="docutils literal"><span class="pre">socket.AI_ADDRCONFIG</span></code> is not available,
as on Windows XP</li>
</ul>
</div>
<div class="section" id="ioloop-and-iostream">
<h6><code class="docutils literal"><span class="pre">IOLoop</span></code> and <code class="docutils literal"><span class="pre">IOStream</span></code><a class="headerlink" href="#ioloop-and-iostream" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> performance has been improved, especially for
small synchronous requests.</li>
<li>New methods <code class="docutils literal"><span class="pre">tornado.iostream.IOStream.read_until_close</span></code> and
<code class="docutils literal"><span class="pre">tornado.iostream.IOStream.read_until_regex</span></code>.</li>
<li><code class="docutils literal"><span class="pre">IOStream.read_bytes</span></code> and <code class="docutils literal"><span class="pre">IOStream.read_until_close</span></code> now take a
<code class="docutils literal"><span class="pre">streaming_callback</span></code> argument to return data as it is received rather
than all at once.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop.add_timeout" title="tornado.ioloop.IOLoop.add_timeout"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.add_timeout</span></code></a> now accepts <a class="reference external" href="https://docs.python.org/3.4/library/datetime.html#datetime.timedelta" title="(在 Python v3.4)"><code class="xref py py-obj docutils literal"><span class="pre">datetime.timedelta</span></code></a> objects in addition
to absolute timestamps.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.PeriodicCallback" title="tornado.ioloop.PeriodicCallback"><code class="xref py py-obj docutils literal"><span class="pre">PeriodicCallback</span></code></a> now sticks to the specified period
instead of creeping later due to accumulated errors.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop" title="tornado.ioloop.IOLoop"><code class="xref py py-obj docutils literal"><span class="pre">tornado.ioloop.IOLoop</span></code></a> and <a class="reference internal" href="index.html#tornado.httpclient.HTTPClient" title="tornado.httpclient.HTTPClient"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient.HTTPClient</span></code></a> now have
<code class="docutils literal"><span class="pre">close()</span></code> methods that should be used in applications that create
and destroy many of these objects.</li>
<li><a class="reference internal" href="index.html#tornado.ioloop.IOLoop.install" title="tornado.ioloop.IOLoop.install"><code class="xref py py-obj docutils literal"><span class="pre">IOLoop.install</span></code></a> can now be used to use a custom subclass of IOLoop
as the singleton without monkey-patching.</li>
<li><a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> should now always call the close callback
instead of the connect callback on a connection error.</li>
<li>The <a class="reference internal" href="index.html#tornado.iostream.IOStream" title="tornado.iostream.IOStream"><code class="xref py py-obj docutils literal"><span class="pre">IOStream</span></code></a> close callback will no longer be called while there
are pending read callbacks that can be satisfied with buffered data.</li>
</ul>
</div>
<div class="section" id="tornado-simple-httpclient">
<h6><code class="docutils literal"><span class="pre">tornado.simple_httpclient</span></code><a class="headerlink" href="#tornado-simple-httpclient" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Now supports client SSL certificates with the <code class="docutils literal"><span class="pre">client_key</span></code> and
<code class="docutils literal"><span class="pre">client_cert</span></code> parameters to <a class="reference internal" href="index.html#tornado.httpclient.HTTPRequest" title="tornado.httpclient.HTTPRequest"><code class="xref py py-obj docutils literal"><span class="pre">tornado.httpclient.HTTPRequest</span></code></a></li>
<li>Now takes a maximum buffer size, to allow reading files larger than 100MB</li>
<li>Now works with HTTP 1.0 servers that don&#8217;t send a Content-Length header</li>
<li>The <code class="docutils literal"><span class="pre">allow_nonstandard_methods</span></code> flag on HTTP client requests now
permits methods other than <code class="docutils literal"><span class="pre">POST</span></code> and <code class="docutils literal"><span class="pre">PUT</span></code> to contain bodies.</li>
<li>Fixed file descriptor leaks and multiple callback invocations in
<code class="docutils literal"><span class="pre">SimpleAsyncHTTPClient</span></code></li>
<li>No longer consumes extra connection resources when following redirects.</li>
<li>Now works with buggy web servers that separate headers with <code class="docutils literal"><span class="pre">\n</span></code> instead
of <code class="docutils literal"><span class="pre">\r\n\r\n</span></code>.</li>
<li>Now sets <code class="docutils literal"><span class="pre">response.request_time</span></code> correctly.</li>
<li>Connect timeouts now work correctly.</li>
</ul>
</div>
<div class="section" id="other-modules">
<h6>Other modules<a class="headerlink" href="#other-modules" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference internal" href="index.html#tornado.auth.OpenIdMixin" title="tornado.auth.OpenIdMixin"><code class="xref py py-obj docutils literal"><span class="pre">tornado.auth.OpenIdMixin</span></code></a> now uses the correct realm when the
callback URI is on a different domain.</li>
<li><a class="reference internal" href="index.html#module-tornado.autoreload" title="tornado.autoreload"><code class="xref py py-obj docutils literal"><span class="pre">tornado.autoreload</span></code></a> has a new command-line interface which can be used
to wrap any script.  This replaces the <code class="docutils literal"><span class="pre">--autoreload</span></code> argument to
<a class="reference internal" href="index.html#tornado.testing.main" title="tornado.testing.main"><code class="xref py py-obj docutils literal"><span class="pre">tornado.testing.main</span></code></a> and is more robust against syntax errors.</li>
<li><a class="reference internal" href="index.html#tornado.autoreload.watch" title="tornado.autoreload.watch"><code class="xref py py-obj docutils literal"><span class="pre">tornado.autoreload.watch</span></code></a> can be used to watch files other than
the sources of imported modules.</li>
<li><code class="docutils literal"><span class="pre">tornado.database.Connection</span></code> has new variants of <code class="docutils literal"><span class="pre">execute</span></code> and
<code class="docutils literal"><span class="pre">executemany</span></code> that return the number of rows affected instead of
the last inserted row id.</li>
<li><a class="reference internal" href="index.html#tornado.locale.load_translations" title="tornado.locale.load_translations"><code class="xref py py-obj docutils literal"><span class="pre">tornado.locale.load_translations</span></code></a> now accepts any properly-formatted
locale name, not just those in the predefined <code class="docutils literal"><span class="pre">LOCALE_NAMES</span></code> list.</li>
<li><a class="reference internal" href="index.html#tornado.options.define" title="tornado.options.define"><code class="xref py py-obj docutils literal"><span class="pre">tornado.options.define</span></code></a> now takes a <code class="docutils literal"><span class="pre">group</span></code> parameter to group options
in <code class="docutils literal"><span class="pre">--help</span></code> output.</li>
<li>Template loaders now take a <code class="docutils literal"><span class="pre">namespace</span></code> constructor argument to add
entries to the template namespace.</li>
<li><a class="reference internal" href="index.html#module-tornado.websocket" title="tornado.websocket"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket</span></code></a> now supports the latest (&#8220;hybi-10&#8221;) version of the
protocol (the old version, &#8220;hixie-76&#8221; is still supported; the correct
version is detected automatically).</li>
<li><a class="reference internal" href="index.html#module-tornado.websocket" title="tornado.websocket"><code class="xref py py-obj docutils literal"><span class="pre">tornado.websocket</span></code></a> now works on Python 3</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h6>Bug fixes<a class="headerlink" href="#bug-fixes" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Windows support has been improved.  Windows is still not an officially
supported platform, but the test suite now passes and
<a class="reference internal" href="index.html#module-tornado.autoreload" title="tornado.autoreload"><code class="xref py py-obj docutils literal"><span class="pre">tornado.autoreload</span></code></a> works.</li>
<li>Uploading files whose names contain special characters will now work.</li>
<li>Cookie values containing special characters are now properly quoted
and unquoted.</li>
<li>Multi-line headers are now supported.</li>
<li>Repeated Content-Length headers (which may be added by certain proxies)
are now supported in <a class="reference internal" href="index.html#tornado.httpserver.HTTPServer" title="tornado.httpserver.HTTPServer"><code class="xref py py-obj docutils literal"><span class="pre">HTTPServer</span></code></a>.</li>
<li>Unicode string literals now work in template expressions.</li>
<li>The template <code class="docutils literal"><span class="pre">{%</span> <span class="pre">module</span> <span class="pre">%}</span></code> directive now works even if applications
use a template variable named <code class="docutils literal"><span class="pre">modules</span></code>.</li>
<li>Requests with &#8220;Expect: 100-continue&#8221; now work on python 3</li>
</ul>
</div>
</div>
</div>
<span id="document-releases/v2.0.0"></span><div class="section" id="what-s-new-in-tornado-2-0">
<h4>What&#8217;s new in Tornado 2.0<a class="headerlink" href="#what-s-new-in-tornado-2-0" title="永久链接至标题">¶</a></h4>
<div class="section" id="jun-21-2011">
<h5>Jun 21, 2011<a class="headerlink" href="#jun-21-2011" title="永久链接至标题">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Major</span> <span class="n">changes</span><span class="p">:</span>
<span class="o">*</span> <span class="n">Template</span> <span class="n">output</span> <span class="ow">is</span> <span class="n">automatically</span> <span class="n">escaped</span> <span class="n">by</span> <span class="n">default</span><span class="p">;</span> <span class="n">see</span> <span class="n">backwards</span>
  <span class="n">compatibility</span> <span class="n">note</span> <span class="n">below</span><span class="o">.</span>
<span class="o">*</span> <span class="n">The</span> <span class="n">default</span> <span class="n">AsyncHTTPClient</span> <span class="n">implementation</span> <span class="ow">is</span> <span class="n">now</span> <span class="n">simple_httpclient</span><span class="o">.</span>
<span class="o">*</span> <span class="n">Python</span> <span class="mf">3.2</span> <span class="ow">is</span> <span class="n">now</span> <span class="n">supported</span><span class="o">.</span>

<span class="n">Backwards</span> <span class="n">compatibility</span><span class="p">:</span>
<span class="o">*</span> <span class="n">Template</span> <span class="n">autoescaping</span> <span class="ow">is</span> <span class="n">enabled</span> <span class="n">by</span> <span class="n">default</span><span class="o">.</span>  <span class="n">Applications</span> <span class="n">upgrading</span> <span class="kn">from</span>
  <span class="nn">a</span> <span class="n">previous</span> <span class="n">release</span> <span class="n">of</span> <span class="n">Tornado</span> <span class="n">must</span> <span class="n">either</span> <span class="n">disable</span> <span class="n">autoescaping</span> <span class="ow">or</span> <span class="n">adapt</span>
  <span class="n">their</span> <span class="n">templates</span> <span class="n">to</span> <span class="n">work</span> <span class="k">with</span> <span class="n">it</span><span class="o">.</span>  <span class="n">For</span> <span class="n">most</span> <span class="n">applications</span><span class="p">,</span> <span class="n">the</span> <span class="n">simplest</span>
  <span class="n">way</span> <span class="n">to</span> <span class="n">do</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">to</span> <span class="k">pass</span> <span class="n">autoescape</span><span class="o">=</span><span class="kc">None</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Application</span> <span class="n">constructor</span><span class="o">.</span>
  <span class="n">Note</span> <span class="n">that</span> <span class="n">this</span> <span class="n">affects</span> <span class="n">certain</span> <span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">methods</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">xsrf_form_html</span>
  <span class="ow">and</span> <span class="n">linkify</span><span class="p">,</span> <span class="n">which</span> <span class="n">must</span> <span class="n">now</span> <span class="n">be</span> <span class="n">called</span> <span class="k">with</span> <span class="p">{</span><span class="o">%</span> <span class="n">raw</span> <span class="o">%</span><span class="p">}</span> <span class="n">instead</span> <span class="n">of</span> <span class="p">{}</span>
<span class="o">*</span> <span class="n">Applications</span> <span class="n">that</span> <span class="n">wish</span> <span class="n">to</span> <span class="k">continue</span> <span class="n">using</span> <span class="n">curl_httpclient</span> <span class="n">instead</span> <span class="n">of</span>
  <span class="n">simple_httpclient</span> <span class="n">may</span> <span class="n">do</span> <span class="n">so</span> <span class="n">by</span> <span class="n">calling</span>
    <span class="n">AsyncHTTPClient</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;tornado.curl_httpclient.CurlAsyncHTTPClient&quot;</span><span class="p">)</span>
  <span class="n">at</span> <span class="n">the</span> <span class="n">beginning</span> <span class="n">of</span> <span class="n">the</span> <span class="n">process</span><span class="o">.</span>  <span class="n">Users</span> <span class="n">of</span> <span class="n">Python</span> <span class="mf">2.5</span> <span class="n">will</span> <span class="n">probably</span> <span class="n">want</span>
  <span class="n">to</span> <span class="n">use</span> <span class="n">curl_httpclient</span> <span class="k">as</span> <span class="n">simple_httpclient</span> <span class="n">only</span> <span class="n">supports</span> <span class="n">ssl</span> <span class="n">on</span> <span class="n">Python</span> <span class="mf">2.6</span><span class="o">+.</span>
<span class="o">*</span> <span class="n">Python</span> <span class="mi">3</span> <span class="n">compatibility</span> <span class="n">involved</span> <span class="n">many</span> <span class="n">changes</span> <span class="n">throughout</span> <span class="n">the</span> <span class="n">codebase</span><span class="p">,</span>
  <span class="n">so</span> <span class="n">users</span> <span class="n">are</span> <span class="n">encouraged</span> <span class="n">to</span> <span class="n">test</span> <span class="n">their</span> <span class="n">applications</span> <span class="n">more</span> <span class="n">thoroughly</span> <span class="n">than</span>
  <span class="n">usual</span> <span class="n">when</span> <span class="n">upgrading</span> <span class="n">to</span> <span class="n">this</span> <span class="n">release</span><span class="o">.</span>

<span class="n">Other</span> <span class="n">changes</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">release</span><span class="p">:</span>
<span class="o">*</span> <span class="n">Templates</span> <span class="n">support</span> <span class="n">several</span> <span class="n">new</span> <span class="n">directives</span><span class="p">:</span>
  <span class="o">-</span> <span class="p">{</span><span class="o">%</span> <span class="n">autoescape</span> <span class="o">...%</span><span class="p">}</span> <span class="n">to</span> <span class="n">control</span> <span class="n">escaping</span> <span class="n">behavior</span>
  <span class="o">-</span> <span class="p">{</span><span class="o">%</span> <span class="n">raw</span> <span class="o">...</span> <span class="o">%</span><span class="p">}</span> <span class="k">for</span> <span class="n">unescaped</span> <span class="n">output</span>
  <span class="o">-</span> <span class="p">{</span><span class="o">%</span> <span class="n">module</span> <span class="o">...</span> <span class="o">%</span><span class="p">}</span> <span class="k">for</span> <span class="n">calling</span> <span class="n">UIModules</span>
<span class="o">*</span> <span class="p">{</span><span class="o">%</span> <span class="n">module</span> <span class="n">Template</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">%</span><span class="p">}</span> <span class="n">may</span> <span class="n">now</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">call</span> <span class="n">another</span>
  <span class="n">template</span> <span class="k">with</span> <span class="n">an</span> <span class="n">independent</span> <span class="n">namespace</span>
<span class="o">*</span> <span class="n">All</span> <span class="n">IOStream</span> <span class="n">callbacks</span> <span class="n">are</span> <span class="n">now</span> <span class="n">run</span> <span class="n">directly</span> <span class="n">on</span> <span class="n">the</span> <span class="n">IOLoop</span> <span class="n">via</span> <span class="n">add_callback</span><span class="o">.</span>
<span class="o">*</span> <span class="n">HTTPServer</span> <span class="n">now</span> <span class="n">supports</span> <span class="n">IPv6</span> <span class="n">where</span> <span class="n">available</span><span class="o">.</span>  <span class="n">To</span> <span class="n">disable</span><span class="p">,</span> <span class="k">pass</span>
  <span class="n">family</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span> <span class="n">to</span> <span class="n">HTTPServer</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span><span class="o">.</span>
<span class="o">*</span> <span class="n">HTTPClient</span> <span class="n">now</span> <span class="n">supports</span> <span class="n">IPv6</span><span class="p">,</span> <span class="n">configurable</span> <span class="n">via</span> <span class="n">allow_ipv6</span><span class="o">=</span><span class="nb">bool</span> <span class="n">on</span> <span class="n">the</span>
  <span class="n">HTTPRequest</span><span class="o">.</span>  <span class="n">allow_ipv6</span> <span class="n">defaults</span> <span class="n">to</span> <span class="n">false</span> <span class="n">on</span> <span class="n">simple_httpclient</span> <span class="ow">and</span> <span class="n">true</span>
  <span class="n">on</span> <span class="n">curl_httpclient</span><span class="o">.</span>
<span class="o">*</span> <span class="n">RequestHandlers</span> <span class="n">can</span> <span class="n">use</span> <span class="n">an</span> <span class="n">encoding</span> <span class="n">other</span> <span class="n">than</span> <span class="n">utf</span><span class="o">-</span><span class="mi">8</span> <span class="k">for</span> <span class="n">query</span> <span class="n">parameters</span>
  <span class="n">by</span> <span class="n">overriding</span> <span class="n">decode_argument</span><span class="p">()</span>
<span class="o">*</span> <span class="n">Performance</span> <span class="n">improvements</span><span class="p">,</span> <span class="n">especially</span> <span class="k">for</span> <span class="n">applications</span> <span class="n">that</span> <span class="n">use</span> <span class="n">a</span> <span class="n">lot</span> <span class="n">of</span>
  <span class="n">IOLoop</span> <span class="n">timeouts</span>
<span class="o">*</span> <span class="n">HTTP</span> <span class="n">OPTIONS</span> <span class="n">method</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">requires</span> <span class="n">an</span> <span class="n">XSRF</span> <span class="n">token</span><span class="o">.</span>
<span class="o">*</span> <span class="n">JSON</span> <span class="n">output</span> <span class="p">(</span><span class="n">RequestHandler</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">dict</span><span class="p">))</span> <span class="n">now</span> <span class="n">sets</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span> <span class="n">to</span>
  <span class="n">application</span><span class="o">/</span><span class="n">json</span>
<span class="o">*</span> <span class="n">Etag</span> <span class="n">computation</span> <span class="n">can</span> <span class="n">now</span> <span class="n">be</span> <span class="n">customized</span> <span class="ow">or</span> <span class="n">disabled</span> <span class="n">by</span> <span class="n">overriding</span>
  <span class="n">RequestHandler</span><span class="o">.</span><span class="n">compute_etag</span>
<span class="o">*</span> <span class="n">USE_SIMPLE_HTTPCLIENT</span> <span class="n">environment</span> <span class="n">variable</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">supported</span><span class="o">.</span>
  <span class="n">Use</span> <span class="n">AsyncHTTPClient</span><span class="o">.</span><span class="n">configure</span> <span class="n">instead</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<span id="document-releases/v1.2.1"></span><div class="section" id="what-s-new-in-tornado-1-2-1">
<h4>What&#8217;s new in Tornado 1.2.1<a class="headerlink" href="#what-s-new-in-tornado-1-2-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="mar-3-2011">
<h5>Mar 3, 2011<a class="headerlink" href="#mar-3-2011" title="永久链接至标题">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">We</span> <span class="n">are</span> <span class="n">pleased</span> <span class="n">to</span> <span class="n">announce</span> <span class="n">the</span> <span class="n">release</span> <span class="n">of</span> <span class="n">Tornado</span> <span class="mf">1.2</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="n">available</span> <span class="kn">from</span>
<span class="nn">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">downloads</span><span class="o">/</span><span class="n">facebook</span><span class="o">/</span><span class="n">tornado</span><span class="o">/</span><span class="n">tornado</span><span class="o">-</span><span class="mf">1.2</span><span class="o">.</span><span class="mf">1.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>

<span class="n">This</span> <span class="n">release</span> <span class="n">contains</span> <span class="n">only</span> <span class="n">two</span> <span class="n">small</span> <span class="n">changes</span> <span class="n">relative</span> <span class="n">to</span> <span class="n">version</span> <span class="mf">1.2</span><span class="p">:</span>
<span class="o">*</span> <span class="n">FacebookGraphMixin</span> <span class="n">has</span> <span class="n">been</span> <span class="n">updated</span> <span class="n">to</span> <span class="n">work</span> <span class="k">with</span> <span class="n">a</span> <span class="n">recent</span> <span class="n">change</span> <span class="n">to</span> <span class="n">the</span>
  <span class="n">Facebook</span> <span class="n">API</span><span class="o">.</span>
<span class="o">*</span> <span class="n">Running</span> <span class="s2">&quot;setup.py install&quot;</span> <span class="n">will</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">attempt</span> <span class="n">to</span> <span class="n">automatically</span>
  <span class="n">install</span> <span class="n">pycurl</span><span class="o">.</span>  <span class="n">This</span> <span class="n">wasn</span><span class="s1">&#39;t working well on platforms where the best way</span>
  <span class="n">to</span> <span class="n">install</span> <span class="n">pycurl</span> <span class="ow">is</span> <span class="n">via</span> <span class="n">something</span> <span class="n">like</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">easy_install</span><span class="o">.</span>

<span class="n">This</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">important</span> <span class="n">upgrade</span> <span class="k">if</span> <span class="n">you</span> <span class="n">are</span> <span class="n">using</span> <span class="n">FacebookGraphMixin</span><span class="p">,</span> <span class="n">but</span>
<span class="n">otherwise</span> <span class="n">it</span> <span class="n">can</span> <span class="n">be</span> <span class="n">safely</span> <span class="n">ignored</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<span id="document-releases/v1.2.0"></span><div class="section" id="what-s-new-in-tornado-1-2">
<h4>What&#8217;s new in Tornado 1.2<a class="headerlink" href="#what-s-new-in-tornado-1-2" title="永久链接至标题">¶</a></h4>
<div class="section" id="feb-20-2011">
<h5>Feb 20, 2011<a class="headerlink" href="#feb-20-2011" title="永久链接至标题">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span>We are pleased to announce the release of Tornado 1.2, available from
https://github.com/downloads/facebook/tornado/tornado-1.2.tar.gz

Backwards compatibility notes:
* This release includes the backwards-incompatible security change from
  version 1.1.1.  Users upgrading from 1.1 or earlier should read the
  release notes from that release:
  http://groups.google.com/group/python-tornado/browse_thread/thread/b36191c781580cde
* StackContexts that do something other than catch exceptions may need to
  be modified to be reentrant.
  https://github.com/tornadoweb/tornado/commit/7a7e24143e77481d140fb5579bc67e4c45cbcfad
* When XSRF tokens are used, the token must also be present on PUT and
  DELETE requests (anything but GET and HEAD)

New features:
* A new HTTP client implementation is available in the module
  tornado.simple_httpclient.  This HTTP client does not depend on pycurl.
  It has not yet been tested extensively in production, but is intended
  to eventually replace the pycurl-based HTTP client in a future release of
  Tornado.  To transparently replace tornado.httpclient.AsyncHTTPClient with
  this new implementation, you can set the environment variable
  USE_SIMPLE_HTTPCLIENT=1 (note that the next release of Tornado will
  likely include a different way to select HTTP client implementations)
* Request logging is now done by the Application rather than the
  RequestHandler.  Logging behavior may be customized by either overriding
  Application.log_request in a subclass or by passing log_function
  as an Application setting
* Application.listen(port): Convenience method as an alternative to
  explicitly creating an HTTPServer
* tornado.escape.linkify(): Wrap urls in &lt;a&gt; tags
* RequestHandler.create_signed_value(): Create signatures like the
  secure_cookie methods without setting cookies.
* tornado.testing.get_unused_port(): Returns a port selected in the same
  way as inAsyncHTTPTestCase
* AsyncHTTPTestCase.fetch(): Convenience method for synchronous fetches
* IOLoop.set_blocking_signal_threshold(): Set a callback to be run when
  the IOLoop is blocked.
* IOStream.connect(): Asynchronously connect a client socket
* AsyncHTTPClient.handle_callback_exception(): May be overridden
  in subclass for custom error handling
* httpclient.HTTPRequest has two new keyword arguments, validate_cert and
  ca_certs. Setting validate_cert=False will disable all certificate checks
  when fetching https urls.  ca_certs may be set to a filename containing
  trusted certificate authorities (defaults will be used if this is
  unspecified)
* HTTPRequest.get_ssl_certificate(): Returns the client&#39;s SSL certificate
  (if client certificates were requested in the server&#39;s ssl_options
* StaticFileHandler can be configured to return a default file (e.g.
  index.html) when a directory is requested
* Template directives of the form &quot;{% from x import y %}&quot; are now
  supported (in addition to the existing support for &quot;{% import x
  %}&quot;
* FacebookGraphMixin.get_authenticated_user now accepts a new
  parameter &#39;extra_fields&#39; which may be used to request additional
  information about the user

Bug fixes:
* auth: Fixed KeyError with Facebook offline_access
* auth: Uses request.uri instead of request.path as the default redirect
  so that parameters are preserved.
* escape: xhtml_escape() now returns a unicode string, not
  utf8-encoded bytes
* ioloop: Callbacks added with add_callback are now run in the order they
  were added
* ioloop: PeriodicCallback.stop can now be called from inside the callback.
* iostream: Fixed several bugs in SSLIOStream
* iostream: Detect when the other side has closed the connection even with
  the select()-based IOLoop
* iostream: read_bytes(0) now works as expected
* iostream: Fixed bug when writing large amounts of data on windows
* iostream: Fixed infinite loop that could occur with unhandled exceptions
* httpclient: Fix bugs when some requests use proxies and others don&#39;t
* httpserver: HTTPRequest.protocol is now set correctly when using the
  built-in SSL support
* httpserver: When using multiple processes, the standard library&#39;s
  random number generator is re-seeded in each child process
* httpserver: With xheaders enabled, X-Forwarded-Proto is supported as an
  alternative to X-Scheme
* httpserver: Fixed bugs in multipart/form-data parsing
* locale: format_date() now behaves sanely with dates in the future
* locale: Updates to the language list
* stack_context: Fixed bug with contexts leaking through reused IOStreams
* stack_context: Simplified semantics and improved performance
* web: The order of css_files from UIModules is now preserved
* web: Fixed error with default_host redirect
* web: StaticFileHandler works when os.path.sep != &#39;/&#39; (i.e. on Windows)
* web: Fixed a caching-related bug in StaticFileHandler when a file&#39;s
  timestamp has changed but its contents have not.
* web: Fixed bugs with HEAD requests and e.g. Etag headers
* web: Fix bugs when different handlers have different static_paths
* web: @removeslash will no longer cause a redirect loop when applied to the
  root path
* websocket: Now works over SSL
* websocket: Improved compatibility with proxies

Many thanks to everyone who contributed patches, bug reports, and feedback
that went into this release!

-Ben
</pre></div>
</div>
</div>
</div>
<span id="document-releases/v1.1.1"></span><div class="section" id="what-s-new-in-tornado-1-1-1">
<h4>What&#8217;s new in Tornado 1.1.1<a class="headerlink" href="#what-s-new-in-tornado-1-1-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="feb-8-2011">
<h5>Feb 8, 2011<a class="headerlink" href="#feb-8-2011" title="永久链接至标题">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Tornado</span> <span class="mf">1.1</span><span class="o">.</span><span class="mi">1</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">BACKWARDS</span><span class="o">-</span><span class="n">INCOMPATIBLE</span> <span class="n">security</span> <span class="n">update</span> <span class="n">that</span> <span class="n">fixes</span> <span class="n">an</span>
<span class="n">XSRF</span> <span class="n">vulnerability</span><span class="o">.</span>  <span class="n">It</span> <span class="ow">is</span> <span class="n">available</span> <span class="n">at</span>
<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">downloads</span><span class="o">/</span><span class="n">facebook</span><span class="o">/</span><span class="n">tornado</span><span class="o">/</span><span class="n">tornado</span><span class="o">-</span><span class="mf">1.1</span><span class="o">.</span><span class="mf">1.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>

<span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">backwards</span><span class="o">-</span><span class="n">incompatible</span> <span class="n">change</span><span class="o">.</span>  <span class="n">Applications</span> <span class="n">that</span> <span class="n">previously</span>
<span class="n">relied</span> <span class="n">on</span> <span class="n">a</span> <span class="n">blanket</span> <span class="n">exception</span> <span class="k">for</span> <span class="n">XMLHTTPRequest</span> <span class="n">may</span> <span class="n">need</span> <span class="n">to</span> <span class="n">be</span> <span class="n">modified</span>
<span class="n">to</span> <span class="n">explicitly</span> <span class="n">include</span> <span class="n">the</span> <span class="n">XSRF</span> <span class="n">token</span> <span class="n">when</span> <span class="n">making</span> <span class="n">ajax</span> <span class="n">requests</span><span class="o">.</span>

<span class="n">The</span> <span class="n">tornado</span> <span class="n">chat</span> <span class="n">demo</span> <span class="n">application</span> <span class="n">demonstrates</span> <span class="n">one</span> <span class="n">way</span> <span class="n">of</span> <span class="n">adding</span> <span class="n">this</span>
<span class="n">token</span> <span class="p">(</span><span class="n">specifically</span> <span class="n">the</span> <span class="n">function</span> <span class="n">postJSON</span> <span class="ow">in</span> <span class="n">demos</span><span class="o">/</span><span class="n">chat</span><span class="o">/</span><span class="n">static</span><span class="o">/</span><span class="n">chat</span><span class="o">.</span><span class="n">js</span><span class="p">)</span><span class="o">.</span>

<span class="n">More</span> <span class="n">information</span> <span class="n">about</span> <span class="n">this</span> <span class="n">change</span> <span class="ow">and</span> <span class="n">its</span> <span class="n">justification</span> <span class="n">can</span> <span class="n">be</span> <span class="n">found</span> <span class="n">at</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">djangoproject</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">weblog</span><span class="o">/</span><span class="mi">2011</span><span class="o">/</span><span class="n">feb</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="n">security</span><span class="o">/</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">weblog</span><span class="o">.</span><span class="n">rubyonrails</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mi">2011</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="mi">8</span><span class="o">/</span><span class="n">csrf</span><span class="o">-</span><span class="n">protection</span><span class="o">-</span><span class="n">bypass</span><span class="o">-</span><span class="ow">in</span><span class="o">-</span><span class="n">ruby</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">rails</span>
</pre></div>
</div>
</div>
</div>
<span id="document-releases/v1.1.0"></span><div class="section" id="what-s-new-in-tornado-1-1">
<h4>What&#8217;s new in Tornado 1.1<a class="headerlink" href="#what-s-new-in-tornado-1-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="sep-7-2010">
<h5>Sep 7, 2010<a class="headerlink" href="#sep-7-2010" title="永久链接至标题">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span>We are pleased to announce the release of Tornado 1.1, available from
https://github.com/downloads/facebook/tornado/tornado-1.1.tar.gz

Changes in this release:
* RequestHandler.async_callback and related functions in other classes
  are no longer needed in most cases (although it&#39;s harmless to continue
  using them).  Uncaught exceptions will now cause the request to be closed
  even in a callback.  If you&#39;re curious how this works, see the new
  tornado.stack_context module.
* The new tornado.testing module contains support for unit testing
  asynchronous IOLoop-based code.
* AsyncHTTPClient has been rewritten (the new implementation was
  available as AsyncHTTPClient2 in Tornado 1.0; both names are
  supported for backwards compatibility).
* The tornado.auth module has had a number of updates, including support
  for OAuth 2.0 and the Facebook Graph API, and upgrading Twitter and
  Google support to OAuth 1.0a.
* The websocket module is back and supports the latest version (76) of the
  websocket protocol.  Note that this module&#39;s interface is different
  from the websocket module that appeared in pre-1.0 versions of Tornado.
* New method RequestHandler.initialize() can be overridden in subclasses
  to simplify handling arguments from URLSpecs.  The sequence of methods
  called during initialization is documented at
  http://tornadoweb.org/documentation#overriding-requesthandler-methods
* get_argument() and related methods now work on PUT requests in addition
  to POST.
* The httpclient module now supports HTTP proxies.
* When HTTPServer is run in SSL mode, the SSL handshake is now non-blocking.
* Many smaller bug fixes and documentation updates

Backwards-compatibility notes:
* While most users of Tornado should not have to deal with the stack_context
  module directly, users of worker thread pools and similar constructs may
  need to use stack_context.wrap and/or NullContext to avoid memory leaks.
* The new AsyncHTTPClient still works with libcurl version 7.16.x, but it
  performs better when both libcurl and pycurl are at least version 7.18.2.
* OAuth transactions started under previous versions of the auth module
  cannot be completed under the new module.  This applies only to the
  initial authorization process; once an authorized token is issued that
  token works with either version.

Many thanks to everyone who contributed patches, bug reports, and feedback
that went into this release!

-Ben
</pre></div>
</div>
</div>
</div>
<span id="document-releases/v1.0.1"></span><div class="section" id="what-s-new-in-tornado-1-0-1">
<h4>What&#8217;s new in Tornado 1.0.1<a class="headerlink" href="#what-s-new-in-tornado-1-0-1" title="永久链接至标题">¶</a></h4>
<div class="section" id="aug-13-2010">
<h5>Aug 13, 2010<a class="headerlink" href="#aug-13-2010" title="永久链接至标题">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">This</span> <span class="n">release</span> <span class="n">fixes</span> <span class="n">a</span> <span class="n">bug</span> <span class="k">with</span> <span class="n">RequestHandler</span><span class="o">.</span><span class="n">get_secure_cookie</span><span class="p">,</span> <span class="n">which</span> <span class="n">would</span>
<span class="ow">in</span> <span class="n">some</span> <span class="n">circumstances</span> <span class="n">allow</span> <span class="n">an</span> <span class="n">attacker</span> <span class="n">to</span> <span class="n">tamper</span> <span class="k">with</span> <span class="n">data</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">the</span>
<span class="n">cookie</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<span id="document-releases/v1.0.0"></span><div class="section" id="what-s-new-in-tornado-1-0">
<h4>What&#8217;s new in Tornado 1.0<a class="headerlink" href="#what-s-new-in-tornado-1-0" title="永久链接至标题">¶</a></h4>
<div class="section" id="july-22-2010">
<h5>July 22, 2010<a class="headerlink" href="#july-22-2010" title="永久链接至标题">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span>We are pleased to announce the release of Tornado 1.0, available
from
https://github.com/downloads/facebook/tornado/tornado-1.0.tar.gz.
There have been many changes since version 0.2; here are some of
the highlights:

New features:
* Improved support for running other WSGI applications in a
  Tornado server (tested with Django and CherryPy)
* Improved performance on Mac OS X and BSD (kqueue-based IOLoop),
  and experimental support for win32
* Rewritten AsyncHTTPClient available as
  tornado.httpclient.AsyncHTTPClient2 (this will become the
  default in a future release)
* Support for standard .mo files in addition to .csv in the locale
  module
* Pre-forking support for running multiple Tornado processes at
  once (see HTTPServer.start())
* SSL and gzip support in HTTPServer
* reverse_url() function refers to urls from the Application
  config by name from templates and RequestHandlers
* RequestHandler.on_connection_close() callback is called when the
  client has closed the connection (subject to limitations of the
  underlying network stack, any proxies, etc)
* Static files can now be served somewhere other than /static/ via
  the static_url_prefix application setting
* URL regexes can now use named groups (&quot;(?P&lt;name&gt;)&quot;) to pass
  arguments to get()/post() via keyword instead of position
* HTTP header dictionary-like objects now support multiple values
  for the same header via the get_all() and add() methods.
* Several new options in the httpclient module, including
  prepare_curl_callback and header_callback
* Improved logging configuration in tornado.options.
* UIModule.html_body() can be used to return html to be inserted
  at the end of the document body.

Backwards-incompatible changes:
* RequestHandler.get_error_html() now receives the exception
  object as a keyword argument if the error was caused by an
  uncaught exception.
* Secure cookies are now more secure, but incompatible with
  cookies set by Tornado 0.2.  To read cookies set by older
  versions of Tornado, pass include_name=False to
  RequestHandler.get_secure_cookie()
* Parameters passed to RequestHandler.get/post() by extraction
  from the path now have %-escapes decoded, for consistency with
  the processing that was already done with other query
  parameters.

Many thanks to everyone who contributed patches, bug reports, and
feedback that went into this release!

-Ben
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">索引</span></a></li>
<li><a class="reference internal" href="py-modindex.html"><span class="std std-ref">模块索引</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">搜索页面</span></a></li>
</ul>
</div>
<div class="section" id="id6">
<h2>讨论和支持<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>你可以讨论Tornado在 <a class="reference external" href="http://groups.google.com/group/python-tornado">Tornado 开发者邮件列表</a>, 报告bug在 <a class="reference external" href="https://github.com/tornadoweb/tornado/issues">GitHub issue tracker</a>.</p>
<p>其他资源可以在 <a class="reference external" href="https://github.com/tornadoweb/tornado/wiki/Links">Tornado wiki</a> 上找到. 新版本会宣布在 <a class="reference external" href="http://groups.google.com/group/python-tornado-announce">announcements mailing list</a>.</p>
<p>Tornado is available under
the <a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License, Version 2.0</a>.</p>
<p>This web site and all documentation is licensed under <a class="reference external" href="http://creativecommons.org/licenses/by/3.0/">Creative
Commons 3.0</a>.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2009-2017, The Tornado Authors.
      
        <span class="commit">
          Revision <code>14f4412a</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/zh/latest/">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="//readthedocs.org/projects/tornado-zh/downloads/htmlzip/latest/">htmlzip</a></dd>
        
          <dd><a href="//readthedocs.org/projects/tornado-zh/downloads/epub/latest/">epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/tornado-zh/?fromdocs=tornado-zh">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/tornado-zh/?fromdocs=tornado-zh">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'4.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>